(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var Ne=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ms(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Li(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var PI={exports:{}},ig={},RI={exports:{}},ht={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nh=Symbol.for("react.element"),wD=Symbol.for("react.portal"),CD=Symbol.for("react.fragment"),xD=Symbol.for("react.strict_mode"),ED=Symbol.for("react.profiler"),TD=Symbol.for("react.provider"),PD=Symbol.for("react.context"),RD=Symbol.for("react.forward_ref"),_D=Symbol.for("react.suspense"),ID=Symbol.for("react.memo"),AD=Symbol.for("react.lazy"),qE=Symbol.iterator;function kD(n){return n===null||typeof n!="object"?null:(n=qE&&n[qE]||n["@@iterator"],typeof n=="function"?n:null)}var _I={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},II=Object.assign,AI={};function lc(n,e,t){this.props=n,this.context=e,this.refs=AI,this.updater=t||_I}lc.prototype.isReactComponent={};lc.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};lc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function kI(){}kI.prototype=lc.prototype;function qw(n,e,t){this.props=n,this.context=e,this.refs=AI,this.updater=t||_I}var Uw=qw.prototype=new kI;Uw.constructor=qw;II(Uw,lc.prototype);Uw.isPureReactComponent=!0;var UE=Array.isArray,OI=Object.prototype.hasOwnProperty,zw={current:null},FI={key:!0,ref:!0,__self:!0,__source:!0};function NI(n,e,t){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)OI.call(e,r)&&!FI.hasOwnProperty(r)&&(i[r]=e[r]);var u=arguments.length-2;if(u===1)i.children=t;else if(1<u){for(var d=Array(u),f=0;f<u;f++)d[f]=arguments[f+2];i.children=d}if(n&&n.defaultProps)for(r in u=n.defaultProps,u)i[r]===void 0&&(i[r]=u[r]);return{$$typeof:Nh,type:n,key:s,ref:o,props:i,_owner:zw.current}}function OD(n,e){return{$$typeof:Nh,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function $w(n){return typeof n=="object"&&n!==null&&n.$$typeof===Nh}function FD(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var zE=/\/+/g;function Z0(n,e){return typeof n=="object"&&n!==null&&n.key!=null?FD(""+n.key):e.toString(36)}function jp(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Nh:case wD:o=!0}}if(o)return o=n,i=i(o),n=r===""?"."+Z0(o,0):r,UE(i)?(t="",n!=null&&(t=n.replace(zE,"$&/")+"/"),jp(i,e,t,"",function(f){return f})):i!=null&&($w(i)&&(i=OD(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(zE,"$&/")+"/")+n)),e.push(i)),1;if(o=0,r=r===""?".":r+":",UE(n))for(var u=0;u<n.length;u++){s=n[u];var d=r+Z0(s,u);o+=jp(s,e,t,d,i)}else if(d=kD(n),typeof d=="function")for(n=d.call(n),u=0;!(s=n.next()).done;)s=s.value,d=r+Z0(s,u++),o+=jp(s,e,t,d,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Yf(n,e,t){if(n==null)return n;var r=[],i=0;return jp(n,r,"","",function(s){return e.call(t,s,i++)}),r}function ND(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Lr={current:null},qp={transition:null},DD={ReactCurrentDispatcher:Lr,ReactCurrentBatchConfig:qp,ReactCurrentOwner:zw};ht.Children={map:Yf,forEach:function(n,e,t){Yf(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Yf(n,function(){e++}),e},toArray:function(n){return Yf(n,function(e){return e})||[]},only:function(n){if(!$w(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};ht.Component=lc;ht.Fragment=CD;ht.Profiler=ED;ht.PureComponent=qw;ht.StrictMode=xD;ht.Suspense=_D;ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=DD;ht.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=II({},n.props),i=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=zw.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var u=n.type.defaultProps;for(d in e)OI.call(e,d)&&!FI.hasOwnProperty(d)&&(r[d]=e[d]===void 0&&u!==void 0?u[d]:e[d])}var d=arguments.length-2;if(d===1)r.children=t;else if(1<d){u=Array(d);for(var f=0;f<d;f++)u[f]=arguments[f+2];r.children=u}return{$$typeof:Nh,type:n.type,key:i,ref:s,props:r,_owner:o}};ht.createContext=function(n){return n={$$typeof:PD,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:TD,_context:n},n.Consumer=n};ht.createElement=NI;ht.createFactory=function(n){var e=NI.bind(null,n);return e.type=n,e};ht.createRef=function(){return{current:null}};ht.forwardRef=function(n){return{$$typeof:RD,render:n}};ht.isValidElement=$w;ht.lazy=function(n){return{$$typeof:AD,_payload:{_status:-1,_result:n},_init:ND}};ht.memo=function(n,e){return{$$typeof:ID,type:n,compare:e===void 0?null:e}};ht.startTransition=function(n){var e=qp.transition;qp.transition={};try{n()}finally{qp.transition=e}};ht.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ht.useCallback=function(n,e){return Lr.current.useCallback(n,e)};ht.useContext=function(n){return Lr.current.useContext(n)};ht.useDebugValue=function(){};ht.useDeferredValue=function(n){return Lr.current.useDeferredValue(n)};ht.useEffect=function(n,e){return Lr.current.useEffect(n,e)};ht.useId=function(){return Lr.current.useId()};ht.useImperativeHandle=function(n,e,t){return Lr.current.useImperativeHandle(n,e,t)};ht.useInsertionEffect=function(n,e){return Lr.current.useInsertionEffect(n,e)};ht.useLayoutEffect=function(n,e){return Lr.current.useLayoutEffect(n,e)};ht.useMemo=function(n,e){return Lr.current.useMemo(n,e)};ht.useReducer=function(n,e,t){return Lr.current.useReducer(n,e,t)};ht.useRef=function(n){return Lr.current.useRef(n)};ht.useState=function(n){return Lr.current.useState(n)};ht.useSyncExternalStore=function(n,e,t){return Lr.current.useSyncExternalStore(n,e,t)};ht.useTransition=function(){return Lr.current.useTransition()};ht.version="18.2.0";RI.exports=ht;var $t=RI.exports;const LD=Ms($t);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MD=$t,BD=Symbol.for("react.element"),jD=Symbol.for("react.fragment"),qD=Object.prototype.hasOwnProperty,UD=MD.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,zD={key:!0,ref:!0,__self:!0,__source:!0};function DI(n,e,t){var r,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)qD.call(e,r)&&!zD.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:BD,type:n,key:s,ref:o,props:i,_owner:UD.current}}ig.Fragment=jD;ig.jsx=DI;ig.jsxs=DI;PI.exports=ig;var Hw=PI.exports;const $D=Hw.Fragment,Gn=Hw.jsx,$E=Hw.jsxs;var LI={exports:{}},gi={},MI={exports:{}},BI={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(Re,je){var Ae=Re.length;Re.push(je);e:for(;0<Ae;){var Ce=Ae-1>>>1,Ve=Re[Ce];if(0<i(Ve,je))Re[Ce]=je,Re[Ae]=Ve,Ae=Ce;else break e}}function t(Re){return Re.length===0?null:Re[0]}function r(Re){if(Re.length===0)return null;var je=Re[0],Ae=Re.pop();if(Ae!==je){Re[0]=Ae;e:for(var Ce=0,Ve=Re.length,qe=Ve>>>1;Ce<qe;){var lt=2*(Ce+1)-1,ee=Re[lt],bt=lt+1,Et=Re[bt];if(0>i(ee,Ae))bt<Ve&&0>i(Et,ee)?(Re[Ce]=Et,Re[bt]=Ae,Ce=bt):(Re[Ce]=ee,Re[lt]=Ae,Ce=lt);else if(bt<Ve&&0>i(Et,Ae))Re[Ce]=Et,Re[bt]=Ae,Ce=bt;else break e}}return je}function i(Re,je){var Ae=Re.sortIndex-je.sortIndex;return Ae!==0?Ae:Re.id-je.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,u=o.now();n.unstable_now=function(){return o.now()-u}}var d=[],f=[],m=1,g=null,P=3,D=!1,M=!1,U=!1,j=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function z(Re){for(var je=t(f);je!==null;){if(je.callback===null)r(f);else if(je.startTime<=Re)r(f),je.sortIndex=je.expirationTime,e(d,je);else break;je=t(f)}}function K(Re){if(U=!1,z(Re),!M)if(t(d)!==null)M=!0,De(ie);else{var je=t(f);je!==null&&Xe(K,je.startTime-Re)}}function ie(Re,je){M=!1,U&&(U=!1,E(X),X=-1),D=!0;var Ae=P;try{for(z(je),g=t(d);g!==null&&(!(g.expirationTime>je)||Re&&!we());){var Ce=g.callback;if(typeof Ce=="function"){g.callback=null,P=g.priorityLevel;var Ve=Ce(g.expirationTime<=je);je=n.unstable_now(),typeof Ve=="function"?g.callback=Ve:g===t(d)&&r(d),z(je)}else r(d);g=t(d)}if(g!==null)var qe=!0;else{var lt=t(f);lt!==null&&Xe(K,lt.startTime-je),qe=!1}return qe}finally{g=null,P=Ae,D=!1}}var he=!1,pe=null,X=-1,fe=5,ge=-1;function we(){return!(n.unstable_now()-ge<fe)}function be(){if(pe!==null){var Re=n.unstable_now();ge=Re;var je=!0;try{je=pe(!0,Re)}finally{je?He():(he=!1,pe=null)}}else he=!1}var He;if(typeof k=="function")He=function(){k(be)};else if(typeof MessageChannel<"u"){var ce=new MessageChannel,ve=ce.port2;ce.port1.onmessage=be,He=function(){ve.postMessage(null)}}else He=function(){j(be,0)};function De(Re){pe=Re,he||(he=!0,He())}function Xe(Re,je){X=j(function(){Re(n.unstable_now())},je)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Re){Re.callback=null},n.unstable_continueExecution=function(){M||D||(M=!0,De(ie))},n.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):fe=0<Re?Math.floor(1e3/Re):5},n.unstable_getCurrentPriorityLevel=function(){return P},n.unstable_getFirstCallbackNode=function(){return t(d)},n.unstable_next=function(Re){switch(P){case 1:case 2:case 3:var je=3;break;default:je=P}var Ae=P;P=je;try{return Re()}finally{P=Ae}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Re,je){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var Ae=P;P=Re;try{return je()}finally{P=Ae}},n.unstable_scheduleCallback=function(Re,je,Ae){var Ce=n.unstable_now();switch(typeof Ae=="object"&&Ae!==null?(Ae=Ae.delay,Ae=typeof Ae=="number"&&0<Ae?Ce+Ae:Ce):Ae=Ce,Re){case 1:var Ve=-1;break;case 2:Ve=250;break;case 5:Ve=1073741823;break;case 4:Ve=1e4;break;default:Ve=5e3}return Ve=Ae+Ve,Re={id:m++,callback:je,priorityLevel:Re,startTime:Ae,expirationTime:Ve,sortIndex:-1},Ae>Ce?(Re.sortIndex=Ae,e(f,Re),t(d)===null&&Re===t(f)&&(U?(E(X),X=-1):U=!0,Xe(K,Ae-Ce))):(Re.sortIndex=Ve,e(d,Re),M||D||(M=!0,De(ie))),Re},n.unstable_shouldYield=we,n.unstable_wrapCallback=function(Re){var je=P;return function(){var Ae=P;P=je;try{return Re.apply(this,arguments)}finally{P=Ae}}}})(BI);MI.exports=BI;var HD=MI.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jI=$t,fi=HD;function Le(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var qI=new Set,nh={};function Tu(n,e){Hl(n,e),Hl(n+"Capture",e)}function Hl(n,e){for(nh[n]=e,n=0;n<e.length;n++)qI.add(e[n])}var lo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),T1=Object.prototype.hasOwnProperty,VD=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,HE={},VE={};function WD(n){return T1.call(VE,n)?!0:T1.call(HE,n)?!1:VD.test(n)?VE[n]=!0:(HE[n]=!0,!1)}function GD(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function KD(n,e,t,r){if(e===null||typeof e>"u"||GD(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Mr(n,e,t,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Zn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Zn[n]=new Mr(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Zn[e]=new Mr(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Zn[n]=new Mr(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Zn[n]=new Mr(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Zn[n]=new Mr(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Zn[n]=new Mr(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Zn[n]=new Mr(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Zn[n]=new Mr(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Zn[n]=new Mr(n,5,!1,n.toLowerCase(),null,!1,!1)});var Vw=/[\-:]([a-z])/g;function Ww(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Vw,Ww);Zn[e]=new Mr(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Vw,Ww);Zn[e]=new Mr(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Vw,Ww);Zn[e]=new Mr(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Zn[n]=new Mr(n,1,!1,n.toLowerCase(),null,!1,!1)});Zn.xlinkHref=new Mr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Zn[n]=new Mr(n,1,!1,n.toLowerCase(),null,!0,!0)});function Gw(n,e,t,r){var i=Zn.hasOwnProperty(e)?Zn[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(KD(e,t,i,r)&&(t=null),r||i===null?WD(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var vo=jI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Zf=Symbol.for("react.element"),fl=Symbol.for("react.portal"),pl=Symbol.for("react.fragment"),Kw=Symbol.for("react.strict_mode"),P1=Symbol.for("react.profiler"),UI=Symbol.for("react.provider"),zI=Symbol.for("react.context"),Jw=Symbol.for("react.forward_ref"),R1=Symbol.for("react.suspense"),_1=Symbol.for("react.suspense_list"),Qw=Symbol.for("react.memo"),Ro=Symbol.for("react.lazy"),$I=Symbol.for("react.offscreen"),WE=Symbol.iterator;function td(n){return n===null||typeof n!="object"?null:(n=WE&&n[WE]||n["@@iterator"],typeof n=="function"?n:null)}var Zt=Object.assign,ey;function kd(n){if(ey===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);ey=e&&e[1]||""}return`
`+ey+n}var ty=!1;function ny(n,e){if(!n||ty)return"";ty=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(f){var r=f}Reflect.construct(n,[],e)}else{try{e.call()}catch(f){r=f}n.call(e.prototype)}else{try{throw Error()}catch(f){r=f}n()}}catch(f){if(f&&r&&typeof f.stack=="string"){for(var i=f.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,u=s.length-1;1<=o&&0<=u&&i[o]!==s[u];)u--;for(;1<=o&&0<=u;o--,u--)if(i[o]!==s[u]){if(o!==1||u!==1)do if(o--,u--,0>u||i[o]!==s[u]){var d=`
`+i[o].replace(" at new "," at ");return n.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",n.displayName)),d}while(1<=o&&0<=u);break}}}finally{ty=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?kd(n):""}function JD(n){switch(n.tag){case 5:return kd(n.type);case 16:return kd("Lazy");case 13:return kd("Suspense");case 19:return kd("SuspenseList");case 0:case 2:case 15:return n=ny(n.type,!1),n;case 11:return n=ny(n.type.render,!1),n;case 1:return n=ny(n.type,!0),n;default:return""}}function I1(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case pl:return"Fragment";case fl:return"Portal";case P1:return"Profiler";case Kw:return"StrictMode";case R1:return"Suspense";case _1:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case zI:return(n.displayName||"Context")+".Consumer";case UI:return(n._context.displayName||"Context")+".Provider";case Jw:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Qw:return e=n.displayName||null,e!==null?e:I1(n.type)||"Memo";case Ro:e=n._payload,n=n._init;try{return I1(n(e))}catch{}}return null}function QD(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return I1(e);case 8:return e===Kw?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function na(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function HI(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function XD(n){var e=HI(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function ep(n){n._valueTracker||(n._valueTracker=XD(n))}function VI(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=HI(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function cm(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function A1(n,e){var t=e.checked;return Zt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function GE(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=na(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function WI(n,e){e=e.checked,e!=null&&Gw(n,"checked",e,!1)}function k1(n,e){WI(n,e);var t=na(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?O1(n,e.type,t):e.hasOwnProperty("defaultValue")&&O1(n,e.type,na(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function KE(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function O1(n,e,t){(e!=="number"||cm(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Od=Array.isArray;function Rl(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+na(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function F1(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Le(91));return Zt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function JE(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Le(92));if(Od(t)){if(1<t.length)throw Error(Le(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:na(t)}}function GI(n,e){var t=na(e.value),r=na(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function QE(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function KI(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function N1(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?KI(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var tp,JI=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(tp=tp||document.createElement("div"),tp.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=tp.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function rh(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Ld={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},YD=["Webkit","ms","Moz","O"];Object.keys(Ld).forEach(function(n){YD.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Ld[e]=Ld[n]})});function QI(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Ld.hasOwnProperty(n)&&Ld[n]?(""+e).trim():e+"px"}function XI(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=QI(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var ZD=Zt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function D1(n,e){if(e){if(ZD[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Le(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Le(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Le(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Le(62))}}function L1(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var M1=null;function Xw(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var B1=null,_l=null,Il=null;function XE(n){if(n=Mh(n)){if(typeof B1!="function")throw Error(Le(280));var e=n.stateNode;e&&(e=lg(e),B1(n.stateNode,n.type,e))}}function YI(n){_l?Il?Il.push(n):Il=[n]:_l=n}function ZI(){if(_l){var n=_l,e=Il;if(Il=_l=null,XE(n),e)for(n=0;n<e.length;n++)XE(e[n])}}function eA(n,e){return n(e)}function tA(){}var ry=!1;function nA(n,e,t){if(ry)return n(e,t);ry=!0;try{return eA(n,e,t)}finally{ry=!1,(_l!==null||Il!==null)&&(tA(),ZI())}}function ih(n,e){var t=n.stateNode;if(t===null)return null;var r=lg(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Le(231,e,typeof t));return t}var j1=!1;if(lo)try{var nd={};Object.defineProperty(nd,"passive",{get:function(){j1=!0}}),window.addEventListener("test",nd,nd),window.removeEventListener("test",nd,nd)}catch{j1=!1}function e4(n,e,t,r,i,s,o,u,d){var f=Array.prototype.slice.call(arguments,3);try{e.apply(t,f)}catch(m){this.onError(m)}}var Md=!1,dm=null,hm=!1,q1=null,t4={onError:function(n){Md=!0,dm=n}};function n4(n,e,t,r,i,s,o,u,d){Md=!1,dm=null,e4.apply(t4,arguments)}function r4(n,e,t,r,i,s,o,u,d){if(n4.apply(this,arguments),Md){if(Md){var f=dm;Md=!1,dm=null}else throw Error(Le(198));hm||(hm=!0,q1=f)}}function Pu(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function rA(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function YE(n){if(Pu(n)!==n)throw Error(Le(188))}function i4(n){var e=n.alternate;if(!e){if(e=Pu(n),e===null)throw Error(Le(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return YE(i),n;if(s===r)return YE(i),e;s=s.sibling}throw Error(Le(188))}if(t.return!==r.return)t=i,r=s;else{for(var o=!1,u=i.child;u;){if(u===t){o=!0,t=i,r=s;break}if(u===r){o=!0,r=i,t=s;break}u=u.sibling}if(!o){for(u=s.child;u;){if(u===t){o=!0,t=s,r=i;break}if(u===r){o=!0,r=s,t=i;break}u=u.sibling}if(!o)throw Error(Le(189))}}if(t.alternate!==r)throw Error(Le(190))}if(t.tag!==3)throw Error(Le(188));return t.stateNode.current===t?n:e}function iA(n){return n=i4(n),n!==null?sA(n):null}function sA(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=sA(n);if(e!==null)return e;n=n.sibling}return null}var oA=fi.unstable_scheduleCallback,ZE=fi.unstable_cancelCallback,s4=fi.unstable_shouldYield,o4=fi.unstable_requestPaint,on=fi.unstable_now,a4=fi.unstable_getCurrentPriorityLevel,Yw=fi.unstable_ImmediatePriority,aA=fi.unstable_UserBlockingPriority,fm=fi.unstable_NormalPriority,u4=fi.unstable_LowPriority,uA=fi.unstable_IdlePriority,sg=null,Ts=null;function l4(n){if(Ts&&typeof Ts.onCommitFiberRoot=="function")try{Ts.onCommitFiberRoot(sg,n,void 0,(n.current.flags&128)===128)}catch{}}var es=Math.clz32?Math.clz32:h4,c4=Math.log,d4=Math.LN2;function h4(n){return n>>>=0,n===0?32:31-(c4(n)/d4|0)|0}var np=64,rp=4194304;function Fd(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function pm(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var u=o&~i;u!==0?r=Fd(u):(s&=o,s!==0&&(r=Fd(s)))}else o=t&~i,o!==0?r=Fd(o):s!==0&&(r=Fd(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-es(e),i=1<<t,r|=n[t],e&=~i;return r}function f4(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function p4(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-es(s),u=1<<o,d=i[o];d===-1?(!(u&t)||u&r)&&(i[o]=f4(u,e)):d<=e&&(n.expiredLanes|=u),s&=~u}}function U1(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function lA(){var n=np;return np<<=1,!(np&4194240)&&(np=64),n}function iy(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Dh(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-es(e),n[e]=t}function m4(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-es(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function Zw(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-es(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var It=0;function cA(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var dA,eC,hA,fA,pA,z1=!1,ip=[],zo=null,$o=null,Ho=null,sh=new Map,oh=new Map,Ao=[],g4="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function e2(n,e){switch(n){case"focusin":case"focusout":zo=null;break;case"dragenter":case"dragleave":$o=null;break;case"mouseover":case"mouseout":Ho=null;break;case"pointerover":case"pointerout":sh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":oh.delete(e.pointerId)}}function rd(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Mh(e),e!==null&&eC(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function v4(n,e,t,r,i){switch(e){case"focusin":return zo=rd(zo,n,e,t,r,i),!0;case"dragenter":return $o=rd($o,n,e,t,r,i),!0;case"mouseover":return Ho=rd(Ho,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return sh.set(s,rd(sh.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,oh.set(s,rd(oh.get(s)||null,n,e,t,r,i)),!0}return!1}function mA(n){var e=Xa(n.target);if(e!==null){var t=Pu(e);if(t!==null){if(e=t.tag,e===13){if(e=rA(t),e!==null){n.blockedOn=e,pA(n.priority,function(){hA(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Up(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=$1(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);M1=r,t.target.dispatchEvent(r),M1=null}else return e=Mh(t),e!==null&&eC(e),n.blockedOn=t,!1;e.shift()}return!0}function t2(n,e,t){Up(n)&&t.delete(e)}function y4(){z1=!1,zo!==null&&Up(zo)&&(zo=null),$o!==null&&Up($o)&&($o=null),Ho!==null&&Up(Ho)&&(Ho=null),sh.forEach(t2),oh.forEach(t2)}function id(n,e){n.blockedOn===e&&(n.blockedOn=null,z1||(z1=!0,fi.unstable_scheduleCallback(fi.unstable_NormalPriority,y4)))}function ah(n){function e(i){return id(i,n)}if(0<ip.length){id(ip[0],n);for(var t=1;t<ip.length;t++){var r=ip[t];r.blockedOn===n&&(r.blockedOn=null)}}for(zo!==null&&id(zo,n),$o!==null&&id($o,n),Ho!==null&&id(Ho,n),sh.forEach(e),oh.forEach(e),t=0;t<Ao.length;t++)r=Ao[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Ao.length&&(t=Ao[0],t.blockedOn===null);)mA(t),t.blockedOn===null&&Ao.shift()}var Al=vo.ReactCurrentBatchConfig,mm=!0;function S4(n,e,t,r){var i=It,s=Al.transition;Al.transition=null;try{It=1,tC(n,e,t,r)}finally{It=i,Al.transition=s}}function b4(n,e,t,r){var i=It,s=Al.transition;Al.transition=null;try{It=4,tC(n,e,t,r)}finally{It=i,Al.transition=s}}function tC(n,e,t,r){if(mm){var i=$1(n,e,t,r);if(i===null)py(n,e,r,gm,t),e2(n,r);else if(v4(i,n,e,t,r))r.stopPropagation();else if(e2(n,r),e&4&&-1<g4.indexOf(n)){for(;i!==null;){var s=Mh(i);if(s!==null&&dA(s),s=$1(n,e,t,r),s===null&&py(n,e,r,gm,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else py(n,e,r,null,t)}}var gm=null;function $1(n,e,t,r){if(gm=null,n=Xw(r),n=Xa(n),n!==null)if(e=Pu(n),e===null)n=null;else if(t=e.tag,t===13){if(n=rA(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return gm=n,null}function gA(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(a4()){case Yw:return 1;case aA:return 4;case fm:case u4:return 16;case uA:return 536870912;default:return 16}default:return 16}}var Oo=null,nC=null,zp=null;function vA(){if(zp)return zp;var n,e=nC,t=e.length,r,i="value"in Oo?Oo.value:Oo.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===i[s-r];r++);return zp=i.slice(n,1<r?1-r:void 0)}function $p(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function sp(){return!0}function n2(){return!1}function vi(n){function e(t,r,i,s,o){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var u in n)n.hasOwnProperty(u)&&(t=n[u],this[u]=t?t(s):s[u]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?sp:n2,this.isPropagationStopped=n2,this}return Zt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=sp)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=sp)},persist:function(){},isPersistent:sp}),e}var cc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rC=vi(cc),Lh=Zt({},cc,{view:0,detail:0}),w4=vi(Lh),sy,oy,sd,og=Zt({},Lh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:iC,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==sd&&(sd&&n.type==="mousemove"?(sy=n.screenX-sd.screenX,oy=n.screenY-sd.screenY):oy=sy=0,sd=n),sy)},movementY:function(n){return"movementY"in n?n.movementY:oy}}),r2=vi(og),C4=Zt({},og,{dataTransfer:0}),x4=vi(C4),E4=Zt({},Lh,{relatedTarget:0}),ay=vi(E4),T4=Zt({},cc,{animationName:0,elapsedTime:0,pseudoElement:0}),P4=vi(T4),R4=Zt({},cc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),_4=vi(R4),I4=Zt({},cc,{data:0}),i2=vi(I4),A4={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},k4={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},O4={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function F4(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=O4[n])?!!e[n]:!1}function iC(){return F4}var N4=Zt({},Lh,{key:function(n){if(n.key){var e=A4[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=$p(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?k4[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:iC,charCode:function(n){return n.type==="keypress"?$p(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?$p(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),D4=vi(N4),L4=Zt({},og,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),s2=vi(L4),M4=Zt({},Lh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:iC}),B4=vi(M4),j4=Zt({},cc,{propertyName:0,elapsedTime:0,pseudoElement:0}),q4=vi(j4),U4=Zt({},og,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),z4=vi(U4),$4=[9,13,27,32],sC=lo&&"CompositionEvent"in window,Bd=null;lo&&"documentMode"in document&&(Bd=document.documentMode);var H4=lo&&"TextEvent"in window&&!Bd,yA=lo&&(!sC||Bd&&8<Bd&&11>=Bd),o2=String.fromCharCode(32),a2=!1;function SA(n,e){switch(n){case"keyup":return $4.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function bA(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var ml=!1;function V4(n,e){switch(n){case"compositionend":return bA(e);case"keypress":return e.which!==32?null:(a2=!0,o2);case"textInput":return n=e.data,n===o2&&a2?null:n;default:return null}}function W4(n,e){if(ml)return n==="compositionend"||!sC&&SA(n,e)?(n=vA(),zp=nC=Oo=null,ml=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return yA&&e.locale!=="ko"?null:e.data;default:return null}}var G4={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function u2(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!G4[n.type]:e==="textarea"}function wA(n,e,t,r){YI(r),e=vm(e,"onChange"),0<e.length&&(t=new rC("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var jd=null,uh=null;function K4(n){OA(n,0)}function ag(n){var e=yl(n);if(VI(e))return n}function J4(n,e){if(n==="change")return e}var CA=!1;if(lo){var uy;if(lo){var ly="oninput"in document;if(!ly){var l2=document.createElement("div");l2.setAttribute("oninput","return;"),ly=typeof l2.oninput=="function"}uy=ly}else uy=!1;CA=uy&&(!document.documentMode||9<document.documentMode)}function c2(){jd&&(jd.detachEvent("onpropertychange",xA),uh=jd=null)}function xA(n){if(n.propertyName==="value"&&ag(uh)){var e=[];wA(e,uh,n,Xw(n)),nA(K4,e)}}function Q4(n,e,t){n==="focusin"?(c2(),jd=e,uh=t,jd.attachEvent("onpropertychange",xA)):n==="focusout"&&c2()}function X4(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return ag(uh)}function Y4(n,e){if(n==="click")return ag(e)}function Z4(n,e){if(n==="input"||n==="change")return ag(e)}function eL(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var rs=typeof Object.is=="function"?Object.is:eL;function lh(n,e){if(rs(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!T1.call(e,i)||!rs(n[i],e[i]))return!1}return!0}function d2(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function h2(n,e){var t=d2(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=d2(t)}}function EA(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?EA(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function TA(){for(var n=window,e=cm();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=cm(n.document)}return e}function oC(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function tL(n){var e=TA(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&EA(t.ownerDocument.documentElement,t)){if(r!==null&&oC(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=h2(t,s);var o=h2(t,r);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var nL=lo&&"documentMode"in document&&11>=document.documentMode,gl=null,H1=null,qd=null,V1=!1;function f2(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;V1||gl==null||gl!==cm(r)||(r=gl,"selectionStart"in r&&oC(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),qd&&lh(qd,r)||(qd=r,r=vm(H1,"onSelect"),0<r.length&&(e=new rC("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=gl)))}function op(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var vl={animationend:op("Animation","AnimationEnd"),animationiteration:op("Animation","AnimationIteration"),animationstart:op("Animation","AnimationStart"),transitionend:op("Transition","TransitionEnd")},cy={},PA={};lo&&(PA=document.createElement("div").style,"AnimationEvent"in window||(delete vl.animationend.animation,delete vl.animationiteration.animation,delete vl.animationstart.animation),"TransitionEvent"in window||delete vl.transitionend.transition);function ug(n){if(cy[n])return cy[n];if(!vl[n])return n;var e=vl[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in PA)return cy[n]=e[t];return n}var RA=ug("animationend"),_A=ug("animationiteration"),IA=ug("animationstart"),AA=ug("transitionend"),kA=new Map,p2="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function oa(n,e){kA.set(n,e),Tu(e,[n])}for(var dy=0;dy<p2.length;dy++){var hy=p2[dy],rL=hy.toLowerCase(),iL=hy[0].toUpperCase()+hy.slice(1);oa(rL,"on"+iL)}oa(RA,"onAnimationEnd");oa(_A,"onAnimationIteration");oa(IA,"onAnimationStart");oa("dblclick","onDoubleClick");oa("focusin","onFocus");oa("focusout","onBlur");oa(AA,"onTransitionEnd");Hl("onMouseEnter",["mouseout","mouseover"]);Hl("onMouseLeave",["mouseout","mouseover"]);Hl("onPointerEnter",["pointerout","pointerover"]);Hl("onPointerLeave",["pointerout","pointerover"]);Tu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Tu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Tu("onBeforeInput",["compositionend","keypress","textInput","paste"]);Tu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Tu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Tu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sL=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nd));function m2(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,r4(r,e,void 0,n),n.currentTarget=null}function OA(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var u=r[o],d=u.instance,f=u.currentTarget;if(u=u.listener,d!==s&&i.isPropagationStopped())break e;m2(i,u,f),s=d}else for(o=0;o<r.length;o++){if(u=r[o],d=u.instance,f=u.currentTarget,u=u.listener,d!==s&&i.isPropagationStopped())break e;m2(i,u,f),s=d}}}if(hm)throw n=q1,hm=!1,q1=null,n}function Mt(n,e){var t=e[Q1];t===void 0&&(t=e[Q1]=new Set);var r=n+"__bubble";t.has(r)||(FA(e,n,2,!1),t.add(r))}function fy(n,e,t){var r=0;e&&(r|=4),FA(t,n,r,e)}var ap="_reactListening"+Math.random().toString(36).slice(2);function ch(n){if(!n[ap]){n[ap]=!0,qI.forEach(function(t){t!=="selectionchange"&&(sL.has(t)||fy(t,!1,n),fy(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[ap]||(e[ap]=!0,fy("selectionchange",!1,e))}}function FA(n,e,t,r){switch(gA(e)){case 1:var i=S4;break;case 4:i=b4;break;default:i=tC}t=i.bind(null,e,t,n),i=void 0,!j1||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function py(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var u=r.stateNode.containerInfo;if(u===i||u.nodeType===8&&u.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var d=o.tag;if((d===3||d===4)&&(d=o.stateNode.containerInfo,d===i||d.nodeType===8&&d.parentNode===i))return;o=o.return}for(;u!==null;){if(o=Xa(u),o===null)return;if(d=o.tag,d===5||d===6){r=s=o;continue e}u=u.parentNode}}r=r.return}nA(function(){var f=s,m=Xw(t),g=[];e:{var P=kA.get(n);if(P!==void 0){var D=rC,M=n;switch(n){case"keypress":if($p(t)===0)break e;case"keydown":case"keyup":D=D4;break;case"focusin":M="focus",D=ay;break;case"focusout":M="blur",D=ay;break;case"beforeblur":case"afterblur":D=ay;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":D=r2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":D=x4;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":D=B4;break;case RA:case _A:case IA:D=P4;break;case AA:D=q4;break;case"scroll":D=w4;break;case"wheel":D=z4;break;case"copy":case"cut":case"paste":D=_4;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":D=s2}var U=(e&4)!==0,j=!U&&n==="scroll",E=U?P!==null?P+"Capture":null:P;U=[];for(var k=f,z;k!==null;){z=k;var K=z.stateNode;if(z.tag===5&&K!==null&&(z=K,E!==null&&(K=ih(k,E),K!=null&&U.push(dh(k,K,z)))),j)break;k=k.return}0<U.length&&(P=new D(P,M,null,t,m),g.push({event:P,listeners:U}))}}if(!(e&7)){e:{if(P=n==="mouseover"||n==="pointerover",D=n==="mouseout"||n==="pointerout",P&&t!==M1&&(M=t.relatedTarget||t.fromElement)&&(Xa(M)||M[co]))break e;if((D||P)&&(P=m.window===m?m:(P=m.ownerDocument)?P.defaultView||P.parentWindow:window,D?(M=t.relatedTarget||t.toElement,D=f,M=M?Xa(M):null,M!==null&&(j=Pu(M),M!==j||M.tag!==5&&M.tag!==6)&&(M=null)):(D=null,M=f),D!==M)){if(U=r2,K="onMouseLeave",E="onMouseEnter",k="mouse",(n==="pointerout"||n==="pointerover")&&(U=s2,K="onPointerLeave",E="onPointerEnter",k="pointer"),j=D==null?P:yl(D),z=M==null?P:yl(M),P=new U(K,k+"leave",D,t,m),P.target=j,P.relatedTarget=z,K=null,Xa(m)===f&&(U=new U(E,k+"enter",M,t,m),U.target=z,U.relatedTarget=j,K=U),j=K,D&&M)t:{for(U=D,E=M,k=0,z=U;z;z=Ju(z))k++;for(z=0,K=E;K;K=Ju(K))z++;for(;0<k-z;)U=Ju(U),k--;for(;0<z-k;)E=Ju(E),z--;for(;k--;){if(U===E||E!==null&&U===E.alternate)break t;U=Ju(U),E=Ju(E)}U=null}else U=null;D!==null&&g2(g,P,D,U,!1),M!==null&&j!==null&&g2(g,j,M,U,!0)}}e:{if(P=f?yl(f):window,D=P.nodeName&&P.nodeName.toLowerCase(),D==="select"||D==="input"&&P.type==="file")var ie=J4;else if(u2(P))if(CA)ie=Z4;else{ie=X4;var he=Q4}else(D=P.nodeName)&&D.toLowerCase()==="input"&&(P.type==="checkbox"||P.type==="radio")&&(ie=Y4);if(ie&&(ie=ie(n,f))){wA(g,ie,t,m);break e}he&&he(n,P,f),n==="focusout"&&(he=P._wrapperState)&&he.controlled&&P.type==="number"&&O1(P,"number",P.value)}switch(he=f?yl(f):window,n){case"focusin":(u2(he)||he.contentEditable==="true")&&(gl=he,H1=f,qd=null);break;case"focusout":qd=H1=gl=null;break;case"mousedown":V1=!0;break;case"contextmenu":case"mouseup":case"dragend":V1=!1,f2(g,t,m);break;case"selectionchange":if(nL)break;case"keydown":case"keyup":f2(g,t,m)}var pe;if(sC)e:{switch(n){case"compositionstart":var X="onCompositionStart";break e;case"compositionend":X="onCompositionEnd";break e;case"compositionupdate":X="onCompositionUpdate";break e}X=void 0}else ml?SA(n,t)&&(X="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(X="onCompositionStart");X&&(yA&&t.locale!=="ko"&&(ml||X!=="onCompositionStart"?X==="onCompositionEnd"&&ml&&(pe=vA()):(Oo=m,nC="value"in Oo?Oo.value:Oo.textContent,ml=!0)),he=vm(f,X),0<he.length&&(X=new i2(X,n,null,t,m),g.push({event:X,listeners:he}),pe?X.data=pe:(pe=bA(t),pe!==null&&(X.data=pe)))),(pe=H4?V4(n,t):W4(n,t))&&(f=vm(f,"onBeforeInput"),0<f.length&&(m=new i2("onBeforeInput","beforeinput",null,t,m),g.push({event:m,listeners:f}),m.data=pe))}OA(g,e)})}function dh(n,e,t){return{instance:n,listener:e,currentTarget:t}}function vm(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=ih(n,t),s!=null&&r.unshift(dh(n,s,i)),s=ih(n,e),s!=null&&r.push(dh(n,s,i))),n=n.return}return r}function Ju(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function g2(n,e,t,r,i){for(var s=e._reactName,o=[];t!==null&&t!==r;){var u=t,d=u.alternate,f=u.stateNode;if(d!==null&&d===r)break;u.tag===5&&f!==null&&(u=f,i?(d=ih(t,s),d!=null&&o.unshift(dh(t,d,u))):i||(d=ih(t,s),d!=null&&o.push(dh(t,d,u)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var oL=/\r\n?/g,aL=/\u0000|\uFFFD/g;function v2(n){return(typeof n=="string"?n:""+n).replace(oL,`
`).replace(aL,"")}function up(n,e,t){if(e=v2(e),v2(n)!==e&&t)throw Error(Le(425))}function ym(){}var W1=null,G1=null;function K1(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var J1=typeof setTimeout=="function"?setTimeout:void 0,uL=typeof clearTimeout=="function"?clearTimeout:void 0,y2=typeof Promise=="function"?Promise:void 0,lL=typeof queueMicrotask=="function"?queueMicrotask:typeof y2<"u"?function(n){return y2.resolve(null).then(n).catch(cL)}:J1;function cL(n){setTimeout(function(){throw n})}function my(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),ah(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);ah(e)}function Vo(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function S2(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var dc=Math.random().toString(36).slice(2),ws="__reactFiber$"+dc,hh="__reactProps$"+dc,co="__reactContainer$"+dc,Q1="__reactEvents$"+dc,dL="__reactListeners$"+dc,hL="__reactHandles$"+dc;function Xa(n){var e=n[ws];if(e)return e;for(var t=n.parentNode;t;){if(e=t[co]||t[ws]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=S2(n);n!==null;){if(t=n[ws])return t;n=S2(n)}return e}n=t,t=n.parentNode}return null}function Mh(n){return n=n[ws]||n[co],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function yl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Le(33))}function lg(n){return n[hh]||null}var X1=[],Sl=-1;function aa(n){return{current:n}}function Ut(n){0>Sl||(n.current=X1[Sl],X1[Sl]=null,Sl--)}function Dt(n,e){Sl++,X1[Sl]=n.current,n.current=e}var ra={},xr=aa(ra),Wr=aa(!1),cu=ra;function Vl(n,e){var t=n.type.contextTypes;if(!t)return ra;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function Gr(n){return n=n.childContextTypes,n!=null}function Sm(){Ut(Wr),Ut(xr)}function b2(n,e,t){if(xr.current!==ra)throw Error(Le(168));Dt(xr,e),Dt(Wr,t)}function NA(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Le(108,QD(n)||"Unknown",i));return Zt({},t,r)}function bm(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||ra,cu=xr.current,Dt(xr,n),Dt(Wr,Wr.current),!0}function w2(n,e,t){var r=n.stateNode;if(!r)throw Error(Le(169));t?(n=NA(n,e,cu),r.__reactInternalMemoizedMergedChildContext=n,Ut(Wr),Ut(xr),Dt(xr,n)):Ut(Wr),Dt(Wr,t)}var Xs=null,cg=!1,gy=!1;function DA(n){Xs===null?Xs=[n]:Xs.push(n)}function fL(n){cg=!0,DA(n)}function ua(){if(!gy&&Xs!==null){gy=!0;var n=0,e=It;try{var t=Xs;for(It=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Xs=null,cg=!1}catch(i){throw Xs!==null&&(Xs=Xs.slice(n+1)),oA(Yw,ua),i}finally{It=e,gy=!1}}return null}var bl=[],wl=0,wm=null,Cm=0,Ei=[],Ti=0,du=null,to=1,no="";function ka(n,e){bl[wl++]=Cm,bl[wl++]=wm,wm=n,Cm=e}function LA(n,e,t){Ei[Ti++]=to,Ei[Ti++]=no,Ei[Ti++]=du,du=n;var r=to;n=no;var i=32-es(r)-1;r&=~(1<<i),t+=1;var s=32-es(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,to=1<<32-es(e)+i|t<<i|r,no=s+n}else to=1<<s|t<<i|r,no=n}function aC(n){n.return!==null&&(ka(n,1),LA(n,1,0))}function uC(n){for(;n===wm;)wm=bl[--wl],bl[wl]=null,Cm=bl[--wl],bl[wl]=null;for(;n===du;)du=Ei[--Ti],Ei[Ti]=null,no=Ei[--Ti],Ei[Ti]=null,to=Ei[--Ti],Ei[Ti]=null}var di=null,li=null,Wt=!1,Qi=null;function MA(n,e){var t=Ai(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function C2(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,di=n,li=Vo(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,di=n,li=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=du!==null?{id:to,overflow:no}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Ai(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,di=n,li=null,!0):!1;default:return!1}}function Y1(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Z1(n){if(Wt){var e=li;if(e){var t=e;if(!C2(n,e)){if(Y1(n))throw Error(Le(418));e=Vo(t.nextSibling);var r=di;e&&C2(n,e)?MA(r,t):(n.flags=n.flags&-4097|2,Wt=!1,di=n)}}else{if(Y1(n))throw Error(Le(418));n.flags=n.flags&-4097|2,Wt=!1,di=n}}}function x2(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;di=n}function lp(n){if(n!==di)return!1;if(!Wt)return x2(n),Wt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!K1(n.type,n.memoizedProps)),e&&(e=li)){if(Y1(n))throw BA(),Error(Le(418));for(;e;)MA(n,e),e=Vo(e.nextSibling)}if(x2(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Le(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){li=Vo(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}li=null}}else li=di?Vo(n.stateNode.nextSibling):null;return!0}function BA(){for(var n=li;n;)n=Vo(n.nextSibling)}function Wl(){li=di=null,Wt=!1}function lC(n){Qi===null?Qi=[n]:Qi.push(n)}var pL=vo.ReactCurrentBatchConfig;function Wi(n,e){if(n&&n.defaultProps){e=Zt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var xm=aa(null),Em=null,Cl=null,cC=null;function dC(){cC=Cl=Em=null}function hC(n){var e=xm.current;Ut(xm),n._currentValue=e}function eb(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function kl(n,e){Em=n,cC=Cl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Vr=!0),n.firstContext=null)}function Ni(n){var e=n._currentValue;if(cC!==n)if(n={context:n,memoizedValue:e,next:null},Cl===null){if(Em===null)throw Error(Le(308));Cl=n,Em.dependencies={lanes:0,firstContext:n}}else Cl=Cl.next=n;return e}var Ya=null;function fC(n){Ya===null?Ya=[n]:Ya.push(n)}function jA(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,fC(e)):(t.next=i.next,i.next=t),e.interleaved=t,ho(n,r)}function ho(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var _o=!1;function pC(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function qA(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function io(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Wo(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,vt&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,ho(n,t)}return i=r.interleaved,i===null?(e.next=e,fC(r)):(e.next=i.next,i.next=e),r.interleaved=e,ho(n,t)}function Hp(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Zw(n,t)}}function E2(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Tm(n,e,t,r){var i=n.updateQueue;_o=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,u=i.shared.pending;if(u!==null){i.shared.pending=null;var d=u,f=d.next;d.next=null,o===null?s=f:o.next=f,o=d;var m=n.alternate;m!==null&&(m=m.updateQueue,u=m.lastBaseUpdate,u!==o&&(u===null?m.firstBaseUpdate=f:u.next=f,m.lastBaseUpdate=d))}if(s!==null){var g=i.baseState;o=0,m=f=d=null,u=s;do{var P=u.lane,D=u.eventTime;if((r&P)===P){m!==null&&(m=m.next={eventTime:D,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var M=n,U=u;switch(P=e,D=t,U.tag){case 1:if(M=U.payload,typeof M=="function"){g=M.call(D,g,P);break e}g=M;break e;case 3:M.flags=M.flags&-65537|128;case 0:if(M=U.payload,P=typeof M=="function"?M.call(D,g,P):M,P==null)break e;g=Zt({},g,P);break e;case 2:_o=!0}}u.callback!==null&&u.lane!==0&&(n.flags|=64,P=i.effects,P===null?i.effects=[u]:P.push(u))}else D={eventTime:D,lane:P,tag:u.tag,payload:u.payload,callback:u.callback,next:null},m===null?(f=m=D,d=g):m=m.next=D,o|=P;if(u=u.next,u===null){if(u=i.shared.pending,u===null)break;P=u,u=P.next,P.next=null,i.lastBaseUpdate=P,i.shared.pending=null}}while(1);if(m===null&&(d=g),i.baseState=d,i.firstBaseUpdate=f,i.lastBaseUpdate=m,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);fu|=o,n.lanes=o,n.memoizedState=g}}function T2(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(Le(191,i));i.call(r)}}}var UA=new jI.Component().refs;function tb(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Zt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var dg={isMounted:function(n){return(n=n._reactInternals)?Pu(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Nr(),i=Ko(n),s=io(r,i);s.payload=e,t!=null&&(s.callback=t),e=Wo(n,s,i),e!==null&&(ts(e,n,i,r),Hp(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Nr(),i=Ko(n),s=io(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=Wo(n,s,i),e!==null&&(ts(e,n,i,r),Hp(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Nr(),r=Ko(n),i=io(t,r);i.tag=2,e!=null&&(i.callback=e),e=Wo(n,i,r),e!==null&&(ts(e,n,r,t),Hp(e,n,r))}};function P2(n,e,t,r,i,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!lh(t,r)||!lh(i,s):!0}function zA(n,e,t){var r=!1,i=ra,s=e.contextType;return typeof s=="object"&&s!==null?s=Ni(s):(i=Gr(e)?cu:xr.current,r=e.contextTypes,s=(r=r!=null)?Vl(n,i):ra),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=dg,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function R2(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&dg.enqueueReplaceState(e,e.state,null)}function nb(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs=UA,pC(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Ni(s):(s=Gr(e)?cu:xr.current,i.context=Vl(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(tb(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&dg.enqueueReplaceState(i,i.state,null),Tm(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function od(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Le(309));var r=t.stateNode}if(!r)throw Error(Le(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var u=i.refs;u===UA&&(u=i.refs={}),o===null?delete u[s]:u[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error(Le(284));if(!t._owner)throw Error(Le(290,n))}return n}function cp(n,e){throw n=Object.prototype.toString.call(e),Error(Le(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function _2(n){var e=n._init;return e(n._payload)}function $A(n){function e(E,k){if(n){var z=E.deletions;z===null?(E.deletions=[k],E.flags|=16):z.push(k)}}function t(E,k){if(!n)return null;for(;k!==null;)e(E,k),k=k.sibling;return null}function r(E,k){for(E=new Map;k!==null;)k.key!==null?E.set(k.key,k):E.set(k.index,k),k=k.sibling;return E}function i(E,k){return E=Jo(E,k),E.index=0,E.sibling=null,E}function s(E,k,z){return E.index=z,n?(z=E.alternate,z!==null?(z=z.index,z<k?(E.flags|=2,k):z):(E.flags|=2,k)):(E.flags|=1048576,k)}function o(E){return n&&E.alternate===null&&(E.flags|=2),E}function u(E,k,z,K){return k===null||k.tag!==6?(k=xy(z,E.mode,K),k.return=E,k):(k=i(k,z),k.return=E,k)}function d(E,k,z,K){var ie=z.type;return ie===pl?m(E,k,z.props.children,K,z.key):k!==null&&(k.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===Ro&&_2(ie)===k.type)?(K=i(k,z.props),K.ref=od(E,k,z),K.return=E,K):(K=Qp(z.type,z.key,z.props,null,E.mode,K),K.ref=od(E,k,z),K.return=E,K)}function f(E,k,z,K){return k===null||k.tag!==4||k.stateNode.containerInfo!==z.containerInfo||k.stateNode.implementation!==z.implementation?(k=Ey(z,E.mode,K),k.return=E,k):(k=i(k,z.children||[]),k.return=E,k)}function m(E,k,z,K,ie){return k===null||k.tag!==7?(k=iu(z,E.mode,K,ie),k.return=E,k):(k=i(k,z),k.return=E,k)}function g(E,k,z){if(typeof k=="string"&&k!==""||typeof k=="number")return k=xy(""+k,E.mode,z),k.return=E,k;if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Zf:return z=Qp(k.type,k.key,k.props,null,E.mode,z),z.ref=od(E,null,k),z.return=E,z;case fl:return k=Ey(k,E.mode,z),k.return=E,k;case Ro:var K=k._init;return g(E,K(k._payload),z)}if(Od(k)||td(k))return k=iu(k,E.mode,z,null),k.return=E,k;cp(E,k)}return null}function P(E,k,z,K){var ie=k!==null?k.key:null;if(typeof z=="string"&&z!==""||typeof z=="number")return ie!==null?null:u(E,k,""+z,K);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case Zf:return z.key===ie?d(E,k,z,K):null;case fl:return z.key===ie?f(E,k,z,K):null;case Ro:return ie=z._init,P(E,k,ie(z._payload),K)}if(Od(z)||td(z))return ie!==null?null:m(E,k,z,K,null);cp(E,z)}return null}function D(E,k,z,K,ie){if(typeof K=="string"&&K!==""||typeof K=="number")return E=E.get(z)||null,u(k,E,""+K,ie);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case Zf:return E=E.get(K.key===null?z:K.key)||null,d(k,E,K,ie);case fl:return E=E.get(K.key===null?z:K.key)||null,f(k,E,K,ie);case Ro:var he=K._init;return D(E,k,z,he(K._payload),ie)}if(Od(K)||td(K))return E=E.get(z)||null,m(k,E,K,ie,null);cp(k,K)}return null}function M(E,k,z,K){for(var ie=null,he=null,pe=k,X=k=0,fe=null;pe!==null&&X<z.length;X++){pe.index>X?(fe=pe,pe=null):fe=pe.sibling;var ge=P(E,pe,z[X],K);if(ge===null){pe===null&&(pe=fe);break}n&&pe&&ge.alternate===null&&e(E,pe),k=s(ge,k,X),he===null?ie=ge:he.sibling=ge,he=ge,pe=fe}if(X===z.length)return t(E,pe),Wt&&ka(E,X),ie;if(pe===null){for(;X<z.length;X++)pe=g(E,z[X],K),pe!==null&&(k=s(pe,k,X),he===null?ie=pe:he.sibling=pe,he=pe);return Wt&&ka(E,X),ie}for(pe=r(E,pe);X<z.length;X++)fe=D(pe,E,X,z[X],K),fe!==null&&(n&&fe.alternate!==null&&pe.delete(fe.key===null?X:fe.key),k=s(fe,k,X),he===null?ie=fe:he.sibling=fe,he=fe);return n&&pe.forEach(function(we){return e(E,we)}),Wt&&ka(E,X),ie}function U(E,k,z,K){var ie=td(z);if(typeof ie!="function")throw Error(Le(150));if(z=ie.call(z),z==null)throw Error(Le(151));for(var he=ie=null,pe=k,X=k=0,fe=null,ge=z.next();pe!==null&&!ge.done;X++,ge=z.next()){pe.index>X?(fe=pe,pe=null):fe=pe.sibling;var we=P(E,pe,ge.value,K);if(we===null){pe===null&&(pe=fe);break}n&&pe&&we.alternate===null&&e(E,pe),k=s(we,k,X),he===null?ie=we:he.sibling=we,he=we,pe=fe}if(ge.done)return t(E,pe),Wt&&ka(E,X),ie;if(pe===null){for(;!ge.done;X++,ge=z.next())ge=g(E,ge.value,K),ge!==null&&(k=s(ge,k,X),he===null?ie=ge:he.sibling=ge,he=ge);return Wt&&ka(E,X),ie}for(pe=r(E,pe);!ge.done;X++,ge=z.next())ge=D(pe,E,X,ge.value,K),ge!==null&&(n&&ge.alternate!==null&&pe.delete(ge.key===null?X:ge.key),k=s(ge,k,X),he===null?ie=ge:he.sibling=ge,he=ge);return n&&pe.forEach(function(be){return e(E,be)}),Wt&&ka(E,X),ie}function j(E,k,z,K){if(typeof z=="object"&&z!==null&&z.type===pl&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case Zf:e:{for(var ie=z.key,he=k;he!==null;){if(he.key===ie){if(ie=z.type,ie===pl){if(he.tag===7){t(E,he.sibling),k=i(he,z.props.children),k.return=E,E=k;break e}}else if(he.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===Ro&&_2(ie)===he.type){t(E,he.sibling),k=i(he,z.props),k.ref=od(E,he,z),k.return=E,E=k;break e}t(E,he);break}else e(E,he);he=he.sibling}z.type===pl?(k=iu(z.props.children,E.mode,K,z.key),k.return=E,E=k):(K=Qp(z.type,z.key,z.props,null,E.mode,K),K.ref=od(E,k,z),K.return=E,E=K)}return o(E);case fl:e:{for(he=z.key;k!==null;){if(k.key===he)if(k.tag===4&&k.stateNode.containerInfo===z.containerInfo&&k.stateNode.implementation===z.implementation){t(E,k.sibling),k=i(k,z.children||[]),k.return=E,E=k;break e}else{t(E,k);break}else e(E,k);k=k.sibling}k=Ey(z,E.mode,K),k.return=E,E=k}return o(E);case Ro:return he=z._init,j(E,k,he(z._payload),K)}if(Od(z))return M(E,k,z,K);if(td(z))return U(E,k,z,K);cp(E,z)}return typeof z=="string"&&z!==""||typeof z=="number"?(z=""+z,k!==null&&k.tag===6?(t(E,k.sibling),k=i(k,z),k.return=E,E=k):(t(E,k),k=xy(z,E.mode,K),k.return=E,E=k),o(E)):t(E,k)}return j}var Gl=$A(!0),HA=$A(!1),Bh={},Ps=aa(Bh),fh=aa(Bh),ph=aa(Bh);function Za(n){if(n===Bh)throw Error(Le(174));return n}function mC(n,e){switch(Dt(ph,e),Dt(fh,n),Dt(Ps,Bh),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:N1(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=N1(e,n)}Ut(Ps),Dt(Ps,e)}function Kl(){Ut(Ps),Ut(fh),Ut(ph)}function VA(n){Za(ph.current);var e=Za(Ps.current),t=N1(e,n.type);e!==t&&(Dt(fh,n),Dt(Ps,t))}function gC(n){fh.current===n&&(Ut(Ps),Ut(fh))}var Qt=aa(0);function Pm(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var vy=[];function vC(){for(var n=0;n<vy.length;n++)vy[n]._workInProgressVersionPrimary=null;vy.length=0}var Vp=vo.ReactCurrentDispatcher,yy=vo.ReactCurrentBatchConfig,hu=0,Yt=null,Cn=null,kn=null,Rm=!1,Ud=!1,mh=0,mL=0;function sr(){throw Error(Le(321))}function yC(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!rs(n[t],e[t]))return!1;return!0}function SC(n,e,t,r,i,s){if(hu=s,Yt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Vp.current=n===null||n.memoizedState===null?SL:bL,n=t(r,i),Ud){s=0;do{if(Ud=!1,mh=0,25<=s)throw Error(Le(301));s+=1,kn=Cn=null,e.updateQueue=null,Vp.current=wL,n=t(r,i)}while(Ud)}if(Vp.current=_m,e=Cn!==null&&Cn.next!==null,hu=0,kn=Cn=Yt=null,Rm=!1,e)throw Error(Le(300));return n}function bC(){var n=mh!==0;return mh=0,n}function vs(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return kn===null?Yt.memoizedState=kn=n:kn=kn.next=n,kn}function Di(){if(Cn===null){var n=Yt.alternate;n=n!==null?n.memoizedState:null}else n=Cn.next;var e=kn===null?Yt.memoizedState:kn.next;if(e!==null)kn=e,Cn=n;else{if(n===null)throw Error(Le(310));Cn=n,n={memoizedState:Cn.memoizedState,baseState:Cn.baseState,baseQueue:Cn.baseQueue,queue:Cn.queue,next:null},kn===null?Yt.memoizedState=kn=n:kn=kn.next=n}return kn}function gh(n,e){return typeof e=="function"?e(n):e}function Sy(n){var e=Di(),t=e.queue;if(t===null)throw Error(Le(311));t.lastRenderedReducer=n;var r=Cn,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var u=o=null,d=null,f=s;do{var m=f.lane;if((hu&m)===m)d!==null&&(d=d.next={lane:0,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null}),r=f.hasEagerState?f.eagerState:n(r,f.action);else{var g={lane:m,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null};d===null?(u=d=g,o=r):d=d.next=g,Yt.lanes|=m,fu|=m}f=f.next}while(f!==null&&f!==s);d===null?o=r:d.next=u,rs(r,e.memoizedState)||(Vr=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=d,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,Yt.lanes|=s,fu|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function by(n){var e=Di(),t=e.queue;if(t===null)throw Error(Le(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=n(s,o.action),o=o.next;while(o!==i);rs(s,e.memoizedState)||(Vr=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function WA(){}function GA(n,e){var t=Yt,r=Di(),i=e(),s=!rs(r.memoizedState,i);if(s&&(r.memoizedState=i,Vr=!0),r=r.queue,wC(QA.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||kn!==null&&kn.memoizedState.tag&1){if(t.flags|=2048,vh(9,JA.bind(null,t,r,i,e),void 0,null),On===null)throw Error(Le(349));hu&30||KA(t,e,i)}return i}function KA(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Yt.updateQueue,e===null?(e={lastEffect:null,stores:null},Yt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function JA(n,e,t,r){e.value=t,e.getSnapshot=r,XA(e)&&YA(n)}function QA(n,e,t){return t(function(){XA(e)&&YA(n)})}function XA(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!rs(n,t)}catch{return!0}}function YA(n){var e=ho(n,1);e!==null&&ts(e,n,1,-1)}function I2(n){var e=vs();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gh,lastRenderedState:n},e.queue=n,n=n.dispatch=yL.bind(null,Yt,n),[e.memoizedState,n]}function vh(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Yt.updateQueue,e===null?(e={lastEffect:null,stores:null},Yt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function ZA(){return Di().memoizedState}function Wp(n,e,t,r){var i=vs();Yt.flags|=n,i.memoizedState=vh(1|e,t,void 0,r===void 0?null:r)}function hg(n,e,t,r){var i=Di();r=r===void 0?null:r;var s=void 0;if(Cn!==null){var o=Cn.memoizedState;if(s=o.destroy,r!==null&&yC(r,o.deps)){i.memoizedState=vh(e,t,s,r);return}}Yt.flags|=n,i.memoizedState=vh(1|e,t,s,r)}function A2(n,e){return Wp(8390656,8,n,e)}function wC(n,e){return hg(2048,8,n,e)}function ek(n,e){return hg(4,2,n,e)}function tk(n,e){return hg(4,4,n,e)}function nk(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function rk(n,e,t){return t=t!=null?t.concat([n]):null,hg(4,4,nk.bind(null,e,n),t)}function CC(){}function ik(n,e){var t=Di();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&yC(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function sk(n,e){var t=Di();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&yC(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function ok(n,e,t){return hu&21?(rs(t,e)||(t=lA(),Yt.lanes|=t,fu|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Vr=!0),n.memoizedState=t)}function gL(n,e){var t=It;It=t!==0&&4>t?t:4,n(!0);var r=yy.transition;yy.transition={};try{n(!1),e()}finally{It=t,yy.transition=r}}function ak(){return Di().memoizedState}function vL(n,e,t){var r=Ko(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},uk(n))lk(e,t);else if(t=jA(n,e,t,r),t!==null){var i=Nr();ts(t,n,r,i),ck(t,e,r)}}function yL(n,e,t){var r=Ko(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(uk(n))lk(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,u=s(o,t);if(i.hasEagerState=!0,i.eagerState=u,rs(u,o)){var d=e.interleaved;d===null?(i.next=i,fC(e)):(i.next=d.next,d.next=i),e.interleaved=i;return}}catch{}finally{}t=jA(n,e,i,r),t!==null&&(i=Nr(),ts(t,n,r,i),ck(t,e,r))}}function uk(n){var e=n.alternate;return n===Yt||e!==null&&e===Yt}function lk(n,e){Ud=Rm=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function ck(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Zw(n,t)}}var _m={readContext:Ni,useCallback:sr,useContext:sr,useEffect:sr,useImperativeHandle:sr,useInsertionEffect:sr,useLayoutEffect:sr,useMemo:sr,useReducer:sr,useRef:sr,useState:sr,useDebugValue:sr,useDeferredValue:sr,useTransition:sr,useMutableSource:sr,useSyncExternalStore:sr,useId:sr,unstable_isNewReconciler:!1},SL={readContext:Ni,useCallback:function(n,e){return vs().memoizedState=[n,e===void 0?null:e],n},useContext:Ni,useEffect:A2,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Wp(4194308,4,nk.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Wp(4194308,4,n,e)},useInsertionEffect:function(n,e){return Wp(4,2,n,e)},useMemo:function(n,e){var t=vs();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=vs();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=vL.bind(null,Yt,n),[r.memoizedState,n]},useRef:function(n){var e=vs();return n={current:n},e.memoizedState=n},useState:I2,useDebugValue:CC,useDeferredValue:function(n){return vs().memoizedState=n},useTransition:function(){var n=I2(!1),e=n[0];return n=gL.bind(null,n[1]),vs().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Yt,i=vs();if(Wt){if(t===void 0)throw Error(Le(407));t=t()}else{if(t=e(),On===null)throw Error(Le(349));hu&30||KA(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,A2(QA.bind(null,r,s,n),[n]),r.flags|=2048,vh(9,JA.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=vs(),e=On.identifierPrefix;if(Wt){var t=no,r=to;t=(r&~(1<<32-es(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=mh++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=mL++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},bL={readContext:Ni,useCallback:ik,useContext:Ni,useEffect:wC,useImperativeHandle:rk,useInsertionEffect:ek,useLayoutEffect:tk,useMemo:sk,useReducer:Sy,useRef:ZA,useState:function(){return Sy(gh)},useDebugValue:CC,useDeferredValue:function(n){var e=Di();return ok(e,Cn.memoizedState,n)},useTransition:function(){var n=Sy(gh)[0],e=Di().memoizedState;return[n,e]},useMutableSource:WA,useSyncExternalStore:GA,useId:ak,unstable_isNewReconciler:!1},wL={readContext:Ni,useCallback:ik,useContext:Ni,useEffect:wC,useImperativeHandle:rk,useInsertionEffect:ek,useLayoutEffect:tk,useMemo:sk,useReducer:by,useRef:ZA,useState:function(){return by(gh)},useDebugValue:CC,useDeferredValue:function(n){var e=Di();return Cn===null?e.memoizedState=n:ok(e,Cn.memoizedState,n)},useTransition:function(){var n=by(gh)[0],e=Di().memoizedState;return[n,e]},useMutableSource:WA,useSyncExternalStore:GA,useId:ak,unstable_isNewReconciler:!1};function Jl(n,e){try{var t="",r=e;do t+=JD(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function wy(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function rb(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var CL=typeof WeakMap=="function"?WeakMap:Map;function dk(n,e,t){t=io(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Am||(Am=!0,fb=r),rb(n,e)},t}function hk(n,e,t){t=io(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){rb(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){rb(n,e),typeof r!="function"&&(Go===null?Go=new Set([this]):Go.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function k2(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new CL;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=LL.bind(null,n,e,t),e.then(n,n))}function O2(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function F2(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=io(-1,1),e.tag=2,Wo(t,e,1))),t.lanes|=1),n)}var xL=vo.ReactCurrentOwner,Vr=!1;function Ar(n,e,t,r){e.child=n===null?HA(e,null,t,r):Gl(e,n.child,t,r)}function N2(n,e,t,r,i){t=t.render;var s=e.ref;return kl(e,i),r=SC(n,e,t,r,s,i),t=bC(),n!==null&&!Vr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,fo(n,e,i)):(Wt&&t&&aC(e),e.flags|=1,Ar(n,e,r,i),e.child)}function D2(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!AC(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,fk(n,e,s,r,i)):(n=Qp(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:lh,t(o,r)&&n.ref===e.ref)return fo(n,e,i)}return e.flags|=1,n=Jo(s,r),n.ref=e.ref,n.return=e,e.child=n}function fk(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(lh(s,r)&&n.ref===e.ref)if(Vr=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(Vr=!0);else return e.lanes=n.lanes,fo(n,e,i)}return ib(n,e,t,r,i)}function pk(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Dt(El,ni),ni|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Dt(El,ni),ni|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,Dt(El,ni),ni|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,Dt(El,ni),ni|=r;return Ar(n,e,i,t),e.child}function mk(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function ib(n,e,t,r,i){var s=Gr(t)?cu:xr.current;return s=Vl(e,s),kl(e,i),t=SC(n,e,t,r,s,i),r=bC(),n!==null&&!Vr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,fo(n,e,i)):(Wt&&r&&aC(e),e.flags|=1,Ar(n,e,t,i),e.child)}function L2(n,e,t,r,i){if(Gr(t)){var s=!0;bm(e)}else s=!1;if(kl(e,i),e.stateNode===null)Gp(n,e),zA(e,t,r),nb(e,t,r,i),r=!0;else if(n===null){var o=e.stateNode,u=e.memoizedProps;o.props=u;var d=o.context,f=t.contextType;typeof f=="object"&&f!==null?f=Ni(f):(f=Gr(t)?cu:xr.current,f=Vl(e,f));var m=t.getDerivedStateFromProps,g=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function";g||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(u!==r||d!==f)&&R2(e,o,r,f),_o=!1;var P=e.memoizedState;o.state=P,Tm(e,r,o,i),d=e.memoizedState,u!==r||P!==d||Wr.current||_o?(typeof m=="function"&&(tb(e,t,m,r),d=e.memoizedState),(u=_o||P2(e,t,u,r,P,d,f))?(g||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=d),o.props=r,o.state=d,o.context=f,r=u):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,qA(n,e),u=e.memoizedProps,f=e.type===e.elementType?u:Wi(e.type,u),o.props=f,g=e.pendingProps,P=o.context,d=t.contextType,typeof d=="object"&&d!==null?d=Ni(d):(d=Gr(t)?cu:xr.current,d=Vl(e,d));var D=t.getDerivedStateFromProps;(m=typeof D=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(u!==g||P!==d)&&R2(e,o,r,d),_o=!1,P=e.memoizedState,o.state=P,Tm(e,r,o,i);var M=e.memoizedState;u!==g||P!==M||Wr.current||_o?(typeof D=="function"&&(tb(e,t,D,r),M=e.memoizedState),(f=_o||P2(e,t,f,r,P,M,d)||!1)?(m||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,M,d),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,M,d)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||u===n.memoizedProps&&P===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||u===n.memoizedProps&&P===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=M),o.props=r,o.state=M,o.context=d,r=f):(typeof o.componentDidUpdate!="function"||u===n.memoizedProps&&P===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||u===n.memoizedProps&&P===n.memoizedState||(e.flags|=1024),r=!1)}return sb(n,e,t,r,s,i)}function sb(n,e,t,r,i,s){mk(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&w2(e,t,!1),fo(n,e,s);r=e.stateNode,xL.current=e;var u=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Gl(e,n.child,null,s),e.child=Gl(e,null,u,s)):Ar(n,e,u,s),e.memoizedState=r.state,i&&w2(e,t,!0),e.child}function gk(n){var e=n.stateNode;e.pendingContext?b2(n,e.pendingContext,e.pendingContext!==e.context):e.context&&b2(n,e.context,!1),mC(n,e.containerInfo)}function M2(n,e,t,r,i){return Wl(),lC(i),e.flags|=256,Ar(n,e,t,r),e.child}var ob={dehydrated:null,treeContext:null,retryLane:0};function ab(n){return{baseLanes:n,cachePool:null,transitions:null}}function vk(n,e,t){var r=e.pendingProps,i=Qt.current,s=!1,o=(e.flags&128)!==0,u;if((u=o)||(u=n!==null&&n.memoizedState===null?!1:(i&2)!==0),u?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Dt(Qt,i&1),n===null)return Z1(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=mg(o,r,0,null),n=iu(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=ab(t),e.memoizedState=ob,n):xC(e,o));if(i=n.memoizedState,i!==null&&(u=i.dehydrated,u!==null))return EL(n,e,o,r,u,i,t);if(s){s=r.fallback,o=e.mode,i=n.child,u=i.sibling;var d={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=d,e.deletions=null):(r=Jo(i,d),r.subtreeFlags=i.subtreeFlags&14680064),u!==null?s=Jo(u,s):(s=iu(s,o,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=n.child.memoizedState,o=o===null?ab(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=ob,r}return s=n.child,n=s.sibling,r=Jo(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function xC(n,e){return e=mg({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function dp(n,e,t,r){return r!==null&&lC(r),Gl(e,n.child,null,t),n=xC(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function EL(n,e,t,r,i,s,o){if(t)return e.flags&256?(e.flags&=-257,r=wy(Error(Le(422))),dp(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=mg({mode:"visible",children:r.children},i,0,null),s=iu(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Gl(e,n.child,null,o),e.child.memoizedState=ab(o),e.memoizedState=ob,s);if(!(e.mode&1))return dp(n,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var u=r.dgst;return r=u,s=Error(Le(419)),r=wy(s,r,void 0),dp(n,e,o,r)}if(u=(o&n.childLanes)!==0,Vr||u){if(r=On,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,ho(n,i),ts(r,n,i,-1))}return IC(),r=wy(Error(Le(421))),dp(n,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=ML.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,li=Vo(i.nextSibling),di=e,Wt=!0,Qi=null,n!==null&&(Ei[Ti++]=to,Ei[Ti++]=no,Ei[Ti++]=du,to=n.id,no=n.overflow,du=e),e=xC(e,r.children),e.flags|=4096,e)}function B2(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),eb(n.return,e,t)}function Cy(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function yk(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Ar(n,e,r.children,t),r=Qt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&B2(n,t,e);else if(n.tag===19)B2(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Dt(Qt,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&Pm(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),Cy(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Pm(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}Cy(e,!0,t,null,s);break;case"together":Cy(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Gp(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function fo(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),fu|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Le(153));if(e.child!==null){for(n=e.child,t=Jo(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Jo(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function TL(n,e,t){switch(e.tag){case 3:gk(e),Wl();break;case 5:VA(e);break;case 1:Gr(e.type)&&bm(e);break;case 4:mC(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Dt(xm,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Dt(Qt,Qt.current&1),e.flags|=128,null):t&e.child.childLanes?vk(n,e,t):(Dt(Qt,Qt.current&1),n=fo(n,e,t),n!==null?n.sibling:null);Dt(Qt,Qt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return yk(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Dt(Qt,Qt.current),r)break;return null;case 22:case 23:return e.lanes=0,pk(n,e,t)}return fo(n,e,t)}var Sk,ub,bk,wk;Sk=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};ub=function(){};bk=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Za(Ps.current);var s=null;switch(t){case"input":i=A1(n,i),r=A1(n,r),s=[];break;case"select":i=Zt({},i,{value:void 0}),r=Zt({},r,{value:void 0}),s=[];break;case"textarea":i=F1(n,i),r=F1(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=ym)}D1(t,r);var o;t=null;for(f in i)if(!r.hasOwnProperty(f)&&i.hasOwnProperty(f)&&i[f]!=null)if(f==="style"){var u=i[f];for(o in u)u.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else f!=="dangerouslySetInnerHTML"&&f!=="children"&&f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(nh.hasOwnProperty(f)?s||(s=[]):(s=s||[]).push(f,null));for(f in r){var d=r[f];if(u=i!=null?i[f]:void 0,r.hasOwnProperty(f)&&d!==u&&(d!=null||u!=null))if(f==="style")if(u){for(o in u)!u.hasOwnProperty(o)||d&&d.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in d)d.hasOwnProperty(o)&&u[o]!==d[o]&&(t||(t={}),t[o]=d[o])}else t||(s||(s=[]),s.push(f,t)),t=d;else f==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,u=u?u.__html:void 0,d!=null&&u!==d&&(s=s||[]).push(f,d)):f==="children"?typeof d!="string"&&typeof d!="number"||(s=s||[]).push(f,""+d):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&(nh.hasOwnProperty(f)?(d!=null&&f==="onScroll"&&Mt("scroll",n),s||u===d||(s=[])):(s=s||[]).push(f,d))}t&&(s=s||[]).push("style",t);var f=s;(e.updateQueue=f)&&(e.flags|=4)}};wk=function(n,e,t,r){t!==r&&(e.flags|=4)};function ad(n,e){if(!Wt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function or(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function PL(n,e,t){var r=e.pendingProps;switch(uC(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return or(e),null;case 1:return Gr(e.type)&&Sm(),or(e),null;case 3:return r=e.stateNode,Kl(),Ut(Wr),Ut(xr),vC(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(lp(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Qi!==null&&(gb(Qi),Qi=null))),ub(n,e),or(e),null;case 5:gC(e);var i=Za(ph.current);if(t=e.type,n!==null&&e.stateNode!=null)bk(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Le(166));return or(e),null}if(n=Za(Ps.current),lp(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[ws]=e,r[hh]=s,n=(e.mode&1)!==0,t){case"dialog":Mt("cancel",r),Mt("close",r);break;case"iframe":case"object":case"embed":Mt("load",r);break;case"video":case"audio":for(i=0;i<Nd.length;i++)Mt(Nd[i],r);break;case"source":Mt("error",r);break;case"img":case"image":case"link":Mt("error",r),Mt("load",r);break;case"details":Mt("toggle",r);break;case"input":GE(r,s),Mt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Mt("invalid",r);break;case"textarea":JE(r,s),Mt("invalid",r)}D1(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var u=s[o];o==="children"?typeof u=="string"?r.textContent!==u&&(s.suppressHydrationWarning!==!0&&up(r.textContent,u,n),i=["children",u]):typeof u=="number"&&r.textContent!==""+u&&(s.suppressHydrationWarning!==!0&&up(r.textContent,u,n),i=["children",""+u]):nh.hasOwnProperty(o)&&u!=null&&o==="onScroll"&&Mt("scroll",r)}switch(t){case"input":ep(r),KE(r,s,!0);break;case"textarea":ep(r),QE(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=ym)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=KI(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[ws]=e,n[hh]=r,Sk(n,e,!1,!1),e.stateNode=n;e:{switch(o=L1(t,r),t){case"dialog":Mt("cancel",n),Mt("close",n),i=r;break;case"iframe":case"object":case"embed":Mt("load",n),i=r;break;case"video":case"audio":for(i=0;i<Nd.length;i++)Mt(Nd[i],n);i=r;break;case"source":Mt("error",n),i=r;break;case"img":case"image":case"link":Mt("error",n),Mt("load",n),i=r;break;case"details":Mt("toggle",n),i=r;break;case"input":GE(n,r),i=A1(n,r),Mt("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=Zt({},r,{value:void 0}),Mt("invalid",n);break;case"textarea":JE(n,r),i=F1(n,r),Mt("invalid",n);break;default:i=r}D1(t,i),u=i;for(s in u)if(u.hasOwnProperty(s)){var d=u[s];s==="style"?XI(n,d):s==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&JI(n,d)):s==="children"?typeof d=="string"?(t!=="textarea"||d!=="")&&rh(n,d):typeof d=="number"&&rh(n,""+d):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(nh.hasOwnProperty(s)?d!=null&&s==="onScroll"&&Mt("scroll",n):d!=null&&Gw(n,s,d,o))}switch(t){case"input":ep(n),KE(n,r,!1);break;case"textarea":ep(n),QE(n);break;case"option":r.value!=null&&n.setAttribute("value",""+na(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?Rl(n,!!r.multiple,s,!1):r.defaultValue!=null&&Rl(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=ym)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return or(e),null;case 6:if(n&&e.stateNode!=null)wk(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Le(166));if(t=Za(ph.current),Za(Ps.current),lp(e)){if(r=e.stateNode,t=e.memoizedProps,r[ws]=e,(s=r.nodeValue!==t)&&(n=di,n!==null))switch(n.tag){case 3:up(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&up(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[ws]=e,e.stateNode=r}return or(e),null;case 13:if(Ut(Qt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Wt&&li!==null&&e.mode&1&&!(e.flags&128))BA(),Wl(),e.flags|=98560,s=!1;else if(s=lp(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error(Le(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Le(317));s[ws]=e}else Wl(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;or(e),s=!1}else Qi!==null&&(gb(Qi),Qi=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Qt.current&1?Tn===0&&(Tn=3):IC())),e.updateQueue!==null&&(e.flags|=4),or(e),null);case 4:return Kl(),ub(n,e),n===null&&ch(e.stateNode.containerInfo),or(e),null;case 10:return hC(e.type._context),or(e),null;case 17:return Gr(e.type)&&Sm(),or(e),null;case 19:if(Ut(Qt),s=e.memoizedState,s===null)return or(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)ad(s,!1);else{if(Tn!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Pm(n),o!==null){for(e.flags|=128,ad(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Dt(Qt,Qt.current&1|2),e.child}n=n.sibling}s.tail!==null&&on()>Ql&&(e.flags|=128,r=!0,ad(s,!1),e.lanes=4194304)}else{if(!r)if(n=Pm(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),ad(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Wt)return or(e),null}else 2*on()-s.renderingStartTime>Ql&&t!==1073741824&&(e.flags|=128,r=!0,ad(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=on(),e.sibling=null,t=Qt.current,Dt(Qt,r?t&1|2:t&1),e):(or(e),null);case 22:case 23:return _C(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ni&1073741824&&(or(e),e.subtreeFlags&6&&(e.flags|=8192)):or(e),null;case 24:return null;case 25:return null}throw Error(Le(156,e.tag))}function RL(n,e){switch(uC(e),e.tag){case 1:return Gr(e.type)&&Sm(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Kl(),Ut(Wr),Ut(xr),vC(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return gC(e),null;case 13:if(Ut(Qt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Le(340));Wl()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Ut(Qt),null;case 4:return Kl(),null;case 10:return hC(e.type._context),null;case 22:case 23:return _C(),null;case 24:return null;default:return null}}var hp=!1,br=!1,_L=typeof WeakSet=="function"?WeakSet:Set,We=null;function xl(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){tn(n,e,r)}else t.current=null}function lb(n,e,t){try{t()}catch(r){tn(n,e,r)}}var j2=!1;function IL(n,e){if(W1=mm,n=TA(),oC(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,u=-1,d=-1,f=0,m=0,g=n,P=null;t:for(;;){for(var D;g!==t||i!==0&&g.nodeType!==3||(u=o+i),g!==s||r!==0&&g.nodeType!==3||(d=o+r),g.nodeType===3&&(o+=g.nodeValue.length),(D=g.firstChild)!==null;)P=g,g=D;for(;;){if(g===n)break t;if(P===t&&++f===i&&(u=o),P===s&&++m===r&&(d=o),(D=g.nextSibling)!==null)break;g=P,P=g.parentNode}g=D}t=u===-1||d===-1?null:{start:u,end:d}}else t=null}t=t||{start:0,end:0}}else t=null;for(G1={focusedElem:n,selectionRange:t},mm=!1,We=e;We!==null;)if(e=We,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,We=n;else for(;We!==null;){e=We;try{var M=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var U=M.memoizedProps,j=M.memoizedState,E=e.stateNode,k=E.getSnapshotBeforeUpdate(e.elementType===e.type?U:Wi(e.type,U),j);E.__reactInternalSnapshotBeforeUpdate=k}break;case 3:var z=e.stateNode.containerInfo;z.nodeType===1?z.textContent="":z.nodeType===9&&z.documentElement&&z.removeChild(z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Le(163))}}catch(K){tn(e,e.return,K)}if(n=e.sibling,n!==null){n.return=e.return,We=n;break}We=e.return}return M=j2,j2=!1,M}function zd(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&lb(e,t,s)}i=i.next}while(i!==r)}}function fg(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function cb(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function Ck(n){var e=n.alternate;e!==null&&(n.alternate=null,Ck(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[ws],delete e[hh],delete e[Q1],delete e[dL],delete e[hL])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function xk(n){return n.tag===5||n.tag===3||n.tag===4}function q2(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||xk(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function db(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=ym));else if(r!==4&&(n=n.child,n!==null))for(db(n,e,t),n=n.sibling;n!==null;)db(n,e,t),n=n.sibling}function hb(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(hb(n,e,t),n=n.sibling;n!==null;)hb(n,e,t),n=n.sibling}var Kn=null,Gi=!1;function Eo(n,e,t){for(t=t.child;t!==null;)Ek(n,e,t),t=t.sibling}function Ek(n,e,t){if(Ts&&typeof Ts.onCommitFiberUnmount=="function")try{Ts.onCommitFiberUnmount(sg,t)}catch{}switch(t.tag){case 5:br||xl(t,e);case 6:var r=Kn,i=Gi;Kn=null,Eo(n,e,t),Kn=r,Gi=i,Kn!==null&&(Gi?(n=Kn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Kn.removeChild(t.stateNode));break;case 18:Kn!==null&&(Gi?(n=Kn,t=t.stateNode,n.nodeType===8?my(n.parentNode,t):n.nodeType===1&&my(n,t),ah(n)):my(Kn,t.stateNode));break;case 4:r=Kn,i=Gi,Kn=t.stateNode.containerInfo,Gi=!0,Eo(n,e,t),Kn=r,Gi=i;break;case 0:case 11:case 14:case 15:if(!br&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&lb(t,e,o),i=i.next}while(i!==r)}Eo(n,e,t);break;case 1:if(!br&&(xl(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(u){tn(t,e,u)}Eo(n,e,t);break;case 21:Eo(n,e,t);break;case 22:t.mode&1?(br=(r=br)||t.memoizedState!==null,Eo(n,e,t),br=r):Eo(n,e,t);break;default:Eo(n,e,t)}}function U2(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new _L),e.forEach(function(r){var i=BL.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function Hi(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,o=e,u=o;e:for(;u!==null;){switch(u.tag){case 5:Kn=u.stateNode,Gi=!1;break e;case 3:Kn=u.stateNode.containerInfo,Gi=!0;break e;case 4:Kn=u.stateNode.containerInfo,Gi=!0;break e}u=u.return}if(Kn===null)throw Error(Le(160));Ek(s,o,i),Kn=null,Gi=!1;var d=i.alternate;d!==null&&(d.return=null),i.return=null}catch(f){tn(i,e,f)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Tk(e,n),e=e.sibling}function Tk(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Hi(e,n),fs(n),r&4){try{zd(3,n,n.return),fg(3,n)}catch(U){tn(n,n.return,U)}try{zd(5,n,n.return)}catch(U){tn(n,n.return,U)}}break;case 1:Hi(e,n),fs(n),r&512&&t!==null&&xl(t,t.return);break;case 5:if(Hi(e,n),fs(n),r&512&&t!==null&&xl(t,t.return),n.flags&32){var i=n.stateNode;try{rh(i,"")}catch(U){tn(n,n.return,U)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,u=n.type,d=n.updateQueue;if(n.updateQueue=null,d!==null)try{u==="input"&&s.type==="radio"&&s.name!=null&&WI(i,s),L1(u,o);var f=L1(u,s);for(o=0;o<d.length;o+=2){var m=d[o],g=d[o+1];m==="style"?XI(i,g):m==="dangerouslySetInnerHTML"?JI(i,g):m==="children"?rh(i,g):Gw(i,m,g,f)}switch(u){case"input":k1(i,s);break;case"textarea":GI(i,s);break;case"select":var P=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var D=s.value;D!=null?Rl(i,!!s.multiple,D,!1):P!==!!s.multiple&&(s.defaultValue!=null?Rl(i,!!s.multiple,s.defaultValue,!0):Rl(i,!!s.multiple,s.multiple?[]:"",!1))}i[hh]=s}catch(U){tn(n,n.return,U)}}break;case 6:if(Hi(e,n),fs(n),r&4){if(n.stateNode===null)throw Error(Le(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(U){tn(n,n.return,U)}}break;case 3:if(Hi(e,n),fs(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{ah(e.containerInfo)}catch(U){tn(n,n.return,U)}break;case 4:Hi(e,n),fs(n);break;case 13:Hi(e,n),fs(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(PC=on())),r&4&&U2(n);break;case 22:if(m=t!==null&&t.memoizedState!==null,n.mode&1?(br=(f=br)||m,Hi(e,n),br=f):Hi(e,n),fs(n),r&8192){if(f=n.memoizedState!==null,(n.stateNode.isHidden=f)&&!m&&n.mode&1)for(We=n,m=n.child;m!==null;){for(g=We=m;We!==null;){switch(P=We,D=P.child,P.tag){case 0:case 11:case 14:case 15:zd(4,P,P.return);break;case 1:xl(P,P.return);var M=P.stateNode;if(typeof M.componentWillUnmount=="function"){r=P,t=P.return;try{e=r,M.props=e.memoizedProps,M.state=e.memoizedState,M.componentWillUnmount()}catch(U){tn(r,t,U)}}break;case 5:xl(P,P.return);break;case 22:if(P.memoizedState!==null){$2(g);continue}}D!==null?(D.return=P,We=D):$2(g)}m=m.sibling}e:for(m=null,g=n;;){if(g.tag===5){if(m===null){m=g;try{i=g.stateNode,f?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(u=g.stateNode,d=g.memoizedProps.style,o=d!=null&&d.hasOwnProperty("display")?d.display:null,u.style.display=QI("display",o))}catch(U){tn(n,n.return,U)}}}else if(g.tag===6){if(m===null)try{g.stateNode.nodeValue=f?"":g.memoizedProps}catch(U){tn(n,n.return,U)}}else if((g.tag!==22&&g.tag!==23||g.memoizedState===null||g===n)&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===n)break e;for(;g.sibling===null;){if(g.return===null||g.return===n)break e;m===g&&(m=null),g=g.return}m===g&&(m=null),g.sibling.return=g.return,g=g.sibling}}break;case 19:Hi(e,n),fs(n),r&4&&U2(n);break;case 21:break;default:Hi(e,n),fs(n)}}function fs(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(xk(t)){var r=t;break e}t=t.return}throw Error(Le(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(rh(i,""),r.flags&=-33);var s=q2(n);hb(n,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,u=q2(n);db(n,u,o);break;default:throw Error(Le(161))}}catch(d){tn(n,n.return,d)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function AL(n,e,t){We=n,Pk(n)}function Pk(n,e,t){for(var r=(n.mode&1)!==0;We!==null;){var i=We,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||hp;if(!o){var u=i.alternate,d=u!==null&&u.memoizedState!==null||br;u=hp;var f=br;if(hp=o,(br=d)&&!f)for(We=i;We!==null;)o=We,d=o.child,o.tag===22&&o.memoizedState!==null?H2(i):d!==null?(d.return=o,We=d):H2(i);for(;s!==null;)We=s,Pk(s),s=s.sibling;We=i,hp=u,br=f}z2(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,We=s):z2(n)}}function z2(n){for(;We!==null;){var e=We;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:br||fg(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!br)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Wi(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&T2(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}T2(e,o,t)}break;case 5:var u=e.stateNode;if(t===null&&e.flags&4){t=u;var d=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&t.focus();break;case"img":d.src&&(t.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var f=e.alternate;if(f!==null){var m=f.memoizedState;if(m!==null){var g=m.dehydrated;g!==null&&ah(g)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Le(163))}br||e.flags&512&&cb(e)}catch(P){tn(e,e.return,P)}}if(e===n){We=null;break}if(t=e.sibling,t!==null){t.return=e.return,We=t;break}We=e.return}}function $2(n){for(;We!==null;){var e=We;if(e===n){We=null;break}var t=e.sibling;if(t!==null){t.return=e.return,We=t;break}We=e.return}}function H2(n){for(;We!==null;){var e=We;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{fg(4,e)}catch(d){tn(e,t,d)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(d){tn(e,i,d)}}var s=e.return;try{cb(e)}catch(d){tn(e,s,d)}break;case 5:var o=e.return;try{cb(e)}catch(d){tn(e,o,d)}}}catch(d){tn(e,e.return,d)}if(e===n){We=null;break}var u=e.sibling;if(u!==null){u.return=e.return,We=u;break}We=e.return}}var kL=Math.ceil,Im=vo.ReactCurrentDispatcher,EC=vo.ReactCurrentOwner,ki=vo.ReactCurrentBatchConfig,vt=0,On=null,fn=null,Yn=0,ni=0,El=aa(0),Tn=0,yh=null,fu=0,pg=0,TC=0,$d=null,$r=null,PC=0,Ql=1/0,Ks=null,Am=!1,fb=null,Go=null,fp=!1,Fo=null,km=0,Hd=0,pb=null,Kp=-1,Jp=0;function Nr(){return vt&6?on():Kp!==-1?Kp:Kp=on()}function Ko(n){return n.mode&1?vt&2&&Yn!==0?Yn&-Yn:pL.transition!==null?(Jp===0&&(Jp=lA()),Jp):(n=It,n!==0||(n=window.event,n=n===void 0?16:gA(n.type)),n):1}function ts(n,e,t,r){if(50<Hd)throw Hd=0,pb=null,Error(Le(185));Dh(n,t,r),(!(vt&2)||n!==On)&&(n===On&&(!(vt&2)&&(pg|=t),Tn===4&&ko(n,Yn)),Kr(n,r),t===1&&vt===0&&!(e.mode&1)&&(Ql=on()+500,cg&&ua()))}function Kr(n,e){var t=n.callbackNode;p4(n,e);var r=pm(n,n===On?Yn:0);if(r===0)t!==null&&ZE(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&ZE(t),e===1)n.tag===0?fL(V2.bind(null,n)):DA(V2.bind(null,n)),lL(function(){!(vt&6)&&ua()}),t=null;else{switch(cA(r)){case 1:t=Yw;break;case 4:t=aA;break;case 16:t=fm;break;case 536870912:t=uA;break;default:t=fm}t=Nk(t,Rk.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function Rk(n,e){if(Kp=-1,Jp=0,vt&6)throw Error(Le(327));var t=n.callbackNode;if(Ol()&&n.callbackNode!==t)return null;var r=pm(n,n===On?Yn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Om(n,r);else{e=r;var i=vt;vt|=2;var s=Ik();(On!==n||Yn!==e)&&(Ks=null,Ql=on()+500,ru(n,e));do try{NL();break}catch(u){_k(n,u)}while(1);dC(),Im.current=s,vt=i,fn!==null?e=0:(On=null,Yn=0,e=Tn)}if(e!==0){if(e===2&&(i=U1(n),i!==0&&(r=i,e=mb(n,i))),e===1)throw t=yh,ru(n,0),ko(n,r),Kr(n,on()),t;if(e===6)ko(n,r);else{if(i=n.current.alternate,!(r&30)&&!OL(i)&&(e=Om(n,r),e===2&&(s=U1(n),s!==0&&(r=s,e=mb(n,s))),e===1))throw t=yh,ru(n,0),ko(n,r),Kr(n,on()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(Le(345));case 2:Oa(n,$r,Ks);break;case 3:if(ko(n,r),(r&130023424)===r&&(e=PC+500-on(),10<e)){if(pm(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Nr(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=J1(Oa.bind(null,n,$r,Ks),e);break}Oa(n,$r,Ks);break;case 4:if(ko(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var o=31-es(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=on()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*kL(r/1960))-r,10<r){n.timeoutHandle=J1(Oa.bind(null,n,$r,Ks),r);break}Oa(n,$r,Ks);break;case 5:Oa(n,$r,Ks);break;default:throw Error(Le(329))}}}return Kr(n,on()),n.callbackNode===t?Rk.bind(null,n):null}function mb(n,e){var t=$d;return n.current.memoizedState.isDehydrated&&(ru(n,e).flags|=256),n=Om(n,e),n!==2&&(e=$r,$r=t,e!==null&&gb(e)),n}function gb(n){$r===null?$r=n:$r.push.apply($r,n)}function OL(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!rs(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ko(n,e){for(e&=~TC,e&=~pg,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-es(e),r=1<<t;n[t]=-1,e&=~r}}function V2(n){if(vt&6)throw Error(Le(327));Ol();var e=pm(n,0);if(!(e&1))return Kr(n,on()),null;var t=Om(n,e);if(n.tag!==0&&t===2){var r=U1(n);r!==0&&(e=r,t=mb(n,r))}if(t===1)throw t=yh,ru(n,0),ko(n,e),Kr(n,on()),t;if(t===6)throw Error(Le(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Oa(n,$r,Ks),Kr(n,on()),null}function RC(n,e){var t=vt;vt|=1;try{return n(e)}finally{vt=t,vt===0&&(Ql=on()+500,cg&&ua())}}function pu(n){Fo!==null&&Fo.tag===0&&!(vt&6)&&Ol();var e=vt;vt|=1;var t=ki.transition,r=It;try{if(ki.transition=null,It=1,n)return n()}finally{It=r,ki.transition=t,vt=e,!(vt&6)&&ua()}}function _C(){ni=El.current,Ut(El)}function ru(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,uL(t)),fn!==null)for(t=fn.return;t!==null;){var r=t;switch(uC(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Sm();break;case 3:Kl(),Ut(Wr),Ut(xr),vC();break;case 5:gC(r);break;case 4:Kl();break;case 13:Ut(Qt);break;case 19:Ut(Qt);break;case 10:hC(r.type._context);break;case 22:case 23:_C()}t=t.return}if(On=n,fn=n=Jo(n.current,null),Yn=ni=e,Tn=0,yh=null,TC=pg=fu=0,$r=$d=null,Ya!==null){for(e=0;e<Ya.length;e++)if(t=Ya[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}t.pending=r}Ya=null}return n}function _k(n,e){do{var t=fn;try{if(dC(),Vp.current=_m,Rm){for(var r=Yt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Rm=!1}if(hu=0,kn=Cn=Yt=null,Ud=!1,mh=0,EC.current=null,t===null||t.return===null){Tn=1,yh=e,fn=null;break}e:{var s=n,o=t.return,u=t,d=e;if(e=Yn,u.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var f=d,m=u,g=m.tag;if(!(m.mode&1)&&(g===0||g===11||g===15)){var P=m.alternate;P?(m.updateQueue=P.updateQueue,m.memoizedState=P.memoizedState,m.lanes=P.lanes):(m.updateQueue=null,m.memoizedState=null)}var D=O2(o);if(D!==null){D.flags&=-257,F2(D,o,u,s,e),D.mode&1&&k2(s,f,e),e=D,d=f;var M=e.updateQueue;if(M===null){var U=new Set;U.add(d),e.updateQueue=U}else M.add(d);break e}else{if(!(e&1)){k2(s,f,e),IC();break e}d=Error(Le(426))}}else if(Wt&&u.mode&1){var j=O2(o);if(j!==null){!(j.flags&65536)&&(j.flags|=256),F2(j,o,u,s,e),lC(Jl(d,u));break e}}s=d=Jl(d,u),Tn!==4&&(Tn=2),$d===null?$d=[s]:$d.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var E=dk(s,d,e);E2(s,E);break e;case 1:u=d;var k=s.type,z=s.stateNode;if(!(s.flags&128)&&(typeof k.getDerivedStateFromError=="function"||z!==null&&typeof z.componentDidCatch=="function"&&(Go===null||!Go.has(z)))){s.flags|=65536,e&=-e,s.lanes|=e;var K=hk(s,u,e);E2(s,K);break e}}s=s.return}while(s!==null)}kk(t)}catch(ie){e=ie,fn===t&&t!==null&&(fn=t=t.return);continue}break}while(1)}function Ik(){var n=Im.current;return Im.current=_m,n===null?_m:n}function IC(){(Tn===0||Tn===3||Tn===2)&&(Tn=4),On===null||!(fu&268435455)&&!(pg&268435455)||ko(On,Yn)}function Om(n,e){var t=vt;vt|=2;var r=Ik();(On!==n||Yn!==e)&&(Ks=null,ru(n,e));do try{FL();break}catch(i){_k(n,i)}while(1);if(dC(),vt=t,Im.current=r,fn!==null)throw Error(Le(261));return On=null,Yn=0,Tn}function FL(){for(;fn!==null;)Ak(fn)}function NL(){for(;fn!==null&&!s4();)Ak(fn)}function Ak(n){var e=Fk(n.alternate,n,ni);n.memoizedProps=n.pendingProps,e===null?kk(n):fn=e,EC.current=null}function kk(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=RL(t,e),t!==null){t.flags&=32767,fn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Tn=6,fn=null;return}}else if(t=PL(t,e,ni),t!==null){fn=t;return}if(e=e.sibling,e!==null){fn=e;return}fn=e=n}while(e!==null);Tn===0&&(Tn=5)}function Oa(n,e,t){var r=It,i=ki.transition;try{ki.transition=null,It=1,DL(n,e,t,r)}finally{ki.transition=i,It=r}return null}function DL(n,e,t,r){do Ol();while(Fo!==null);if(vt&6)throw Error(Le(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Le(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(m4(n,s),n===On&&(fn=On=null,Yn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||fp||(fp=!0,Nk(fm,function(){return Ol(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=ki.transition,ki.transition=null;var o=It;It=1;var u=vt;vt|=4,EC.current=null,IL(n,t),Tk(t,n),tL(G1),mm=!!W1,G1=W1=null,n.current=t,AL(t),o4(),vt=u,It=o,ki.transition=s}else n.current=t;if(fp&&(fp=!1,Fo=n,km=i),s=n.pendingLanes,s===0&&(Go=null),l4(t.stateNode),Kr(n,on()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Am)throw Am=!1,n=fb,fb=null,n;return km&1&&n.tag!==0&&Ol(),s=n.pendingLanes,s&1?n===pb?Hd++:(Hd=0,pb=n):Hd=0,ua(),null}function Ol(){if(Fo!==null){var n=cA(km),e=ki.transition,t=It;try{if(ki.transition=null,It=16>n?16:n,Fo===null)var r=!1;else{if(n=Fo,Fo=null,km=0,vt&6)throw Error(Le(331));var i=vt;for(vt|=4,We=n.current;We!==null;){var s=We,o=s.child;if(We.flags&16){var u=s.deletions;if(u!==null){for(var d=0;d<u.length;d++){var f=u[d];for(We=f;We!==null;){var m=We;switch(m.tag){case 0:case 11:case 15:zd(8,m,s)}var g=m.child;if(g!==null)g.return=m,We=g;else for(;We!==null;){m=We;var P=m.sibling,D=m.return;if(Ck(m),m===f){We=null;break}if(P!==null){P.return=D,We=P;break}We=D}}}var M=s.alternate;if(M!==null){var U=M.child;if(U!==null){M.child=null;do{var j=U.sibling;U.sibling=null,U=j}while(U!==null)}}We=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,We=o;else e:for(;We!==null;){if(s=We,s.flags&2048)switch(s.tag){case 0:case 11:case 15:zd(9,s,s.return)}var E=s.sibling;if(E!==null){E.return=s.return,We=E;break e}We=s.return}}var k=n.current;for(We=k;We!==null;){o=We;var z=o.child;if(o.subtreeFlags&2064&&z!==null)z.return=o,We=z;else e:for(o=k;We!==null;){if(u=We,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:fg(9,u)}}catch(ie){tn(u,u.return,ie)}if(u===o){We=null;break e}var K=u.sibling;if(K!==null){K.return=u.return,We=K;break e}We=u.return}}if(vt=i,ua(),Ts&&typeof Ts.onPostCommitFiberRoot=="function")try{Ts.onPostCommitFiberRoot(sg,n)}catch{}r=!0}return r}finally{It=t,ki.transition=e}}return!1}function W2(n,e,t){e=Jl(t,e),e=dk(n,e,1),n=Wo(n,e,1),e=Nr(),n!==null&&(Dh(n,1,e),Kr(n,e))}function tn(n,e,t){if(n.tag===3)W2(n,n,t);else for(;e!==null;){if(e.tag===3){W2(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Go===null||!Go.has(r))){n=Jl(t,n),n=hk(e,n,1),e=Wo(e,n,1),n=Nr(),e!==null&&(Dh(e,1,n),Kr(e,n));break}}e=e.return}}function LL(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Nr(),n.pingedLanes|=n.suspendedLanes&t,On===n&&(Yn&t)===t&&(Tn===4||Tn===3&&(Yn&130023424)===Yn&&500>on()-PC?ru(n,0):TC|=t),Kr(n,e)}function Ok(n,e){e===0&&(n.mode&1?(e=rp,rp<<=1,!(rp&130023424)&&(rp=4194304)):e=1);var t=Nr();n=ho(n,e),n!==null&&(Dh(n,e,t),Kr(n,t))}function ML(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),Ok(n,t)}function BL(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Le(314))}r!==null&&r.delete(e),Ok(n,t)}var Fk;Fk=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Wr.current)Vr=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Vr=!1,TL(n,e,t);Vr=!!(n.flags&131072)}else Vr=!1,Wt&&e.flags&1048576&&LA(e,Cm,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Gp(n,e),n=e.pendingProps;var i=Vl(e,xr.current);kl(e,t),i=SC(null,e,r,n,i,t);var s=bC();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Gr(r)?(s=!0,bm(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,pC(e),i.updater=dg,e.stateNode=i,i._reactInternals=e,nb(e,r,n,t),e=sb(null,e,r,!0,s,t)):(e.tag=0,Wt&&s&&aC(e),Ar(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Gp(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=qL(r),n=Wi(r,n),i){case 0:e=ib(null,e,r,n,t);break e;case 1:e=L2(null,e,r,n,t);break e;case 11:e=N2(null,e,r,n,t);break e;case 14:e=D2(null,e,r,Wi(r.type,n),t);break e}throw Error(Le(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Wi(r,i),ib(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Wi(r,i),L2(n,e,r,i,t);case 3:e:{if(gk(e),n===null)throw Error(Le(387));r=e.pendingProps,s=e.memoizedState,i=s.element,qA(n,e),Tm(e,r,null,t);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Jl(Error(Le(423)),e),e=M2(n,e,r,t,i);break e}else if(r!==i){i=Jl(Error(Le(424)),e),e=M2(n,e,r,t,i);break e}else for(li=Vo(e.stateNode.containerInfo.firstChild),di=e,Wt=!0,Qi=null,t=HA(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Wl(),r===i){e=fo(n,e,t);break e}Ar(n,e,r,t)}e=e.child}return e;case 5:return VA(e),n===null&&Z1(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,o=i.children,K1(r,i)?o=null:s!==null&&K1(r,s)&&(e.flags|=32),mk(n,e),Ar(n,e,o,t),e.child;case 6:return n===null&&Z1(e),null;case 13:return vk(n,e,t);case 4:return mC(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Gl(e,null,r,t):Ar(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Wi(r,i),N2(n,e,r,i,t);case 7:return Ar(n,e,e.pendingProps,t),e.child;case 8:return Ar(n,e,e.pendingProps.children,t),e.child;case 12:return Ar(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,Dt(xm,r._currentValue),r._currentValue=o,s!==null)if(rs(s.value,o)){if(s.children===i.children&&!Wr.current){e=fo(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var u=s.dependencies;if(u!==null){o=s.child;for(var d=u.firstContext;d!==null;){if(d.context===r){if(s.tag===1){d=io(-1,t&-t),d.tag=2;var f=s.updateQueue;if(f!==null){f=f.shared;var m=f.pending;m===null?d.next=d:(d.next=m.next,m.next=d),f.pending=d}}s.lanes|=t,d=s.alternate,d!==null&&(d.lanes|=t),eb(s.return,t,e),u.lanes|=t;break}d=d.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(Le(341));o.lanes|=t,u=o.alternate,u!==null&&(u.lanes|=t),eb(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ar(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,kl(e,t),i=Ni(i),r=r(i),e.flags|=1,Ar(n,e,r,t),e.child;case 14:return r=e.type,i=Wi(r,e.pendingProps),i=Wi(r.type,i),D2(n,e,r,i,t);case 15:return fk(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Wi(r,i),Gp(n,e),e.tag=1,Gr(r)?(n=!0,bm(e)):n=!1,kl(e,t),zA(e,r,i),nb(e,r,i,t),sb(null,e,r,!0,n,t);case 19:return yk(n,e,t);case 22:return pk(n,e,t)}throw Error(Le(156,e.tag))};function Nk(n,e){return oA(n,e)}function jL(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ai(n,e,t,r){return new jL(n,e,t,r)}function AC(n){return n=n.prototype,!(!n||!n.isReactComponent)}function qL(n){if(typeof n=="function")return AC(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Jw)return 11;if(n===Qw)return 14}return 2}function Jo(n,e){var t=n.alternate;return t===null?(t=Ai(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Qp(n,e,t,r,i,s){var o=2;if(r=n,typeof n=="function")AC(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case pl:return iu(t.children,i,s,e);case Kw:o=8,i|=8;break;case P1:return n=Ai(12,t,e,i|2),n.elementType=P1,n.lanes=s,n;case R1:return n=Ai(13,t,e,i),n.elementType=R1,n.lanes=s,n;case _1:return n=Ai(19,t,e,i),n.elementType=_1,n.lanes=s,n;case $I:return mg(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case UI:o=10;break e;case zI:o=9;break e;case Jw:o=11;break e;case Qw:o=14;break e;case Ro:o=16,r=null;break e}throw Error(Le(130,n==null?n:typeof n,""))}return e=Ai(o,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function iu(n,e,t,r){return n=Ai(7,n,r,e),n.lanes=t,n}function mg(n,e,t,r){return n=Ai(22,n,r,e),n.elementType=$I,n.lanes=t,n.stateNode={isHidden:!1},n}function xy(n,e,t){return n=Ai(6,n,null,e),n.lanes=t,n}function Ey(n,e,t){return e=Ai(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function UL(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=iy(0),this.expirationTimes=iy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=iy(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function kC(n,e,t,r,i,s,o,u,d){return n=new UL(n,e,t,u,d),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Ai(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},pC(s),n}function zL(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fl,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function Dk(n){if(!n)return ra;n=n._reactInternals;e:{if(Pu(n)!==n||n.tag!==1)throw Error(Le(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Gr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Le(171))}if(n.tag===1){var t=n.type;if(Gr(t))return NA(n,t,e)}return e}function Lk(n,e,t,r,i,s,o,u,d){return n=kC(t,r,!0,n,i,s,o,u,d),n.context=Dk(null),t=n.current,r=Nr(),i=Ko(t),s=io(r,i),s.callback=e??null,Wo(t,s,i),n.current.lanes=i,Dh(n,i,r),Kr(n,r),n}function gg(n,e,t,r){var i=e.current,s=Nr(),o=Ko(i);return t=Dk(t),e.context===null?e.context=t:e.pendingContext=t,e=io(s,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Wo(i,e,o),n!==null&&(ts(n,i,o,s),Hp(n,i,o)),o}function Fm(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function G2(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function OC(n,e){G2(n,e),(n=n.alternate)&&G2(n,e)}function $L(){return null}var Mk=typeof reportError=="function"?reportError:function(n){console.error(n)};function FC(n){this._internalRoot=n}vg.prototype.render=FC.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Le(409));gg(n,e,null,null)};vg.prototype.unmount=FC.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;pu(function(){gg(null,n,null,null)}),e[co]=null}};function vg(n){this._internalRoot=n}vg.prototype.unstable_scheduleHydration=function(n){if(n){var e=fA();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Ao.length&&e!==0&&e<Ao[t].priority;t++);Ao.splice(t,0,n),t===0&&mA(n)}};function NC(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function yg(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function K2(){}function HL(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var f=Fm(o);s.call(f)}}var o=Lk(e,r,n,0,null,!1,!1,"",K2);return n._reactRootContainer=o,n[co]=o.current,ch(n.nodeType===8?n.parentNode:n),pu(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var u=r;r=function(){var f=Fm(d);u.call(f)}}var d=kC(n,0,!1,null,null,!1,!1,"",K2);return n._reactRootContainer=d,n[co]=d.current,ch(n.nodeType===8?n.parentNode:n),pu(function(){gg(e,d,t,r)}),d}function Sg(n,e,t,r,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var u=i;i=function(){var d=Fm(o);u.call(d)}}gg(e,o,n,i)}else o=HL(t,e,n,i,r);return Fm(o)}dA=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Fd(e.pendingLanes);t!==0&&(Zw(e,t|1),Kr(e,on()),!(vt&6)&&(Ql=on()+500,ua()))}break;case 13:pu(function(){var r=ho(n,1);if(r!==null){var i=Nr();ts(r,n,1,i)}}),OC(n,1)}};eC=function(n){if(n.tag===13){var e=ho(n,134217728);if(e!==null){var t=Nr();ts(e,n,134217728,t)}OC(n,134217728)}};hA=function(n){if(n.tag===13){var e=Ko(n),t=ho(n,e);if(t!==null){var r=Nr();ts(t,n,e,r)}OC(n,e)}};fA=function(){return It};pA=function(n,e){var t=It;try{return It=n,e()}finally{It=t}};B1=function(n,e,t){switch(e){case"input":if(k1(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=lg(r);if(!i)throw Error(Le(90));VI(r),k1(r,i)}}}break;case"textarea":GI(n,t);break;case"select":e=t.value,e!=null&&Rl(n,!!t.multiple,e,!1)}};eA=RC;tA=pu;var VL={usingClientEntryPoint:!1,Events:[Mh,yl,lg,YI,ZI,RC]},ud={findFiberByHostInstance:Xa,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},WL={bundleType:ud.bundleType,version:ud.version,rendererPackageName:ud.rendererPackageName,rendererConfig:ud.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:vo.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=iA(n),n===null?null:n.stateNode},findFiberByHostInstance:ud.findFiberByHostInstance||$L,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var pp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pp.isDisabled&&pp.supportsFiber)try{sg=pp.inject(WL),Ts=pp}catch{}}gi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=VL;gi.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!NC(e))throw Error(Le(200));return zL(n,e,null,t)};gi.createRoot=function(n,e){if(!NC(n))throw Error(Le(299));var t=!1,r="",i=Mk;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=kC(n,1,!1,null,null,t,!1,r,i),n[co]=e.current,ch(n.nodeType===8?n.parentNode:n),new FC(e)};gi.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Le(188)):(n=Object.keys(n).join(","),Error(Le(268,n)));return n=iA(e),n=n===null?null:n.stateNode,n};gi.flushSync=function(n){return pu(n)};gi.hydrate=function(n,e,t){if(!yg(e))throw Error(Le(200));return Sg(null,n,e,!0,t)};gi.hydrateRoot=function(n,e,t){if(!NC(n))throw Error(Le(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",o=Mk;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=Lk(e,null,n,1,t??null,i,!1,s,o),n[co]=e.current,ch(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new vg(e)};gi.render=function(n,e,t){if(!yg(e))throw Error(Le(200));return Sg(null,n,e,!1,t)};gi.unmountComponentAtNode=function(n){if(!yg(n))throw Error(Le(40));return n._reactRootContainer?(pu(function(){Sg(null,null,n,!1,function(){n._reactRootContainer=null,n[co]=null})}),!0):!1};gi.unstable_batchedUpdates=RC;gi.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!yg(t))throw Error(Le(200));if(n==null||n._reactInternals===void 0)throw Error(Le(38));return Sg(n,e,t,!1,r)};gi.version="18.2.0-next-9e3b772b8-20220608";function Bk(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Bk)}catch(n){console.error(n)}}Bk(),LI.exports=gi;var GL=LI.exports,jk,J2=GL;jk=J2.createRoot,J2.hydrateRoot;var qk={exports:{}};(function(n,e){(function(t,r){n.exports=r()})(typeof self<"u"?self:Ne,()=>(()=>{var t={302:(o,u,d)=>{u.formatArgs=function(m){if(m[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+m[0]+(this.useColors?"%c ":" ")+"+"+o.exports.humanize(this.diff),!this.useColors)return;const g="color: "+this.color;m.splice(1,0,g,"color: inherit");let P=0,D=0;m[0].replace(/%[a-zA-Z%]/g,M=>{M!=="%%"&&(P++,M==="%c"&&(D=P))}),m.splice(D,0,g)},u.save=function(m){try{m?u.storage.setItem("debug",m):u.storage.removeItem("debug")}catch{}},u.load=function(){let m;try{m=u.storage.getItem("debug")}catch{}return!m&&typeof process<"u"&&"env"in process&&(m={}.DEBUG),m},u.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},u.storage=function(){try{return localStorage}catch{}}(),u.destroy=(()=>{let m=!1;return()=>{m||(m=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),u.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],u.log=console.debug||console.log||(()=>{}),o.exports=d(65)(u);const{formatters:f}=o.exports;f.j=function(m){try{return JSON.stringify(m)}catch(g){return"[UnexpectedJSONParseError]: "+g.message}}},65:(o,u,d)=>{o.exports=function(f){function m(D){let M,U,j,E=null;function k(...z){if(!k.enabled)return;const K=k,ie=Number(new Date),he=ie-(M||ie);K.diff=he,K.prev=M,K.curr=ie,M=ie,z[0]=m.coerce(z[0]),typeof z[0]!="string"&&z.unshift("%O");let pe=0;z[0]=z[0].replace(/%([a-zA-Z%])/g,(X,fe)=>{if(X==="%%")return"%";pe++;const ge=m.formatters[fe];if(typeof ge=="function"){const we=z[pe];X=ge.call(K,we),z.splice(pe,1),pe--}return X}),m.formatArgs.call(K,z),(K.log||m.log).apply(K,z)}return k.namespace=D,k.useColors=m.useColors(),k.color=m.selectColor(D),k.extend=g,k.destroy=m.destroy,Object.defineProperty(k,"enabled",{enumerable:!0,configurable:!1,get:()=>E!==null?E:(U!==m.namespaces&&(U=m.namespaces,j=m.enabled(D)),j),set:z=>{E=z}}),typeof m.init=="function"&&m.init(k),k}function g(D,M){const U=m(this.namespace+(M===void 0?":":M)+D);return U.log=this.log,U}function P(D){return D.toString().substring(2,D.toString().length-2).replace(/\.\*\?$/,"*")}return m.debug=m,m.default=m,m.coerce=function(D){return D instanceof Error?D.stack||D.message:D},m.disable=function(){const D=[...m.names.map(P),...m.skips.map(P).map(M=>"-"+M)].join(",");return m.enable(""),D},m.enable=function(D){let M;m.save(D),m.namespaces=D,m.names=[],m.skips=[];const U=(typeof D=="string"?D:"").split(/[\s,]+/),j=U.length;for(M=0;M<j;M++)U[M]&&((D=U[M].replace(/\*/g,".*?"))[0]==="-"?m.skips.push(new RegExp("^"+D.slice(1)+"$")):m.names.push(new RegExp("^"+D+"$")))},m.enabled=function(D){if(D[D.length-1]==="*")return!0;let M,U;for(M=0,U=m.skips.length;M<U;M++)if(m.skips[M].test(D))return!1;for(M=0,U=m.names.length;M<U;M++)if(m.names[M].test(D))return!0;return!1},m.humanize=d(247),m.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(f).forEach(D=>{m[D]=f[D]}),m.names=[],m.skips=[],m.formatters={},m.selectColor=function(D){let M=0;for(let U=0;U<D.length;U++)M=(M<<5)-M+D.charCodeAt(U),M|=0;return m.colors[Math.abs(M)%m.colors.length]},m.enable(m.load()),m}},247:o=>{var u=1e3,d=60*u,f=60*d,m=24*f,g=7*m,P=365.25*m;function D(E){if(!((E=String(E)).length>100)){var k=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(E);if(k){var z=parseFloat(k[1]);switch((k[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return z*P;case"weeks":case"week":case"w":return z*g;case"days":case"day":case"d":return z*m;case"hours":case"hour":case"hrs":case"hr":case"h":return z*f;case"minutes":case"minute":case"mins":case"min":case"m":return z*d;case"seconds":case"second":case"secs":case"sec":case"s":return z*u;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return z;default:return}}}}function M(E){var k=Math.abs(E);return k>=m?Math.round(E/m)+"d":k>=f?Math.round(E/f)+"h":k>=d?Math.round(E/d)+"m":k>=u?Math.round(E/u)+"s":E+"ms"}function U(E){var k=Math.abs(E);return k>=m?j(E,k,m,"day"):k>=f?j(E,k,f,"hour"):k>=d?j(E,k,d,"minute"):k>=u?j(E,k,u,"second"):E+" ms"}function j(E,k,z,K){var ie=k>=1.5*z;return Math.round(E/z)+" "+K+(ie?"s":"")}o.exports=function(E,k){k=k||{};var z=typeof E;if(z==="string"&&E.length>0)return D(E);if(z==="number"&&isFinite(E))return k.long?U(E):M(E);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(E))}}},r={};function i(o){var u=r[o];if(u!==void 0)return u.exports;var d=r[o]={exports:{}};return t[o](d,d.exports,i),d.exports}i.d=(o,u)=>{for(var d in u)i.o(u,d)&&!i.o(o,d)&&Object.defineProperty(o,d,{enumerable:!0,get:u[d]})},i.o=(o,u)=>Object.prototype.hasOwnProperty.call(o,u),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var s={};return(()=>{i.r(s),i.d(s,{ActionObjectType:()=>je,ChannelType:()=>er,ChildAppWindow:()=>Us,DialogDimension:()=>en,ErrorCode:()=>Ce,FileOpenPreference:()=>Re,FrameContexts:()=>ee,HostClientType:()=>qe,HostName:()=>lt,LiveShareHost:()=>p,NotificationTypes:()=>Lc,ParentAppWindow:()=>ba,SecondaryM365ContentIdName:()=>Ae,TaskModuleDimension:()=>mn,TeamType:()=>bt,UserSettingTypes:()=>bi,UserTeamRole:()=>Et,ViewerActionTypes:()=>Mc,app:()=>nr,appEntity:()=>J,appInitialization:()=>Ca,appInstallDialog:()=>jc,appNotification:()=>qc,authentication:()=>ma,barCode:()=>Uc,calendar:()=>zs,call:()=>wa,chat:()=>Yr,conversations:()=>cn,dialog:()=>os,enablePrintCapability:()=>W0,executeDeepLink:()=>xe,files:()=>ae,geoLocation:()=>zc,getAdaptiveCardSchemaVersion:()=>q0,getContext:()=>Hf,getMruTabInstances:()=>Ku,getTabInstances:()=>Q0,initialize:()=>Vu,initializeWithFrameContext:()=>Jf,liveShare:()=>l,location:()=>Hc,logs:()=>ya,mail:()=>Rr,marketplace:()=>ue,media:()=>ls,meeting:()=>Gt,meetingRoom:()=>le,menus:()=>Bu,monetization:()=>Pt,navigateBack:()=>X0,navigateCrossDomain:()=>tt,navigateToTab:()=>Xf,notifications:()=>H,openFilePreview:()=>C0,pages:()=>Ft,people:()=>Vc,print:()=>G0,profile:()=>Wc,registerAppButtonClickHandler:()=>K0,registerAppButtonHoverEnterHandler:()=>J0,registerAppButtonHoverLeaveHandler:()=>Vf,registerBackButtonHandler:()=>Wu,registerBeforeUnloadHandler:()=>Wf,registerChangeSettingsHandler:()=>Kf,registerCustomHandler:()=>b0,registerFocusEnterHandler:()=>Gf,registerFullScreenHandler:()=>ed,registerOnLoadHandler:()=>Gu,registerOnThemeChangeHandler:()=>Zc,registerUserSettingsChangeHandler:()=>w0,remoteCamera:()=>W,returnFocus:()=>Qf,search:()=>Qc,secondaryBrowser:()=>$c,sendCustomEvent:()=>S0,sendCustomMessage:()=>Of,setFrameContext:()=>gt,settings:()=>wo,shareDeepLink:()=>Hs,sharing:()=>$u,stageView:()=>So,tasks:()=>a,teams:()=>$,teamsCore:()=>ji,uploadCustomApp:()=>y0,version:()=>ju,video:()=>cs,videoEx:()=>oe,webStorage:()=>bo});var o="2.0.1",u="2.0.2",d="2.0.3",f="2.0.4",m="2.0.1",g="1.9.0",P="2.0.0",D="1.7.0",M="1.8.0",U="1.9.0",j=["teams.microsoft.com","teams.microsoft.us","gov.teams.microsoft.us","dod.teams.microsoft.us","int.teams.microsoft.com","teams.live.com","devspaces.skype.com","ssauth.skype.com","local.teams.live.com","local.teams.live.com:8080","local.teams.office.com","local.teams.office.com:8080","outlook.office.com","outlook-sdf.office.com","outlook.office365.com","outlook-sdf.office365.com","outlook.live.com","outlook-sdf.live.com","*.teams.microsoft.com","*.www.office.com","www.office.com","word.office.com","excel.office.com","powerpoint.office.com","www.officeppe.com","*.www.microsoft365.com","www.microsoft365.com"],E=/^https:\/\//,k="https",z="teams.microsoft.com",K="The library has not yet been initialized",ie="The runtime has not yet been initialized",he="The runtime version is not supported",pe="The call was not properly started",X=function(){function h(){}return h.initializeCalled=!1,h.initializeCompleted=!1,h.additionalValidOrigins=[],h.isFramelessWindow=!1,h.printCapabilityEnabled=!1,h}(),fe=(0,i(302).debug)("teamsJs");function ge(h){return fe.extend(h)}const we={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let be;const He=new Uint8Array(16);function ce(){if(!be&&(be=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!be))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return be(He)}const ve=[];for(let h=0;h<256;++h)ve.push((h+256).toString(16).slice(1));function De(h,T=0){return(ve[h[T+0]]+ve[h[T+1]]+ve[h[T+2]]+ve[h[T+3]]+"-"+ve[h[T+4]]+ve[h[T+5]]+"-"+ve[h[T+6]]+ve[h[T+7]]+"-"+ve[h[T+8]]+ve[h[T+9]]+"-"+ve[h[T+10]]+ve[h[T+11]]+ve[h[T+12]]+ve[h[T+13]]+ve[h[T+14]]+ve[h[T+15]]).toLowerCase()}const Xe=function(h,T,b){if(we.randomUUID&&!T&&!h)return we.randomUUID();const A=(h=h||{}).random||(h.rng||ce)();if(A[6]=15&A[6]|64,A[8]=63&A[8]|128,T){b=b||0;for(let q=0;q<16;++q)T[b+q]=A[q];return T}return De(A)};var Re,je,Ae,Ce,Ve,qe,lt,ee,bt,Et,en;(function(h){h.Inline="inline",h.Desktop="desktop",h.Web="web"})(Re||(Re={})),function(h){h.M365Content="m365content"}(je||(je={})),function(h){h.DriveId="driveId",h.GroupId="groupId",h.SiteId="siteId",h.UserId="userId"}(Ae||(Ae={})),function(h){h[h.NOT_SUPPORTED_ON_PLATFORM=100]="NOT_SUPPORTED_ON_PLATFORM",h[h.INTERNAL_ERROR=500]="INTERNAL_ERROR",h[h.NOT_SUPPORTED_IN_CURRENT_CONTEXT=501]="NOT_SUPPORTED_IN_CURRENT_CONTEXT",h[h.PERMISSION_DENIED=1e3]="PERMISSION_DENIED",h[h.NETWORK_ERROR=2e3]="NETWORK_ERROR",h[h.NO_HW_SUPPORT=3e3]="NO_HW_SUPPORT",h[h.INVALID_ARGUMENTS=4e3]="INVALID_ARGUMENTS",h[h.UNAUTHORIZED_USER_OPERATION=5e3]="UNAUTHORIZED_USER_OPERATION",h[h.INSUFFICIENT_RESOURCES=6e3]="INSUFFICIENT_RESOURCES",h[h.THROTTLE=7e3]="THROTTLE",h[h.USER_ABORT=8e3]="USER_ABORT",h[h.OPERATION_TIMED_OUT=8001]="OPERATION_TIMED_OUT",h[h.OLD_PLATFORM=9e3]="OLD_PLATFORM",h[h.FILE_NOT_FOUND=404]="FILE_NOT_FOUND",h[h.SIZE_EXCEEDED=1e4]="SIZE_EXCEEDED"}(Ce||(Ce={})),function(h){h.GeoLocation="geolocation",h.Media="media"}(Ve||(Ve={})),function(h){h.desktop="desktop",h.web="web",h.android="android",h.ios="ios",h.ipados="ipados",h.rigel="rigel",h.surfaceHub="surfaceHub",h.teamsRoomsWindows="teamsRoomsWindows",h.teamsRoomsAndroid="teamsRoomsAndroid",h.teamsPhones="teamsPhones",h.teamsDisplays="teamsDisplays"}(qe||(qe={})),function(h){h.office="Office",h.outlook="Outlook",h.outlookWin32="OutlookWin32",h.orange="Orange",h.teams="Teams",h.teamsModern="TeamsModern"}(lt||(lt={})),function(h){h.settings="settings",h.content="content",h.authentication="authentication",h.remove="remove",h.task="task",h.sidePanel="sidePanel",h.stage="stage",h.meetingStage="meetingStage"}(ee||(ee={})),function(h){h[h.Standard=0]="Standard",h[h.Edu=1]="Edu",h[h.Class=2]="Class",h[h.Plc=3]="Plc",h[h.Staff=4]="Staff"}(bt||(bt={})),function(h){h[h.Admin=0]="Admin",h[h.User=1]="User",h[h.Guest=2]="Guest"}(Et||(Et={})),function(h){h.Large="large",h.Medium="medium",h.Small="small"}(en||(en={}));var er,mn=en;(function(h){h.Regular="Regular",h.Private="Private",h.Shared="Shared"})(er||(er={}));var Ee={errorCode:Ce.NOT_SUPPORTED_ON_PLATFORM},Nn={majorVersion:1,minorVersion:5},tr={adaptiveCardSchemaVersion:{majorVersion:1,minorVersion:5}};function gn(h,T){if(h.substring(0,2)==="*."){var b=h.substring(1);if(T.length>b.length&&T.split(".").length===b.split(".").length&&T.substring(T.length-b.length)===b)return!0}else if(h===T)return!0;return!1}function Mi(h){if(!Sf(h))return!1;var T=h.host;if(j.some(function(G){return gn(G,T)}))return!0;for(var b=0,A=X.additionalValidOrigins;b<A.length;b++){var q=A[b];if(gn(q.substring(0,8)==="https://"?q.substring(8):q,T))return!0}return!1}function Br(h){return function(T,b){if(!T)throw new Error(h||b)}}function Lu(h,T){if(typeof h!="string"||typeof T!="string")return NaN;var b=h.split("."),A=T.split(".");function q(Q){return/^\d+$/.test(Q)}if(!b.every(q)||!A.every(q))return NaN;for(;b.length<A.length;)b.push("0");for(;A.length<b.length;)A.push("0");for(var G=0;G<b.length;++G)if(Number(b[G])!=Number(A[G]))return Number(b[G])>Number(A[G])?1:-1;return 0}function mf(){return Xe()}function gf(h){return Object.keys(h).forEach(function(T){typeof h[T]=="object"&&gf(h[T])}),Object.freeze(h)}function zv(h,T){for(var b=[],A=2;A<arguments.length;A++)b[A-2]=arguments[A];var q=h.apply(void 0,b);return q.then(function(G){T&&T(void 0,G)}).catch(function(G){T&&T(G)}),q}function vf(h,T){for(var b=[],A=2;A<arguments.length;A++)b[A-2]=arguments[A];var q=h.apply(void 0,b);return q.then(function(){T&&T(null)}).catch(function(G){T&&T(G)}),q}function $v(h,T){for(var b=[],A=2;A<arguments.length;A++)b[A-2]=arguments[A];var q=h.apply(void 0,b);return q.then(function(G){T&&T(null,G)}).catch(function(G){T&&T(G,null)}),q}function Hv(h,T,b){return new Promise(function(A,q){var G=setTimeout(q,T,b);h().then(function(Q){clearTimeout(G),A(Q)}).catch(function(Q){clearTimeout(G),q(Q)})})}function Vv(h){var T=new URL("https://teams.microsoft.com/l/entity/"+encodeURIComponent(h.appId)+"/"+encodeURIComponent(h.pageId));return h.webUrl&&T.searchParams.append("webUrl",h.webUrl),(h.channelId||h.subPageId)&&T.searchParams.append("context",JSON.stringify({channelId:h.channelId,subEntityId:h.subPageId})),T.toString()}function yf(h){return!(Lu("".concat(h.majorVersion,".").concat(h.minorVersion),"".concat(Nn.majorVersion,".").concat(Nn.minorVersion))>=0)}function Sf(h){return h.protocol==="https:"}var Bi=function(){return Bi=Object.assign||function(h){for(var T,b=1,A=arguments.length;b<A;b++)for(var q in T=arguments[b])Object.prototype.hasOwnProperty.call(T,q)&&(h[q]=T[q]);return h},Bi.apply(this,arguments)},bf=ge("runtime"),Ic=2;function wf(h){return h.apiVersion===Ic}var Wv={apiVersion:-1,supports:{}};function Gv(h){if(wf(h))return!0;throw h.apiVersion===-1?new Error(ie):new Error(he)}var Y=Wv,Kv={apiVersion:2,hostVersionsInfo:tr,isLegacyTeams:!0,supports:{appInstallDialog:{},appEntity:{},call:{},chat:{},conversations:{},dialog:{card:{bot:{}},url:{bot:{}},update:{}},interactive:{},logs:{},meetingRoom:{},menus:{},monetization:{},notifications:{},pages:{appButton:{},tabs:{},config:{},backStack:{},fullTrust:{}},remoteCamera:{},stageView:{},teams:{fullTrust:{}},teamsCore:{},video:{sharedFrame:{}}}},Cf=[qe.desktop,qe.web,qe.android,qe.ios,qe.rigel,qe.surfaceHub,qe.teamsRoomsWindows,qe.teamsRoomsAndroid,qe.teamsPhones,qe.teamsDisplays];function Jv(h){var T=h;if(T.apiVersion<Ic&&Qv.forEach(function(b){T.apiVersion===b.versionToUpgradeFrom&&(T=b.upgradeToNextVersion(T))}),wf(T))return T;throw new Error("Received a runtime that could not be upgraded to the latest version")}var Qv=[{versionToUpgradeFrom:1,upgradeToNextVersion:function(h){var T;return{apiVersion:2,hostVersionsInfo:void 0,isLegacyTeams:h.isLegacyTeams,supports:Bi(Bi({},h.supports),{dialog:h.supports.dialog?{card:void 0,url:h.supports.dialog,update:(T=h.supports.dialog)===null||T===void 0?void 0:T.update}:void 0})}}}],xf={"1.9.0":[{capability:{location:{}},hostClientTypes:Cf}],"2.0.0":[{capability:{people:{}},hostClientTypes:Cf},{capability:{sharing:{}},hostClientTypes:[qe.desktop,qe.web]}],"2.0.1":[{capability:{teams:{fullTrust:{joinedTeams:{}}}},hostClientTypes:[qe.android,qe.desktop,qe.ios,qe.teamsRoomsAndroid,qe.teamsPhones,qe.teamsDisplays,qe.web]},{capability:{webStorage:{}},hostClientTypes:[qe.desktop]}],"2.0.5":[{capability:{webStorage:{}},hostClientTypes:[qe.android,qe.desktop,qe.ios]}]},pa=bf.extend("generateBackCompatRuntimeConfig");function Xv(h){pa("generating back compat runtime config for %s",h);var T=Bi({},Kv.supports);pa("Supported capabilities in config before updating based on highestSupportedVersion: %o",T),Object.keys(xf).forEach(function(A){Lu(h,A)>=0&&xf[A].forEach(function(q){q.hostClientTypes.includes(X.hostClientType)&&(T=Bi(Bi({},T),q.capability))})});var b={apiVersion:2,hostVersionsInfo:tr,isLegacyTeams:!0,supports:T};return pa("Runtime config after updating based on highestSupportedVersion: %o",b),b}var Mu=bf.extend("applyRuntimeConfig");function Ac(h){typeof h.apiVersion=="string"&&(Mu("Trying to apply runtime with string apiVersion, processing as v1: %o",h),h=Bi(Bi({},h),{apiVersion:1})),Mu("Fast-forwarding runtime %o",h);var T=Jv(h);Mu("Applying runtime %o",T),Y=gf(T)}var ma,os,Bu,ji,nr,Ft,ju="2.14.0",Ef=ge("internal"),Yv=Ef.extend("ensureInitializeCalled"),Zv=Ef.extend("ensureInitialized");function qi(){if(!X.initializeCalled)throw Yv(K),new Error(K)}function se(h){for(var T=[],b=1;b<arguments.length;b++)T[b-1]=arguments[b];if(!X.initializeCompleted)throw Zv("%s. initializeCalled: %s",K,X.initializeCalled.toString()),new Error(K);if(T&&T.length>0){for(var A=!1,q=0;q<T.length;q++)if(T[q]===X.frameContext){A=!0;break}if(!A)throw new Error("This call is only allowed in following contexts: ".concat(JSON.stringify(T),". ")+'Current context: "'.concat(X.frameContext,'".'))}return Gv(h)}function Qr(h){h===void 0&&(h=o);var T=Lu(X.clientSupportedSDKVersion,h);return!isNaN(T)&&T>=0}function e0(){return X.hostClientType==qe.android||X.hostClientType==qe.ios||X.hostClientType==qe.ipados}function qu(h){if(h===void 0&&(h=o),!e0())throw{errorCode:Ce.NOT_SUPPORTED_ON_PLATFORM};if(!Qr(h))throw{errorCode:Ce.OLD_PLATFORM}}function t0(h){var T=X.additionalValidOrigins.concat(h.filter(function(A){return typeof A=="string"&&E.test(A)})),b={};T=T.filter(function(A){return!b[A]&&(b[A]=!0,!0)}),X.additionalValidOrigins=T}function Ui(){return typeof window>"u"}function n0(h){return{actionInfo:h.actionInfo,app:{locale:h.locale,sessionId:h.appSessionId?h.appSessionId:"",theme:h.theme?h.theme:"default",iconPositionVertical:h.appIconPosition,osLocaleInfo:h.osLocaleInfo,parentMessageId:h.parentMessageId,userClickTime:h.userClickTime,userFileOpenPreference:h.userFileOpenPreference,host:{name:h.hostName?h.hostName:lt.teams,clientType:h.hostClientType?h.hostClientType:qe.web,sessionId:h.sessionId?h.sessionId:"",ringId:h.ringId},appLaunchId:h.appLaunchId},page:{id:h.entityId,frameContext:h.frameContext?h.frameContext:X.frameContext,subPageId:h.subEntityId,isFullScreen:h.isFullScreen,isMultiWindow:h.isMultiWindow,sourceOrigin:h.sourceOrigin},user:{id:h.userObjectId,displayName:h.userDisplayName,isCallingAllowed:h.isCallingAllowed,isPSTNCallingAllowed:h.isPSTNCallingAllowed,licenseType:h.userLicenseType,loginHint:h.loginHint,userPrincipalName:h.userPrincipalName,tenant:h.tid?{id:h.tid,teamsSku:h.tenantSKU}:void 0},channel:h.channelId?{id:h.channelId,displayName:h.channelName,relativeUrl:h.channelRelativeUrl,membershipType:h.channelType,defaultOneNoteSectionId:h.defaultOneNoteSectionId,ownerGroupId:h.hostTeamGroupId,ownerTenantId:h.hostTeamTenantId}:void 0,chat:h.chatId?{id:h.chatId}:void 0,meeting:h.meetingId?{id:h.meetingId}:void 0,sharepoint:h.sharepoint,team:h.teamId?{internalId:h.teamId,displayName:h.teamName,type:h.teamType,groupId:h.groupId,templateId:h.teamTemplateId,isArchived:h.isTeamArchived,userRole:h.userTeamRole}:void 0,sharePointSite:h.teamSiteUrl||h.teamSiteDomain||h.teamSitePath||h.mySitePath||h.mySiteDomain?{teamSiteUrl:h.teamSiteUrl,teamSiteDomain:h.teamSiteDomain,teamSitePath:h.teamSitePath,teamSiteId:h.teamSiteId,mySitePath:h.mySitePath,mySiteDomain:h.mySiteDomain}:void 0}}(function(h){var T,b,A;function q(Ie){return new Promise(function(ze,Ye){if(X.hostClientType===qe.desktop||X.hostClientType===qe.android||X.hostClientType===qe.ios||X.hostClientType===qe.ipados||X.hostClientType===qe.rigel||X.hostClientType===qe.teamsRoomsWindows||X.hostClientType===qe.teamsRoomsAndroid||X.hostClientType===qe.teamsPhones||X.hostClientType===qe.teamsDisplays){var Ke=document.createElement("a");Ke.href=Ie.url,ze(us("authentication.authenticate",[Ke.href,Ie.width,Ie.height,Ie.isExternal]).then(function(bn){var ir=bn[0],Dn=bn[1];if(ir)return Dn;throw new Error(Dn)}))}else T={success:ze,fail:Ye},me(Ie)})}function G(Ie){return new Promise(function(ze){ze(us("authentication.getAuthToken",[Ie==null?void 0:Ie.resources,Ie==null?void 0:Ie.claims,Ie==null?void 0:Ie.silent]))}).then(function(ze){var Ye=ze[0],Ke=ze[1];if(Ye)return Ke;throw new Error(Ke)})}function Q(){return new Promise(function(Ie){Ie(us("authentication.getUser"))}).then(function(Ie){var ze=Ie[0],Ye=Ie[1];if(ze)return Ye;throw new Error(Ye)})}function ne(){re();try{ke.childWindow&&ke.childWindow.close()}finally{ke.childWindow=null,ke.childOrigin=null}}function me(Ie){ne();var ze=Ie.width||600,Ye=Ie.height||400;ze=Math.min(ze,ke.currentWindow.outerWidth-400),Ye=Math.min(Ye,ke.currentWindow.outerHeight-200);var Ke=document.createElement("a");Ke.href=Ie.url.replace("{oauthRedirectMethod}","web");var bn=ke.currentWindow.screenLeft!==void 0?ke.currentWindow.screenLeft:ke.currentWindow.screenX,ir=ke.currentWindow.screenTop!==void 0?ke.currentWindow.screenTop:ke.currentWindow.screenY;bn+=ke.currentWindow.outerWidth/2-ze/2,ir+=ke.currentWindow.outerHeight/2-Ye/2,ke.childWindow=ke.currentWindow.open(Ke.href,"_blank","toolbar=no, location=yes, status=no, menubar=no, scrollbars=yes, top="+ir+", left="+bn+", width="+ze+", height="+Ye),ke.childWindow?Se():Oe("FailedToOpenWindow")}function re(){b&&(clearInterval(b),b=0),yn("initialize"),yn("navigateCrossDomain")}function Se(){re(),b=ke.currentWindow.setInterval(function(){if(!ke.childWindow||ke.childWindow.closed)Oe("CancelledByUser");else{var Ie=ke.childOrigin;try{ke.childOrigin="*",zi("ping")}finally{ke.childOrigin=Ie}}},100),Ze("initialize",function(){return[ee.authentication,X.hostClientType]}),Ze("navigateCrossDomain",function(){return!1})}function Ue(Ie){try{T&&T.success(Ie)}finally{T=null,ne()}}function Oe(Ie){try{T&&T.fail(new Error(Ie))}finally{T=null,ne()}}function Pe(Ie,ze,Ye){if(Ie){var Ke=document.createElement("a");Ke.href=decodeURIComponent(Ie),Ke.host&&Ke.host!==window.location.host&&Ke.host==="outlook.office.com"&&Ke.search.indexOf("client_type=Win32_Outlook")>-1&&(ze&&ze==="result"&&(Ye&&(Ke.href=Me(Ke.href,"result",Ye)),ke.currentWindow.location.assign(Me(Ke.href,"authSuccess",""))),ze&&ze==="reason"&&(Ye&&(Ke.href=Me(Ke.href,"reason",Ye)),ke.currentWindow.location.assign(Me(Ke.href,"authFailure",""))))}}function Me(Ie,ze,Ye){var Ke=Ie.indexOf("#"),bn=Ke===-1?"#":Ie.substr(Ke);return bn=bn+"&"+ze+(Ye!==""?"="+Ye:""),(Ie=Ke===-1?Ie:Ie.substr(0,Ke))+bn}h.initialize=function(){Ze("authentication.authenticate.success",Ue,!1),Ze("authentication.authenticate.failure",Oe,!1)},h.registerAuthenticationHandlers=function(Ie){A=Ie},h.authenticate=function(Ie){var ze=Ie!==void 0,Ye=ze?Ie:A;if(!Ye)throw new Error("No parameters are provided for authentication");return se(Y,ee.content,ee.sidePanel,ee.settings,ee.remove,ee.task,ee.stage,ee.meetingStage),q(Ye).then(function(Ke){try{return Ye&&Ye.successCallback?(Ye.successCallback(Ke),""):Ke}finally{ze||(A=null)}}).catch(function(Ke){try{if(Ye&&Ye.failureCallback)return Ye.failureCallback(Ke.message),"";throw Ke}finally{ze||(A=null)}})},h.getAuthToken=function(Ie){return qi(),G(Ie).then(function(ze){return Ie&&Ie.successCallback?(Ie.successCallback(ze),""):ze}).catch(function(ze){if(Ie&&Ie.failureCallback)return Ie.failureCallback(ze.message),"";throw ze})},h.getUser=function(Ie){return qi(),Q().then(function(ze){return Ie&&Ie.successCallback?(Ie.successCallback(ze),null):ze}).catch(function(ze){if(Ie&&Ie.failureCallback)return Ie.failureCallback(ze.message),null;throw ze})},h.notifySuccess=function(Ie,ze){Pe(ze,"result",Ie),se(Y,ee.authentication),_e("authentication.authenticate.success",[Ie]),kf(ke.parentWindow,function(){return setTimeout(function(){return ke.currentWindow.close()},200)})},h.notifyFailure=function(Ie,ze){Pe(ze,"reason",Ie),se(Y,ee.authentication),_e("authentication.authenticate.failure",[Ie]),kf(ke.parentWindow,function(){return setTimeout(function(){return ke.currentWindow.close()},200)})},function(Ie){Ie.Public="public",Ie.EUDB="eudb",Ie.Other="other"}(h.DataResidency||(h.DataResidency={}))})(ma||(ma={})),function(h){var T=[];function b(A){X.frameContext&&(X.frameContext===ee.task?T.push(A):yn("messageForChild"))}h.initialize=function(){Ze("messageForChild",b,!1)},function(A){function q(){return se(Y)&&(Y.supports.dialog&&Y.supports.dialog.url)!==void 0}function G(ne){return{url:ne.url,height:ne.size?ne.size.height:en.Small,width:ne.size?ne.size.width:en.Small,title:ne.title,fallbackUrl:ne.fallbackUrl}}function Q(ne){var me=G(ne);return me.completionBotId=ne.completionBotId,me}A.open=function(ne,me,re){if(se(Y,ee.content,ee.sidePanel,ee.meetingStage),!q())throw Ee;re&&Ze("messageForParent",re),_e("tasks.startTask",[G(ne)],function(Se,Ue){me==null||me({err:Se,result:Ue}),yn("messageForParent")})},A.submit=function(ne,me){if(se(Y,ee.content,ee.task),!q())throw Ee;_e("tasks.completeTask",[ne,me?Array.isArray(me)?me:[me]:[]])},A.sendMessageToParentFromDialog=function(ne){if(se(Y,ee.task),!q())throw Ee;_e("messageForParent",[ne])},A.sendMessageToDialog=function(ne){if(se(Y,ee.content,ee.sidePanel,ee.meetingStage),!q())throw Ee;_e("messageForChild",[ne])},A.registerOnMessageFromParent=function(ne){if(se(Y,ee.task),!q())throw Ee;for(yn("messageForChild"),Ze("messageForChild",ne),T.reverse();T.length>0;)ne(T.pop())},A.isSupported=q,function(ne){function me(){return se(Y)&&(Y.supports.dialog&&Y.supports.dialog.url&&Y.supports.dialog.url.bot)!==void 0}ne.open=function(re,Se,Ue){if(se(Y,ee.content,ee.sidePanel,ee.meetingStage),!me())throw Ee;Ue&&Ze("messageForParent",Ue),_e("tasks.startTask",[Q(re)],function(Oe,Pe){Se==null||Se({err:Oe,result:Pe}),yn("messageForParent")})},ne.isSupported=me}(A.bot||(A.bot={})),A.getDialogInfoFromUrlDialogInfo=G,A.getDialogInfoFromBotUrlDialogInfo=Q}(h.url||(h.url={})),h.isSupported=function(){return!(!se(Y)||!Y.supports.dialog)},function(A){function q(){return!(!se(Y)||!Y.supports.dialog)&&!!Y.supports.dialog.update}A.resize=function(G){if(se(Y,ee.content,ee.sidePanel,ee.task,ee.meetingStage),!q())throw Ee;_e("tasks.updateTask",[G])},A.isSupported=q}(h.update||(h.update={})),function(A){function q(){var ne=Y.hostVersionsInfo&&Y.hostVersionsInfo.adaptiveCardSchemaVersion&&!yf(Y.hostVersionsInfo.adaptiveCardSchemaVersion);return se(Y)&&(ne&&Y.supports.dialog&&Y.supports.dialog.card)!==void 0}function G(ne){return{card:ne.card,height:ne.size?ne.size.height:en.Small,width:ne.size?ne.size.width:en.Small,title:ne.title}}function Q(ne){var me=G(ne);return me.completionBotId=ne.completionBotId,me}A.open=function(ne,me){if(se(Y,ee.content,ee.sidePanel,ee.meetingStage),!q())throw Ee;_e("tasks.startTask",[G(ne)],function(re,Se){me==null||me({err:re,result:Se})})},A.isSupported=q,function(ne){function me(){var re=Y.hostVersionsInfo&&Y.hostVersionsInfo.adaptiveCardSchemaVersion&&!yf(Y.hostVersionsInfo.adaptiveCardSchemaVersion);return se(Y)&&(re&&Y.supports.dialog&&Y.supports.dialog.card&&Y.supports.dialog.card.bot)!==void 0}ne.open=function(re,Se){if(se(Y,ee.content,ee.sidePanel,ee.meetingStage),!me())throw Ee;_e("tasks.startTask",[Q(re)],function(Ue,Oe){Se==null||Se({err:Ue,result:Oe})})},ne.isSupported=me}(A.bot||(A.bot={}))}(h.adaptiveCard||(h.adaptiveCard={}))}(os||(os={})),function(h){(function(re){re[re.ifRoom=0]="ifRoom",re[re.overflowOnly=1]="overflowOnly"})(h.DisplayMode||(h.DisplayMode={}));var T,b,A,q=function(){return function(){this.enabled=!0,this.selected=!1}}();function G(re){A&&A(re)||(se(Y),_e("viewConfigItemPress",[re]))}function Q(re){T&&T(re)||(se(Y),_e("handleNavBarMenuItemPress",[re]))}function ne(re){b&&b(re)||(se(Y),_e("handleActionMenuItemPress",[re]))}function me(){return!(!se(Y)||!Y.supports.menus)}h.MenuItem=q,function(re){re.dropDown="dropDown",re.popOver="popOver"}(h.MenuListType||(h.MenuListType={})),h.initialize=function(){Ze("navBarMenuItemPress",Q,!1),Ze("actionMenuItemPress",ne,!1),Ze("setModuleView",G,!1)},h.setUpViews=function(re,Se){if(se(Y),!me())throw Ee;A=Se,_e("setUpViews",[re])},h.setNavBarMenu=function(re,Se){if(se(Y),!me())throw Ee;T=Se,_e("setNavBarMenu",[re])},h.showActionMenu=function(re,Se){if(se(Y),!me())throw Ee;b=Se,_e("showActionMenu",[re])},h.isSupported=me}(Bu||(Bu={})),function(h){function T(){if(typeof window>"u")throw new Error("window object undefined at print call");window.print()}function b(G,Q){G&&se(Y),G&&Q&&Q(),u0(G)}function A(G,Q){G&&se(Y),G&&Q&&Q(),l0(G)}function q(){return!(!se(Y)||!Y.supports.teamsCore)}h.enablePrintCapability=function(){if(!X.printCapabilityEnabled){if(se(Y),!q())throw Ee;X.printCapabilityEnabled=!0,document.addEventListener("keydown",function(G){(G.ctrlKey||G.metaKey)&&G.keyCode===80&&(T(),G.cancelBubble=!0,G.preventDefault(),G.stopImmediatePropagation())})}},h.print=T,h.registerOnLoadHandler=function(G){b(G,function(){if(G&&!q())throw Ee})},h.registerOnLoadHandlerHelper=b,h.registerBeforeUnloadHandler=function(G){A(G,function(){if(G&&!q())throw Ee})},h.registerBeforeUnloadHandlerHelper=A,h.isSupported=q}(ji||(ji={})),function(h){var T=ge("app");h.Messages={AppLoaded:"appInitialization.appLoaded",Success:"appInitialization.success",Failure:"appInitialization.failure",ExpectedFailure:"appInitialization.expectedFailure"},function(Q){Q.AuthFailed="AuthFailed",Q.Timeout="Timeout",Q.Other="Other"}(h.FailedReason||(h.FailedReason={})),function(Q){Q.PermissionError="PermissionError",Q.NotFound="NotFound",Q.Throttling="Throttling",Q.Offline="Offline",Q.Other="Other"}(h.ExpectedFailureReason||(h.ExpectedFailureReason={})),h.isInitialized=function(){return X.initializeCompleted},h.getFrameContext=function(){return X.frameContext};var b=5e3;h.initialize=function(Q){return Ui()?(T.extend("initialize")("window object undefined at initialization"),Promise.resolve()):Hv(function(){return q(Q)},b,new Error("SDK initialization timed out."))};var A=T.extend("initializeHelper");function q(Q){return new Promise(function(ne){X.initializeCalled||(X.initializeCalled=!0,i0(),X.initializePromise=d0(Q).then(function(me){var re=me.context,Se=me.clientType,Ue=me.runtimeConfig,Oe=me.clientSupportedSDKVersion,Pe=Oe===void 0?o:Oe;X.frameContext=re,X.hostClientType=Se,X.clientSupportedSDKVersion=Pe;try{A("Parsing %s",Ue);var Me=JSON.parse(Ue);if(A("Checking if %o is a valid runtime object",Me??"null"),!Me||!Me.apiVersion)throw new Error("Received runtime config is invalid");Ue&&Ac(Me)}catch(Ie){if(!(Ie instanceof SyntaxError))throw Ie;try{if(A("Attempting to parse %s as an SDK version",Ue),isNaN(Lu(Ue,o))||(X.clientSupportedSDKVersion=Ue),Me=JSON.parse(Pe),A("givenRuntimeConfig parsed to %o",Me??"null"),!Me)throw new Error("givenRuntimeConfig string was successfully parsed. However, it parsed to value of null");Ac(Me)}catch(ze){if(!(ze instanceof SyntaxError))throw ze;Ac(Xv(X.clientSupportedSDKVersion))}}X.initializeCompleted=!0}),ma.initialize(),Bu.initialize(),Ft.config.initialize(),os.initialize()),Array.isArray(Q)&&t0(Q),ne(X.initializePromise)})}function G(Q){Q&&qi(),o0(Q)}h._initialize=function(Q){ke.currentWindow=Q},h._uninitialize=function(){X.initializeCalled&&(X.frameContext&&(G(null),Ft.backStack.registerBackButtonHandler(null),Ft.registerFullScreenHandler(null),ji.registerBeforeUnloadHandler(null),ji.registerOnLoadHandler(null),ya.registerGetLogHandler(null)),X.frameContext===ee.settings&&Ft.config.registerOnSaveHandler(null),X.frameContext===ee.remove&&Ft.config.registerOnRemoveHandler(null),X.initializeCalled=!1,X.initializeCompleted=!1,X.initializePromise=null,X.additionalValidOrigins=[],X.frameContext=null,X.hostClientType=null,X.isFramelessWindow=!1,h0())},h.getContext=function(){return new Promise(function(Q){qi(),Q(as("getContext"))}).then(function(Q){return n0(Q)})},h.notifyAppLoaded=function(){qi(),_e(h.Messages.AppLoaded,[ju])},h.notifySuccess=function(){qi(),_e(h.Messages.Success,[ju])},h.notifyFailure=function(Q){qi(),_e(h.Messages.Failure,[Q.reason,Q.message])},h.notifyExpectedFailure=function(Q){qi(),_e(h.Messages.ExpectedFailure,[Q.reason,Q.message])},h.registerOnThemeChangeHandler=G,h.openLink=function(Q){return new Promise(function(ne){se(Y,ee.content,ee.sidePanel,ee.settings,ee.task,ee.stage,ee.meetingStage),ne(yt("executeDeepLink",Q))})}}(nr||(nr={})),function(h){function T(A){if(se(Y,ee.content),!b())throw Ee;_e("setFrameContext",[A])}function b(){return!(!se(Y)||!Y.supports.pages)}h.returnFocus=function(A){if(se(Y),!b())throw Ee;_e("returnFocus",[A])},h.registerFocusEnterHandler=function(A){jr("focusEnter",A,[],function(){if(!b())throw Ee})},h.setCurrentFrame=T,h.initializeWithFrameContext=function(A,q,G){nr.initialize(G).then(function(){return q&&q()}),T(A)},h.getConfig=function(){return new Promise(function(A){if(se(Y,ee.content,ee.settings,ee.remove,ee.sidePanel),!b())throw Ee;A(as("settings.getSettings"))})},h.navigateCrossDomain=function(A){return new Promise(function(q){if(se(Y,ee.content,ee.sidePanel,ee.settings,ee.remove,ee.task,ee.stage,ee.meetingStage),!b())throw Ee;q(Oc("navigateCrossDomain","Cross-origin navigation is only supported for URLs matching the pattern registered in the manifest.",A))})},h.navigateToApp=function(A){return new Promise(function(q){if(se(Y,ee.content,ee.sidePanel,ee.settings,ee.task,ee.stage,ee.meetingStage),!b())throw Ee;Y.isLegacyTeams?q(yt("executeDeepLink",Vv(A))):q(yt("pages.navigateToApp",A))})},h.shareDeepLink=function(A){if(se(Y,ee.content,ee.sidePanel,ee.meetingStage),!b())throw Ee;_e("shareDeepLink",[A.subPageId,A.subPageLabel,A.subPageWebUrl])},h.registerFullScreenHandler=function(A){jr("fullScreenChange",A,[],function(){if(A&&!b())throw Ee})},h.isSupported=b,function(A){function q(){return!(!se(Y)||!Y.supports.pages)&&!!Y.supports.pages.tabs}A.navigateToTab=function(G){return new Promise(function(Q){if(se(Y),!q())throw Ee;Q(Oc("navigateToTab","Invalid internalTabInstanceId and/or channelId were/was provided",G))})},A.getTabInstances=function(G){return new Promise(function(Q){if(se(Y),!q())throw Ee;Q(as("getTabInstances",G))})},A.getMruTabInstances=function(G){return new Promise(function(Q){if(se(Y),!q())throw Ee;Q(as("getMruTabInstances",G))})},A.isSupported=q}(h.tabs||(h.tabs={})),function(A){var q,G;function Q(Pe,Me){Pe&&se(Y,ee.settings),Me&&Me(),q=Pe,Pe&&_e("registerHandler",["save"])}function ne(Pe,Me){Pe&&se(Y,ee.remove,ee.settings),Me&&Me(),G=Pe,Pe&&_e("registerHandler",["remove"])}function me(Pe){var Me=new re(Pe);q?q(Me):ke.childWindow?zi("settings.save",[Pe]):Me.notifySuccess()}A.initialize=function(){Ze("settings.save",me,!1),Ze("settings.remove",Se,!1)},A.setValidityState=function(Pe){if(se(Y,ee.settings,ee.remove),!Oe())throw Ee;_e("settings.setValidityState",[Pe])},A.setConfig=function(Pe){return new Promise(function(Me){if(se(Y,ee.content,ee.settings,ee.sidePanel),!Oe())throw Ee;Me(yt("settings.setSettings",Pe))})},A.registerOnSaveHandler=function(Pe){Q(Pe,function(){if(Pe&&!Oe())throw Ee})},A.registerOnSaveHandlerHelper=Q,A.registerOnRemoveHandler=function(Pe){ne(Pe,function(){if(Pe&&!Oe())throw Ee})},A.registerOnRemoveHandlerHelper=ne,A.registerChangeConfigHandler=function(Pe){jr("changeSettings",Pe,[ee.content],function(){if(!Oe())throw Ee})};var re=function(){function Pe(Me){this.notified=!1,this.result=Me||{}}return Pe.prototype.notifySuccess=function(){this.ensureNotNotified(),_e("settings.save.success"),this.notified=!0},Pe.prototype.notifyFailure=function(Me){this.ensureNotNotified(),_e("settings.save.failure",[Me]),this.notified=!0},Pe.prototype.ensureNotNotified=function(){if(this.notified)throw new Error("The SaveEvent may only notify success or failure once.")},Pe}();function Se(){var Pe=new Ue;G?G(Pe):ke.childWindow?zi("settings.remove",[]):Pe.notifySuccess()}var Ue=function(){function Pe(){this.notified=!1}return Pe.prototype.notifySuccess=function(){this.ensureNotNotified(),_e("settings.remove.success"),this.notified=!0},Pe.prototype.notifyFailure=function(Me){this.ensureNotNotified(),_e("settings.remove.failure",[Me]),this.notified=!0},Pe.prototype.ensureNotNotified=function(){if(this.notified)throw new Error("The removeEventType may only notify success or failure once.")},Pe}();function Oe(){return!(!se(Y)||!Y.supports.pages)&&!!Y.supports.pages.config}A.isSupported=Oe}(h.config||(h.config={})),function(A){var q;function G(){return new Promise(function(re){if(se(Y),!me())throw Ee;re(Oc("navigateBack","Back navigation is not supported in the current client or context."))})}function Q(re,Se){re&&se(Y),Se&&Se(),q=re,re&&_e("registerHandler",["backButton"])}function ne(){q&&q()||(ke.childWindow?zi("backButtonPress",[]):G())}function me(){return!(!se(Y)||!Y.supports.pages)&&!!Y.supports.pages.backStack}A._initialize=function(){Ze("backButtonPress",ne,!1)},A.navigateBack=G,A.registerBackButtonHandler=function(re){Q(re,function(){if(re&&!me())throw Ee})},A.registerBackButtonHandlerHelper=Q,A.isSupported=me}(h.backStack||(h.backStack={})),function(A){function q(){return!(!se(Y)||!Y.supports.pages)&&!!Y.supports.pages.fullTrust}A.enterFullscreen=function(){if(se(Y,ee.content),!q())throw Ee;_e("enterFullscreen",[])},A.exitFullscreen=function(){if(se(Y,ee.content),!q())throw Ee;_e("exitFullscreen",[])},A.isSupported=q}(h.fullTrust||(h.fullTrust={})),function(A){function q(){return!(!se(Y)||!Y.supports.pages)&&!!Y.supports.pages.appButton}A.onClick=function(G){jr("appButtonClick",G,[ee.content],function(){if(!q())throw Ee})},A.onHoverEnter=function(G){jr("appButtonHoverEnter",G,[ee.content],function(){if(!q())throw Ee})},A.onHoverLeave=function(G){jr("appButtonHoverLeave",G,[ee.content],function(){if(!q())throw Ee})},A.isSupported=q}(h.appButton||(h.appButton={})),function(A){function q(){return!(!se(Y)||!Y.supports.pages)&&!!Y.supports.pages.currentApp}A.navigateTo=function(G){return new Promise(function(Q){if(se(Y,ee.content,ee.sidePanel,ee.settings,ee.task,ee.stage,ee.meetingStage),!q())throw Ee;Q(ft("pages.currentApp.navigateTo",G))})},A.navigateToDefaultPage=function(){return new Promise(function(G){if(se(Y,ee.content,ee.sidePanel,ee.settings,ee.task,ee.stage,ee.meetingStage),!q())throw Ee;G(ft("pages.currentApp.navigateToDefaultPage"))})},A.isSupported=q}(h.currentApp||(h.currentApp={}))}(Ft||(Ft={}));var Tf=function(h,T,b){if(b||arguments.length===2)for(var A,q=0,G=T.length;q<G;q++)!A&&q in T||(A||(A=Array.prototype.slice.call(T,0,q)),A[q]=T[q]);return h.concat(A||Array.prototype.slice.call(T))},r0=ge("handlers"),vn=function(){function h(){}return h.handlers={},h}();function i0(){vn.handlers.themeChange=a0,vn.handlers.load=yo,vn.handlers.beforeUnload=c0,Ft.backStack._initialize()}var Pf=r0.extend("callHandler");function Rf(h,T){var b=vn.handlers[h];return b?(Pf("Invoking the registered handler for message %s with arguments %o",h,T),[!0,b.apply(this,T)]):ke.childWindow?(zi(h,T),[!1,void 0]):(Pf("Handler for action message %s not found.",h),[!1,void 0])}function Ze(h,T,b,A){b===void 0&&(b=!0),A===void 0&&(A=[]),T?(vn.handlers[h]=T,b&&_e("registerHandler",Tf([h],A,!0))):delete vn.handlers[h]}function yn(h){delete vn.handlers[h]}function s0(h){return vn.handlers[h]!=null}function jr(h,T,b,A){T&&se.apply(void 0,Tf([Y],b,!1)),A&&A(),Ze(h,T)}function o0(h){vn.themeChangeHandler=h,h&&_e("registerHandler",["themeChange"])}function a0(h){vn.themeChangeHandler&&vn.themeChangeHandler(h),ke.childWindow&&zi("themeChange",[h])}function u0(h){vn.loadHandler=h,h&&_e("registerHandler",["load"])}function yo(h){vn.loadHandler&&vn.loadHandler(h),ke.childWindow&&zi("load",[h])}function l0(h){vn.beforeUnloadHandler=h,h&&_e("registerHandler",["beforeUnload"])}function c0(){var h=function(){_e("readyToUnload",[])};vn.beforeUnloadHandler&&vn.beforeUnloadHandler(h)||(ke.childWindow?zi("beforeUnload"):h())}var _f=function(h,T,b){if(b||arguments.length===2)for(var A,q=0,G=T.length;q<G;q++)!A&&q in T||(A||(A=Array.prototype.slice.call(T,0,q)),A[q]=T[q]);return h.concat(A||Array.prototype.slice.call(T))},kc=ge("communication"),ke=function(){return function(){}}(),Sn=function(){function h(){}return h.parentMessageQueue=[],h.childMessageQueue=[],h.nextMessageId=0,h.callbacks={},h.promiseCallbacks={},h}();function d0(h){if(Sn.messageListener=function(b){return Nc(b)},ke.currentWindow=ke.currentWindow||window,ke.parentWindow=ke.currentWindow.parent!==ke.currentWindow.self?ke.currentWindow.parent:ke.currentWindow.opener,(ke.parentWindow||h)&&ke.currentWindow.addEventListener("message",Sn.messageListener,!1),!ke.parentWindow){var T=ke.currentWindow;if(!T.nativeInterface)return Promise.reject(new Error("Initialization Failed. No Parent window found."));X.isFramelessWindow=!0,T.onNativeMessage=Af}try{return ke.parentOrigin="*",us("initialize",[ju,Ic]).then(function(b){return{context:b[0],clientType:b[1],runtimeConfig:b[2],clientSupportedSDKVersion:b[3]}})}finally{ke.parentOrigin=null}}function h0(){ke.currentWindow&&ke.currentWindow.removeEventListener("message",Sn.messageListener,!1),ke.currentWindow=null,ke.parentWindow=null,ke.parentOrigin=null,ke.childWindow=null,ke.childOrigin=null,Sn.parentMessageQueue=[],Sn.childMessageQueue=[],Sn.nextMessageId=0,Sn.callbacks={},Sn.promiseCallbacks={}}function as(h){for(var T=[],b=1;b<arguments.length;b++)T[b-1]=arguments[b];return us(h,T).then(function(A){return A[0]})}function yt(h){for(var T=[],b=1;b<arguments.length;b++)T[b-1]=arguments[b];return us(h,T).then(function(A){var q=A[0],G=A[1];if(!q)throw new Error(G)})}function Oc(h,T){for(var b=[],A=2;A<arguments.length;A++)b[A-2]=arguments[A];return us(h,b).then(function(q){var G=q[0],Q=q[1];if(!G)throw new Error(Q||T)})}function ft(h){for(var T=[],b=1;b<arguments.length;b++)T[b-1]=arguments[b];return us(h,T).then(function(A){var q=A[0],G=A[1];if(q)throw q;return G})}function us(h,T){return T===void 0&&(T=void 0),new Promise(function(b){b(Fc(If(h,T).id))})}function Fc(h){return new Promise(function(T){Sn.promiseCallbacks[h]=T})}function _e(h,T,b){var A;T instanceof Function?b=T:T instanceof Array&&(A=T);var q=If(h,A);b&&(Sn.callbacks[q.id]=b)}var f0=kc.extend("sendMessageToParentHelper");function If(h,T){var b=f0,A=ke.parentWindow,q=m0(h,T);if(b("Message %i information: %o",q.id,{actionName:h,args:T}),X.isFramelessWindow)ke.currentWindow&&ke.currentWindow.nativeInterface&&(b("Sending message %i to parent via framelessPostMessage interface",q.id),ke.currentWindow.nativeInterface.framelessPostMessage(JSON.stringify(q)));else{var G=va(A);A&&G?(b("Sending message %i to parent via postMessage",q.id),A.postMessage(q,G)):(b("Adding message %i to parent message queue",q.id),ga(A).push(q))}return q}function Nc(h){if(h&&h.data&&typeof h.data=="object"){var T=h.source||h.originalEvent&&h.originalEvent.source,b=h.origin||h.originalEvent&&h.originalEvent.origin;Uu(T,b)&&(Pr(T,b),T===ke.parentWindow?Af(h):T===ke.childWindow&&Xr(h))}}function Uu(h,T){return(!ke.currentWindow||h!==ke.currentWindow)&&(!!(ke.currentWindow&&ke.currentWindow.location&&T&&T===ke.currentWindow.location.origin)||Mi(new URL(T)))}function Pr(h,T){X.isFramelessWindow||ke.parentWindow&&!ke.parentWindow.closed&&h!==ke.parentWindow?ke.childWindow&&!ke.childWindow.closed&&h!==ke.childWindow||(ke.childWindow=h,ke.childOrigin=T):(ke.parentWindow=h,ke.parentOrigin=T),ke.parentWindow&&ke.parentWindow.closed&&(ke.parentWindow=null,ke.parentOrigin=null),ke.childWindow&&ke.childWindow.closed&&(ke.childWindow=null,ke.childOrigin=null),Bc(ke.parentWindow),Bc(ke.childWindow)}var ln=kc.extend("handleParentMessage");function Af(h){var T=ln;if("id"in h.data&&typeof h.data.id=="number"){var b=h.data,A=Sn.callbacks[b.id];T("Received a response from parent for message %i",b.id),A&&(T("Invoking the registered callback for message %i with arguments %o",b.id,b.args),A.apply(null,_f(_f([],b.args,!0),[b.isPartialResponse],!1)),Dc(h)||(T("Removing registered callback for message %i",b.id),delete Sn.callbacks[b.id]));var q=Sn.promiseCallbacks[b.id];q&&(T("Invoking the registered promise callback for message %i with arguments %o",b.id,b.args),q(b.args),T("Removing registered promise callback for message %i",b.id),delete Sn.promiseCallbacks[b.id])}else"func"in h.data&&typeof h.data.func=="string"?(T("Received an action message %s from parent",(b=h.data).func),Rf(b.func,b.args)):T("Received an unknown message: %O",h)}function Dc(h){return h.data.isPartialResponse===!0}function Xr(h){if("id"in h.data&&"func"in h.data){var T=h.data,b=Rf(T.func,T.args),A=b[0],q=b[1];A&&q!==void 0?Je(T.id,Array.isArray(q)?q:[q]):_e(T.func,T.args,function(){for(var G=[],Q=0;Q<arguments.length;Q++)G[Q]=arguments[Q];if(ke.childWindow){var ne=G.pop();Je(T.id,G,ne)}})}}function ga(h){return h===ke.parentWindow?Sn.parentMessageQueue:h===ke.childWindow?Sn.childMessageQueue:[]}function va(h){return h===ke.parentWindow?ke.parentOrigin:h===ke.childWindow?ke.childOrigin:null}var ya,Lc,Mc,bi,cn,p0=kc.extend("flushMessageQueue");function Bc(h){for(var T=va(h),b=ga(h),A=h==ke.parentWindow?"parent":"child";h&&T&&b.length>0;){var q=b.shift();p0("Flushing message %i from "+A+" message queue via postMessage.",q.id),h.postMessage(q,T)}}function kf(h,T){var b=ke.currentWindow.setInterval(function(){ga(h).length===0&&(clearInterval(b),T())},100)}function Je(h,T,b){var A=ke.childWindow,q=g0(h,T,b),G=va(A);A&&G&&A.postMessage(q,G)}function zi(h,T){var b=ke.childWindow,A=v0(h,T),q=va(b);b&&q?b.postMessage(A,q):ga(b).push(A)}function m0(h,T){return{id:Sn.nextMessageId++,func:h,timestamp:Date.now(),args:T||[]}}function g0(h,T,b){return{id:h,args:T||[],isPartialResponse:b}}function v0(h,T){return{func:h,args:T||[]}}function y0(h,T){se(Y),_e("uploadCustomApp",[h],T||Br())}function Of(h,T,b){se(Y),_e(h,T,b)}function S0(h,T){if(se(Y),!ke.childWindow)throw new Error("The child window has not yet been initialized or is not present");zi(h,T)}function b0(h,T){var b=this;se(Y),Ze(h,function(){for(var A=[],q=0;q<arguments.length;q++)A[q]=arguments[q];return T.apply(b,A)})}function w0(h,T){se(Y),Ze("userSettingsChange",T,!0,[h])}function C0(h){se(Y,ee.content,ee.task),_e("openFilePreview",[h.entityId,h.title,h.description,h.type,h.objectUrl,h.downloadUrl,h.webPreviewUrl,h.webEditUrl,h.baseUrl,h.editFile,h.subEntityId,h.viewerAction,h.fileOpenPreference,h.conversationId])}(function(h){function T(){return!(!se(Y)||!Y.supports.logs)}h.registerGetLogHandler=function(b){if(b&&se(Y),b&&!T())throw Ee;b?Ze("log.request",function(){_e("log.receive",[b()])}):yn("log.request")},h.isSupported=T})(ya||(ya={})),function(h){h.fileDownloadStart="fileDownloadStart",h.fileDownloadComplete="fileDownloadComplete"}(Lc||(Lc={})),function(h){h.view="view",h.edit="edit",h.editNew="editNew"}(Mc||(Mc={})),function(h){h.fileOpenPreference="fileOpenPreference",h.theme="theme"}(bi||(bi={})),function(h){function T(){return!(!se(Y)||!Y.supports.conversations)}h.openConversation=function(b){return new Promise(function(A){if(se(Y,ee.content),!T())throw Ee;var q=yt("conversations.openConversation",{title:b.title,subEntityId:b.subEntityId,conversationId:b.conversationId,channelId:b.channelId,entityId:b.entityId});b.onStartConversation&&Ze("startConversation",function(G,Q,ne,me){return b.onStartConversation({subEntityId:G,conversationId:Q,channelId:ne,entityId:me})}),b.onCloseConversation&&Ze("closeConversation",function(G,Q,ne,me){return b.onCloseConversation({subEntityId:G,conversationId:Q,channelId:ne,entityId:me})}),A(q)})},h.closeConversation=function(){if(se(Y,ee.content),!T())throw Ee;_e("conversations.closeConversation"),yn("startConversation"),yn("closeConversation")},h.getChatMembers=function(){return new Promise(function(b){if(se(Y),!T())throw Ee;b(as("getChatMembers"))})},h.isSupported=T}(cn||(cn={}));var jc,qc,x0="/l/app/",rn="/l/meeting/new",E0="attendees",T0="startTime",P0="endTime",R0="subject",_0="content",I0="/l/call/0/0",A0="source",k0="withVideo",mt="/l/chat/0/0",Ff="users",O0="topicName",F0="message";function Nf(h,T,b){if(h.length===0)throw new Error("Must have at least one user when creating a chat deep link");var A="".concat(Ff,"=")+h.map(function(Q){return encodeURIComponent(Q)}).join(","),q=T===void 0?"":"&".concat(O0,"=").concat(encodeURIComponent(T)),G=b===void 0?"":"&".concat(F0,"=").concat(encodeURIComponent(b));return"".concat(k,"://").concat(z).concat(mt,"?").concat(A).concat(q).concat(G)}function N0(h,T,b){if(h.length===0)throw new Error("Must have at least one target when creating a call deep link");var A="".concat(Ff,"=")+h.map(function(Q){return encodeURIComponent(Q)}).join(","),q=T===void 0?"":"&".concat(k0,"=").concat(encodeURIComponent(T)),G=b===void 0?"":"&".concat(A0,"=").concat(encodeURIComponent(b));return"".concat(k,"://").concat(z).concat(I0,"?").concat(A).concat(q).concat(G)}function D0(h,T,b,A,q){var G=h===void 0?"":"".concat(E0,"=")+h.map(function(Se){return encodeURIComponent(Se)}).join(","),Q=T===void 0?"":"&".concat(T0,"=").concat(encodeURIComponent(T)),ne=b===void 0?"":"&".concat(P0,"=").concat(encodeURIComponent(b)),me=A===void 0?"":"&".concat(R0,"=").concat(encodeURIComponent(A)),re=q===void 0?"":"&".concat(_0,"=").concat(encodeURIComponent(q));return"".concat(k,"://").concat(z).concat(rn,"?").concat(G).concat(Q).concat(ne).concat(me).concat(re)}function L0(h){if(!h)throw new Error("App ID must be set when creating an app install dialog deep link");return"".concat(k,"://").concat(z).concat(x0).concat(encodeURIComponent(h))}(function(h){function T(){return!(!se(Y)||!Y.supports.appInstallDialog)}h.openAppInstallDialog=function(b){return new Promise(function(A){if(se(Y,ee.content,ee.sidePanel,ee.settings,ee.task,ee.stage,ee.meetingStage),!T())throw new Error("Not supported");Y.isLegacyTeams?A(yt("executeDeepLink",L0(b.appId))):(_e("appInstallDialog.openAppInstallDialog",[b]),A())})},h.isSupported=T})(jc||(jc={})),function(h){function T(Q){var ne;return{title:Q.title,content:Q.content,notificationIconAsSring:(ne=Q.icon)===null||ne===void 0?void 0:ne.href,displayDurationInSeconds:Q.displayDurationInSeconds,notificationActionUrlAsString:Q.notificationActionUrl.href}}function b(Q){return["https:"].includes(Q.protocol)}function A(Q,ne){return Q.length<=ne}function q(Q){if(!Q.title)throw new Error("Must supply notification title");if(!A(Q.title,75))throw new Error("Invalid notification title length: Maximum title length ".concat(75,", title length supplied ").concat(Q.title.length));if(!Q.content)throw new Error("Must supply notification content");if(!A(Q.content,1500))throw new Error("Invalid notification content length: Maximum content length ".concat(1500,", content length supplied ").concat(Q.content.length));if(!Q.notificationActionUrl)throw new Error("Must supply notification url");if(!b(Q.notificationActionUrl))throw new Error("Invalid notificationAction url");if((Q==null?void 0:Q.icon)!==void 0&&!b(Q==null?void 0:Q.icon))throw new Error("Invalid icon url");if(!Q.displayDurationInSeconds)throw new Error("Must supply notification display duration in seconds");if(Q.displayDurationInSeconds<0)throw new Error("Notification display time must be greater than zero")}function G(){return!(!se(Y)||!Y.supports.appNotification)}h.displayInAppNotification=function(Q){if(se(Y,ee.content,ee.stage,ee.sidePanel,ee.meetingStage),!G())throw Ee;return q(Q),ft("appNotification.displayNotification",T(Q))},h.isSupported=G}(qc||(qc={}));var ls,Uc,Yr,zc,Df=function(){var h=function(T,b){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,q){A.__proto__=q}||function(A,q){for(var G in q)Object.prototype.hasOwnProperty.call(q,G)&&(A[G]=q[G])},h(T,b)};return function(T,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function A(){this.constructor=T}h(T,b),T.prototype=b===null?Object.create(b):(A.prototype=b.prototype,new A)}}();function Lf(h,T){if(h==null||T==null||h.length<=0)return null;var b,A=1;return h.sort(function(q,G){return q.sequence>G.sequence?1:-1}),h.forEach(function(q){q.sequence==A&&(b=b?new Blob([b,q.file],{type:T}):new Blob([q.file],{type:T}),A++)}),b}function Mf(h,T){if(h==null||T==null)return null;for(var b=atob(h.chunk),A=new Array(b.length),q=0;q<b.length;q++)A[q]=b.charCodeAt(q);var G=new Uint8Array(A),Q=new Blob([G],{type:T});return{sequence:h.chunkSequence,file:Q}}function M0(h){Fe(h)?qu(u):S(h)?qu(d):Bf(h)&&qu(f)}function B0(h){return!(h.mediaType!=ls.MediaType.Video||!h.videoProps||!h.videoProps.videoController)}function j0(h){return!(h==null||h.maxMediaCount>10)}function Bf(h){var T;return!((h==null?void 0:h.mediaType)!=ls.MediaType.Image||!(!((T=h==null?void 0:h.imageProps)===null||T===void 0)&&T.imageOutputFormats))}function Fe(h){return!(!h||h.mediaType!=ls.MediaType.VideoAndImage&&!h.videoAndImageProps)}function S(h){return!(!h||h.mediaType!=ls.MediaType.Video||!h.videoProps||h.videoProps.isFullScreenMode)}function jf(h,T,b){return h!=null&&T!=null&&T==ls.FileFormat.ID&&b!=null}function qf(h){return!(h==null||h.length<=0||h.length>10)}function Sa(h){return!h||!(h.timeOutIntervalInSec===null||h.timeOutIntervalInSec<=0||h.timeOutIntervalInSec>60)}function rr(h){return!(h&&(h.title&&typeof h.title!="string"||h.setSelected&&typeof h.setSelected!="object"||h.openOrgWideSearchInChatOrChannel&&typeof h.openOrgWideSearchInChatOrChannel!="boolean"||h.singleSelect&&typeof h.singleSelect!="boolean"))}function q0(){return Y.hostVersionsInfo?Y.hostVersionsInfo.adaptiveCardSchemaVersion:void 0}(function(h){(function(ne){ne.Base64="base64",ne.ID="id"})(h.FileFormat||(h.FileFormat={}));var T=function(){return function(){}}();function b(){return!(!se(Y)||!Y.supports.permissions)}h.File=T,h.captureImage=function(ne){if(!ne)throw new Error("[captureImage] Callback cannot be null");se(Y,ee.content,ee.task),X.isFramelessWindow?Qr(D)?_e("captureImage",ne):ne({errorCode:Ce.OLD_PLATFORM},void 0):ne({errorCode:Ce.NOT_SUPPORTED_ON_PLATFORM},void 0)},h.hasPermission=function(){if(se(Y,ee.content,ee.task),!b())throw Ee;var ne=Ve.Media;return new Promise(function(me){me(ft("permissions.has",ne))})},h.requestPermission=function(){if(se(Y,ee.content,ee.task),!b())throw Ee;var ne=Ve.Media;return new Promise(function(me){me(ft("permissions.request",ne))})};var A=function(ne){function me(re){re===void 0&&(re=null);var Se=ne.call(this)||this;return re&&(Se.content=re.content,Se.format=re.format,Se.mimeType=re.mimeType,Se.name=re.name,Se.preview=re.preview,Se.size=re.size),Se}return Df(me,ne),me.prototype.getMedia=function(re){if(!re)throw new Error("[get Media] Callback cannot be null");se(Y,ee.content,ee.task),Qr(M)?jf(this.mimeType,this.format,this.content)?Qr("2.0.0")?this.getMediaViaCallback(re):this.getMediaViaHandler(re):re({errorCode:Ce.INVALID_ARGUMENTS},null):re({errorCode:Ce.OLD_PLATFORM},null)},me.prototype.getMediaViaCallback=function(re){var Se={mediaMimeType:this.mimeType,assembleAttachment:[]};_e("getMedia",[this.content],function(Ue){if(re)if(Ue&&Ue.error)re(Ue.error,null);else if(Ue&&Ue.mediaChunk)if(Ue.mediaChunk.chunkSequence<=0){var Oe=Lf(Se.assembleAttachment,Se.mediaMimeType);re(Ue.error,Oe)}else{var Pe=Mf(Ue.mediaChunk,Se.mediaMimeType);Se.assembleAttachment.push(Pe)}else re({errorCode:Ce.INTERNAL_ERROR,message:"data received is null"},null)})},me.prototype.getMediaViaHandler=function(re){var Se=mf(),Ue={mediaMimeType:this.mimeType,assembleAttachment:[]},Oe=[Se,this.content];this.content&&re&&_e("getMedia",Oe),Ze("getMedia"+Se,function(Pe){if(re){var Me=JSON.parse(Pe);if(Me.error)re(Me.error,null),yn("getMedia"+Se);else if(Me.mediaChunk)if(Me.mediaChunk.chunkSequence<=0){var Ie=Lf(Ue.assembleAttachment,Ue.mediaMimeType);re(Me.error,Ie),yn("getMedia"+Se)}else{var ze=Mf(Me.mediaChunk,Ue.mediaMimeType);Ue.assembleAttachment.push(ze)}else re({errorCode:Ce.INTERNAL_ERROR,message:"data received is null"},null),yn("getMedia"+Se)}})},me}(T);h.Media=A;var q,G,Q=function(ne){function me(){return ne!==null&&ne.apply(this,arguments)||this}return Df(me,ne),me.prototype.getMediaType=function(){return G.Video},me.prototype.notifyEventToApp=function(re){if(this.controllerCallback)switch(re){case q.StartRecording:if(this.controllerCallback.onRecordingStarted){this.controllerCallback.onRecordingStarted();break}}},me}(function(){function ne(me){this.controllerCallback=me}return ne.prototype.notifyEventToHost=function(me,re){se(Y,ee.content,ee.task);try{qu(d)}catch(Se){return void(re&&re(Se))}_e("media.controller",[{mediaType:this.getMediaType(),mediaControllerEvent:me}],function(Se){re&&re(Se)})},ne.prototype.stop=function(me){this.notifyEventToHost(q.StopRecording,me)},ne}());h.VideoController=Q,function(ne){ne[ne.StartRecording=1]="StartRecording",ne[ne.StopRecording=2]="StopRecording"}(q=h.MediaControllerEvent||(h.MediaControllerEvent={})),function(ne){ne[ne.Photo=1]="Photo",ne[ne.Document=2]="Document",ne[ne.Whiteboard=3]="Whiteboard",ne[ne.BusinessCard=4]="BusinessCard"}(h.CameraStartMode||(h.CameraStartMode={})),function(ne){ne[ne.Camera=1]="Camera",ne[ne.Gallery=2]="Gallery"}(h.Source||(h.Source={})),function(ne){ne[ne.Image=1]="Image",ne[ne.Video=2]="Video",ne[ne.VideoAndImage=3]="VideoAndImage",ne[ne.Audio=4]="Audio"}(G=h.MediaType||(h.MediaType={})),function(ne){ne[ne.ID=1]="ID",ne[ne.URL=2]="URL"}(h.ImageUriType||(h.ImageUriType={})),function(ne){ne[ne.IMAGE=1]="IMAGE",ne[ne.PDF=2]="PDF"}(h.ImageOutputFormats||(h.ImageOutputFormats={})),h.selectMedia=function(ne,me){if(!me)throw new Error("[select Media] Callback cannot be null");if(se(Y,ee.content,ee.task),Qr(M)){try{M0(ne)}catch(Ue){return void me(Ue,null)}if(j0(ne))_e("selectMedia",[ne],function(Ue,Oe,Pe){if(Pe)B0(ne)&&ne.videoProps.videoController.notifyEventToApp(Pe);else if(Oe){for(var Me=[],Ie=0,ze=Oe;Ie<ze.length;Ie++){var Ye=ze[Ie];Me.push(new A(Ye))}me(Ue,Me)}else me(Ue,null)});else{var re={errorCode:Ce.INVALID_ARGUMENTS};me(re,null)}}else{var Se={errorCode:Ce.OLD_PLATFORM};me(Se,null)}},h.viewImages=function(ne,me){if(!me)throw new Error("[view images] Callback cannot be null");se(Y,ee.content,ee.task),Qr(M)?qf(ne)?_e("viewImages",[ne],me):me({errorCode:Ce.INVALID_ARGUMENTS}):me({errorCode:Ce.OLD_PLATFORM})},h.scanBarCode=function(ne,me){if(!ne)throw new Error("[media.scanBarCode] Callback cannot be null");se(Y,ee.content,ee.task),X.hostClientType!==qe.desktop&&X.hostClientType!==qe.web&&X.hostClientType!==qe.rigel&&X.hostClientType!==qe.teamsRoomsWindows&&X.hostClientType!==qe.teamsRoomsAndroid&&X.hostClientType!==qe.teamsPhones&&X.hostClientType!==qe.teamsDisplays?Qr(U)?Sa(me)?_e("media.scanBarCode",[me],ne):ne({errorCode:Ce.INVALID_ARGUMENTS},null):ne({errorCode:Ce.OLD_PLATFORM},null):ne({errorCode:Ce.NOT_SUPPORTED_ON_PLATFORM},null)}})(ls||(ls={})),function(h){function T(){return!!(se(Y)&&Y.supports.barCode&&Y.supports.permissions)}h.scanBarCode=function(b){return new Promise(function(A){if(se(Y,ee.content,ee.task),!T())throw Ee;if(!Sa(b))throw{errorCode:Ce.INVALID_ARGUMENTS};A(ft("media.scanBarCode",b))})},h.hasPermission=function(){if(se(Y,ee.content,ee.task),!T())throw Ee;var b=Ve.Media;return new Promise(function(A){A(ft("permissions.has",b))})},h.requestPermission=function(){if(se(Y,ee.content,ee.task),!T())throw Ee;var b=Ve.Media;return new Promise(function(A){A(ft("permissions.request",b))})},h.isSupported=T}(Uc||(Uc={})),function(h){function T(A){return new Promise(function(q){if(se(Y,ee.content,ee.task),!b())throw Ee;Y.isLegacyTeams?q(yt("executeDeepLink",Nf([A.user],void 0,A.message))):q(yt("chat.openChat",{members:A.user,message:A.message}))})}function b(){return!(!se(Y)||!Y.supports.chat)}h.openChat=T,h.openGroupChat=function(A){return new Promise(function(q){if(A.users.length<1)throw Error("OpenGroupChat Failed: No users specified");if(A.users.length===1)T({user:A.users[0],message:A.message});else{if(se(Y,ee.content,ee.task),!b())throw Ee;Y.isLegacyTeams?q(yt("executeDeepLink",Nf(A.users,A.topic,A.message))):q(yt("chat.openChat",{members:A.users,message:A.message,topic:A.topic}))}})},h.isSupported=b}(Yr||(Yr={})),function(h){function T(){return!!(se(Y)&&Y.supports.geoLocation&&Y.supports.permissions)}h.getCurrentLocation=function(){if(se(Y,ee.content,ee.task),!T())throw Ee;return ft("location.getLocation",{allowChooseLocation:!1,showMap:!1})},h.hasPermission=function(){if(se(Y,ee.content,ee.task),!T())throw Ee;var b=Ve.GeoLocation;return new Promise(function(A){A(ft("permissions.has",b))})},h.requestPermission=function(){if(se(Y,ee.content,ee.task),!T())throw Ee;var b=Ve.GeoLocation;return new Promise(function(A){A(ft("permissions.request",b))})},h.isSupported=T,function(b){function A(){return!!(se(Y)&&Y.supports.geoLocation&&Y.supports.geoLocation.map&&Y.supports.permissions)}b.chooseLocation=function(){if(se(Y,ee.content,ee.task),!A())throw Ee;return ft("location.getLocation",{allowChooseLocation:!0,showMap:!0})},b.showLocation=function(q){if(se(Y,ee.content,ee.task),!A())throw Ee;if(!q)throw{errorCode:Ce.INVALID_ARGUMENTS};return ft("location.showLocation",q)},b.isSupported=A}(h.map||(h.map={}))}(zc||(zc={}));var $c,Hc,Us=function(){function h(){}return h.prototype.postMessage=function(T,b){se(Y),_e("messageForChild",[T],b||Br())},h.prototype.addEventListener=function(T,b){se(Y),T==="message"&&Ze("messageForParent",b)},h}(),ba=function(){function h(){}return Object.defineProperty(h,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!1,configurable:!0}),h.prototype.postMessage=function(T,b){se(Y,ee.task),_e("messageForParent",[T],b||Br())},h.prototype.addEventListener=function(T,b){se(Y,ee.task),T==="message"&&Ze("messageForChild",b)},h}();(function(h){function T(){return!(!se(Y)||!Y.supports.secondaryBrowser)}h.open=function(b){if(se(Y,ee.content),!T())throw Ee;if(!b||!Sf(b))throw{errorCode:Ce.INVALID_ARGUMENTS,message:"Invalid Url: Only https URL is allowed"};return ft("secondaryBrowser.open",b.toString())},h.isSupported=T})($c||($c={})),function(h){function T(){return!(!se(Y)||!Y.supports.location)}h.getLocation=function(b,A){if(!A)throw new Error("[location.getLocation] Callback cannot be null");if(se(Y,ee.content,ee.task),!Qr(g))throw{errorCode:Ce.OLD_PLATFORM};if(!b)throw{errorCode:Ce.INVALID_ARGUMENTS};if(!T())throw Ee;_e("location.getLocation",[b],A)},h.showLocation=function(b,A){if(!A)throw new Error("[location.showLocation] Callback cannot be null");if(se(Y,ee.content,ee.task),!Qr(g))throw{errorCode:Ce.OLD_PLATFORM};if(!b)throw{errorCode:Ce.INVALID_ARGUMENTS};if(!T())throw Ee;_e("location.showLocation",[b],A)},h.isSupported=T}(Hc||(Hc={}));var Gt,Pt,zs,Rr,Vc,Wc,zu=function(h,T,b,A){function q(G){return G instanceof b?G:new b(function(Q){Q(G)})}return new(b||(b=Promise))(function(G,Q){function ne(Se){try{re(A.next(Se))}catch(Ue){Q(Ue)}}function me(Se){try{re(A.throw(Se))}catch(Ue){Q(Ue)}}function re(Se){Se.done?G(Se.value):q(Se.value).then(ne,me)}re((A=A.apply(h,T||[])).next())})},St=function(h,T){var b,A,q,G,Q={label:0,sent:function(){if(1&q[0])throw q[1];return q[1]},trys:[],ops:[]};return G={next:ne(0),throw:ne(1),return:ne(2)},typeof Symbol=="function"&&(G[Symbol.iterator]=function(){return this}),G;function ne(re){return function(Se){return me([re,Se])}}function me(re){if(b)throw new TypeError("Generator is already executing.");for(;G&&(G=0,re[0]&&(Q=0)),Q;)try{if(b=1,A&&(q=2&re[0]?A.return:re[0]?A.throw||((q=A.return)&&q.call(A),0):A.next)&&!(q=q.call(A,re[1])).done)return q;switch(A=0,q&&(re=[2&re[0],q.value]),re[0]){case 0:case 1:q=re;break;case 4:return Q.label++,{value:re[1],done:!1};case 5:Q.label++,A=re[1],re=[0];continue;case 7:re=Q.ops.pop(),Q.trys.pop();continue;default:if(q=Q.trys,!((q=q.length>0&&q[q.length-1])||re[0]!==6&&re[0]!==2)){Q=0;continue}if(re[0]===3&&(!q||re[1]>q[0]&&re[1]<q[3])){Q.label=re[1];break}if(re[0]===6&&Q.label<q[1]){Q.label=q[1],q=re;break}if(q&&Q.label<q[2]){Q.label=q[2],Q.ops.push(re);break}q[2]&&Q.ops.pop(),Q.trys.pop();continue}re=T.call(h,Q)}catch(Se){re=[6,Se],A=0}finally{b=q=0}if(5&re[0])throw re[1];return{value:re[0]?re[1]:void 0,done:!0}}};function U0(h){return h?h.modality&&typeof h.modality!="string"?[!1,"modality must be a string"]:h.targetElementBoundingRect&&typeof h.targetElementBoundingRect=="object"?h.triggerType&&typeof h.triggerType=="string"?z0(h.persona):[!1,"triggerType must be a valid string"]:[!1,"targetElementBoundingRect must be a DOMRect"]:[!1,"A request object is required"]}function z0(h){return h?h.displayName&&typeof h.displayName!="string"?[!1,"displayName must be a string"]:h.identifiers&&typeof h.identifiers=="object"?h.identifiers.AadObjectId||h.identifiers.Smtp||h.identifiers.Upn?h.identifiers.AadObjectId&&typeof h.identifiers.AadObjectId!="string"?[!1,"AadObjectId identifier must be a string"]:h.identifiers.Smtp&&typeof h.identifiers.Smtp!="string"?[!1,"Smtp identifier must be a string"]:h.identifiers.Upn&&typeof h.identifiers.Upn!="string"?[!1,"Upn identifier must be a string"]:[!0,void 0]:[!1,"at least one valid identifier must be provided"]:[!1,"persona identifiers object must be provided"]:[!1,"persona object must be provided"]}(function(h){var T;function b(G,Q){var ne=this;_e("meeting.requestAppAudioHandling",[G.isAppHandlingAudio],function(me,re){if(me&&re!=null)throw new Error("[requestAppAudioHandling] Callback response - both parameters cannot be set");if(me)throw new Error("[requestAppAudioHandling] Callback response - SDK error ".concat(me.errorCode," ").concat(me.message));if(typeof re!="boolean")throw new Error("[requestAppAudioHandling] Callback response - isHostAudioless must be a boolean");Ze("meeting.micStateChanged",function(Se){return zu(ne,void 0,void 0,function(){var Ue,Oe;return St(this,function(Pe){switch(Pe.label){case 0:return Pe.trys.push([0,2,,3]),[4,G.micMuteStateChangedCallback(Se)];case 1:return Ue=Pe.sent(),Oe=Ue.isMicMuted===Se.isMicMuted,q(Ue,Oe?T.HostInitiated:T.AppDeclinedToChange),[3,3];case 2:return Pe.sent(),q(Se,T.AppFailedToChange),[3,3];case 3:return[2]}})})}),Q(re)})}function A(G,Q){_e("meeting.requestAppAudioHandling",[G.isAppHandlingAudio],function(ne,me){if(ne&&me!=null)throw new Error("[requestAppAudioHandling] Callback response - both parameters cannot be set");if(ne)throw new Error("[requestAppAudioHandling] Callback response - SDK error ".concat(ne.errorCode," ").concat(ne.message));if(typeof me!="boolean")throw new Error("[requestAppAudioHandling] Callback response - isHostAudioless must be a boolean");s0("meeting.micStateChanged")&&yn("meeting.micStateChanged"),Q(me)})}function q(G,Q){se(Y,ee.sidePanel,ee.meetingStage),_e("meeting.updateMicState",[G,Q])}(function(G){G[G.HostInitiated=0]="HostInitiated",G[G.AppInitiated=1]="AppInitiated",G[G.AppDeclinedToChange=2]="AppDeclinedToChange",G[G.AppFailedToChange=3]="AppFailedToChange"})(T||(T={})),function(G){G.like="like",G.heart="heart",G.laugh="laugh",G.surprised="surprised",G.applause="applause"}(h.MeetingReactionType||(h.MeetingReactionType={})),function(G){G.Unknown="Unknown",G.Adhoc="Adhoc",G.Scheduled="Scheduled",G.Recurring="Recurring",G.Broadcast="Broadcast",G.MeetNow="MeetNow"}(h.MeetingType||(h.MeetingType={})),function(G){G.OneOnOneCall="oneOnOneCall",G.GroupCall="groupCall"}(h.CallType||(h.CallType={})),h.getIncomingClientAudioState=function(G){if(!G)throw new Error("[get incoming client audio state] Callback cannot be null");se(Y,ee.sidePanel,ee.meetingStage),_e("getIncomingClientAudioState",G)},h.toggleIncomingClientAudio=function(G){if(!G)throw new Error("[toggle incoming client audio] Callback cannot be null");se(Y,ee.sidePanel,ee.meetingStage),_e("toggleIncomingClientAudio",G)},h.getMeetingDetails=function(G){if(!G)throw new Error("[get meeting details] Callback cannot be null");se(Y,ee.sidePanel,ee.meetingStage,ee.settings,ee.content),_e("meeting.getMeetingDetails",G)},h.getAuthenticationTokenForAnonymousUser=function(G){if(!G)throw new Error("[get Authentication Token For AnonymousUser] Callback cannot be null");se(Y,ee.sidePanel,ee.meetingStage,ee.task),_e("meeting.getAuthenticationTokenForAnonymousUser",G)},h.getLiveStreamState=function(G){if(!G)throw new Error("[get live stream state] Callback cannot be null");se(Y,ee.sidePanel),_e("meeting.getLiveStreamState",G)},h.requestStartLiveStreaming=function(G,Q,ne){if(!G)throw new Error("[request start live streaming] Callback cannot be null");se(Y,ee.sidePanel),_e("meeting.requestStartLiveStreaming",[Q,ne],G)},h.requestStopLiveStreaming=function(G){if(!G)throw new Error("[request stop live streaming] Callback cannot be null");se(Y,ee.sidePanel),_e("meeting.requestStopLiveStreaming",G)},h.registerLiveStreamChangedHandler=function(G){if(!G)throw new Error("[register live stream changed handler] Handler cannot be null");se(Y,ee.sidePanel),Ze("meeting.liveStreamChanged",G)},h.shareAppContentToStage=function(G,Q){if(!G)throw new Error("[share app content to stage] Callback cannot be null");se(Y,ee.sidePanel,ee.meetingStage),_e("meeting.shareAppContentToStage",[Q],G)},h.getAppContentStageSharingCapabilities=function(G){if(!G)throw new Error("[get app content stage sharing capabilities] Callback cannot be null");se(Y,ee.sidePanel,ee.meetingStage),_e("meeting.getAppContentStageSharingCapabilities",G)},h.stopSharingAppContentToStage=function(G){if(!G)throw new Error("[stop sharing app content to stage] Callback cannot be null");se(Y,ee.sidePanel,ee.meetingStage),_e("meeting.stopSharingAppContentToStage",G)},h.getAppContentStageSharingState=function(G){if(!G)throw new Error("[get app content stage sharing state] Callback cannot be null");se(Y,ee.sidePanel,ee.meetingStage),_e("meeting.getAppContentStageSharingState",G)},h.registerSpeakingStateChangeHandler=function(G){if(!G)throw new Error("[registerSpeakingStateChangeHandler] Handler cannot be null");se(Y,ee.sidePanel,ee.meetingStage),Ze("meeting.speakingStateChanged",G)},h.registerRaiseHandStateChangedHandler=function(G){if(!G)throw new Error("[registerRaiseHandStateChangedHandler] Handler cannot be null");se(Y,ee.sidePanel,ee.meetingStage),Ze("meeting.raiseHandStateChanged",G)},h.registerMeetingReactionReceivedHandler=function(G){if(!G)throw new Error("[registerMeetingReactionReceivedHandler] Handler cannot be null");se(Y,ee.sidePanel,ee.meetingStage),Ze("meeting.meetingReactionReceived",G)},function(G){G.setOptions=function(Q){se(Y,ee.sidePanel),Q.contentUrl&&new URL(Q.contentUrl),_e("meeting.appShareButton.setOptions",[Q])}}(h.appShareButton||(h.appShareButton={})),h.requestAppAudioHandling=function(G,Q){if(!Q)throw new Error("[requestAppAudioHandling] Callback response cannot be null");if(!G.micMuteStateChangedCallback)throw new Error("[requestAppAudioHandling] Callback Mic mute state handler cannot be null");se(Y,ee.sidePanel,ee.meetingStage),G.isAppHandlingAudio?b(G,Q):A(G,Q)},h.updateMicState=function(G){q(G,T.AppInitiated)}})(Gt||(Gt={})),function(h){function T(){return!(!se(Y)||!Y.supports.monetization)}h.openPurchaseExperience=function(b,A){var q,G;return typeof b=="function"?(q=b,G=A):G=b,se(Y,ee.content),$v(function(){return new Promise(function(Q){if(!T())throw Ee;Q(ft("monetization.openPurchaseExperience",G))})},q)},h.isSupported=T}(Pt||(Pt={})),function(h){function T(){return!(!se(Y)||!Y.supports.calendar)}h.openCalendarItem=function(b){return new Promise(function(A){if(se(Y,ee.content),!T())throw new Error("Not supported");if(!b.itemId||!b.itemId.trim())throw new Error("Must supply an itemId to openCalendarItem");A(yt("calendar.openCalendarItem",b))})},h.composeMeeting=function(b){return new Promise(function(A){if(se(Y,ee.content),!T())throw new Error("Not supported");Y.isLegacyTeams?A(yt("executeDeepLink",D0(b.attendees,b.startTime,b.endTime,b.subject,b.content))):A(yt("calendar.composeMeeting",b))})},h.isSupported=T}(zs||(zs={})),function(h){function T(){return!(!se(Y)||!Y.supports.mail)}h.openMailItem=function(b){return new Promise(function(A){if(se(Y,ee.content),!T())throw new Error("Not supported");if(!b.itemId||!b.itemId.trim())throw new Error("Must supply an itemId to openMailItem");A(yt("mail.openMailItem",b))})},h.composeMail=function(b){return new Promise(function(A){if(se(Y,ee.content),!T())throw new Error("Not supported");A(yt("mail.composeMail",b))})},h.isSupported=T,function(b){b.New="new",b.Reply="reply",b.ReplyAll="replyAll",b.Forward="forward"}(h.ComposeMailType||(h.ComposeMailType={}))}(Rr||(Rr={})),function(h){function T(A){return new Promise(function(q){if(!Qr(P))throw{errorCode:Ce.OLD_PLATFORM};if(!rr(A))throw{errorCode:Ce.INVALID_ARGUMENTS};if(!b())throw Ee;q(ft("people.selectPeople",A))})}function b(){return!(!se(Y)||!Y.supports.people)}h.selectPeople=function(A,q){var G,Q,ne;return se(Y,ee.content,ee.task,ee.settings),typeof A=="function"?(Q=(G=[A,q])[0],ne=G[1]):ne=A,zv(T,Q,ne)},h.isSupported=b}(Vc||(Vc={})),function(h){h.showProfile=function(T){return se(Y,ee.content),new Promise(function(b){var A=U0(T),q=A[0],G=A[1];if(!q)throw{errorCode:Ce.INVALID_ARGUMENTS,message:G};b(ft("profile.showProfile",{modality:T.modality,persona:T.persona,triggerType:T.triggerType,targetRectangle:{x:T.targetElementBoundingRect.x,y:T.targetElementBoundingRect.y,width:T.targetElementBoundingRect.width,height:T.targetElementBoundingRect.height}}))})},h.isSupported=function(){return!(!se(Y)||!Y.supports.profile)}}(Wc||(Wc={}));var Kt,Pn=function(){function h(){}return h.setTimeout=function(T,b){var A=performance.now(),q=mf();return h.setTimeoutCallbacks[q]={callback:T,timeoutInMs:b,startedAtInMs:A},q},h.clearTimeout=function(T){delete h.setTimeoutCallbacks[T]},h.setInterval=function(T,b){h.setTimeout(function A(){T(),h.setTimeout(A,b)},b)},h.tick=function(){var T=performance.now(),b=[];for(var A in h.setTimeoutCallbacks)T-(Q=h.setTimeoutCallbacks[A]).startedAtInMs>=Q.timeoutInMs&&b.push(A);for(var q=0,G=b;q<G.length;q++){var Q,ne=G[q];(Q=h.setTimeoutCallbacks[ne]).callback(),delete h.setTimeoutCallbacks[ne]}},h.setTimeoutCallbacks={},h}(),Gc=function(){function h(T,b){this.reportStatisticsResult=b,this.sampleCount=0,this.distributionBins=new Uint32Array(T)}return h.prototype.processStarts=function(T,b,A,q){Pn.tick(),this.suitableForThisSession(T,b,A,q)||this.reportAndResetSession(this.getStatistics(),T,q,b,A),this.start()},h.prototype.processEnds=function(){var T=performance.now()-this.frameProcessingStartedAt,b=Math.floor(Math.max(0,Math.min(this.distributionBins.length-1,T)));this.distributionBins[b]+=1,this.sampleCount+=1},h.prototype.getStatistics=function(){return this.currentSession?{effectId:this.currentSession.effectId,effectParam:this.currentSession.effectParam,frameHeight:this.currentSession.frameHeight,frameWidth:this.currentSession.frameWidth,duration:performance.now()-this.currentSession.startedAtInMs,sampleCount:this.sampleCount,distributionBins:this.distributionBins.slice()}:null},h.prototype.start=function(){this.frameProcessingStartedAt=performance.now()},h.prototype.suitableForThisSession=function(T,b,A,q){return this.currentSession&&this.currentSession.effectId===T&&this.currentSession.effectParam===q&&this.currentSession.frameWidth===b&&this.currentSession.frameHeight===A},h.prototype.reportAndResetSession=function(T,b,A,q,G){var Q=this;T&&this.reportStatisticsResult(T),this.resetCurrentSession(this.getNextTimeout(b,this.currentSession),b,A,q,G),this.timeoutId&&Pn.clearTimeout(this.timeoutId),this.timeoutId=Pn.setTimeout((function(){return Q.reportAndResetSession(Q.getStatistics(),b,A,q,G)}).bind(this),this.currentSession.timeoutInMs)},h.prototype.resetCurrentSession=function(T,b,A,q,G){this.currentSession={startedAtInMs:performance.now(),timeoutInMs:T,effectId:b,effectParam:A,frameWidth:q,frameHeight:G},this.sampleCount=0,this.distributionBins.fill(0)},h.prototype.getNextTimeout=function(T,b){return b&&b.effectId===T?Math.min(h.maxSessionTimeoutInMs,2*b.timeoutInMs):h.initialSessionTimeoutInMs},h.initialSessionTimeoutInMs=1e3,h.maxSessionTimeoutInMs=3e4,h}(),Uf=function(){function h(T){var b=this;this.reportPerformanceEvent=T,this.isFirstFrameProcessed=!1,this.frameProcessTimeLimit=100,this.frameProcessingStartedAt=0,this.frameProcessingTimeCost=0,this.processedFrameCount=0,this.performanceStatistics=new Gc(h.distributionBinSize,function(A){return b.reportPerformanceEvent("video.performance.performanceDataGenerated",[A])})}return h.prototype.startMonitorSlowFrameProcessing=function(){var T=this;Pn.setInterval(function(){if(T.processedFrameCount!==0){var b=T.frameProcessingTimeCost/T.processedFrameCount;b>T.frameProcessTimeLimit&&T.reportPerformanceEvent("video.performance.frameProcessingSlow",[b]),T.frameProcessingTimeCost=0,T.processedFrameCount=0}},h.calculateFPSInterval)},h.prototype.setFrameProcessTimeLimit=function(T){this.frameProcessTimeLimit=T},h.prototype.reportApplyingVideoEffect=function(T,b){var A,q;((A=this.applyingEffect)===null||A===void 0?void 0:A.effectId)===T&&((q=this.applyingEffect)===null||q===void 0?void 0:q.effectParam)===b||(this.applyingEffect={effectId:T,effectParam:b},this.appliedEffect=void 0)},h.prototype.reportVideoEffectChanged=function(T,b){this.applyingEffect===void 0||this.applyingEffect.effectId!==T&&this.applyingEffect.effectParam!==b||(this.appliedEffect={effectId:T,effectParam:b},this.applyingEffect=void 0,this.isFirstFrameProcessed=!1)},h.prototype.reportStartFrameProcessing=function(T,b){Pn.tick(),this.appliedEffect&&(this.frameProcessingStartedAt=performance.now(),this.performanceStatistics.processStarts(this.appliedEffect.effectId,T,b,this.appliedEffect.effectParam))},h.prototype.reportFrameProcessed=function(){var T;this.appliedEffect&&(this.processedFrameCount++,this.frameProcessingTimeCost+=performance.now()-this.frameProcessingStartedAt,this.performanceStatistics.processEnds(),this.isFirstFrameProcessed||(this.isFirstFrameProcessed=!0,this.reportPerformanceEvent("video.performance.firstFrameProcessed",[Date.now(),this.appliedEffect.effectId,(T=this.appliedEffect)===null||T===void 0?void 0:T.effectParam])))},h.prototype.reportGettingTextureStream=function(T){this.gettingTextureStreamStartedAt=performance.now(),this.currentStreamId=T},h.prototype.reportTextureStreamAcquired=function(){if(this.gettingTextureStreamStartedAt!==void 0){var T=performance.now()-this.gettingTextureStreamStartedAt;this.reportPerformanceEvent("video.performance.textureStreamAcquired",[this.currentStreamId,T])}},h.distributionBinSize=1e3,h.calculateFPSInterval=1e3,h}(),$i=function(h,T,b,A){function q(G){return G instanceof b?G:new b(function(Q){Q(G)})}return new(b||(b=Promise))(function(G,Q){function ne(Se){try{re(A.next(Se))}catch(Ue){Q(Ue)}}function me(Se){try{re(A.throw(Se))}catch(Ue){Q(Ue)}}function re(Se){Se.done?G(Se.value):q(Se.value).then(ne,me)}re((A=A.apply(h,T||[])).next())})},$s=function(h,T){var b,A,q,G,Q={label:0,sent:function(){if(1&q[0])throw q[1];return q[1]},trys:[],ops:[]};return G={next:ne(0),throw:ne(1),return:ne(2)},typeof Symbol=="function"&&(G[Symbol.iterator]=function(){return this}),G;function ne(re){return function(Se){return me([re,Se])}}function me(re){if(b)throw new TypeError("Generator is already executing.");for(;G&&(G=0,re[0]&&(Q=0)),Q;)try{if(b=1,A&&(q=2&re[0]?A.return:re[0]?A.throw||((q=A.return)&&q.call(A),0):A.next)&&!(q=q.call(A,re[1])).done)return q;switch(A=0,q&&(re=[2&re[0],q.value]),re[0]){case 0:case 1:q=re;break;case 4:return Q.label++,{value:re[1],done:!1};case 5:Q.label++,A=re[1],re=[0];continue;case 7:re=Q.ops.pop(),Q.trys.pop();continue;default:if(q=Q.trys,!((q=q.length>0&&q[q.length-1])||re[0]!==6&&re[0]!==2)){Q=0;continue}if(re[0]===3&&(!q||re[1]>q[0]&&re[1]<q[3])){Q.label=re[1];break}if(re[0]===6&&Q.label<q[1]){Q.label=q[1],q=re;break}if(q&&Q.label<q[2]){Q.label=q[2],Q.ops.push(re);break}q[2]&&Q.ops.pop(),Q.trys.pop();continue}re=T.call(h,Q)}catch(Se){re=[6,Se],A=0}finally{b=q=0}if(5&re[0])throw re[1];return{value:re[0]?re[1]:void 0,done:!0}}};function zf(h,T,b,A){return $i(this,void 0,void 0,function(){var q;return $s(this,function(G){switch(G.label){case 0:return q=$f,[4,zt(h,b,A)];case 1:return[2,q.apply(void 0,[G.sent(),new $0(b,T)])]}})})}function dn(h,T,b,A){return $i(this,void 0,void 0,function(){var q;return $s(this,function(G){switch(G.label){case 0:return q=$f,[4,zt(h,b,A)];case 1:return[2,q.apply(void 0,[G.sent(),new V0(b,T)])]}})})}function zt(h,T,b){return $i(this,void 0,void 0,function(){var A,q,G,Q,ne;return $s(this,function(me){switch(me.label){case 0:if(Ui())throw Ee;A=window.chrome,me.label=1;case 1:return me.trys.push([1,3,,4]),b==null||b.reportGettingTextureStream(h),[4,A.webview.getTextureStream(h)];case 2:if(q=me.sent(),(G=q.getVideoTracks()).length===0)throw new Error("No video track in stream ".concat(h));return b==null||b.reportTextureStreamAcquired(),[2,G[0]];case 3:throw Q=me.sent(),ne="Failed to get video track from stream ".concat(h,", error: ").concat(Q),T(ne),new Error("Internal error: can't get video track from stream ".concat(h));case 4:return[2]}})})}function $f(h,T){if(Ui())throw Ee;var b=new window.MediaStreamTrackProcessor({track:h}).readable,A=new window.MediaStreamTrackGenerator({kind:"video"}),q=A.writable;return b.pipeThrough(new TransformStream(T)).pipeTo(q),A}(function(h){h.TimestampIsNull="timestamp of the original video frame is null",h.UnsupportedVideoFramePixelFormat="Unsupported video frame pixel format"})(Kt||(Kt={}));var $0=function(){return function(h,T){var b=this;this.notifyError=h,this.videoFrameHandler=T,this.transform=function(A,q){return $i(b,void 0,void 0,function(){var G,Q,ne,me;return $s(this,function(re){switch(re.label){case 0:if((G=A.timestamp)===null)return[3,5];re.label=1;case 1:return re.trys.push([1,3,,4]),[4,this.videoFrameHandler({videoFrame:A})];case 2:return Q=re.sent(),ne=new VideoFrame(Q,{timestamp:G}),q.enqueue(ne),A.close(),Q.close(),[3,4];case 3:return me=re.sent(),A.close(),this.notifyError(me),[3,4];case 4:return[3,6];case 5:this.notifyError(Kt.TimestampIsNull),re.label=6;case 6:return[2]}})})}}}(),H0=function(){function h(T,b){if(this.headerBuffer=T,this.notifyError=b,this.ONE_TEXTURE_INPUT_ID=1869900081,this.INVALID_HEADER_ERROR="Invalid video frame header",this.UNSUPPORTED_LAYOUT_ERROR="Unsupported texture layout",this.headerDataView=new Uint32Array(T),this.headerDataView.length<8)throw this.notifyError(this.INVALID_HEADER_ERROR),new Error(this.INVALID_HEADER_ERROR);if(this.headerDataView[0]!==this.ONE_TEXTURE_INPUT_ID)throw this.notifyError(this.UNSUPPORTED_LAYOUT_ERROR),new Error(this.UNSUPPORTED_LAYOUT_ERROR)}return Object.defineProperty(h.prototype,"oneTextureLayoutId",{get:function(){return this.headerDataView[0]},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"version",{get:function(){return this.headerDataView[1]},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"frameRowOffset",{get:function(){return this.headerDataView[2]},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"frameFormat",{get:function(){return this.headerDataView[3]},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"frameWidth",{get:function(){return this.headerDataView[4]},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"frameHeight",{get:function(){return this.headerDataView[5]},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"multiStreamHeaderRowOffset",{get:function(){return this.headerDataView[6]},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"multiStreamCount",{get:function(){return this.headerDataView[7]},enumerable:!1,configurable:!0}),h}(),Kc=function(){function h(T,b){this.metadataMap=new Map,this.AUDIO_INFERENCE_RESULT_STREAM_ID=828664161;for(var A=new Uint32Array(T),q=0,G=0;q<b;q++){var Q=A[G++],ne=A[G++],me=A[G++],re=new Uint8Array(T,ne,me);this.metadataMap.set(Q,re)}}return Object.defineProperty(h.prototype,"audioInferenceResult",{get:function(){return this.metadataMap.get(this.AUDIO_INFERENCE_RESULT_STREAM_ID)},enumerable:!1,configurable:!0}),h}(),V0=function(){return function(h,T){var b=this;this.notifyError=h,this.videoFrameHandler=T,this.shouldDiscardAudioInferenceResult=!1,this.transform=function(A,q){return $i(b,void 0,void 0,function(){var G,Q,ne,me,re,Se,Ue,Oe;return $s(this,function(Pe){switch(Pe.label){case 0:if((G=A.timestamp)===null)return[3,6];Pe.label=1;case 1:return Pe.trys.push([1,4,,5]),[4,this.extractVideoFrameAndMetadata(A)];case 2:return Q=Pe.sent(),ne=Q.videoFrame,me=Q.metadata,re=(me===void 0?{}:me).audioInferenceResult,[4,this.videoFrameHandler({videoFrame:ne,audioInferenceResult:re})];case 3:return Se=Pe.sent(),Ue=new VideoFrame(Se,{timestamp:G}),q.enqueue(Ue),ne.close(),A.close(),Se.close(),[3,5];case 4:return Oe=Pe.sent(),A.close(),this.notifyError(Oe),[3,5];case 5:return[3,7];case 6:this.notifyError(Kt.TimestampIsNull),Pe.label=7;case 7:return[2]}})})},this.extractVideoFrameAndMetadata=function(A){return $i(b,void 0,void 0,function(){var q,G,Q,ne,me,re;return $s(this,function(Se){switch(Se.label){case 0:if(Ui())throw Ee;if(A.format!=="NV12")throw this.notifyError(Kt.UnsupportedVideoFramePixelFormat),new Error(Kt.UnsupportedVideoFramePixelFormat);return q={x:0,y:0,width:A.codedWidth,height:2},G=new ArrayBuffer(q.width*q.height*3/2),[4,A.copyTo(G,{rect:q})];case 1:return Se.sent(),Q=new H0(G,this.notifyError),ne={x:0,y:Q.multiStreamHeaderRowOffset,width:A.codedWidth,height:A.codedHeight-Q.multiStreamHeaderRowOffset},me=new ArrayBuffer(ne.width*ne.height*3/2),[4,A.copyTo(me,{rect:ne})];case 2:return Se.sent(),re=new Kc(me,Q.multiStreamCount),[2,{videoFrame:new VideoFrame(A,{timestamp:A.timestamp,visibleRect:{x:0,y:Q.frameRowOffset,width:Q.frameWidth,height:Q.frameHeight}}),metadata:{audioInferenceResult:this.shouldDiscardAudioInferenceResult?void 0:re.audioInferenceResult}}]}})})},Ze("video.mediaStream.audioInferenceDiscardStatusChange",function(A){var q=A.discardAudioInferenceResult;b.shouldDiscardAudioInferenceResult=q})}}();function Jc(h,T){return function(b,A){T==null||T.reportApplyingVideoEffect(b||"",A),h(b,A).then(function(){T==null||T.reportVideoEffectChanged(b||"",A),_e("video.videoEffectReadiness",[!0,b,void 0,A])}).catch(function(q){var G=q in cs.EffectFailureReason?q:cs.EffectFailureReason.InitializationFailure;_e("video.videoEffectReadiness",[!1,b,G,A])})}}var cs,Qc,$u,So,bo,wa,Ca,wo,xa=function(){return xa=Object.assign||function(h){for(var T,b=1,A=arguments.length;b<A;b++)for(var q in T=arguments[b])Object.prototype.hasOwnProperty.call(T,q)&&(h[q]=T[q]);return h},xa.apply(this,arguments)},Hu=function(h,T,b,A){function q(G){return G instanceof b?G:new b(function(Q){Q(G)})}return new(b||(b=Promise))(function(G,Q){function ne(Se){try{re(A.next(Se))}catch(Ue){Q(Ue)}}function me(Se){try{re(A.throw(Se))}catch(Ue){Q(Ue)}}function re(Se){Se.done?G(Se.value):q(Se.value).then(ne,me)}re((A=A.apply(h,T||[])).next())})},Xc=function(h,T){var b,A,q,G,Q={label:0,sent:function(){if(1&q[0])throw q[1];return q[1]},trys:[],ops:[]};return G={next:ne(0),throw:ne(1),return:ne(2)},typeof Symbol=="function"&&(G[Symbol.iterator]=function(){return this}),G;function ne(re){return function(Se){return me([re,Se])}}function me(re){if(b)throw new TypeError("Generator is already executing.");for(;G&&(G=0,re[0]&&(Q=0)),Q;)try{if(b=1,A&&(q=2&re[0]?A.return:re[0]?A.throw||((q=A.return)&&q.call(A),0):A.next)&&!(q=q.call(A,re[1])).done)return q;switch(A=0,q&&(re=[2&re[0],q.value]),re[0]){case 0:case 1:q=re;break;case 4:return Q.label++,{value:re[1],done:!1};case 5:Q.label++,A=re[1],re=[0];continue;case 7:re=Q.ops.pop(),Q.trys.pop();continue;default:if(q=Q.trys,!((q=q.length>0&&q[q.length-1])||re[0]!==6&&re[0]!==2)){Q=0;continue}if(re[0]===3&&(!q||re[1]>q[0]&&re[1]<q[3])){Q.label=re[1];break}if(re[0]===6&&Q.label<q[1]){Q.label=q[1],q=re;break}if(q&&Q.label<q[2]){Q.label=q[2],Q.ops.push(re);break}q[2]&&Q.ops.pop(),Q.trys.pop();continue}re=T.call(h,Q)}catch(Se){re=[6,Se],A=0}finally{b=q=0}if(5&re[0])throw re[1];return{value:re[0]?re[1]:void 0,done:!0}}},Yc=function(h,T){var b={};for(var A in h)Object.prototype.hasOwnProperty.call(h,A)&&T.indexOf(A)<0&&(b[A]=h[A]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function"){var q=0;for(A=Object.getOwnPropertySymbols(h);q<A.length;q++)T.indexOf(A[q])<0&&Object.prototype.propertyIsEnumerable.call(h,A[q])&&(b[A[q]]=h[A[q]])}return b};function Vu(h,T){nr.initialize(T).then(function(){h&&h()})}function W0(){ji.enablePrintCapability()}function G0(){ji.print()}function Hf(h){qi(),_e("getContext",function(T){T.frameContext||(T.frameContext=X.frameContext),h(T)})}function Zc(h){nr.registerOnThemeChangeHandler(h)}function ed(h){jr("fullScreenChange",h,[])}function K0(h){jr("appButtonClick",h,[ee.content])}function J0(h){jr("appButtonHoverEnter",h,[ee.content])}function Vf(h){jr("appButtonHoverLeave",h,[ee.content])}function Wu(h){Ft.backStack.registerBackButtonHandlerHelper(h)}function Gu(h){ji.registerOnLoadHandlerHelper(h)}function Wf(h){ji.registerBeforeUnloadHandlerHelper(h)}function Gf(h){jr("focusEnter",h,[])}function Kf(h){jr("changeSettings",h,[ee.content])}function Q0(h,T){se(Y),Ft.tabs.getTabInstances(T).then(function(b){h(b)})}function Ku(h,T){se(Y),Ft.tabs.getMruTabInstances(T).then(function(b){h(b)})}function Hs(h){Ft.shareDeepLink({subPageId:h.subEntityId,subPageLabel:h.subEntityLabel,subPageWebUrl:h.subEntityWebUrl})}function xe(h,T){se(Y,ee.content,ee.sidePanel,ee.settings,ee.task,ee.stage,ee.meetingStage),T=T||Br(),nr.openLink(h).then(function(){T(!0)}).catch(function(b){T(!1,b.message)})}function gt(h){Ft.setCurrentFrame(h)}function Jf(h,T,b){Ft.initializeWithFrameContext(h,T,b)}function Qf(h){Ft.returnFocus(h)}function Xf(h,T){se(Y),T=T||Br(),Ft.tabs.navigateToTab(h).then(function(){T(!0)}).catch(function(b){T(!1,b.message)})}function tt(h,T){se(Y,ee.content,ee.sidePanel,ee.settings,ee.remove,ee.task,ee.stage,ee.meetingStage),T=T||Br(),Ft.navigateCrossDomain(h).then(function(){T(!0)}).catch(function(b){T(!1,b.message)})}function X0(h){se(Y),h=h||Br(),Ft.backStack.navigateBack().then(function(){h(!0)}).catch(function(T){h(!1,T.message)})}(function(h){var T=Ui()?void 0:new Uf(_e);function b(Oe){_e("video.videoFrameProcessed",[Oe])}function A(Oe){_e("video.notifyError",[Oe])}function q(){return se(Y)&&!!Y.supports.video&&(!!Y.supports.video.mediaStream||!!Y.supports.video.sharedFrame)}function G(Oe,Pe){var Me=this;if(se(Y,ee.sidePanel),!q()||!re())throw Ee;Ze("video.startVideoExtensibilityVideoStream",function(Ie){return Hu(Me,void 0,void 0,function(){var ze,Ye,Ke,bn,ir;return Xc(this,function(Dn){switch(Dn.label){case 0:return ze=Ie.streamId,Ye=Q(Oe,T),[4,zf(ze,Ye,A,T)];case 1:return Ke=Dn.sent(),!Ui()&&((ir=(bn=window.chrome)===null||bn===void 0?void 0:bn.webview)===null||ir===void 0||ir.registerTextureStream(ze,Ke)),[2]}})})},!1),_e("video.mediaStream.registerForVideoFrame",[Pe])}function Q(Oe,Pe){var Me=this;return function(Ie){return Hu(Me,void 0,void 0,function(){var ze,Ye;return Xc(this,function(Ke){switch(Ke.label){case 0:return ze=Ie.videoFrame,Pe==null||Pe.reportStartFrameProcessing(ze.codedWidth,ze.codedHeight),[4,Oe(Ie)];case 1:return Ye=Ke.sent(),Pe==null||Pe.reportFrameProcessed(),[2,Ye]}})})}}function ne(Oe,Pe){if(se(Y,ee.sidePanel),!q()||!Ue())throw Ee;Ze("video.newVideoFrame",function(Me){if(Me){var Ie=Me.timestamp;T==null||T.reportStartFrameProcessing(Me.width,Me.height),Oe(me(Me),function(){T==null||T.reportFrameProcessed(),b(Ie)},A)}},!1),_e("video.registerForVideoFrame",[Pe])}function me(Oe){if("videoFrameBuffer"in Oe)return Oe;var Pe=Oe.data,Me=Yc(Oe,["data"]);return xa(xa({},Me),{videoFrameBuffer:Pe})}function re(){var Oe;return se(Y,ee.sidePanel)&&Se()&&!!(!((Oe=Y.supports.video)===null||Oe===void 0)&&Oe.mediaStream)}function Se(){var Oe,Pe,Me,Ie;return!Ui()&&!(!(!((Pe=(Oe=window.chrome)===null||Oe===void 0?void 0:Oe.webview)===null||Pe===void 0)&&Pe.getTextureStream)||!(!((Ie=(Me=window.chrome)===null||Me===void 0?void 0:Me.webview)===null||Ie===void 0)&&Ie.registerTextureStream))}function Ue(){var Oe;return se(Y,ee.sidePanel)&&!!(!((Oe=Y.supports.video)===null||Oe===void 0)&&Oe.sharedFrame)}(function(Oe){Oe.NV12="NV12"})(h.VideoFrameFormat||(h.VideoFrameFormat={})),function(Oe){Oe.EffectChanged="EffectChanged",Oe.EffectDisabled="EffectDisabled"}(h.EffectChangeType||(h.EffectChangeType={})),function(Oe){Oe.InvalidEffectId="InvalidEffectId",Oe.InitializationFailure="InitializationFailure"}(h.EffectFailureReason||(h.EffectFailureReason={})),h.registerForVideoFrame=function(Oe){if(se(Y,ee.sidePanel),!q())throw Ee;if(!Oe.videoFrameHandler||!Oe.videoBufferHandler)throw new Error("Both videoFrameHandler and videoBufferHandler must be provided");if(Ze("video.setFrameProcessTimeLimit",function(Pe){return T==null?void 0:T.setFrameProcessTimeLimit(Pe.timeLimit)},!1),re())G(Oe.videoFrameHandler,Oe.config);else{if(!Ue())throw Ee;ne(Oe.videoBufferHandler,Oe.config)}T==null||T.startMonitorSlowFrameProcessing()},h.notifySelectedVideoEffectChanged=function(Oe,Pe){if(se(Y,ee.sidePanel),!q())throw Ee;_e("video.videoEffectChanged",[Oe,Pe])},h.registerForVideoEffect=function(Oe){if(se(Y,ee.sidePanel),!q())throw Ee;Ze("video.effectParameterChange",Jc(Oe,T),!1),_e("video.registerForVideoEffect")},h.isSupported=q})(cs||(cs={})),function(h){var T="search.queryChange",b="search.queryClose",A="search.queryExecute";function q(){return!(!se(Y)||!Y.supports.search)}h.registerHandlers=function(G,Q,ne){if(se(Y,ee.content),!q())throw Ee;Ze(b,G),Ze(A,Q),ne&&Ze(T,ne)},h.unregisterHandlers=function(){if(se(Y,ee.content),!q())throw Ee;_e("search.unregister"),yn(T),yn(b),yn(A)},h.isSupported=q,h.closeSearch=function(){return new Promise(function(G){if(se(Y,ee.content),!q())throw new Error("Not supported");G(yt("search.closeSearch"))})}}(Qc||(Qc={})),function(h){function T(Q){return new Promise(function(ne){if(!G())throw Ee;ne(ft(h.SharingAPIMessages.shareWebContent,Q))})}function b(Q){if(!(Q&&Q.content&&Q.content.length))throw{errorCode:Ce.INVALID_ARGUMENTS,message:"Shared content is missing"}}function A(Q){if(Q.content.some(function(ne){return!ne.type}))throw{errorCode:Ce.INVALID_ARGUMENTS,message:"Shared content type cannot be undefined"};if(Q.content.some(function(ne){return ne.type!==Q.content[0].type}))throw{errorCode:Ce.INVALID_ARGUMENTS,message:"Shared content must be of the same type"}}function q(Q){if(Q.content[0].type!=="URL")throw{errorCode:Ce.INVALID_ARGUMENTS,message:"Content type is unsupported"};if(Q.content.some(function(ne){return!ne.url}))throw{errorCode:Ce.INVALID_ARGUMENTS,message:"URLs are required for URL content types"}}function G(){return!(!se(Y)||!Y.supports.sharing)}h.SharingAPIMessages={shareWebContent:"sharing.shareWebContent"},h.shareWebContent=function(Q,ne){try{b(Q),A(Q),q(Q)}catch(me){return vf(function(){return Promise.reject(me)},ne)}return se(Y,ee.content,ee.sidePanel,ee.task,ee.stage,ee.meetingStage),vf(T,ne,Q)},h.isSupported=G}($u||($u={})),function(h){function T(){return!(!se(Y)||!Y.supports.stageView)}h.open=function(b){return new Promise(function(A){if(se(Y,ee.content),!T())throw Ee;if(!b)throw new Error("[stageView.open] Stage view params cannot be null");A(ft("stageView.open",b))})},h.isSupported=T}(So||(So={})),function(h){function T(){return!(!se(Y)||!Y.supports.webStorage)}h.isWebStorageClearedOnUserLogOut=function(){return se(Y),T()},h.isSupported=T}(bo||(bo={})),function(h){var T;function b(){return!(!se(Y)||!Y.supports.call)}(function(A){A.Unknown="unknown",A.Audio="audio",A.Video="video",A.VideoBasedScreenSharing="videoBasedScreenSharing",A.Data="data"})(T=h.CallModalities||(h.CallModalities={})),h.startCall=function(A){return new Promise(function(q){var G;if(se(Y,ee.content,ee.task),!b())throw Ee;if(!Y.isLegacyTeams)return _e("call.startCall",[A],q);q(as("executeDeepLink",N0(A.targets,(G=A.requestedModalities)===null||G===void 0?void 0:G.includes(T.Video),A.source)).then(function(Q){if(!Q)throw new Error(pe);return Q}))})},h.isSupported=b}(wa||(wa={})),function(h){h.Messages=nr.Messages,h.FailedReason=nr.FailedReason,h.ExpectedFailureReason=nr.ExpectedFailureReason,h.notifyAppLoaded=function(){nr.notifyAppLoaded()},h.notifySuccess=function(){nr.notifySuccess()},h.notifyFailure=function(T){nr.notifyFailure(T)},h.notifyExpectedFailure=function(T){nr.notifyExpectedFailure(T)}}(Ca||(Ca={})),function(h){h.setValidityState=function(T){Ft.config.setValidityState(T)},h.getSettings=function(T){se(Y,ee.content,ee.settings,ee.remove,ee.sidePanel),Ft.getConfig().then(function(b){T(b)})},h.setSettings=function(T,b){se(Y,ee.content,ee.settings,ee.sidePanel),b=b||Br(),Ft.config.setConfig(T).then(function(){b(!0)}).catch(function(A){b(!1,A.message)})},h.registerOnSaveHandler=function(T){Ft.config.registerOnSaveHandlerHelper(T)},h.registerOnRemoveHandler=function(T){Ft.config.registerOnRemoveHandlerHelper(T)}}(wo||(wo={}));var a,l,c=function(h,T){var b={};for(var A in h)Object.prototype.hasOwnProperty.call(h,A)&&T.indexOf(A)<0&&(b[A]=h[A]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function"){var q=0;for(A=Object.getOwnPropertySymbols(h);q<A.length;q++)T.indexOf(A[q])<0&&Object.prototype.propertyIsEnumerable.call(h,A[q])&&(b[A[q]]=h[A[q]])}return b};(function(h){function T(q){return{url:q.url,size:{height:q.height?q.height:mn.Small,width:q.width?q.width:mn.Small},title:q.title,fallbackUrl:q.fallbackUrl}}function b(q){return{url:q.url,size:{height:q.height?q.height:mn.Small,width:q.width?q.width:mn.Small},title:q.title,fallbackUrl:q.fallbackUrl,completionBotId:q.completionBotId}}function A(q){return q.height=q.height?q.height:mn.Small,q.width=q.width?q.width:mn.Small,q}h.startTask=function(q,G){var Q=G?function(ne){return G(ne.err,ne.result)}:void 0;return q.card===void 0&&q.url===void 0||q.card?(se(Y,ee.content,ee.sidePanel,ee.meetingStage),_e("tasks.startTask",[q],G)):q.completionBotId!==void 0?os.url.bot.open(b(q),Q):os.url.open(T(q),Q),new Us},h.updateTask=function(q){(q=A(q)).width,q.height;var G=c(q,["width","height"]);if(Object.keys(G).length)throw new Error("resize requires a TaskInfo argument containing only width and height");os.update.resize(q)},h.submitTask=function(q,G){os.url.submit(q,G)},h.getDefaultSizeIfNotProvided=A})(a||(a={})),function(h){(function(T){T.guest="Guest",T.attendee="Attendee",T.presenter="Presenter",T.organizer="Organizer"})(h.UserMeetingRole||(h.UserMeetingRole={})),function(T){T.added="Added",T.alreadyExists="AlreadyExists",T.conflict="Conflict",T.notFound="NotFound"}(h.ContainerState||(h.ContainerState={})),h.isSupported=function(){return!(!se(Y,ee.meetingStage,ee.sidePanel)||!Y.supports.interactive)}}(l||(l={}));var p=function(){function h(){}return h.prototype.getFluidTenantInfo=function(){return y(),new Promise(function(T){T(ft("interactive.getFluidTenantInfo"))})},h.prototype.getFluidToken=function(T){return y(),new Promise(function(b){b(ft("interactive.getFluidToken",T))})},h.prototype.getFluidContainerId=function(){return y(),new Promise(function(T){T(ft("interactive.getFluidContainerId"))})},h.prototype.setFluidContainerId=function(T){return y(),new Promise(function(b){b(ft("interactive.setFluidContainerId",T))})},h.prototype.getNtpTime=function(){return y(),new Promise(function(T){T(ft("interactive.getNtpTime"))})},h.prototype.registerClientId=function(T){return y(),new Promise(function(b){b(ft("interactive.registerClientId",T))})},h.prototype.getClientRoles=function(T){return y(),new Promise(function(b){b(ft("interactive.getClientRoles",T))})},h.prototype.getClientInfo=function(T){return y(),new Promise(function(b){b(ft("interactive.getClientInfo",T))})},h.create=function(){return y(),new h},h}();function y(){if(!l.isSupported())throw new Error("LiveShareHost Not supported")}const v=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,x=function(h){return typeof h=="string"&&v.test(h)};var C=function(){return C=Object.assign||function(h){for(var T,b=1,A=arguments.length;b<A;b++)for(var q in T=arguments[b])Object.prototype.hasOwnProperty.call(T,q)&&(h[q]=T[q]);return h},C.apply(this,arguments)},O=function(h,T){var b={};for(var A in h)Object.prototype.hasOwnProperty.call(h,A)&&T.indexOf(A)<0&&(b[A]=h[A]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function"){var q=0;for(A=Object.getOwnPropertySymbols(h);q<A.length;q++)T.indexOf(A[q])<0&&Object.prototype.propertyIsEnumerable.call(h,A[q])&&(b[A[q]]=h[A[q]])}return b};function _(h){try{return h.cartItems=B(h.cartItems),h}catch{throw new Error("Error deserializing cart")}}function B(h){return h.map(function(T){if(T.imageURL){var b=new URL(T.imageURL);T.imageURL=b}return T.accessories&&(T.accessories=B(T.accessories)),T})}var N=function(h){try{return h.map(function(T){var b=T.imageURL,A=T.accessories,q=O(T,["imageURL","accessories"]),G=C({},q);return b&&(G.imageURL=b.href),A&&(G.accessories=N(A)),G})}catch{throw new Error("Error serializing cart items")}};function w(h){if(!Array.isArray(h)||h.length===0)throw new Error("cartItems must be a non-empty array");for(var T=0,b=h;T<b.length;T++){var A=b[T];R(A),I(A.accessories)}}function I(h){if(h!=null){if(!Array.isArray(h)||h.length===0)throw new Error("CartItem.accessories must be a non-empty array");for(var T=0,b=h;T<b.length;T++){var A=b[T];if(A.accessories)throw new Error("Item in CartItem.accessories cannot have accessories");R(A)}}}function R(h){if(!h.id)throw new Error("cartItem.id must not be empty");if(!h.name)throw new Error("cartItem.name must not be empty");L(h.price),V(h.quantity)}function F(h){if(h!=null){if(!h)throw new Error("id must not be empty");if(x(h)===!1)throw new Error("id must be a valid UUID")}}function L(h){if(typeof h!="number"||h<0)throw new Error("price ".concat(h," must be a number not less than 0"));if(parseFloat(h.toFixed(3))!==h)throw new Error("price ".concat(h," must have at most 3 decimal places"))}function V(h){if(typeof h!="number"||h<=0||parseInt(h.toString())!==h)throw new Error("quantity ".concat(h," must be an integer greater than 0"))}function te(h){if(!Object.values(ue.CartStatus).includes(h))throw new Error("cartStatus ".concat(h," is not valid"))}var ue,ae,le,H,W,J,$,Z=function(){return Z=Object.assign||function(h){for(var T,b=1,A=arguments.length;b<A;b++)for(var q in T=arguments[b])Object.prototype.hasOwnProperty.call(T,q)&&(h[q]=T[q]);return h},Z.apply(this,arguments)};(function(h){function T(){return!(!se(Y)||!Y.supports.marketplace)}h.cartVersion={majorVersion:1,minorVersion:1},function(b){b.TACAdminUser="TACAdminUser",b.TeamsAdminUser="TeamsAdminUser",b.TeamsEndUser="TeamsEndUser"}(h.Intent||(h.Intent={})),function(b){b.Open="Open",b.Processing="Processing",b.Processed="Processed",b.Closed="Closed",b.Error="Error"}(h.CartStatus||(h.CartStatus={})),h.getCart=function(){if(se(Y,ee.content,ee.task),!T())throw Ee;return ft("marketplace.getCart",h.cartVersion).then(_)},h.addOrUpdateCartItems=function(b){if(se(Y,ee.content,ee.task),!T())throw Ee;if(!b)throw new Error("addOrUpdateCartItemsParams must be provided");return F(b==null?void 0:b.cartId),w(b==null?void 0:b.cartItems),ft("marketplace.addOrUpdateCartItems",Z(Z({},b),{cartItems:N(b.cartItems),cartVersion:h.cartVersion})).then(_)},h.removeCartItems=function(b){if(se(Y,ee.content,ee.task),!T())throw Ee;if(!b)throw new Error("removeCartItemsParams must be provided");if(F(b==null?void 0:b.cartId),!Array.isArray(b==null?void 0:b.cartItemIds)||(b==null?void 0:b.cartItemIds.length)===0)throw new Error("cartItemIds must be a non-empty array");return ft("marketplace.removeCartItems",Z(Z({},b),{cartVersion:h.cartVersion})).then(_)},h.updateCartStatus=function(b){if(se(Y,ee.content,ee.task),!T())throw Ee;if(!b)throw new Error("updateCartStatusParams must be provided");return F(b==null?void 0:b.cartId),te(b==null?void 0:b.cartStatus),ft("marketplace.updateCartStatus",Z(Z({},b),{cartVersion:h.cartVersion})).then(_)},h.isSupported=T})(ue||(ue={})),function(h){function T(b,A){return{errorCode:b,message:A}}(function(b){b.Dropbox="DROPBOX",b.Box="BOX",b.Sharefile="SHAREFILE",b.GoogleDrive="GOOGLEDRIVE",b.Egnyte="EGNYTE",b.SharePoint="SharePoint"})(h.CloudStorageProvider||(h.CloudStorageProvider={})),function(b){b[b.Sharepoint=0]="Sharepoint",b[b.WopiIntegration=1]="WopiIntegration",b[b.Google=2]="Google",b[b.OneDrive=3]="OneDrive",b[b.Recent=4]="Recent",b[b.Aggregate=5]="Aggregate",b[b.FileSystem=6]="FileSystem",b[b.Search=7]="Search",b[b.AllFiles=8]="AllFiles",b[b.SharedWithMe=9]="SharedWithMe"}(h.CloudStorageProviderType||(h.CloudStorageProviderType={})),function(b){b.ClassMaterials="classMaterials"}(h.SpecialDocumentLibraryType||(h.SpecialDocumentLibraryType={})),function(b){b.Readonly="readonly"}(h.DocumentLibraryAccessType||(h.DocumentLibraryAccessType={})),function(b){b.Downloaded="Downloaded",b.Downloading="Downloading",b.Failed="Failed"}(h.FileDownloadStatus||(h.FileDownloadStatus={})),function(b){b.Download="DOWNLOAD",b.Upload="UPLOAD",b.Delete="DELETE"}(h.CloudStorageProviderFileAction||(h.CloudStorageProviderFileAction={})),h.getCloudStorageFolders=function(b,A){if(se(Y,ee.content),!b||b.length===0)throw new Error("[files.getCloudStorageFolders] channelId name cannot be null or empty");if(!A)throw new Error("[files.getCloudStorageFolders] Callback cannot be null");_e("files.getCloudStorageFolders",[b],A)},h.addCloudStorageFolder=function(b,A){if(se(Y,ee.content),!b||b.length===0)throw new Error("[files.addCloudStorageFolder] channelId name cannot be null or empty");if(!A)throw new Error("[files.addCloudStorageFolder] Callback cannot be null");_e("files.addCloudStorageFolder",[b],A)},h.deleteCloudStorageFolder=function(b,A,q){if(se(Y,ee.content),!b)throw new Error("[files.deleteCloudStorageFolder] channelId name cannot be null or empty");if(!A)throw new Error("[files.deleteCloudStorageFolder] folderToDelete cannot be null or empty");if(!q)throw new Error("[files.deleteCloudStorageFolder] Callback cannot be null");_e("files.deleteCloudStorageFolder",[b,A],q)},h.getCloudStorageFolderContents=function(b,A,q){if(se(Y,ee.content),!b||!A)throw new Error("[files.getCloudStorageFolderContents] folder/providerCode name cannot be null or empty");if(!q)throw new Error("[files.getCloudStorageFolderContents] Callback cannot be null");if("isSubdirectory"in b&&!b.isSubdirectory)throw new Error("[files.getCloudStorageFolderContents] provided folder is not a subDirectory");_e("files.getCloudStorageFolderContents",[b,A],q)},h.openCloudStorageFile=function(b,A,q){if(se(Y,ee.content),!b||!A)throw new Error("[files.openCloudStorageFile] file/providerCode cannot be null or empty");if(b.isSubdirectory)throw new Error("[files.openCloudStorageFile] provided file is a subDirectory");_e("files.openCloudStorageFile",[b,A,q])},h.getExternalProviders=function(b,A){if(b===void 0&&(b=!1),se(Y,ee.content),!A)throw new Error("[files.getExternalProviders] Callback cannot be null");_e("files.getExternalProviders",[b],A)},h.copyMoveFiles=function(b,A,q,G,Q,ne){if(Q===void 0&&(Q=!1),se(Y,ee.content),!b||b.length===0)throw new Error("[files.copyMoveFiles] selectedFiles cannot be null or empty");if(!A)throw new Error("[files.copyMoveFiles] providerCode cannot be null or empty");if(!q)throw new Error("[files.copyMoveFiles] destinationFolder cannot be null or empty");if(!G)throw new Error("[files.copyMoveFiles] destinationProviderCode cannot be null or empty");if(!ne)throw new Error("[files.copyMoveFiles] callback cannot be null");_e("files.copyMoveFiles",[b,A,q,G,Q],ne)},h.getFileDownloads=function(b){if(se(Y,ee.content),!b)throw new Error("[files.getFileDownloads] Callback cannot be null");_e("files.getFileDownloads",[],b)},h.openDownloadFolder=function(b,A){if(b===void 0&&(b=void 0),se(Y,ee.content),!A)throw new Error("[files.openDownloadFolder] Callback cannot be null");_e("files.openDownloadFolder",[b],A)},h.addCloudStorageProvider=function(b){if(se(Y,ee.content),!b)throw T(Ce.INVALID_ARGUMENTS,"[files.addCloudStorageProvider] callback cannot be null");_e("files.addCloudStorageProvider",[],b)},h.removeCloudStorageProvider=function(b,A){if(se(Y,ee.content),!A)throw T(Ce.INVALID_ARGUMENTS,"[files.removeCloudStorageProvider] callback cannot be null");if(!b||!b.content)throw T(Ce.INVALID_ARGUMENTS,"[files.removeCloudStorageProvider] 3P cloud storage provider request content is missing");_e("files.removeCloudStorageProvider",[b],A)},h.addCloudStorageProviderFile=function(b,A){if(se(Y,ee.content),!A)throw T(Ce.INVALID_ARGUMENTS,"[files.addCloudStorageProviderFile] callback cannot be null");if(!b||!b.content)throw T(Ce.INVALID_ARGUMENTS,"[files.addCloudStorageProviderFile] 3P cloud storage provider request content is missing");_e("files.addCloudStorageProviderFile",[b],A)},h.renameCloudStorageProviderFile=function(b,A){if(se(Y,ee.content),!A)throw T(Ce.INVALID_ARGUMENTS,"[files.renameCloudStorageProviderFile] callback cannot be null");if(!b||!b.content)throw T(Ce.INVALID_ARGUMENTS,"[files.renameCloudStorageProviderFile] 3P cloud storage provider request content is missing");_e("files.renameCloudStorageProviderFile",[b],A)},h.deleteCloudStorageProviderFile=function(b,A){if(se(Y,ee.content),!A)throw T(Ce.INVALID_ARGUMENTS,"[files.deleteCloudStorageProviderFile] callback cannot be null");if(!(b&&b.content&&b.content.itemList&&b.content.itemList.length>0))throw T(Ce.INVALID_ARGUMENTS,"[files.deleteCloudStorageProviderFile] 3P cloud storage provider request content details are missing");_e("files.deleteCloudStorageProviderFile",[b],A)},h.downloadCloudStorageProviderFile=function(b,A){if(se(Y,ee.content),!A)throw T(Ce.INVALID_ARGUMENTS,"[files.downloadCloudStorageProviderFile] callback cannot be null");if(!(b&&b.content&&b.content.itemList&&b.content.itemList.length>0))throw T(Ce.INVALID_ARGUMENTS,"[files.downloadCloudStorageProviderFile] 3P cloud storage provider request content details are missing");_e("files.downloadCloudStorageProviderFile",[b],A)},h.uploadCloudStorageProviderFile=function(b,A){if(se(Y,ee.content),!A)throw T(Ce.INVALID_ARGUMENTS,"[files.uploadCloudStorageProviderFile] callback cannot be null");if(!(b&&b.content&&b.content.itemList&&b.content.itemList.length>0))throw T(Ce.INVALID_ARGUMENTS,"[files.uploadCloudStorageProviderFile] 3P cloud storage provider request content details are missing");if(!b.content.destinationFolder)throw T(Ce.INVALID_ARGUMENTS,"[files.uploadCloudStorageProviderFile] Invalid destination folder details");_e("files.uploadCloudStorageProviderFile",[b],A)},h.registerCloudStorageProviderListChangeHandler=function(b){if(se(Y),!b)throw new Error("[registerCloudStorageProviderListChangeHandler] Handler cannot be null");Ze("files.cloudStorageProviderListChange",b)},h.registerCloudStorageProviderContentChangeHandler=function(b){if(se(Y),!b)throw new Error("[registerCloudStorageProviderContentChangeHandler] Handler cannot be null");Ze("files.cloudStorageProviderContentChange",b)}}(ae||(ae={})),function(h){function T(){return!(!se(Y)||!Y.supports.meetingRoom)}h.getPairedMeetingRoomInfo=function(){return new Promise(function(b){if(se(Y),!T())throw Ee;b(ft("meetingRoom.getPairedMeetingRoomInfo"))})},h.sendCommandToPairedMeetingRoom=function(b){return new Promise(function(A){if(!b||b.length==0)throw new Error("[meetingRoom.sendCommandToPairedMeetingRoom] Command name cannot be null or empty");if(se(Y),!T())throw Ee;A(ft("meetingRoom.sendCommandToPairedMeetingRoom",b))})},h.registerMeetingRoomCapabilitiesUpdateHandler=function(b){if(!b)throw new Error("[meetingRoom.registerMeetingRoomCapabilitiesUpdateHandler] Handler cannot be null");if(se(Y),!T())throw Ee;Ze("meetingRoom.meetingRoomCapabilitiesUpdate",function(A){se(Y),b(A)})},h.registerMeetingRoomStatesUpdateHandler=function(b){if(!b)throw new Error("[meetingRoom.registerMeetingRoomStatesUpdateHandler] Handler cannot be null");if(se(Y),!T())throw Ee;Ze("meetingRoom.meetingRoomStatesUpdate",function(A){se(Y),b(A)})},h.isSupported=T}(le||(le={})),function(h){function T(){return!(!se(Y)||!Y.supports.notifications)}h.showNotification=function(b){if(se(Y,ee.content),!T())throw Ee;_e("notifications.showNotification",[b])},h.isSupported=T}(H||(H={})),function(h){function T(){return!(!se(Y)||!Y.supports.remoteCamera)}(function(b){b.Reset="Reset",b.ZoomIn="ZoomIn",b.ZoomOut="ZoomOut",b.PanLeft="PanLeft",b.PanRight="PanRight",b.TiltUp="TiltUp",b.TiltDown="TiltDown"})(h.ControlCommand||(h.ControlCommand={})),function(b){b[b.CommandResetError=0]="CommandResetError",b[b.CommandZoomInError=1]="CommandZoomInError",b[b.CommandZoomOutError=2]="CommandZoomOutError",b[b.CommandPanLeftError=3]="CommandPanLeftError",b[b.CommandPanRightError=4]="CommandPanRightError",b[b.CommandTiltUpError=5]="CommandTiltUpError",b[b.CommandTiltDownError=6]="CommandTiltDownError",b[b.SendDataError=7]="SendDataError"}(h.ErrorReason||(h.ErrorReason={})),function(b){b[b.None=0]="None",b[b.ControlDenied=1]="ControlDenied",b[b.ControlNoResponse=2]="ControlNoResponse",b[b.ControlBusy=3]="ControlBusy",b[b.AckTimeout=4]="AckTimeout",b[b.ControlTerminated=5]="ControlTerminated",b[b.ControllerTerminated=6]="ControllerTerminated",b[b.DataChannelError=7]="DataChannelError",b[b.ControllerCancelled=8]="ControllerCancelled",b[b.ControlDisabled=9]="ControlDisabled",b[b.ControlTerminatedToAllowOtherController=10]="ControlTerminatedToAllowOtherController"}(h.SessionTerminatedReason||(h.SessionTerminatedReason={})),h.getCapableParticipants=function(b){if(!b)throw new Error("[remoteCamera.getCapableParticipants] Callback cannot be null");if(se(Y,ee.sidePanel),!T())throw Ee;_e("remoteCamera.getCapableParticipants",b)},h.requestControl=function(b,A){if(!b)throw new Error("[remoteCamera.requestControl] Participant cannot be null");if(!A)throw new Error("[remoteCamera.requestControl] Callback cannot be null");if(se(Y,ee.sidePanel),!T())throw Ee;_e("remoteCamera.requestControl",[b],A)},h.sendControlCommand=function(b,A){if(!b)throw new Error("[remoteCamera.sendControlCommand] ControlCommand cannot be null");if(!A)throw new Error("[remoteCamera.sendControlCommand] Callback cannot be null");if(se(Y,ee.sidePanel),!T())throw Ee;_e("remoteCamera.sendControlCommand",[b],A)},h.terminateSession=function(b){if(!b)throw new Error("[remoteCamera.terminateSession] Callback cannot be null");if(se(Y,ee.sidePanel),!T())throw Ee;_e("remoteCamera.terminateSession",b)},h.registerOnCapableParticipantsChangeHandler=function(b){if(!b)throw new Error("[remoteCamera.registerOnCapableParticipantsChangeHandler] Handler cannot be null");if(se(Y,ee.sidePanel),!T())throw Ee;Ze("remoteCamera.capableParticipantsChange",b)},h.registerOnErrorHandler=function(b){if(!b)throw new Error("[remoteCamera.registerOnErrorHandler] Handler cannot be null");if(se(Y,ee.sidePanel),!T())throw Ee;Ze("remoteCamera.handlerError",b)},h.registerOnDeviceStateChangeHandler=function(b){if(!b)throw new Error("[remoteCamera.registerOnDeviceStateChangeHandler] Handler cannot be null");if(se(Y,ee.sidePanel),!T())throw Ee;Ze("remoteCamera.deviceStateChange",b)},h.registerOnSessionStatusChangeHandler=function(b){if(!b)throw new Error("[remoteCamera.registerOnSessionStatusChangeHandler] Handler cannot be null");if(se(Y,ee.sidePanel),!T())throw Ee;Ze("remoteCamera.sessionStatusChange",b)},h.isSupported=T}(W||(W={})),function(h){function T(){return!(!se(Y)||!Y.supports.appEntity)}h.selectAppEntity=function(b,A,q,G){if(se(Y,ee.content),!T())throw Ee;if(!b||b.length==0)throw new Error("[appEntity.selectAppEntity] threadId name cannot be null or empty");if(!G)throw new Error("[appEntity.selectAppEntity] Callback cannot be null");_e("appEntity.selectAppEntity",[b,A,q],G)},h.isSupported=T}(J||(J={})),function(h){function T(){return!(!se(Y)||!Y.supports.teams)}(function(b){b[b.Regular=0]="Regular",b[b.Private=1]="Private",b[b.Shared=2]="Shared"})(h.ChannelType||(h.ChannelType={})),h.getTeamChannels=function(b,A){if(se(Y,ee.content),!T())throw Ee;if(!b)throw new Error("[teams.getTeamChannels] groupId cannot be null or empty");if(!A)throw new Error("[teams.getTeamChannels] Callback cannot be null");_e("teams.getTeamChannels",[b],A)},h.refreshSiteUrl=function(b,A){if(se(Y),!T())throw Ee;if(!b)throw new Error("[teams.refreshSiteUrl] threadId cannot be null or empty");if(!A)throw new Error("[teams.refreshSiteUrl] Callback cannot be null");_e("teams.refreshSiteUrl",[b],A)},h.isSupported=T,function(b){function A(){return!(!se(Y)||!Y.supports.teams)&&!!Y.supports.teams.fullTrust}(function(q){function G(){return!(!se(Y)||!Y.supports.teams)&&!!Y.supports.teams.fullTrust&&!!Y.supports.teams.fullTrust.joinedTeams}q.getUserJoinedTeams=function(Q){return new Promise(function(ne){if(se(Y),!G())throw Ee;if((X.hostClientType===qe.android||X.hostClientType===qe.teamsRoomsAndroid||X.hostClientType===qe.teamsPhones||X.hostClientType===qe.teamsDisplays)&&!Qr(m)){var me={errorCode:Ce.OLD_PLATFORM};throw new Error(JSON.stringify(me))}ne(as("getUserJoinedTeams",Q))})},q.isSupported=G})(b.joinedTeams||(b.joinedTeams={})),b.getConfigSetting=function(q){return new Promise(function(G){if(se(Y),!A())throw Ee;G(as("getConfigSetting",q))})},b.isSupported=A}(h.fullTrust||(h.fullTrust={}))}($||($={}));var oe,de=function(h,T,b,A){function q(G){return G instanceof b?G:new b(function(Q){Q(G)})}return new(b||(b=Promise))(function(G,Q){function ne(Se){try{re(A.next(Se))}catch(Ue){Q(Ue)}}function me(Se){try{re(A.throw(Se))}catch(Ue){Q(Ue)}}function re(Se){Se.done?G(Se.value):q(Se.value).then(ne,me)}re((A=A.apply(h,T||[])).next())})},Te=function(h,T){var b,A,q,G,Q={label:0,sent:function(){if(1&q[0])throw q[1];return q[1]},trys:[],ops:[]};return G={next:ne(0),throw:ne(1),return:ne(2)},typeof Symbol=="function"&&(G[Symbol.iterator]=function(){return this}),G;function ne(re){return function(Se){return me([re,Se])}}function me(re){if(b)throw new TypeError("Generator is already executing.");for(;G&&(G=0,re[0]&&(Q=0)),Q;)try{if(b=1,A&&(q=2&re[0]?A.return:re[0]?A.throw||((q=A.return)&&q.call(A),0):A.next)&&!(q=q.call(A,re[1])).done)return q;switch(A=0,q&&(re=[2&re[0],q.value]),re[0]){case 0:case 1:q=re;break;case 4:return Q.label++,{value:re[1],done:!1};case 5:Q.label++,A=re[1],re=[0];continue;case 7:re=Q.ops.pop(),Q.trys.pop();continue;default:if(q=Q.trys,!((q=q.length>0&&q[q.length-1])||re[0]!==6&&re[0]!==2)){Q=0;continue}if(re[0]===3&&(!q||re[1]>q[0]&&re[1]<q[3])){Q.label=re[1];break}if(re[0]===6&&Q.label<q[1]){Q.label=q[1],q=re;break}if(q&&Q.label<q[2]){Q.label=q[2],Q.ops.push(re);break}q[2]&&Q.ops.pop(),Q.trys.pop();continue}re=T.call(h,Q)}catch(Se){re=[6,Se],A=0}finally{b=q=0}if(5&re[0])throw re[1];return{value:re[0]?re[1]:void 0,done:!0}}};(function(h){var T,b=Ui()?void 0:new Uf(_e);function A(ne){return ne.videoFrameBuffer=ne.videoFrameBuffer||ne.data,delete ne.data,ne}function q(){return se(Y),cs.isSupported()}function G(ne){_e("video.videoFrameProcessed",[ne])}function Q(ne,me){me===void 0&&(me=T.Warn),_e("video.notifyError",[ne,me])}(function(ne){ne.Fatal="fatal",ne.Warn="warn"})(T=h.ErrorLevel||(h.ErrorLevel={})),h.registerForVideoFrame=function(ne){var me,re,Se=this;if(!q())throw Ee;if(!ne.videoFrameHandler||!ne.videoBufferHandler)throw new Error("Both videoFrameHandler and videoBufferHandler must be provided");if(se(Y,ee.sidePanel)){if(Ze("video.setFrameProcessTimeLimit",function(Ue){return b==null?void 0:b.setFrameProcessTimeLimit(Ue)},!1),(me=Y.supports.video)===null||me===void 0?void 0:me.mediaStream)Ze("video.startVideoExtensibilityVideoStream",function(Ue){return de(Se,void 0,void 0,function(){var Oe,Pe,Me,Ie,ze;return Te(this,function(Ye){switch(Ye.label){case 0:return Oe=Ue.streamId,Ue.metadataInTexture?[4,dn(Oe,ne.videoFrameHandler,Q,b)]:[3,2];case 1:return Me=Ye.sent(),[3,4];case 2:return[4,zf(Oe,ne.videoFrameHandler,Q,b)];case 3:Me=Ye.sent(),Ye.label=4;case 4:return Pe=Me,!Ui()&&((ze=(Ie=window.chrome)===null||Ie===void 0?void 0:Ie.webview)===null||ze===void 0||ze.registerTextureStream(Oe,Pe)),[2]}})})},!1),_e("video.mediaStream.registerForVideoFrame",[ne.config]);else{if(!(!((re=Y.supports.video)===null||re===void 0)&&re.sharedFrame))throw Ee;Ze("video.newVideoFrame",function(Ue){if(Ue){b==null||b.reportStartFrameProcessing(Ue.width,Ue.height);var Oe=Ue.timestamp;ne.videoBufferHandler(A(Ue),function(){b==null||b.reportFrameProcessed(),G(Oe)},Q)}},!1),_e("video.registerForVideoFrame",[ne.config])}b==null||b.startMonitorSlowFrameProcessing()}},h.notifySelectedVideoEffectChanged=function(ne,me,re){if(se(Y,ee.sidePanel),!q())throw Ee;_e("video.videoEffectChanged",[ne,me,re])},h.registerForVideoEffect=function(ne){if(se(Y,ee.sidePanel),!q())throw Ee;Ze("video.effectParameterChange",Jc(ne,b),!1),_e("video.registerForVideoEffect")},h.updatePersonalizedEffects=function(ne){if(se(Y,ee.sidePanel),!cs.isSupported())throw Ee;_e("video.personalizedEffectsChanged",[ne])},h.isSupported=q,h.notifyFatalError=function(ne){if(se(Y),!cs.isSupported())throw Ee;Q(ne,T.Fatal)}})(oe||(oe={}))})(),s})())})(qk);var Ty=qk.exports,Nm={},la={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const bg=n=>typeof n=="object"&&typeof(n==null?void 0:n.name)=="string"&&typeof(n==null?void 0:n.fluid)=="object",vb=n=>{const e=n;return typeof e=="object"&&(typeof(e==null?void 0:e.package)=="string"||bg(e==null?void 0:e.package))&&((e==null?void 0:e.config)===void 0||typeof(e==null?void 0:e.config)=="object")},KL="IFluidCodeDetailsComparer";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const JL=n=>{var e,t,r,i,s,o;return bg(n)&&typeof((r=(t=(e=n==null?void 0:n.fluid)===null||e===void 0?void 0:e.browser)===null||t===void 0?void 0:t.umd)===null||r===void 0?void 0:r.library)=="string"&&Array.isArray((o=(s=(i=n==null?void 0:n.fluid)===null||i===void 0?void 0:i.browser)===null||s===void 0?void 0:s.umd)===null||o===void 0?void 0:o.files)};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var po;(function(n){n.genericError="genericError",n.throttlingError="throttlingError",n.dataCorruptionError="dataCorruptionError",n.dataProcessingError="dataProcessingError",n.usageError="usageError",n.clientSessionExpiredError="clientSessionExpiredError"})(po||(po={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ht;(function(n){n.cache="fluid-cache",n.clientDetails="fluid-client-details",n.loadMode="loadMode",n.reconnect="fluid-reconnect",n.sequenceNumber="fluid-sequence-number",n.version="version"})(Ht||(Ht={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Qe;(function(n){n.Detached="Detached",n.Attaching="Attaching",n.Attached="Attached"})(Qe||(Qe={}));var Hr;(function(n){n.NotBound="NotBound",n.Binding="Binding",n.Bound="Bound"})(Hr||(Hr={}));const QL="IRuntimeFactory";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const XL="IFluidTokenProvider";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const YL=Object.freeze(Object.defineProperty({__proto__:null,get AttachState(){return Qe},get BindState(){return Hr},get ContainerErrorType(){return po},IFluidCodeDetailsComparer:KL,IFluidTokenProvider:XL,IRuntimeFactory:QL,get LoaderHeader(){return Ht},isFluidBrowserPackage:JL,isFluidCodeDetails:vb,isFluidPackage:bg},Symbol.toStringTag,{value:"Module"}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Tt;(function(n){n[n.Disconnected=0]="Disconnected",n[n.EstablishingConnection=3]="EstablishingConnection",n[n.Connecting=1]="Connecting",n[n.CatchingUp=1]="CatchingUp",n[n.Connected=2]="Connected"})(Tt||(Tt={}));function ZL(){this.__data__=[],this.size=0}var eM=ZL;function tM(n,e){return n===e||n!==n&&e!==e}var wg=tM,nM=wg;function rM(n,e){for(var t=n.length;t--;)if(nM(n[t][0],e))return t;return-1}var Cg=rM,iM=Cg,sM=Array.prototype,oM=sM.splice;function aM(n){var e=this.__data__,t=iM(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():oM.call(e,t,1),--this.size,!0}var uM=aM,lM=Cg;function cM(n){var e=this.__data__,t=lM(e,n);return t<0?void 0:e[t][1]}var dM=cM,hM=Cg;function fM(n){return hM(this.__data__,n)>-1}var pM=fM,mM=Cg;function gM(n,e){var t=this.__data__,r=mM(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}var vM=gM,yM=eM,SM=uM,bM=dM,wM=pM,CM=vM;function hc(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}hc.prototype.clear=yM;hc.prototype.delete=SM;hc.prototype.get=bM;hc.prototype.has=wM;hc.prototype.set=CM;var xg=hc,xM=xg;function EM(){this.__data__=new xM,this.size=0}var TM=EM;function PM(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}var RM=PM;function _M(n){return this.__data__.get(n)}var IM=_M;function AM(n){return this.__data__.has(n)}var kM=AM,OM=typeof Ne=="object"&&Ne&&Ne.Object===Object&&Ne,Uk=OM,FM=Uk,NM=typeof self=="object"&&self&&self.Object===Object&&self,DM=FM||NM||Function("return this")(),Bs=DM,LM=Bs,MM=LM.Symbol,DC=MM,Q2=DC,zk=Object.prototype,BM=zk.hasOwnProperty,jM=zk.toString,ld=Q2?Q2.toStringTag:void 0;function qM(n){var e=BM.call(n,ld),t=n[ld];try{n[ld]=void 0;var r=!0}catch{}var i=jM.call(n);return r&&(e?n[ld]=t:delete n[ld]),i}var UM=qM,zM=Object.prototype,$M=zM.toString;function HM(n){return $M.call(n)}var VM=HM,X2=DC,WM=UM,GM=VM,KM="[object Null]",JM="[object Undefined]",Y2=X2?X2.toStringTag:void 0;function QM(n){return n==null?n===void 0?JM:KM:Y2&&Y2 in Object(n)?WM(n):GM(n)}var jh=QM;function XM(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var ca=XM,YM=jh,ZM=ca,e6="[object AsyncFunction]",t6="[object Function]",n6="[object GeneratorFunction]",r6="[object Proxy]";function i6(n){if(!ZM(n))return!1;var e=YM(n);return e==t6||e==n6||e==e6||e==r6}var LC=i6,s6=Bs,o6=s6["__core-js_shared__"],a6=o6,Py=a6,Z2=function(){var n=/[^.]+$/.exec(Py&&Py.keys&&Py.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function u6(n){return!!Z2&&Z2 in n}var l6=u6,c6=Function.prototype,d6=c6.toString;function h6(n){if(n!=null){try{return d6.call(n)}catch{}try{return n+""}catch{}}return""}var $k=h6,f6=LC,p6=l6,m6=ca,g6=$k,v6=/[\\^$.*+?()[\]{}|]/g,y6=/^\[object .+?Constructor\]$/,S6=Function.prototype,b6=Object.prototype,w6=S6.toString,C6=b6.hasOwnProperty,x6=RegExp("^"+w6.call(C6).replace(v6,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function E6(n){if(!m6(n)||p6(n))return!1;var e=f6(n)?x6:y6;return e.test(g6(n))}var T6=E6;function P6(n,e){return n==null?void 0:n[e]}var R6=P6,_6=T6,I6=R6;function A6(n,e){var t=I6(n,e);return _6(t)?t:void 0}var Ru=A6,k6=Ru,O6=Bs,F6=k6(O6,"Map"),MC=F6,N6=Ru,D6=N6(Object,"create"),Eg=D6,eT=Eg;function L6(){this.__data__=eT?eT(null):{},this.size=0}var M6=L6;function B6(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var j6=B6,q6=Eg,U6="__lodash_hash_undefined__",z6=Object.prototype,$6=z6.hasOwnProperty;function H6(n){var e=this.__data__;if(q6){var t=e[n];return t===U6?void 0:t}return $6.call(e,n)?e[n]:void 0}var V6=H6,W6=Eg,G6=Object.prototype,K6=G6.hasOwnProperty;function J6(n){var e=this.__data__;return W6?e[n]!==void 0:K6.call(e,n)}var Q6=J6,X6=Eg,Y6="__lodash_hash_undefined__";function Z6(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=X6&&e===void 0?Y6:e,this}var e5=Z6,t5=M6,n5=j6,r5=V6,i5=Q6,s5=e5;function fc(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}fc.prototype.clear=t5;fc.prototype.delete=n5;fc.prototype.get=r5;fc.prototype.has=i5;fc.prototype.set=s5;var o5=fc,tT=o5,a5=xg,u5=MC;function l5(){this.size=0,this.__data__={hash:new tT,map:new(u5||a5),string:new tT}}var c5=l5;function d5(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}var h5=d5,f5=h5;function p5(n,e){var t=n.__data__;return f5(e)?t[typeof e=="string"?"string":"hash"]:t.map}var Tg=p5,m5=Tg;function g5(n){var e=m5(this,n).delete(n);return this.size-=e?1:0,e}var v5=g5,y5=Tg;function S5(n){return y5(this,n).get(n)}var b5=S5,w5=Tg;function C5(n){return w5(this,n).has(n)}var x5=C5,E5=Tg;function T5(n,e){var t=E5(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}var P5=T5,R5=c5,_5=v5,I5=b5,A5=x5,k5=P5;function pc(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}pc.prototype.clear=R5;pc.prototype.delete=_5;pc.prototype.get=I5;pc.prototype.has=A5;pc.prototype.set=k5;var O5=pc,F5=xg,N5=MC,D5=O5,L5=200;function M5(n,e){var t=this.__data__;if(t instanceof F5){var r=t.__data__;if(!N5||r.length<L5-1)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new D5(r)}return t.set(n,e),this.size=t.size,this}var B5=M5,j5=xg,q5=TM,U5=RM,z5=IM,$5=kM,H5=B5;function mc(n){var e=this.__data__=new j5(n);this.size=e.size}mc.prototype.clear=q5;mc.prototype.delete=U5;mc.prototype.get=z5;mc.prototype.has=$5;mc.prototype.set=H5;var Hk=mc,V5=Ru,W5=function(){try{var n=V5(Object,"defineProperty");return n({},"",{}),n}catch{}}(),Vk=W5,nT=Vk;function G5(n,e,t){e=="__proto__"&&nT?nT(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}var BC=G5,K5=BC,J5=wg;function Q5(n,e,t){(t!==void 0&&!J5(n[e],t)||t===void 0&&!(e in n))&&K5(n,e,t)}var Wk=Q5;function X5(n){return function(e,t,r){for(var i=-1,s=Object(e),o=r(e),u=o.length;u--;){var d=o[n?u:++i];if(t(s[d],d,s)===!1)break}return e}}var Y5=X5,Z5=Y5,e8=Z5(),t8=e8,Dm={exports:{}};Dm.exports;(function(n,e){var t=Bs,r=e&&!e.nodeType&&e,i=r&&!0&&n&&!n.nodeType&&n,s=i&&i.exports===r,o=s?t.Buffer:void 0,u=o?o.allocUnsafe:void 0;function d(f,m){if(m)return f.slice();var g=f.length,P=u?u(g):new f.constructor(g);return f.copy(P),P}n.exports=d})(Dm,Dm.exports);var Gk=Dm.exports,n8=Bs,r8=n8.Uint8Array,i8=r8,rT=i8;function s8(n){var e=new n.constructor(n.byteLength);return new rT(e).set(new rT(n)),e}var jC=s8,o8=jC;function a8(n,e){var t=e?o8(n.buffer):n.buffer;return new n.constructor(t,n.byteOffset,n.length)}var Kk=a8;function u8(n,e){var t=-1,r=n.length;for(e||(e=Array(r));++t<r;)e[t]=n[t];return e}var Jk=u8,l8=ca,iT=Object.create,c8=function(){function n(){}return function(e){if(!l8(e))return{};if(iT)return iT(e);n.prototype=e;var t=new n;return n.prototype=void 0,t}}(),d8=c8;function h8(n,e){return function(t){return n(e(t))}}var Qk=h8,f8=Qk,p8=f8(Object.getPrototypeOf,Object),qC=p8,m8=Object.prototype;function g8(n){var e=n&&n.constructor,t=typeof e=="function"&&e.prototype||m8;return n===t}var UC=g8,v8=d8,y8=qC,S8=UC;function b8(n){return typeof n.constructor=="function"&&!S8(n)?v8(y8(n)):{}}var Xk=b8;function w8(n){return n!=null&&typeof n=="object"}var _u=w8,C8=jh,x8=_u,E8="[object Arguments]";function T8(n){return x8(n)&&C8(n)==E8}var P8=T8,sT=P8,R8=_u,Yk=Object.prototype,_8=Yk.hasOwnProperty,I8=Yk.propertyIsEnumerable,A8=sT(function(){return arguments}())?sT:function(n){return R8(n)&&_8.call(n,"callee")&&!I8.call(n,"callee")},Zk=A8,k8=Array.isArray,Pg=k8,O8=9007199254740991;function F8(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=O8}var eO=F8,N8=LC,D8=eO;function L8(n){return n!=null&&D8(n.length)&&!N8(n)}var Rg=L8,M8=Rg,B8=_u;function j8(n){return B8(n)&&M8(n)}var q8=j8,Lm={exports:{}};function U8(){return!1}var z8=U8;Lm.exports;(function(n,e){var t=Bs,r=z8,i=e&&!e.nodeType&&e,s=i&&!0&&n&&!n.nodeType&&n,o=s&&s.exports===i,u=o?t.Buffer:void 0,d=u?u.isBuffer:void 0,f=d||r;n.exports=f})(Lm,Lm.exports);var zC=Lm.exports,$8=jh,H8=qC,V8=_u,W8="[object Object]",G8=Function.prototype,K8=Object.prototype,tO=G8.toString,J8=K8.hasOwnProperty,Q8=tO.call(Object);function X8(n){if(!V8(n)||$8(n)!=W8)return!1;var e=H8(n);if(e===null)return!0;var t=J8.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&tO.call(t)==Q8}var Y8=X8,Z8=jh,eB=eO,tB=_u,nB="[object Arguments]",rB="[object Array]",iB="[object Boolean]",sB="[object Date]",oB="[object Error]",aB="[object Function]",uB="[object Map]",lB="[object Number]",cB="[object Object]",dB="[object RegExp]",hB="[object Set]",fB="[object String]",pB="[object WeakMap]",mB="[object ArrayBuffer]",gB="[object DataView]",vB="[object Float32Array]",yB="[object Float64Array]",SB="[object Int8Array]",bB="[object Int16Array]",wB="[object Int32Array]",CB="[object Uint8Array]",xB="[object Uint8ClampedArray]",EB="[object Uint16Array]",TB="[object Uint32Array]",Bt={};Bt[vB]=Bt[yB]=Bt[SB]=Bt[bB]=Bt[wB]=Bt[CB]=Bt[xB]=Bt[EB]=Bt[TB]=!0;Bt[nB]=Bt[rB]=Bt[mB]=Bt[iB]=Bt[gB]=Bt[sB]=Bt[oB]=Bt[aB]=Bt[uB]=Bt[lB]=Bt[cB]=Bt[dB]=Bt[hB]=Bt[fB]=Bt[pB]=!1;function PB(n){return tB(n)&&eB(n.length)&&!!Bt[Z8(n)]}var RB=PB;function _B(n){return function(e){return n(e)}}var $C=_B,Mm={exports:{}};Mm.exports;(function(n,e){var t=Uk,r=e&&!e.nodeType&&e,i=r&&!0&&n&&!n.nodeType&&n,s=i&&i.exports===r,o=s&&t.process,u=function(){try{var d=i&&i.require&&i.require("util").types;return d||o&&o.binding&&o.binding("util")}catch{}}();n.exports=u})(Mm,Mm.exports);var HC=Mm.exports,IB=RB,AB=$C,oT=HC,aT=oT&&oT.isTypedArray,kB=aT?AB(aT):IB,nO=kB;function OB(n,e){if(!(e==="constructor"&&typeof n[e]=="function")&&e!="__proto__")return n[e]}var rO=OB,FB=BC,NB=wg,DB=Object.prototype,LB=DB.hasOwnProperty;function MB(n,e,t){var r=n[e];(!(LB.call(n,e)&&NB(r,t))||t===void 0&&!(e in n))&&FB(n,e,t)}var iO=MB,BB=iO,jB=BC;function qB(n,e,t,r){var i=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var u=e[s],d=r?r(t[u],n[u],u,t,n):void 0;d===void 0&&(d=n[u]),i?jB(t,u,d):BB(t,u,d)}return t}var qh=qB;function UB(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}var zB=UB,$B=9007199254740991,HB=/^(?:0|[1-9]\d*)$/;function VB(n,e){var t=typeof n;return e=e??$B,!!e&&(t=="number"||t!="symbol"&&HB.test(n))&&n>-1&&n%1==0&&n<e}var sO=VB,WB=zB,GB=Zk,KB=Pg,JB=zC,QB=sO,XB=nO,YB=Object.prototype,ZB=YB.hasOwnProperty;function ej(n,e){var t=KB(n),r=!t&&GB(n),i=!t&&!r&&JB(n),s=!t&&!r&&!i&&XB(n),o=t||r||i||s,u=o?WB(n.length,String):[],d=u.length;for(var f in n)(e||ZB.call(n,f))&&!(o&&(f=="length"||i&&(f=="offset"||f=="parent")||s&&(f=="buffer"||f=="byteLength"||f=="byteOffset")||QB(f,d)))&&u.push(f);return u}var oO=ej;function tj(n){var e=[];if(n!=null)for(var t in Object(n))e.push(t);return e}var nj=tj,rj=ca,ij=UC,sj=nj,oj=Object.prototype,aj=oj.hasOwnProperty;function uj(n){if(!rj(n))return sj(n);var e=ij(n),t=[];for(var r in n)r=="constructor"&&(e||!aj.call(n,r))||t.push(r);return t}var lj=uj,cj=oO,dj=lj,hj=Rg;function fj(n){return hj(n)?cj(n,!0):dj(n)}var Uh=fj,pj=qh,mj=Uh;function gj(n){return pj(n,mj(n))}var vj=gj,uT=Wk,yj=Gk,Sj=Kk,bj=Jk,wj=Xk,lT=Zk,cT=Pg,Cj=q8,xj=zC,Ej=LC,Tj=ca,Pj=Y8,Rj=nO,dT=rO,_j=vj;function Ij(n,e,t,r,i,s,o){var u=dT(n,t),d=dT(e,t),f=o.get(d);if(f){uT(n,t,f);return}var m=s?s(u,d,t+"",n,e,o):void 0,g=m===void 0;if(g){var P=cT(d),D=!P&&xj(d),M=!P&&!D&&Rj(d);m=d,P||D||M?cT(u)?m=u:Cj(u)?m=bj(u):D?(g=!1,m=yj(d,!0)):M?(g=!1,m=Sj(d,!0)):m=[]:Pj(d)||lT(d)?(m=u,lT(u)?m=_j(u):(!Tj(u)||Ej(u))&&(m=wj(d))):g=!1}g&&(o.set(d,m),i(m,d,r,s,o),o.delete(d)),uT(n,t,m)}var Aj=Ij,kj=Hk,Oj=Wk,Fj=t8,Nj=Aj,Dj=ca,Lj=Uh,Mj=rO;function aO(n,e,t,r,i){n!==e&&Fj(e,function(s,o){if(i||(i=new kj),Dj(s))Nj(n,e,o,t,aO,r,i);else{var u=r?r(Mj(n,o),s,o+"",n,e,i):void 0;u===void 0&&(u=s),Oj(n,o,u)}},Lj)}var Bj=aO;function jj(n){return n}var uO=jj;function qj(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}var Uj=qj,zj=Uj,hT=Math.max;function $j(n,e,t){return e=hT(e===void 0?n.length-1:e,0),function(){for(var r=arguments,i=-1,s=hT(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var u=Array(e+1);++i<e;)u[i]=r[i];return u[e]=t(o),zj(n,this,u)}}var Hj=$j;function Vj(n){return function(){return n}}var Wj=Vj,Gj=Wj,fT=Vk,Kj=uO,Jj=fT?function(n,e){return fT(n,"toString",{configurable:!0,enumerable:!1,value:Gj(e),writable:!0})}:Kj,Qj=Jj,Xj=800,Yj=16,Zj=Date.now;function eq(n){var e=0,t=0;return function(){var r=Zj(),i=Yj-(r-t);if(t=r,i>0){if(++e>=Xj)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}var tq=eq,nq=Qj,rq=tq,iq=rq(nq),sq=iq,oq=uO,aq=Hj,uq=sq;function lq(n,e){return uq(aq(n,e,oq),n+"")}var cq=lq,dq=wg,hq=Rg,fq=sO,pq=ca;function mq(n,e,t){if(!pq(t))return!1;var r=typeof e;return(r=="number"?hq(t)&&fq(e,t.length):r=="string"&&e in t)?dq(t[e],n):!1}var gq=mq,vq=cq,yq=gq;function Sq(n){return vq(function(e,t){var r=-1,i=t.length,s=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(s=n.length>3&&typeof s=="function"?(i--,s):void 0,o&&yq(t[0],t[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var u=t[r];u&&n(e,u,r,s)}return e})}var bq=Sq,wq=Bj,Cq=bq,xq=Cq(function(n,e,t){wq(n,e,t)}),Eq=xq;const Tq=Ms(Eq);var mp,Pq=new Uint8Array(16);function Rq(){if(!mp&&(mp=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!mp))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return mp(Pq)}const _q=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Iq(n){return typeof n=="string"&&_q.test(n)}var Ln=[];for(var Ry=0;Ry<256;++Ry)Ln.push((Ry+256).toString(16).substr(1));function Aq(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Ln[n[e+0]]+Ln[n[e+1]]+Ln[n[e+2]]+Ln[n[e+3]]+"-"+Ln[n[e+4]]+Ln[n[e+5]]+"-"+Ln[n[e+6]]+Ln[n[e+7]]+"-"+Ln[n[e+8]]+Ln[n[e+9]]+"-"+Ln[n[e+10]]+Ln[n[e+11]]+Ln[n[e+12]]+Ln[n[e+13]]+Ln[n[e+14]]+Ln[n[e+15]]).toLowerCase();if(!Iq(t))throw TypeError("Stringified UUID is invalid");return t}function Xl(n,e,t){n=n||{};var r=n.random||(n.rng||Rq)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return Aq(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function $e(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}var VC={};VC.byteLength=Fq;var js=VC.toByteArray=Dq,yi=VC.fromByteArray=Bq,Cs=[],Ci=[],kq=typeof Uint8Array<"u"?Uint8Array:Array,_y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Qu=0,Oq=_y.length;Qu<Oq;++Qu)Cs[Qu]=_y[Qu],Ci[_y.charCodeAt(Qu)]=Qu;Ci["-".charCodeAt(0)]=62;Ci["_".charCodeAt(0)]=63;function lO(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function Fq(n){var e=lO(n),t=e[0],r=e[1];return(t+r)*3/4-r}function Nq(n,e,t){return(e+t)*3/4-t}function Dq(n){var e,t=lO(n),r=t[0],i=t[1],s=new kq(Nq(n,r,i)),o=0,u=i>0?r-4:r,d;for(d=0;d<u;d+=4)e=Ci[n.charCodeAt(d)]<<18|Ci[n.charCodeAt(d+1)]<<12|Ci[n.charCodeAt(d+2)]<<6|Ci[n.charCodeAt(d+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=Ci[n.charCodeAt(d)]<<2|Ci[n.charCodeAt(d+1)]>>4,s[o++]=e&255),i===1&&(e=Ci[n.charCodeAt(d)]<<10|Ci[n.charCodeAt(d+1)]<<4|Ci[n.charCodeAt(d+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function Lq(n){return Cs[n>>18&63]+Cs[n>>12&63]+Cs[n>>6&63]+Cs[n&63]}function Mq(n,e,t){for(var r,i=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),i.push(Lq(r));return i.join("")}function Bq(n){for(var e,t=n.length,r=t%3,i=[],s=16383,o=0,u=t-r;o<u;o+=s)i.push(Mq(n,o,o+s>u?u:o+s));return r===1?(e=n[t-1],i.push(Cs[e>>2]+Cs[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(Cs[e>>10]+Cs[e>>4&63]+Cs[e<<2&63]+"=")),i.join("")}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function jq(n,e){switch(e){case"base64":return yi(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const qq=(n,e)=>Uq.from(n,e).buffer;function pT(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let Uq=class Fa extends Uint8Array{toString(e){return jq(this,e)}static from(e,t,r){if(typeof e=="string")return Fa.fromString(e,t);if(e!==null&&typeof e=="object"&&pT(e.buffer))return $e(e.byteOffset===0,0),$e(e.byteLength===e.buffer.byteLength,1),Fa.fromArrayBuffer(e.buffer,t,r);if(pT(e))return Fa.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Fa(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=js(r);return new Fa(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Fa(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};const zq="modulepreload",$q=function(n,e){return new URL(n,e).href},mT={},WC=function(e,t,r){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=$q(s,r),s in mT)return;mT[s]=!0;const o=s.endsWith(".css"),u=o?'[rel="stylesheet"]':"";if(!!r)for(let m=i.length-1;m>=0;m--){const g=i[m];if(g.href===s&&(!o||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${u}`))return;const f=document.createElement("link");if(f.rel=o?"stylesheet":zq,o||(f.as="script",f.crossOrigin=""),f.href=s,document.head.appendChild(f),o)return new Promise((m,g)=>{f.addEventListener("load",m),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const vr=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function cd(n,e){return(...t)=>{if(n.disposed)throw new Error("Already disposed");return e(...t)}}var GC={exports:{}},Fl=typeof Reflect=="object"?Reflect:null,gT=Fl&&typeof Fl.apply=="function"?Fl.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},Xp;Fl&&typeof Fl.ownKeys=="function"?Xp=Fl.ownKeys:Object.getOwnPropertySymbols?Xp=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Xp=function(e){return Object.getOwnPropertyNames(e)};function Hq(n){console&&console.warn&&console.warn(n)}var cO=Number.isNaN||function(e){return e!==e};function kt(){kt.init.call(this)}GC.exports=kt;GC.exports.once=Kq;kt.EventEmitter=kt;kt.prototype._events=void 0;kt.prototype._eventsCount=0;kt.prototype._maxListeners=void 0;var vT=10;function _g(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(kt,"defaultMaxListeners",{enumerable:!0,get:function(){return vT},set:function(n){if(typeof n!="number"||n<0||cO(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");vT=n}});kt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};kt.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||cO(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function dO(n){return n._maxListeners===void 0?kt.defaultMaxListeners:n._maxListeners}kt.prototype.getMaxListeners=function(){return dO(this)};kt.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var u=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw u.context=o,u}var d=s[e];if(d===void 0)return!1;if(typeof d=="function")gT(d,this,t);else for(var f=d.length,m=gO(d,f),r=0;r<f;++r)gT(m[r],this,t);return!0};function hO(n,e,t,r){var i,s,o;if(_g(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),o=s[e]),o===void 0)o=s[e]=t,++n._eventsCount;else if(typeof o=="function"?o=s[e]=r?[t,o]:[o,t]:r?o.unshift(t):o.push(t),i=dO(n),i>0&&o.length>i&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=n,u.type=e,u.count=o.length,Hq(u)}return n}kt.prototype.addListener=function(e,t){return hO(this,e,t,!1)};kt.prototype.on=kt.prototype.addListener;kt.prototype.prependListener=function(e,t){return hO(this,e,t,!0)};function Vq(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function fO(n,e,t){var r={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},i=Vq.bind(r);return i.listener=t,r.wrapFn=i,i}kt.prototype.once=function(e,t){return _g(t),this.on(e,fO(this,e,t)),this};kt.prototype.prependOnceListener=function(e,t){return _g(t),this.prependListener(e,fO(this,e,t)),this};kt.prototype.removeListener=function(e,t){var r,i,s,o,u;if(_g(t),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){u=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():Wq(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,u||t)}return this};kt.prototype.off=kt.prototype.removeListener;kt.prototype.removeAllListeners=function(e){var t,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function pO(n,e,t){var r=n._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?Gq(i):gO(i,i.length)}kt.prototype.listeners=function(e){return pO(this,e,!0)};kt.prototype.rawListeners=function(e){return pO(this,e,!1)};kt.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):mO.call(n,e)};kt.prototype.listenerCount=mO;function mO(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}kt.prototype.eventNames=function(){return this._eventsCount>0?Xp(this._events):[]};function gO(n,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=n[r];return t}function Wq(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function Gq(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function Kq(n,e){return new Promise(function(t,r){function i(o){n.removeListener(e,s),r(o)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",i),t([].slice.call(arguments))}vO(n,e,s,{once:!0}),e!=="error"&&Jq(n,i,{once:!0})})}function Jq(n,e,t){typeof n.on=="function"&&vO(n,"error",e,t)}function vO(n,e,t,r){if(typeof n.on=="function")r.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function i(s){r.once&&n.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var Fn=GC.exports;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Ig=class extends Fn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let zh=class Na extends Ig{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,e!==void 0){const t=i=>this.unforwardEvent(e,i),r=i=>this.forwardEvent(e,i);this.on(Na.removeListenerEvent,t),this.on(Na.newListenerEvent,r)}}static isEmitterEvent(e){return e===Na.newListenerEvent||e===Na.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(e!==void 0&&r!==void 0&&!Na.isEmitterEvent(r)){let i=this.forwardingEvents.get(r);if(i===void 0&&(i=new Map,this.forwardingEvents.set(r,i)),!i.has(e)){const s=(...o)=>this.emit(r,...o);i.set(e,()=>e.off(r,s)),e.on(r,s)}}}unforwardEvent(e,...t){for(const r of t)if(r!==void 0&&!Na.isEmitterEvent(r)){const i=this.forwardingEvents.get(r);if(i!=null&&i.has(e)&&this.listenerCount(r)===0){const s=i.get(e);s!==void 0&&s(),i.delete(e),i.size===0&&this.forwardingEvents.delete(r)}}}};zh.newListenerEvent="newListener";zh.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Qq=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};function Xq(n,e){for(var t=-1,r=n==null?0:n.length;++t<r&&e(n[t],t,n)!==!1;);return n}var Yq=Xq,Zq=Qk,e9=Zq(Object.keys,Object),t9=e9,n9=UC,r9=t9,i9=Object.prototype,s9=i9.hasOwnProperty;function o9(n){if(!n9(n))return r9(n);var e=[];for(var t in Object(n))s9.call(n,t)&&t!="constructor"&&e.push(t);return e}var a9=o9,u9=oO,l9=a9,c9=Rg;function d9(n){return c9(n)?u9(n):l9(n)}var KC=d9,h9=qh,f9=KC;function p9(n,e){return n&&h9(e,f9(e),n)}var m9=p9,g9=qh,v9=Uh;function y9(n,e){return n&&g9(e,v9(e),n)}var S9=y9;function b9(n,e){for(var t=-1,r=n==null?0:n.length,i=0,s=[];++t<r;){var o=n[t];e(o,t,n)&&(s[i++]=o)}return s}var w9=b9;function C9(){return[]}var yO=C9,x9=w9,E9=yO,T9=Object.prototype,P9=T9.propertyIsEnumerable,yT=Object.getOwnPropertySymbols,R9=yT?function(n){return n==null?[]:(n=Object(n),x9(yT(n),function(e){return P9.call(n,e)}))}:E9,JC=R9,_9=qh,I9=JC;function A9(n,e){return _9(n,I9(n),e)}var k9=A9;function O9(n,e){for(var t=-1,r=e.length,i=n.length;++t<r;)n[i+t]=e[t];return n}var SO=O9,F9=SO,N9=qC,D9=JC,L9=yO,M9=Object.getOwnPropertySymbols,B9=M9?function(n){for(var e=[];n;)F9(e,D9(n)),n=N9(n);return e}:L9,bO=B9,j9=qh,q9=bO;function U9(n,e){return j9(n,q9(n),e)}var z9=U9,$9=SO,H9=Pg;function V9(n,e,t){var r=e(n);return H9(n)?r:$9(r,t(n))}var wO=V9,W9=wO,G9=JC,K9=KC;function J9(n){return W9(n,K9,G9)}var Q9=J9,X9=wO,Y9=bO,Z9=Uh;function eU(n){return X9(n,Z9,Y9)}var tU=eU,nU=Ru,rU=Bs,iU=nU(rU,"DataView"),sU=iU,oU=Ru,aU=Bs,uU=oU(aU,"Promise"),lU=uU,cU=Ru,dU=Bs,hU=cU(dU,"Set"),fU=hU,pU=Ru,mU=Bs,gU=pU(mU,"WeakMap"),vU=gU,yb=sU,Sb=MC,bb=lU,wb=fU,Cb=vU,CO=jh,gc=$k,ST="[object Map]",yU="[object Object]",bT="[object Promise]",wT="[object Set]",CT="[object WeakMap]",xT="[object DataView]",SU=gc(yb),bU=gc(Sb),wU=gc(bb),CU=gc(wb),xU=gc(Cb),Da=CO;(yb&&Da(new yb(new ArrayBuffer(1)))!=xT||Sb&&Da(new Sb)!=ST||bb&&Da(bb.resolve())!=bT||wb&&Da(new wb)!=wT||Cb&&Da(new Cb)!=CT)&&(Da=function(n){var e=CO(n),t=e==yU?n.constructor:void 0,r=t?gc(t):"";if(r)switch(r){case SU:return xT;case bU:return ST;case wU:return bT;case CU:return wT;case xU:return CT}return e});var QC=Da,EU=Object.prototype,TU=EU.hasOwnProperty;function PU(n){var e=n.length,t=new n.constructor(e);return e&&typeof n[0]=="string"&&TU.call(n,"index")&&(t.index=n.index,t.input=n.input),t}var RU=PU,_U=jC;function IU(n,e){var t=e?_U(n.buffer):n.buffer;return new n.constructor(t,n.byteOffset,n.byteLength)}var AU=IU,kU=/\w*$/;function OU(n){var e=new n.constructor(n.source,kU.exec(n));return e.lastIndex=n.lastIndex,e}var FU=OU,ET=DC,TT=ET?ET.prototype:void 0,PT=TT?TT.valueOf:void 0;function NU(n){return PT?Object(PT.call(n)):{}}var DU=NU,LU=jC,MU=AU,BU=FU,jU=DU,qU=Kk,UU="[object Boolean]",zU="[object Date]",$U="[object Map]",HU="[object Number]",VU="[object RegExp]",WU="[object Set]",GU="[object String]",KU="[object Symbol]",JU="[object ArrayBuffer]",QU="[object DataView]",XU="[object Float32Array]",YU="[object Float64Array]",ZU="[object Int8Array]",e7="[object Int16Array]",t7="[object Int32Array]",n7="[object Uint8Array]",r7="[object Uint8ClampedArray]",i7="[object Uint16Array]",s7="[object Uint32Array]";function o7(n,e,t){var r=n.constructor;switch(e){case JU:return LU(n);case UU:case zU:return new r(+n);case QU:return MU(n,t);case XU:case YU:case ZU:case e7:case t7:case n7:case r7:case i7:case s7:return qU(n,t);case $U:return new r;case HU:case GU:return new r(n);case VU:return BU(n);case WU:return new r;case KU:return jU(n)}}var a7=o7,u7=QC,l7=_u,c7="[object Map]";function d7(n){return l7(n)&&u7(n)==c7}var h7=d7,f7=h7,p7=$C,RT=HC,_T=RT&&RT.isMap,m7=_T?p7(_T):f7,g7=m7,v7=QC,y7=_u,S7="[object Set]";function b7(n){return y7(n)&&v7(n)==S7}var w7=b7,C7=w7,x7=$C,IT=HC,AT=IT&&IT.isSet,E7=AT?x7(AT):C7,T7=E7,P7=Hk,R7=Yq,_7=iO,I7=m9,A7=S9,k7=Gk,O7=Jk,F7=k9,N7=z9,D7=Q9,L7=tU,M7=QC,B7=RU,j7=a7,q7=Xk,U7=Pg,z7=zC,$7=g7,H7=ca,V7=T7,W7=KC,G7=Uh,K7=1,J7=2,Q7=4,xO="[object Arguments]",X7="[object Array]",Y7="[object Boolean]",Z7="[object Date]",ez="[object Error]",EO="[object Function]",tz="[object GeneratorFunction]",nz="[object Map]",rz="[object Number]",TO="[object Object]",iz="[object RegExp]",sz="[object Set]",oz="[object String]",az="[object Symbol]",uz="[object WeakMap]",lz="[object ArrayBuffer]",cz="[object DataView]",dz="[object Float32Array]",hz="[object Float64Array]",fz="[object Int8Array]",pz="[object Int16Array]",mz="[object Int32Array]",gz="[object Uint8Array]",vz="[object Uint8ClampedArray]",yz="[object Uint16Array]",Sz="[object Uint32Array]",Nt={};Nt[xO]=Nt[X7]=Nt[lz]=Nt[cz]=Nt[Y7]=Nt[Z7]=Nt[dz]=Nt[hz]=Nt[fz]=Nt[pz]=Nt[mz]=Nt[nz]=Nt[rz]=Nt[TO]=Nt[iz]=Nt[sz]=Nt[oz]=Nt[az]=Nt[gz]=Nt[vz]=Nt[yz]=Nt[Sz]=!0;Nt[ez]=Nt[EO]=Nt[uz]=!1;function Yp(n,e,t,r,i,s){var o,u=e&K7,d=e&J7,f=e&Q7;if(t&&(o=i?t(n,r,i,s):t(n)),o!==void 0)return o;if(!H7(n))return n;var m=U7(n);if(m){if(o=B7(n),!u)return O7(n,o)}else{var g=M7(n),P=g==EO||g==tz;if(z7(n))return k7(n,u);if(g==TO||g==xO||P&&!i){if(o=d||P?{}:q7(n),!u)return d?N7(n,A7(o,n)):F7(n,I7(o,n))}else{if(!Nt[g])return i?n:{};o=j7(n,g,u)}}s||(s=new P7);var D=s.get(n);if(D)return D;s.set(n,o),V7(n)?n.forEach(function(j){o.add(Yp(j,e,t,j,n,s))}):$7(n)&&n.forEach(function(j,E){o.set(E,Yp(j,e,t,E,n,s))});var M=f?d?L7:D7:d?G7:W7,U=m?void 0:M(n);return R7(U||n,function(j,E){U&&(E=j,j=n[E]),_7(o,E,Yp(j,e,t,E,n,s))}),o}var bz=Yp,wz=bz,Cz=1,xz=4;function Ez(n){return wz(n,Cz|xz)}var Tz=Ez;const ia=Ms(Tz);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let xb=class{constructor(e,t,r=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,i;if(!this.runningState)this.start(e,t);else{const s=e??this.runningState.intendedDuration,o=(i=t??((r=this.runningState.restart)===null||r===void 0?void 0:r.handler))!==null&&i!==void 0?i:this.runningState.handler,u=this.calculateRemainingTime(this.runningState);s<u?this.start(s,o):s===u?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:setTimeout(()=>this.handler(),e)}}handler(){$e(!!this.runningState,10);const e=this.runningState.restart;if(e!==void 0){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Eb(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Pz(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Sh=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Rz=class extends Fn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let _z=class{send(e){}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Iz=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};var Tb={exports:{}},Iy,kT;function Az(){if(kT)return Iy;kT=1;var n=1e3,e=n*60,t=e*60,r=t*24,i=r*7,s=r*365.25;Iy=function(m,g){g=g||{};var P=typeof m;if(P==="string"&&m.length>0)return o(m);if(P==="number"&&isFinite(m))return g.long?d(m):u(m);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(m))};function o(m){if(m=String(m),!(m.length>100)){var g=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(m);if(g){var P=parseFloat(g[1]),D=(g[2]||"ms").toLowerCase();switch(D){case"years":case"year":case"yrs":case"yr":case"y":return P*s;case"weeks":case"week":case"w":return P*i;case"days":case"day":case"d":return P*r;case"hours":case"hour":case"hrs":case"hr":case"h":return P*t;case"minutes":case"minute":case"mins":case"min":case"m":return P*e;case"seconds":case"second":case"secs":case"sec":case"s":return P*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return P;default:return}}}}function u(m){var g=Math.abs(m);return g>=r?Math.round(m/r)+"d":g>=t?Math.round(m/t)+"h":g>=e?Math.round(m/e)+"m":g>=n?Math.round(m/n)+"s":m+"ms"}function d(m){var g=Math.abs(m);return g>=r?f(m,g,r,"day"):g>=t?f(m,g,t,"hour"):g>=e?f(m,g,e,"minute"):g>=n?f(m,g,n,"second"):m+" ms"}function f(m,g,P,D){var M=g>=P*1.5;return Math.round(m/P)+" "+D+(M?"s":"")}return Iy}function kz(n){t.debug=t,t.default=t,t.coerce=d,t.disable=s,t.enable=i,t.enabled=o,t.humanize=Az(),t.destroy=f,Object.keys(n).forEach(m=>{t[m]=n[m]}),t.names=[],t.skips=[],t.formatters={};function e(m){let g=0;for(let P=0;P<m.length;P++)g=(g<<5)-g+m.charCodeAt(P),g|=0;return t.colors[Math.abs(g)%t.colors.length]}t.selectColor=e;function t(m){let g,P=null,D,M;function U(...j){if(!U.enabled)return;const E=U,k=Number(new Date),z=k-(g||k);E.diff=z,E.prev=g,E.curr=k,g=k,j[0]=t.coerce(j[0]),typeof j[0]!="string"&&j.unshift("%O");let K=0;j[0]=j[0].replace(/%([a-zA-Z%])/g,(he,pe)=>{if(he==="%%")return"%";K++;const X=t.formatters[pe];if(typeof X=="function"){const fe=j[K];he=X.call(E,fe),j.splice(K,1),K--}return he}),t.formatArgs.call(E,j),(E.log||t.log).apply(E,j)}return U.namespace=m,U.useColors=t.useColors(),U.color=t.selectColor(m),U.extend=r,U.destroy=t.destroy,Object.defineProperty(U,"enabled",{enumerable:!0,configurable:!1,get:()=>P!==null?P:(D!==t.namespaces&&(D=t.namespaces,M=t.enabled(m)),M),set:j=>{P=j}}),typeof t.init=="function"&&t.init(U),U}function r(m,g){const P=t(this.namespace+(typeof g>"u"?":":g)+m);return P.log=this.log,P}function i(m){t.save(m),t.namespaces=m,t.names=[],t.skips=[];let g;const P=(typeof m=="string"?m:"").split(/[\s,]+/),D=P.length;for(g=0;g<D;g++)P[g]&&(m=P[g].replace(/\*/g,".*?"),m[0]==="-"?t.skips.push(new RegExp("^"+m.slice(1)+"$")):t.names.push(new RegExp("^"+m+"$")))}function s(){const m=[...t.names.map(u),...t.skips.map(u).map(g=>"-"+g)].join(",");return t.enable(""),m}function o(m){if(m[m.length-1]==="*")return!0;let g,P;for(g=0,P=t.skips.length;g<P;g++)if(t.skips[g].test(m))return!1;for(g=0,P=t.names.length;g<P;g++)if(t.names[g].test(m))return!0;return!1}function u(m){return m.toString().substring(2,m.toString().length-2).replace(/\.\*\?$/,"*")}function d(m){return m instanceof Error?m.stack||m.message:m}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Oz=kz;(function(n,e){e.formatArgs=r,e.save=i,e.load=s,e.useColors=t,e.storage=o(),e.destroy=(()=>{let d=!1;return()=>{d||(d=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(d){if(d[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+d[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const f="color: "+this.color;d.splice(1,0,f,"color: inherit");let m=0,g=0;d[0].replace(/%[a-zA-Z%]/g,P=>{P!=="%%"&&(m++,P==="%c"&&(g=m))}),d.splice(g,0,f)}e.log=console.debug||console.log||(()=>{});function i(d){try{d?e.storage.setItem("debug",d):e.storage.removeItem("debug")}catch{}}function s(){let d;try{d=e.storage.getItem("debug")}catch{}return!d&&typeof process<"u"&&"env"in process&&(d={}.DEBUG),d}function o(){try{return localStorage}catch{}}n.exports=Oz(e);const{formatters:u}=n.exports;u.j=function(d){try{return JSON.stringify(d)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}})(Tb,Tb.exports);var Pb=Tb.exports;const XC=new Iz(()=>Nz(Dz())),Fz={getRawConfig:()=>{}},Nz=n=>n!=null?new $h({getRawConfig:e=>{var t,r;try{return(r=PO((t=n.getItem(e))!==null&&t!==void 0?t:void 0))===null||r===void 0?void 0:r.raw}catch{}}}):Fz;function OT(n){switch(n){case"boolean":case"number":case"string":return!0;default:return!1}}function PO(n){let e=n,t;if(typeof n=="string")try{e=JSON.parse(n),t={raw:n,string:n}}catch{}if(e===void 0)return t;const r=typeof e;if(OT(r))return Object.assign(Object.assign({},t),{raw:n,[r]:e});if(Array.isArray(e)){const i=typeof e[0];if(!OT(i))return t;for(const s of e)if(typeof s!==i)return t;return Object.assign(Object.assign({},t),{raw:n,[`${i}[]`]:e})}return t}const Dz=()=>{try{return sessionStorage!==null?sessionStorage:void 0}catch{return}};class $h{constructor(...e){this.configCache=new Map,this.orderedBaseProviders=[];const t=new Set,r=[...e];for(;r.length>0;){const i=r.shift();i!==void 0&&RO(i)&&!t.has(i)&&(t.add(i),i instanceof $h?r.push(...i.orderedBaseProviders):this.orderedBaseProviders.push(i))}}getBoolean(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.boolean}getNumber(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.number}getString(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.string}getBooleanArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["boolean[]"]}getNumberArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["number[]"]}getStringArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["string[]"]}getRawConfig(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.raw}getCacheEntry(e){if(!this.configCache.has(e)){for(const t of this.orderedBaseProviders){const r=PO(t==null?void 0:t.getRawConfig(e));if(r!==void 0)return this.configCache.set(e,r),r}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}function YC(n){const e=n;return RO(e==null?void 0:e.config)&&(e==null?void 0:e.logger)!==void 0}function Iu(n){return YC(n)?n:Ag(n,XC.value)}function Ag(n,...e){if(YC(n))throw new Error("Logger is already a monitoring context");const t=n;return t.config=new $h(...e),t.logger=n,t}function RO(n){const e=n;return typeof(e==null?void 0:e.getRawConfig)=="function"}var gp,Lz=new Uint8Array(16);function Mz(){if(!gp&&(gp=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!gp))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return gp(Lz)}const Bz=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function jz(n){return typeof n=="string"&&Bz.test(n)}var Mn=[];for(var Ay=0;Ay<256;++Ay)Mn.push((Ay+256).toString(16).substr(1));function qz(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Mn[n[e+0]]+Mn[n[e+1]]+Mn[n[e+2]]+Mn[n[e+3]]+"-"+Mn[n[e+4]]+Mn[n[e+5]]+"-"+Mn[n[e+6]]+Mn[n[e+7]]+"-"+Mn[n[e+8]]+Mn[n[e+9]]+"-"+Mn[n[e+10]]+Mn[n[e+11]]+Mn[n[e+12]]+Mn[n[e+13]]+Mn[n[e+14]]+Mn[n[e+15]]).toLowerCase();if(!jz(t))throw TypeError("Stringified UUID is invalid");return t}function _O(n,e,t){n=n||{};var r=n.random||(n.rng||Mz)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return qz(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const IO=n=>typeof(n==null?void 0:n.getTelemetryProperties)=="function"&&typeof(n==null?void 0:n.addTelemetryProperties)=="function",ZC=n=>typeof(n==null?void 0:n.errorInstanceId)=="string";function ex(n){return typeof(n==null?void 0:n.errorType)=="string"&&typeof(n==null?void 0:n.message)=="string"&&ZC(n)&&IO(n)}function tx(n){return typeof(n==null?void 0:n.errorType)=="string"&&typeof(n==null?void 0:n.message)=="string"&&IO(n)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Uz=n=>n!==null&&!Array.isArray(n)&&typeof n=="object";function kg(n,e){const t=(s,o)=>{if(!e)return s;const u=s.split(`
`);return u.shift(),o!==void 0&&u.unshift(o),u.join(`
`)},i={message:typeof(n==null?void 0:n.message)=="string"?n.message:String(n)};if(Uz(n)){const{errorType:s,stack:o,name:u}=n;if(typeof s=="string"&&(i.errorType=s),typeof o=="string"){const d=typeof u=="string"?u:void 0;i.stack=t(o,d)}}return i}const Og=n=>typeof(n==null?void 0:n.getTelemetryProperties)=="function";function zz(n,e){for(const t of Object.keys(e))n[t]===void 0&&(n[t]=e[t])}function $z(n){const e=n;e.errorInstanceId===void 0&&(e.errorInstanceId=_O())}function Oi(n,e={}){var t;if(tx(n)&&$z(n),ex(n))return n.addTelemetryProperties((t=e.props)!==null&&t!==void 0?t:{}),n;const{message:r,stack:i}=kg(n,!1),s=new Wh({message:r,stack:i});if(typeof n=="object"&&n!==null){const{canRetry:u,retryAfterSeconds:d}=n;Object.assign(Oi,{canRetry:u,retryAfterSeconds:d})}typeof n!="object"&&s.addTelemetryProperties({typeofError:typeof n});const o=Og(n)?n.getTelemetryProperties():{};return s.addTelemetryProperties(Object.assign(Object.assign(Object.assign({},o),e.props),{untrustedOrigin:1})),s}let ky;function Hh(){const n=new Error("<<generated stack>>");if(ky===void 0&&(ky=n.stack!==void 0),ky)return n;try{throw n}catch(e){return e}}function AO(){return Hh().stack}function Vh(n,e){const{message:t,stack:r}=kg(n,!1),i=e(t);return r!==void 0&&kO(i,r),rx(n)&&i.addTelemetryProperties({untrustedOrigin:1}),ZC(n)&&(i.overwriteErrorInstanceId(n.errorInstanceId),i.addTelemetryProperties({innerErrorInstanceId:n.errorInstanceId})),Og(n)&&i.addTelemetryProperties(n.getTelemetryProperties()),i}function nx(n,e,t){const r=Vh(n,e),i=r.errorInstanceId,s=i;return t.sendTelemetryEvent({eventName:"WrapError",errorInstanceId:i,wrappedByErrorInstanceId:s},n),r}function kO(n,e){try{Object.assign(n,{stack:e})}catch{n.addTelemetryProperties({stack2:e})}}function rx(n){return!tx(n)||n.getTelemetryProperties().untrustedOrigin===1&&n.errorType===Wh.normalizedErrorType}function OO(n){return typeof(n==null?void 0:n.value)!="object"&&typeof(n==null?void 0:n.tag)=="string"}function Hz(n,e){const t={};for(const r of Object.keys(n)){if(e.has(r))continue;const i=n[r];switch(typeof i){case"string":case"number":case"boolean":case"undefined":t[r]=i;break;default:{OO(i)?t[r]=i:t[r]="REDACTED (arbitrary object)";break}}}return t}const FO=()=>{const n=new WeakSet;return(e,t)=>{if(typeof t=="object"&&t!==null){if(n.has(t))return"<removed/circular>";n.add(t)}return t}};class st extends Error{constructor(e,t,r=new Set){super(e),this.omitPropsFromLogging=r,this._errorInstanceId=_O(),this.fluidErrorCode="-",r.add("omitPropsFromLogging"),r.add("_errorInstanceId"),t&&this.addTelemetryProperties(t)}get errorInstanceId(){return this._errorInstanceId}overwriteErrorInstanceId(e){this._errorInstanceId=e}addTelemetryProperties(e){zz(this,e)}getTelemetryProperties(){const e=Hz(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}class Wh extends st{constructor(e){super(e.message),this.errorType=Wh.normalizedErrorType,e.stack!==void 0&&kO(this,e.stack)}}Wh.normalizedErrorType="genericError";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ot;(function(n){n.PackageData="PackageData",n.CodeArtifact="CodeArtifact",n.UserData="UserData"})(Ot||(Ot={}));class qt{constructor(e,t){this.namespace=e,this.properties=t}static formatTick(e){return Math.floor(e)}static numberFromString(e){if(e==null)return;const t=Number(e);return Number.isNaN(t)?e:t}static sanitizePkgName(e){return e.replace("@","").replace("/","-")}static prepareErrorObject(e,t,r){const{message:i,errorType:s,stack:o}=kg(t,!0);if(e.stack=o,e.error=i,e.errorType=s,Og(t)){const u=t.getTelemetryProperties();for(const d of Object.keys(u))e[d]===void 0&&(e[d]=u[d])}e.stack===void 0&&r&&(e.stack=AO())}sendTelemetryEvent(e,t){var r;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:(r=e.category)!==null&&r!==void 0?r:"generic"}),t)}sendTelemetryEventCore(e,t){const r=Object.assign({},e);t!==void 0&&qt.prepareErrorObject(r,t,!1),typeof r.duration=="number"&&(r.duration=qt.formatTick(r.duration)),this.send(r)}sendErrorEvent(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}sendPerformanceEvent(e,t){var r;const i=Object.assign(Object.assign({},e),{category:(r=e.category)!==null&&r!==void 0?r:"performance"});this.sendTelemetryEventCore(i,t)}prepareEvent(e){const t=e.category==="error"||e.error!==void 0,r=Object.assign({},e);if(this.namespace!==void 0&&(r.eventName=`${this.namespace}${qt.eventNamespaceSeparator}${r.eventName}`),this.properties){const i=[];i.push(this.properties.all),t&&i.push(this.properties.error);for(const s of i)if(s!==void 0)for(const o of Object.keys(s)){if(e[o]!==void 0)continue;const u=s[o],d=typeof u=="function"?u():u;d!==void 0&&(r[o]=d)}}return r}}qt.eventNamespaceSeparator=":";class NO{constructor(e){this.logger=e}send(e){const t={category:e.category,eventName:e.eventName};for(const r of Object.keys(e)){const i=e[r],{value:s,tag:o}=typeof i=="object"?i:{value:i,tag:void 0};switch(o){case void 0:t[r]=s;break;case Ot.PackageData:t[r]=s;break;case Ot.UserData:t[r]="REDACTED (UserData)";break;default:t[r]="REDACTED (unknown tag)";break}}this.logger.send(t)}}class at extends qt{constructor(e,t,r){super(t,r),this.baseLogger=e,YC(e)&&Ag(this,new $h(e.config))}static create(e,t,r){if(e instanceof at){const i={};for(const o of[e.properties,r])o!==void 0&&(o.all!==void 0&&(i.all=Object.assign(Object.assign({},i.all),o.all)),o.error!==void 0&&(i.error=Object.assign(Object.assign({},i.error),o.error)));const s=e.namespace===void 0?t:t===void 0?e.namespace:`${e.namespace}${qt.eventNamespaceSeparator}${t}`;return new at(e.baseLogger,s,i)}return new at(e||new _z,t,r)}send(e){this.baseLogger.send(this.prepareEvent(e))}}class DO extends qt{constructor(e,t){super(e,t),this.loggers=[]}addLogger(e){e!=null&&this.loggers.push(e)}send(e){const t=this.prepareEvent(e);this.loggers.forEach(r=>{r.send(t)})}}class dt{constructor(e,t,r={end:!0,cancel:"generic"}){this.logger=e,this.markers=r,this.startTime=Sh.now(),this.event=Object.assign({},t),this.markers.start&&this.reportEvent("start"),typeof window=="object"&&window!=null&&window.performance&&(this.startMark=`${t.eventName}-start`,window.performance.mark(this.startMark))}static start(e,t,r){return new dt(e,t,r)}static timedExec(e,t,r,i){const s=dt.start(e,t,i);try{const o=r(s);return s.autoEnd(),o}catch(o){throw s.cancel(void 0,o),o}}static async timedExecAsync(e,t,r,i){const s=dt.start(e,t,i);try{const o=await r(s);return s.autoEnd(),o}catch(o){throw s.cancel(void 0,o),o}}get duration(){return Sh.now()-this.startTime}reportProgress(e,t="update"){this.reportEvent(t,e)}autoEnd(){this.event&&this.markers.end&&this.reportEvent("end"),this.performanceEndMark(),this.event=void 0}end(e){this.reportEvent("end",e),this.performanceEndMark(),this.event=void 0}performanceEndMark(){if(this.startMark&&this.event){const e=`${this.event.eventName}-end`;window.performance.mark(e),window.performance.measure(`${this.event.eventName}`,this.startMark,e),this.startMark=void 0}}cancel(e,t){this.markers.cancel!==void 0&&this.reportEvent("cancel",Object.assign({category:this.markers.cancel},e),t),this.event=void 0}reportEvent(e,t,r){if(!this.event)return;const i=Object.assign(Object.assign({},this.event),t);i.eventName=`${i.eventName}_${e}`,e!=="start"&&(i.duration=this.duration),this.logger.sendPerformanceEvent(i,r)}}class Vz{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){this.reportError("errorEvent in UT logger!",e,t)}sendPerformanceEvent(e,t){}logGenericError(e,t){this.reportError("genericError in UT logger!",{eventName:e},t)}logException(e,t){this.reportError("exception in UT logger!",e,t)}debugAssert(e,t){this.reportError("debugAssert in UT logger!")}shipAssert(e,t){this.reportError("shipAssert in UT logger!")}reportError(e,t,r){const i=new Error(e);throw i.error=i,i.event=t,console.error(e),console.error(i),i}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Nl extends qt{constructor(e,t,r){super(void 0,r),this.debug=e,this.debugErr=t}static create(e,t){const r=Pb.debug(e),i=Pb.debug(e);return i.log=console.error.bind(console),i.enabled=!0,new Nl(r,i,t)}static mixinDebugLogger(e,t,r){if(!t)return Nl.create(e,r);const i=new DO(void 0,r);return i.addLogger(Nl.create(e,this.tryGetBaseLoggerProps(t))),i.addLogger(at.create(t,e)),i}static tryGetBaseLoggerProps(e){if(e instanceof qt)return e.properties}send(e){const t=this.prepareEvent(e),r=t.category==="error";let i=r?this.debugErr:this.debug;const s=e.eventName.lastIndexOf(qt.eventNamespaceSeparator),o=e.eventName.substring(s+1);s>0&&(i=i.extend(e.eventName.substring(0,s))),t.eventName=void 0;let u="";u=`tick=${qt.formatTick(Sh.now())}`;const d=t.stack?t.stack:"";t.stack=void 0;let f;try{f=JSON.stringify(t)}catch{t.error=void 0,f=JSON.stringify(t)}f==="{}"&&(f=""),r&&(i.enabled=!0),i(`${o} ${f} ${u} ${d}`)}}class Fg extends Rz{constructor(e){super(),this.errorHandler=e}emit(e,...t){try{return super.emit(e,...t)}catch(r){return this.errorHandler(e,r),!0}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const ix="connected",sx="disconnected";function LO(n,e,t,...r){try{n.emit(t,...r)}catch(i){e.sendErrorEvent({eventName:"RaiseEventError",event:t},i)}}function Ng(n,e,t,r){try{t?e.emit(ix,r):e.emit(sx)}catch(i){n.sendErrorEvent({eventName:"RaiseConnectedEventError"},i)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ox extends qt{constructor(){super(),this.events=[]}clear(){this.events=[]}send(e){this.events.push(e)}matchEvents(e){const t=this.getMatchedEventsCount(e);return e.length-t===0}assertMatch(e,t){const r=this.events;if(!this.matchEvents(e))throw new Error(`${t}
expected:
${JSON.stringify(e)}

actual:
${JSON.stringify(r)}`)}matchAnyEvent(e){return this.getMatchedEventsCount(e)>0}assertMatchAny(e,t){const r=this.events;if(!this.matchAnyEvent(e))throw new Error(`${t}
expected:
${JSON.stringify(e)}

actual:
${JSON.stringify(r)}`)}getMatchedEventsCount(e){let t=0;return this.events.forEach(r=>{t<e.length&&ox.eventsMatch(r,e[t])&&++t}),this.events=[],t}static eventsMatch(e,t){const r=Object.assign(Object.assign({},e),t);return JSON.stringify(r)===JSON.stringify(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ax{constructor(e,t,r=e){this.threshold=e,this.logger=t,this.thresholdMultiple=r}send(e,t){t<this.threshold||this.logger.sendPerformanceEvent({eventName:e,value:t})}sendIfMultiple(e,t){t===this.thresholdMultiple&&(this.logger.sendPerformanceEvent({eventName:e,value:t}),this.thresholdMultiple=this.thresholdMultiple*2)}}function MO(n,e,t){if(n)return!0;const r=typeof t=="string"?{eventName:t,category:"error"}:Object.assign({category:"error"},t);return e.send(r),!1}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Rb{constructor(e,t,r,i=!1,s=new Map){this.eventBase=e,this.logger=t,this.sampleThreshold=r,this.includeAggregateMetrics=i,this.perBucketProperties=s,this.disposed=!1,this.measurementsMap=new Map}measure(e,t=""){var r,i,s;const o=Sh.now(),u=e(),d=Sh.now()-o;let f=this.measurementsMap.get(t);return f===void 0&&(f={count:0,duration:-1},this.measurementsMap.set(t,f)),f.count++,f.duration=d,this.includeAggregateMetrics&&(f.totalDuration=((r=f.totalDuration)!==null&&r!==void 0?r:0)+d,f.minDuration=Math.min((i=f.minDuration)!==null&&i!==void 0?i:d,d),f.maxDuration=Math.max((s=f.maxDuration)!==null&&s!==void 0?s:0,d)),f.count>=this.sampleThreshold&&this.flushBucket(t),u}flushBucket(e){const t=this.measurementsMap.get(e);if(t!==void 0&&t.count!==0){const r=this.perBucketProperties.get(e),i=Object.assign(Object.assign(Object.assign({},this.eventBase),r),t);this.logger.sendPerformanceEvent(i),this.measurementsMap.delete(e)}}dispose(e){this.measurementsMap.forEach((t,r)=>this.flushBucket(r))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Wz=Object.freeze(Object.defineProperty({__proto__:null,ChildLogger:at,DebugLogger:Nl,EventEmitterWithErrorHandling:Fg,LoggingError:st,MockLogger:ox,MultiSinkLogger:DO,PerformanceEvent:dt,SampledTelemetryHelper:Rb,TaggedLoggerAdapter:NO,get TelemetryDataTag(){return Ot},TelemetryLogger:qt,TelemetryUTLogger:Vz,ThresholdCounter:ax,connectedEventName:ix,disconnectedEventName:sx,extractLogSafeErrorProperties:kg,generateErrorWithStack:Hh,generateStack:AO,getCircularReplacer:FO,hasErrorInstanceId:ZC,isExternalError:rx,isFluidError:ex,isILoggingError:Og,isTaggedTelemetryPropertyValue:OO,isValidLegacyError:tx,logIfFalse:MO,loggerToMonitoringContext:Iu,mixinMonitoringContext:Ag,normalizeError:Oi,raiseConnectedEvent:Ng,safeRaiseEvent:LO,sessionStorageConfigProvider:XC,wrapError:Vh,wrapErrorAndLog:nx},Symbol.toStringTag,{value:"Module"}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ro extends st{constructor(e,t,r){super(e,r,new Set(["error"])),this.error=t,this.errorType=po.genericError}}class ux extends st{constructor(e,t,r){super(e,r),this.retryAfterSeconds=t,this.errorType=po.throttlingError}static wrap(e,t,r){return nx(e,s=>new ux(s,t),r)}}class Ct extends st{constructor(e){super(e,{usageError:!0}),this.errorType="usageError"}}class Gz extends st{constructor(e,t){super(e,{timeoutMs:t}),this.expiryMs=t,this.errorType=po.clientSessionExpiredError}}class Rs extends st{constructor(e,t){super(e,Object.assign(Object.assign({},t),{dataProcessingError:1})),this.errorType=po.dataCorruptionError,this.canRetry=!1}}class pi extends st{constructor(e){super(e),this.errorType=po.dataProcessingError,this.canRetry=!1}static create(e,t,r,i={}){const s=pi.wrapIfUnrecognized(e,t,r);return s.addTelemetryProperties(i),s}static wrapIfUnrecognized(e,t,r){const i=Object.assign({dataProcessingError:1,dataProcessingCodepath:t},r===void 0?void 0:mu(r)),s=Oi(e,{props:i});if(!rx(s))return s;const o=Vh(s,u=>new pi(u));return o.addTelemetryProperties(s.getTelemetryProperties()),o}}const mu=n=>({messageClientId:n.clientId,messageSequenceNumber:n.sequenceNumber,messageClientSequenceNumber:n.clientSequenceNumber,messageReferenceSequenceNumber:n.referenceSequenceNumber,messageMinimumSequenceNumber:n.minimumSequenceNumber,messageTimestamp:n.timestamp});/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class lx{constructor(e){this.internalStorageService=e}set policies(e){this._policies=e}get policies(){var e;return(e=this._policies)!==null&&e!==void 0?e:this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.internalStorageService.getSnapshotTree(e,t)}async getVersions(e,t,r){return this.internalStorageService.getVersions(e,t,r)}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.internalStorageService.downloadSummary(e)}async createBlob(e){return this.internalStorageService.createBlob(e)}async readBlob(e){return this.internalStorageService.readBlob(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Kz extends lx{constructor(e,t){super(e),this.blobs=t}get policies(){return this.internalStorageService.policies}async readBlob(e){const t=this.blobs.get(e);return t!==void 0?t:this.internalStorageService.readBlob(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var su;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(su||(su={}));var FT;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(FT||(FT={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Bm;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(Bm||(Bm={}));var Vd;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(Vd||(Vd={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var eu;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(eu||(eu={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function At(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Jz(n,e){switch(e){case"base64":return yi(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const Qz=(n,e)=>cx.from(n,e).buffer,Xz=(n,e)=>cx.from(n).toString(e);function NT(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let cx=class La extends Uint8Array{toString(e){return Jz(this,e)}static from(e,t,r){if(typeof e=="string")return La.fromString(e,t);if(e!==null&&typeof e=="object"&&NT(e.buffer))return At(e.byteOffset===0,0),At(e.byteLength===e.buffer.byteLength,1),La.fromArrayBuffer(e.buffer,t,r);if(NT(e))return La.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new La(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=js(r);return new La(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new La(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const No=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let BO=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Yz=async n=>new Promise(e=>setTimeout(()=>e(),n));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Do;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Do||(Do={}));var DT;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(DT||(DT={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var gu;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(gu||(gu={}));var bh;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(bh||(bh={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var xs;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(xs||(xs={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function _b(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let dx=class extends Fn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function jO(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Zz(n){const e=n.type===xs.Handle?n.handleType:n.type;switch(e){case xs.Blob:case xs.Attachment:return gu.File;case xs.Tree:return gu.Directory;default:jO(e,`Unknown type: ${e}`)}}function qO(n){const e=n.type===xs.Handle?n.handleType:n.type;switch(e){case xs.Blob:case xs.Attachment:return"blob";case xs.Tree:return"tree";default:jO(e,`Unknown type: ${e}`)}}function hx(n,e=new Map,t=!1){const r={},i={id:n.sha,blobs:{},trees:{}};r[""]=i;for(const s of n.tree){const o=t?s.path.replace(/^\.app\//,""):s.path,u=o.lastIndexOf("/"),d=o.slice(0,Math.max(0,u)),f=o.slice(u+1),m=r[d];if(s.type==="tree"){const g={id:s.sha,blobs:{},commits:{},trees:{}};m.trees[decodeURIComponent(f)]=g,r[o]=g}else if(s.type==="blob")m.blobs[decodeURIComponent(f)]=s.sha,e.set(s.sha,`/${o}`);else throw new Error("Unknown entry type!!")}return i}class UO{constructor(e,t,r="utf-8"){this.path=e,this.mode=gu.File,this.type=bh.Blob,this.value={contents:t,encoding:r}}}class e${constructor(e,t){this.path=e,this.value=t,this.mode=gu.Directory,this.type=bh.Tree}}class t${constructor(e,t){this.path=e,this.id=t,this.mode=gu.File,this.type=bh.Attachment,this.value={id:t}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class LT{constructor(e,t,r,i){this.sequenceNumber=e,this.key=t,this.value=r,this.local=i}}class n$ extends dx{constructor(e){super(),this.isDisposed=!1,this.members=new Map(e),this.snapshotCache=e}get disposed(){return this.isDisposed}snapshot(){var e;return(e=this.snapshotCache)!==null&&e!==void 0||(this.snapshotCache=ia(Array.from(this.members))),this.snapshotCache}addMember(e,t){_b(!this.members.has(e),462),this.members.set(e,t),this.emit("addMember",e,t),this.snapshotCache=void 0}removeMember(e){_b(this.members.has(e),463),this.members.delete(e),this.emit("removeMember",e),this.snapshotCache=void 0}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}dispose(){this.isDisposed=!0}}class r$ extends dx{constructor(e,t){super(),this.sendProposal=t,this.isDisposed=!1,this.stateEvents=new Fn.EventEmitter,this.proposals=new Map(e.proposals.map(([,r])=>[r.sequenceNumber,new LT(r.sequenceNumber,r.key,r.value,!1)])),this.values=new Map(e.values),this.proposalsSnapshotCache=e.proposals,this.valuesSnapshotCache=e.values}get disposed(){return this.isDisposed}snapshot(){var e,t;return(e=this.proposalsSnapshotCache)!==null&&e!==void 0||(this.proposalsSnapshotCache=Array.from(this.proposals).map(([r,i])=>[r,{sequenceNumber:r,key:i.key,value:i.value},[]])),(t=this.valuesSnapshotCache)!==null&&t!==void 0||(this.valuesSnapshotCache=ia(Array.from(this.values))),{proposals:this.proposalsSnapshotCache,values:this.valuesSnapshotCache}}has(e){return this.values.has(e)}get(e){var t;return(t=this.values.get(e))===null||t===void 0?void 0:t.value}getApprovalData(e){const t=this.values.get(e);return t?ia(t):void 0}async propose(e,t){const r=this.sendProposal(e,t);if(r<0)throw this.emit("error",{eventName:"ProposalInDisconnectedState",key:e}),new Error("Can't propose in disconnected state");return new Promise((i,s)=>{let o;const u=(P,D)=>{P===r&&(o=D,this.stateEvents.off("localProposalSequenced",u),this.stateEvents.off("disconnected",f),this.stateEvents.on("localProposalApproved",d))},d=P=>{P===o&&(i(),g())},f=()=>{o===void 0&&this.stateEvents.once("connected",()=>{o===void 0&&(s(new Error("Client disconnected without successfully sending proposal")),g())})},m=()=>{s(new Error("QuorumProposals was disposed")),g()},g=()=>{this.stateEvents.off("localProposalSequenced",u),this.stateEvents.off("localProposalApproved",d),this.stateEvents.off("disconnected",f),this.stateEvents.off("disposed",m)};this.stateEvents.on("localProposalSequenced",u),this.stateEvents.on("disconnected",f),this.stateEvents.on("disposed",m)})}addProposal(e,t,r,i,s){_b(!this.proposals.has(r),464);const o=new LT(r,e,t,i);this.proposals.set(r,o),this.emit("addProposal",o),i&&this.stateEvents.emit("localProposalSequenced",s,r),this.proposalsSnapshotCache=void 0}updateMinimumSequenceNumber(e){const t=e.minimumSequenceNumber,r=[];for(const[i,s]of this.proposals)i<=t&&r.push(s);r.sort((i,s)=>i.sequenceNumber-s.sequenceNumber);for(const i of r){const s={approvalSequenceNumber:e.sequenceNumber,commitSequenceNumber:-1,key:i.key,sequenceNumber:i.sequenceNumber,value:i.value};this.values.set(s.key,s),this.valuesSnapshotCache=void 0,this.emit("approveProposal",s.sequenceNumber,s.key,s.value,s.approvalSequenceNumber),this.proposals.delete(i.sequenceNumber),this.proposalsSnapshotCache=void 0,i.local&&this.stateEvents.emit("localProposalApproved",i.sequenceNumber)}}setConnectionState(e){e?this.stateEvents.emit("connected"):this.stateEvents.emit("disconnected")}dispose(){this.isDisposed=!0,this.stateEvents.emit("disposed")}}class i$ extends dx{constructor(e,t,r,i){super(),this.isDisposed=!1,this.quorumClients=new n$(e),this.quorumClients.on("addMember",(s,o)=>{this.emit("addMember",s,o)}),this.quorumClients.on("removeMember",s=>{this.emit("removeMember",s)}),this.quorumProposals=new r$({proposals:t,values:r},i),this.quorumProposals.on("addProposal",s=>{this.emit("addProposal",s)}),this.quorumProposals.on("approveProposal",(s,o,u,d)=>{this.emit("approveProposal",s,o,u,d)})}get disposed(){return this.isDisposed}close(){this.removeAllListeners()}snapshot(){const e=this.quorumClients.snapshot(),{proposals:t,values:r}=this.quorumProposals.snapshot();return{members:e,proposals:t,values:r}}has(e){return this.quorumProposals.has(e)}get(e){return this.quorumProposals.get(e)}getApprovalData(e){return this.quorumProposals.getApprovalData(e)}addMember(e,t){this.quorumClients.addMember(e,t)}removeMember(e){this.quorumClients.removeMember(e)}getMembers(){return this.quorumClients.getMembers()}getMember(e){return this.quorumClients.getMember(e)}async propose(e,t){return this.quorumProposals.propose(e,t)}addProposal(e,t,r,i,s){return this.quorumProposals.addProposal(e,t,r,i,s)}updateMinimumSequenceNumber(e){this.quorumProposals.updateMinimumSequenceNumber(e)}setConnectionState(e,t){this.quorumProposals.setConnectionState(e)}dispose(){throw new Error("Not implemented.")}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class s${constructor(e,t,r,i,s,o,u){this.minimumSequenceNumber=e,this.sequenceNumber=t,this.term=r??1,this._quorum=new i$(i,s,o,u)}get quorum(){return this._quorum}get attributes(){return{minimumSequenceNumber:this.minimumSequenceNumber,sequenceNumber:this.sequenceNumber,term:this.term}}setConnectionState(e,t){this._quorum.setConnectionState(e,t)}snapshot(){return this._quorum.snapshot()}close(){this._quorum.close()}processMessage(e,t){if(e.sequenceNumber!==this.sequenceNumber+1)throw new Error(`Protocol state is not moving sequentially. Current is ${this.sequenceNumber}. Next is ${e.sequenceNumber}`);this.sequenceNumber=e.sequenceNumber,this.minimumSequenceNumber=e.minimumSequenceNumber;let r=!1;switch(e.type){case Do.ClientJoin:const i=e,s=JSON.parse(i.data),o={client:s.detail,sequenceNumber:i.sequenceNumber};this._quorum.addMember(s.clientId,o);break;case Do.ClientLeave:const d=JSON.parse(e.data);this._quorum.removeMember(d);break;case Do.Propose:const f=e.contents;this._quorum.addProposal(f.key,f.value,e.sequenceNumber,t,e.clientSequenceNumber),r=!0;break;case Do.Reject:throw new Error("Quorum rejection is removed.")}return this._quorum.updateMinimumSequenceNumber(e),{immediateNoOp:r}}getProtocolState(){return Object.assign({sequenceNumber:this.sequenceNumber,minimumSequenceNumber:this.minimumSequenceNumber},this._quorum.snapshot())}}class o$ extends s${processMessage(e,t){const r=this._quorum.getMember(e.clientId);if(e.clientId!=null){if(r===void 0&&e.type!==Do.ClientJoin)throw new Error("Remote message's clientId is missing from the quorum");if((r==null?void 0:r.shouldHaveLeft)===!0&&e.type!==Do.NoOp)throw new Error("Remote message's clientId already should have left")}return super.processMessage(e,t)}}var vp,a$=new Uint8Array(16);function u$(){if(!vp&&(vp=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!vp))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vp(a$)}const l$=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function c$(n){return typeof n=="string"&&l$.test(n)}var Bn=[];for(var Oy=0;Oy<256;++Oy)Bn.push((Oy+256).toString(16).substr(1));function d$(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Bn[n[e+0]]+Bn[n[e+1]]+Bn[n[e+2]]+Bn[n[e+3]]+"-"+Bn[n[e+4]]+Bn[n[e+5]]+"-"+Bn[n[e+6]]+Bn[n[e+7]]+"-"+Bn[n[e+8]]+Bn[n[e+9]]+"-"+Bn[n[e+10]]+Bn[n[e+11]]+Bn[n[e+12]]+Bn[n[e+13]]+Bn[n[e+14]]+Bn[n[e+15]]).toLowerCase();if(!c$(t))throw TypeError("Stringified UUID is invalid");return t}function h$(n,e,t){n=n||{};var r=n.random||(n.rng||u$)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return d$(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function zO(n,e,t){const r=[];for(const i of e){const s=`${n}${i.path}`;if(i.type===Vd.Blob){const o=i.value,u=Qz(o.contents,o.encoding),d=h$();t.set(d,u);const f={mode:Bm[i.mode],path:s,sha:d,size:0,type:"blob",url:""};r.push(f)}else if(i.type===Vd.Tree){At(i.type===Vd.Tree,257);const o=i.value,u={mode:Bm[i.mode],path:s,sha:"",size:-1,type:"tree",url:""};r.push(u);const d=zO(`${s}/`,o.entries,t);r.push(...d)}}return r}function f$(n,e){return{sha:"",tree:zO("",n,e),url:""}}function $O(n,e){const t=f$(n,e);return hx(t)}var jm={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */jm.exports;(function(n,e){(function(t){var r=e&&!e.nodeType&&e,i=n&&!n.nodeType&&n,s=typeof Ne=="object"&&Ne;(s.global===s||s.window===s||s.self===s)&&(t=s);var o,u=2147483647,d=36,f=1,m=26,g=38,P=700,D=72,M=128,U="-",j=/^xn--/,E=/[^\x20-\x7E]/,k=/[\x2E\u3002\uFF0E\uFF61]/g,z={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},K=d-f,ie=Math.floor,he=String.fromCharCode,pe;function X(Ae){throw new RangeError(z[Ae])}function fe(Ae,Ce){for(var Ve=Ae.length,qe=[];Ve--;)qe[Ve]=Ce(Ae[Ve]);return qe}function ge(Ae,Ce){var Ve=Ae.split("@"),qe="";Ve.length>1&&(qe=Ve[0]+"@",Ae=Ve[1]),Ae=Ae.replace(k,".");var lt=Ae.split("."),ee=fe(lt,Ce).join(".");return qe+ee}function we(Ae){for(var Ce=[],Ve=0,qe=Ae.length,lt,ee;Ve<qe;)lt=Ae.charCodeAt(Ve++),lt>=55296&&lt<=56319&&Ve<qe?(ee=Ae.charCodeAt(Ve++),(ee&64512)==56320?Ce.push(((lt&1023)<<10)+(ee&1023)+65536):(Ce.push(lt),Ve--)):Ce.push(lt);return Ce}function be(Ae){return fe(Ae,function(Ce){var Ve="";return Ce>65535&&(Ce-=65536,Ve+=he(Ce>>>10&1023|55296),Ce=56320|Ce&1023),Ve+=he(Ce),Ve}).join("")}function He(Ae){return Ae-48<10?Ae-22:Ae-65<26?Ae-65:Ae-97<26?Ae-97:d}function ce(Ae,Ce){return Ae+22+75*(Ae<26)-((Ce!=0)<<5)}function ve(Ae,Ce,Ve){var qe=0;for(Ae=Ve?ie(Ae/P):Ae>>1,Ae+=ie(Ae/Ce);Ae>K*m>>1;qe+=d)Ae=ie(Ae/K);return ie(qe+(K+1)*Ae/(Ae+g))}function De(Ae){var Ce=[],Ve=Ae.length,qe,lt=0,ee=M,bt=D,Et,en,er,mn,Ee,Nn,tr,gn,Mi;for(Et=Ae.lastIndexOf(U),Et<0&&(Et=0),en=0;en<Et;++en)Ae.charCodeAt(en)>=128&&X("not-basic"),Ce.push(Ae.charCodeAt(en));for(er=Et>0?Et+1:0;er<Ve;){for(mn=lt,Ee=1,Nn=d;er>=Ve&&X("invalid-input"),tr=He(Ae.charCodeAt(er++)),(tr>=d||tr>ie((u-lt)/Ee))&&X("overflow"),lt+=tr*Ee,gn=Nn<=bt?f:Nn>=bt+m?m:Nn-bt,!(tr<gn);Nn+=d)Mi=d-gn,Ee>ie(u/Mi)&&X("overflow"),Ee*=Mi;qe=Ce.length+1,bt=ve(lt-mn,qe,mn==0),ie(lt/qe)>u-ee&&X("overflow"),ee+=ie(lt/qe),lt%=qe,Ce.splice(lt++,0,ee)}return be(Ce)}function Xe(Ae){var Ce,Ve,qe,lt,ee,bt,Et,en,er,mn,Ee,Nn=[],tr,gn,Mi,Br;for(Ae=we(Ae),tr=Ae.length,Ce=M,Ve=0,ee=D,bt=0;bt<tr;++bt)Ee=Ae[bt],Ee<128&&Nn.push(he(Ee));for(qe=lt=Nn.length,lt&&Nn.push(U);qe<tr;){for(Et=u,bt=0;bt<tr;++bt)Ee=Ae[bt],Ee>=Ce&&Ee<Et&&(Et=Ee);for(gn=qe+1,Et-Ce>ie((u-Ve)/gn)&&X("overflow"),Ve+=(Et-Ce)*gn,Ce=Et,bt=0;bt<tr;++bt)if(Ee=Ae[bt],Ee<Ce&&++Ve>u&&X("overflow"),Ee==Ce){for(en=Ve,er=d;mn=er<=ee?f:er>=ee+m?m:er-ee,!(en<mn);er+=d)Br=en-mn,Mi=d-mn,Nn.push(he(ce(mn+Br%Mi,0))),en=ie(Br/Mi);Nn.push(he(ce(en,0))),ee=ve(Ve,gn,qe==lt),Ve=0,++qe}++Ve,++Ce}return Nn.join("")}function Re(Ae){return ge(Ae,function(Ce){return j.test(Ce)?De(Ce.slice(4).toLowerCase()):Ce})}function je(Ae){return ge(Ae,function(Ce){return E.test(Ce)?"xn--"+Xe(Ce):Ce})}if(o={version:"1.4.1",ucs2:{decode:we,encode:be},decode:De,encode:Xe,toASCII:je,toUnicode:Re},r&&i)if(n.exports==r)i.exports=o;else for(pe in o)o.hasOwnProperty(pe)&&(r[pe]=o[pe]);else t.punycode=o})(Ne)})(jm,jm.exports);var p$=jm.exports,m$=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var s=Object.getOwnPropertySymbols(e);if(s.length!==1||s[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(e,t);if(o.value!==i||o.enumerable!==!0)return!1}return!0},MT=typeof Symbol<"u"&&Symbol,g$=m$,v$=function(){return typeof MT!="function"||typeof Symbol!="function"||typeof MT("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:g$()},BT={foo:{}},y$=Object,S$=function(){return{__proto__:BT}.foo===BT.foo&&!({__proto__:null}instanceof y$)},b$="Function.prototype.bind called on incompatible ",Fy=Array.prototype.slice,w$=Object.prototype.toString,C$="[object Function]",x$=function(e){var t=this;if(typeof t!="function"||w$.call(t)!==C$)throw new TypeError(b$+t);for(var r=Fy.call(arguments,1),i,s=function(){if(this instanceof i){var m=t.apply(this,r.concat(Fy.call(arguments)));return Object(m)===m?m:this}else return t.apply(e,r.concat(Fy.call(arguments)))},o=Math.max(0,t.length-r.length),u=[],d=0;d<o;d++)u.push("$"+d);if(i=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(s),t.prototype){var f=function(){};f.prototype=t.prototype,i.prototype=new f,f.prototype=null}return i},E$=x$,fx=Function.prototype.bind||E$,T$=fx,P$=T$.call(Function.call,Object.prototype.hasOwnProperty),ct,Yl=SyntaxError,HO=Function,Dl=TypeError,Ny=function(n){try{return HO('"use strict"; return ('+n+").constructor;")()}catch{}},ou=Object.getOwnPropertyDescriptor;if(ou)try{ou({},"")}catch{ou=null}var Dy=function(){throw new Dl},R$=ou?function(){try{return arguments.callee,Dy}catch{try{return ou(arguments,"callee").get}catch{return Dy}}}():Dy,Xu=v$(),_$=S$(),In=Object.getPrototypeOf||(_$?function(n){return n.__proto__}:null),al={},I$=typeof Uint8Array>"u"||!In?ct:In(Uint8Array),au={"%AggregateError%":typeof AggregateError>"u"?ct:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?ct:ArrayBuffer,"%ArrayIteratorPrototype%":Xu&&In?In([][Symbol.iterator]()):ct,"%AsyncFromSyncIteratorPrototype%":ct,"%AsyncFunction%":al,"%AsyncGenerator%":al,"%AsyncGeneratorFunction%":al,"%AsyncIteratorPrototype%":al,"%Atomics%":typeof Atomics>"u"?ct:Atomics,"%BigInt%":typeof BigInt>"u"?ct:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?ct:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?ct:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?ct:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?ct:Float32Array,"%Float64Array%":typeof Float64Array>"u"?ct:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?ct:FinalizationRegistry,"%Function%":HO,"%GeneratorFunction%":al,"%Int8Array%":typeof Int8Array>"u"?ct:Int8Array,"%Int16Array%":typeof Int16Array>"u"?ct:Int16Array,"%Int32Array%":typeof Int32Array>"u"?ct:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Xu&&In?In(In([][Symbol.iterator]())):ct,"%JSON%":typeof JSON=="object"?JSON:ct,"%Map%":typeof Map>"u"?ct:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Xu||!In?ct:In(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?ct:Promise,"%Proxy%":typeof Proxy>"u"?ct:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?ct:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?ct:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Xu||!In?ct:In(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?ct:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Xu&&In?In(""[Symbol.iterator]()):ct,"%Symbol%":Xu?Symbol:ct,"%SyntaxError%":Yl,"%ThrowTypeError%":R$,"%TypedArray%":I$,"%TypeError%":Dl,"%Uint8Array%":typeof Uint8Array>"u"?ct:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?ct:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?ct:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?ct:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?ct:WeakMap,"%WeakRef%":typeof WeakRef>"u"?ct:WeakRef,"%WeakSet%":typeof WeakSet>"u"?ct:WeakSet};if(In)try{null.error}catch(n){var A$=In(In(n));au["%Error.prototype%"]=A$}var k$=function n(e){var t;if(e==="%AsyncFunction%")t=Ny("async function () {}");else if(e==="%GeneratorFunction%")t=Ny("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Ny("async function* () {}");else if(e==="%AsyncGenerator%"){var r=n("%AsyncGeneratorFunction%");r&&(t=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=n("%AsyncGenerator%");i&&In&&(t=In(i.prototype))}return au[e]=t,t},jT={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Gh=fx,qm=P$,O$=Gh.call(Function.call,Array.prototype.concat),F$=Gh.call(Function.apply,Array.prototype.splice),qT=Gh.call(Function.call,String.prototype.replace),Um=Gh.call(Function.call,String.prototype.slice),N$=Gh.call(Function.call,RegExp.prototype.exec),D$=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,L$=/\\(\\)?/g,M$=function(e){var t=Um(e,0,1),r=Um(e,-1);if(t==="%"&&r!=="%")throw new Yl("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&t!=="%")throw new Yl("invalid intrinsic syntax, expected opening `%`");var i=[];return qT(e,D$,function(s,o,u,d){i[i.length]=u?qT(d,L$,"$1"):o||s}),i},B$=function(e,t){var r=e,i;if(qm(jT,r)&&(i=jT[r],r="%"+i[0]+"%"),qm(au,r)){var s=au[r];if(s===al&&(s=k$(r)),typeof s>"u"&&!t)throw new Dl("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:s}}throw new Yl("intrinsic "+e+" does not exist!")},px=function(e,t){if(typeof e!="string"||e.length===0)throw new Dl("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new Dl('"allowMissing" argument must be a boolean');if(N$(/^%?[^%]*%?$/,e)===null)throw new Yl("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=M$(e),i=r.length>0?r[0]:"",s=B$("%"+i+"%",t),o=s.name,u=s.value,d=!1,f=s.alias;f&&(i=f[0],F$(r,O$([0,1],f)));for(var m=1,g=!0;m<r.length;m+=1){var P=r[m],D=Um(P,0,1),M=Um(P,-1);if((D==='"'||D==="'"||D==="`"||M==='"'||M==="'"||M==="`")&&D!==M)throw new Yl("property names with quotes must have matching quotes");if((P==="constructor"||!g)&&(d=!0),i+="."+P,o="%"+i+"%",qm(au,o))u=au[o];else if(u!=null){if(!(P in u)){if(!t)throw new Dl("base intrinsic for "+e+" exists, but the property is not available.");return}if(ou&&m+1>=r.length){var U=ou(u,P);g=!!U,g&&"get"in U&&!("originalValue"in U.get)?u=U.get:u=u[P]}else g=qm(u,P),u=u[P];g&&!d&&(au[o]=u)}}return u},VO={exports:{}};(function(n){var e=fx,t=px,r=t("%Function.prototype.apply%"),i=t("%Function.prototype.call%"),s=t("%Reflect.apply%",!0)||e.call(i,r),o=t("%Object.getOwnPropertyDescriptor%",!0),u=t("%Object.defineProperty%",!0),d=t("%Math.max%");if(u)try{u({},"a",{value:1})}catch{u=null}n.exports=function(g){var P=s(e,i,arguments);if(o&&u){var D=o(P,"length");D.configurable&&u(P,"length",{value:1+d(0,g.length-(arguments.length-1))})}return P};var f=function(){return s(e,r,arguments)};u?u(n.exports,"apply",{value:f}):n.exports.apply=f})(VO);var j$=VO.exports,WO=px,GO=j$,q$=GO(WO("String.prototype.indexOf")),U$=function(e,t){var r=WO(e,!!t);return typeof r=="function"&&q$(e,".prototype.")>-1?GO(r):r};const z$={},$$=Object.freeze(Object.defineProperty({__proto__:null,default:z$},Symbol.toStringTag,{value:"Module"})),H$=Li($$);var mx=typeof Map=="function"&&Map.prototype,Ly=Object.getOwnPropertyDescriptor&&mx?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,zm=mx&&Ly&&typeof Ly.get=="function"?Ly.get:null,UT=mx&&Map.prototype.forEach,gx=typeof Set=="function"&&Set.prototype,My=Object.getOwnPropertyDescriptor&&gx?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,$m=gx&&My&&typeof My.get=="function"?My.get:null,zT=gx&&Set.prototype.forEach,V$=typeof WeakMap=="function"&&WeakMap.prototype,Wd=V$?WeakMap.prototype.has:null,W$=typeof WeakSet=="function"&&WeakSet.prototype,Gd=W$?WeakSet.prototype.has:null,G$=typeof WeakRef=="function"&&WeakRef.prototype,$T=G$?WeakRef.prototype.deref:null,K$=Boolean.prototype.valueOf,J$=Object.prototype.toString,Q$=Function.prototype.toString,X$=String.prototype.match,vx=String.prototype.slice,Lo=String.prototype.replace,Y$=String.prototype.toUpperCase,HT=String.prototype.toLowerCase,KO=RegExp.prototype.test,VT=Array.prototype.concat,Ss=Array.prototype.join,Z$=Array.prototype.slice,WT=Math.floor,Ib=typeof BigInt=="function"?BigInt.prototype.valueOf:null,By=Object.getOwnPropertySymbols,Ab=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Zl=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Er=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Zl||"symbol")?Symbol.toStringTag:null,JO=Object.prototype.propertyIsEnumerable,GT=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(n){return n.__proto__}:null);function KT(n,e){if(n===1/0||n===-1/0||n!==n||n&&n>-1e3&&n<1e3||KO.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof n=="number"){var r=n<0?-WT(-n):WT(n);if(r!==n){var i=String(r),s=vx.call(e,i.length+1);return Lo.call(i,t,"$&_")+"."+Lo.call(Lo.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Lo.call(e,t,"$&_")}var kb=H$,JT=kb.custom,QT=XO(JT)?JT:null,eH=function n(e,t,r,i){var s=t||{};if(Io(s,"quoteStyle")&&s.quoteStyle!=="single"&&s.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Io(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=Io(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Io(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Io(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var u=s.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return ZO(e,s);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var d=String(e);return u?KT(e,d):d}if(typeof e=="bigint"){var f=String(e)+"n";return u?KT(e,f):f}var m=typeof s.depth>"u"?5:s.depth;if(typeof r>"u"&&(r=0),r>=m&&m>0&&typeof e=="object")return Ob(e)?"[Array]":"[Object]";var g=yH(s,r);if(typeof i>"u")i=[];else if(YO(i,e)>=0)return"[Circular]";function P(He,ce,ve){if(ce&&(i=Z$.call(i),i.push(ce)),ve){var De={depth:s.depth};return Io(s,"quoteStyle")&&(De.quoteStyle=s.quoteStyle),n(He,De,r+1,i)}return n(He,s,r+1,i)}if(typeof e=="function"&&!XT(e)){var D=lH(e),M=yp(e,P);return"[Function"+(D?": "+D:" (anonymous)")+"]"+(M.length>0?" { "+Ss.call(M,", ")+" }":"")}if(XO(e)){var U=Zl?Lo.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Ab.call(e);return typeof e=="object"&&!Zl?dd(U):U}if(mH(e)){for(var j="<"+HT.call(String(e.nodeName)),E=e.attributes||[],k=0;k<E.length;k++)j+=" "+E[k].name+"="+QO(tH(E[k].value),"double",s);return j+=">",e.childNodes&&e.childNodes.length&&(j+="..."),j+="</"+HT.call(String(e.nodeName))+">",j}if(Ob(e)){if(e.length===0)return"[]";var z=yp(e,P);return g&&!vH(z)?"["+Fb(z,g)+"]":"[ "+Ss.call(z,", ")+" ]"}if(rH(e)){var K=yp(e,P);return!("cause"in Error.prototype)&&"cause"in e&&!JO.call(e,"cause")?"{ ["+String(e)+"] "+Ss.call(VT.call("[cause]: "+P(e.cause),K),", ")+" }":K.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+Ss.call(K,", ")+" }"}if(typeof e=="object"&&o){if(QT&&typeof e[QT]=="function"&&kb)return kb(e,{depth:m-r});if(o!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(cH(e)){var ie=[];return UT&&UT.call(e,function(He,ce){ie.push(P(ce,e,!0)+" => "+P(He,e))}),YT("Map",zm.call(e),ie,g)}if(fH(e)){var he=[];return zT&&zT.call(e,function(He){he.push(P(He,e))}),YT("Set",$m.call(e),he,g)}if(dH(e))return jy("WeakMap");if(pH(e))return jy("WeakSet");if(hH(e))return jy("WeakRef");if(sH(e))return dd(P(Number(e)));if(aH(e))return dd(P(Ib.call(e)));if(oH(e))return dd(K$.call(e));if(iH(e))return dd(P(String(e)));if(!nH(e)&&!XT(e)){var pe=yp(e,P),X=GT?GT(e)===Object.prototype:e instanceof Object||e.constructor===Object,fe=e instanceof Object?"":"null prototype",ge=!X&&Er&&Object(e)===e&&Er in e?vx.call(da(e),8,-1):fe?"Object":"",we=X||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",be=we+(ge||fe?"["+Ss.call(VT.call([],ge||[],fe||[]),": ")+"] ":"");return pe.length===0?be+"{}":g?be+"{"+Fb(pe,g)+"}":be+"{ "+Ss.call(pe,", ")+" }"}return String(e)};function QO(n,e,t){var r=(t.quoteStyle||e)==="double"?'"':"'";return r+n+r}function tH(n){return Lo.call(String(n),/"/g,"&quot;")}function Ob(n){return da(n)==="[object Array]"&&(!Er||!(typeof n=="object"&&Er in n))}function nH(n){return da(n)==="[object Date]"&&(!Er||!(typeof n=="object"&&Er in n))}function XT(n){return da(n)==="[object RegExp]"&&(!Er||!(typeof n=="object"&&Er in n))}function rH(n){return da(n)==="[object Error]"&&(!Er||!(typeof n=="object"&&Er in n))}function iH(n){return da(n)==="[object String]"&&(!Er||!(typeof n=="object"&&Er in n))}function sH(n){return da(n)==="[object Number]"&&(!Er||!(typeof n=="object"&&Er in n))}function oH(n){return da(n)==="[object Boolean]"&&(!Er||!(typeof n=="object"&&Er in n))}function XO(n){if(Zl)return n&&typeof n=="object"&&n instanceof Symbol;if(typeof n=="symbol")return!0;if(!n||typeof n!="object"||!Ab)return!1;try{return Ab.call(n),!0}catch{}return!1}function aH(n){if(!n||typeof n!="object"||!Ib)return!1;try{return Ib.call(n),!0}catch{}return!1}var uH=Object.prototype.hasOwnProperty||function(n){return n in this};function Io(n,e){return uH.call(n,e)}function da(n){return J$.call(n)}function lH(n){if(n.name)return n.name;var e=X$.call(Q$.call(n),/^function\s*([\w$]+)/);return e?e[1]:null}function YO(n,e){if(n.indexOf)return n.indexOf(e);for(var t=0,r=n.length;t<r;t++)if(n[t]===e)return t;return-1}function cH(n){if(!zm||!n||typeof n!="object")return!1;try{zm.call(n);try{$m.call(n)}catch{return!0}return n instanceof Map}catch{}return!1}function dH(n){if(!Wd||!n||typeof n!="object")return!1;try{Wd.call(n,Wd);try{Gd.call(n,Gd)}catch{return!0}return n instanceof WeakMap}catch{}return!1}function hH(n){if(!$T||!n||typeof n!="object")return!1;try{return $T.call(n),!0}catch{}return!1}function fH(n){if(!$m||!n||typeof n!="object")return!1;try{$m.call(n);try{zm.call(n)}catch{return!0}return n instanceof Set}catch{}return!1}function pH(n){if(!Gd||!n||typeof n!="object")return!1;try{Gd.call(n,Gd);try{Wd.call(n,Wd)}catch{return!0}return n instanceof WeakSet}catch{}return!1}function mH(n){return!n||typeof n!="object"?!1:typeof HTMLElement<"u"&&n instanceof HTMLElement?!0:typeof n.nodeName=="string"&&typeof n.getAttribute=="function"}function ZO(n,e){if(n.length>e.maxStringLength){var t=n.length-e.maxStringLength,r="... "+t+" more character"+(t>1?"s":"");return ZO(vx.call(n,0,e.maxStringLength),e)+r}var i=Lo.call(Lo.call(n,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,gH);return QO(i,"single",e)}function gH(n){var e=n.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+Y$.call(e.toString(16))}function dd(n){return"Object("+n+")"}function jy(n){return n+" { ? }"}function YT(n,e,t,r){var i=r?Fb(t,r):Ss.call(t,", ");return n+" ("+e+") {"+i+"}"}function vH(n){for(var e=0;e<n.length;e++)if(YO(n[e],`
`)>=0)return!1;return!0}function yH(n,e){var t;if(n.indent==="	")t="	";else if(typeof n.indent=="number"&&n.indent>0)t=Ss.call(Array(n.indent+1)," ");else return null;return{base:t,prev:Ss.call(Array(e+1),t)}}function Fb(n,e){if(n.length===0)return"";var t=`
`+e.prev+e.base;return t+Ss.call(n,","+t)+`
`+e.prev}function yp(n,e){var t=Ob(n),r=[];if(t){r.length=n.length;for(var i=0;i<n.length;i++)r[i]=Io(n,i)?e(n[i],n):""}var s=typeof By=="function"?By(n):[],o;if(Zl){o={};for(var u=0;u<s.length;u++)o["$"+s[u]]=s[u]}for(var d in n)Io(n,d)&&(t&&String(Number(d))===d&&d<n.length||Zl&&o["$"+d]instanceof Symbol||(KO.call(/[^\w$]/,d)?r.push(e(d,n)+": "+e(n[d],n)):r.push(d+": "+e(n[d],n))));if(typeof By=="function")for(var f=0;f<s.length;f++)JO.call(n,s[f])&&r.push("["+e(s[f])+"]: "+e(n[s[f]],n));return r}var yx=px,vc=U$,SH=eH,bH=yx("%TypeError%"),Sp=yx("%WeakMap%",!0),bp=yx("%Map%",!0),wH=vc("WeakMap.prototype.get",!0),CH=vc("WeakMap.prototype.set",!0),xH=vc("WeakMap.prototype.has",!0),EH=vc("Map.prototype.get",!0),TH=vc("Map.prototype.set",!0),PH=vc("Map.prototype.has",!0),Sx=function(n,e){for(var t=n,r;(r=t.next)!==null;t=r)if(r.key===e)return t.next=r.next,r.next=n.next,n.next=r,r},RH=function(n,e){var t=Sx(n,e);return t&&t.value},_H=function(n,e,t){var r=Sx(n,e);r?r.value=t:n.next={key:e,next:n.next,value:t}},IH=function(n,e){return!!Sx(n,e)},AH=function(){var e,t,r,i={assert:function(s){if(!i.has(s))throw new bH("Side channel does not contain "+SH(s))},get:function(s){if(Sp&&s&&(typeof s=="object"||typeof s=="function")){if(e)return wH(e,s)}else if(bp){if(t)return EH(t,s)}else if(r)return RH(r,s)},has:function(s){if(Sp&&s&&(typeof s=="object"||typeof s=="function")){if(e)return xH(e,s)}else if(bp){if(t)return PH(t,s)}else if(r)return IH(r,s);return!1},set:function(s,o){Sp&&s&&(typeof s=="object"||typeof s=="function")?(e||(e=new Sp),CH(e,s,o)):bp?(t||(t=new bp),TH(t,s,o)):(r||(r={key:{},next:null}),_H(r,s,o))}};return i},kH=String.prototype.replace,OH=/%20/g,qy={RFC1738:"RFC1738",RFC3986:"RFC3986"},bx={default:qy.RFC3986,formatters:{RFC1738:function(n){return kH.call(n,OH,"+")},RFC3986:function(n){return String(n)}},RFC1738:qy.RFC1738,RFC3986:qy.RFC3986},FH=bx,Uy=Object.prototype.hasOwnProperty,Wa=Array.isArray,ps=function(){for(var n=[],e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n}(),NH=function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(Wa(r)){for(var i=[],s=0;s<r.length;++s)typeof r[s]<"u"&&i.push(r[s]);t.obj[t.prop]=i}}},eF=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},i=0;i<e.length;++i)typeof e[i]<"u"&&(r[i]=e[i]);return r},DH=function n(e,t,r){if(!t)return e;if(typeof t!="object"){if(Wa(e))e.push(t);else if(e&&typeof e=="object")(r&&(r.plainObjects||r.allowPrototypes)||!Uy.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object")return[e].concat(t);var i=e;return Wa(e)&&!Wa(t)&&(i=eF(e,r)),Wa(e)&&Wa(t)?(t.forEach(function(s,o){if(Uy.call(e,o)){var u=e[o];u&&typeof u=="object"&&s&&typeof s=="object"?e[o]=n(u,s,r):e.push(s)}else e[o]=s}),e):Object.keys(t).reduce(function(s,o){var u=t[o];return Uy.call(s,o)?s[o]=n(s[o],u,r):s[o]=u,s},i)},LH=function(e,t){return Object.keys(t).reduce(function(r,i){return r[i]=t[i],r},e)},MH=function(n,e,t){var r=n.replace(/\+/g," ");if(t==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},BH=function(e,t,r,i,s){if(e.length===0)return e;var o=e;if(typeof e=="symbol"?o=Symbol.prototype.toString.call(e):typeof e!="string"&&(o=String(e)),r==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(m){return"%26%23"+parseInt(m.slice(2),16)+"%3B"});for(var u="",d=0;d<o.length;++d){var f=o.charCodeAt(d);if(f===45||f===46||f===95||f===126||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||s===FH.RFC1738&&(f===40||f===41)){u+=o.charAt(d);continue}if(f<128){u=u+ps[f];continue}if(f<2048){u=u+(ps[192|f>>6]+ps[128|f&63]);continue}if(f<55296||f>=57344){u=u+(ps[224|f>>12]+ps[128|f>>6&63]+ps[128|f&63]);continue}d+=1,f=65536+((f&1023)<<10|o.charCodeAt(d)&1023),u+=ps[240|f>>18]+ps[128|f>>12&63]+ps[128|f>>6&63]+ps[128|f&63]}return u},jH=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],i=0;i<t.length;++i)for(var s=t[i],o=s.obj[s.prop],u=Object.keys(o),d=0;d<u.length;++d){var f=u[d],m=o[f];typeof m=="object"&&m!==null&&r.indexOf(m)===-1&&(t.push({obj:o,prop:f}),r.push(m))}return NH(t),e},qH=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},UH=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},zH=function(e,t){return[].concat(e,t)},$H=function(e,t){if(Wa(e)){for(var r=[],i=0;i<e.length;i+=1)r.push(t(e[i]));return r}return t(e)},tF={arrayToObject:eF,assign:LH,combine:zH,compact:jH,decode:MH,encode:BH,isBuffer:UH,isRegExp:qH,maybeMap:$H,merge:DH},nF=AH,Zp=tF,Kd=bx,HH=Object.prototype.hasOwnProperty,ZT={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},Ys=Array.isArray,VH=Array.prototype.push,rF=function(n,e){VH.apply(n,Ys(e)?e:[e])},WH=Date.prototype.toISOString,eP=Kd.default,gr={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:Zp.encode,encodeValuesOnly:!1,format:eP,formatter:Kd.formatters[eP],indices:!1,serializeDate:function(e){return WH.call(e)},skipNulls:!1,strictNullHandling:!1},GH=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},zy={},KH=function n(e,t,r,i,s,o,u,d,f,m,g,P,D,M,U,j){for(var E=e,k=j,z=0,K=!1;(k=k.get(zy))!==void 0&&!K;){var ie=k.get(e);if(z+=1,typeof ie<"u"){if(ie===z)throw new RangeError("Cyclic object value");K=!0}typeof k.get(zy)>"u"&&(z=0)}if(typeof d=="function"?E=d(t,E):E instanceof Date?E=g(E):r==="comma"&&Ys(E)&&(E=Zp.maybeMap(E,function(De){return De instanceof Date?g(De):De})),E===null){if(s)return u&&!M?u(t,gr.encoder,U,"key",P):t;E=""}if(GH(E)||Zp.isBuffer(E)){if(u){var he=M?t:u(t,gr.encoder,U,"key",P);return[D(he)+"="+D(u(E,gr.encoder,U,"value",P))]}return[D(t)+"="+D(String(E))]}var pe=[];if(typeof E>"u")return pe;var X;if(r==="comma"&&Ys(E))M&&u&&(E=Zp.maybeMap(E,u)),X=[{value:E.length>0?E.join(",")||null:void 0}];else if(Ys(d))X=d;else{var fe=Object.keys(E);X=f?fe.sort(f):fe}for(var ge=i&&Ys(E)&&E.length===1?t+"[]":t,we=0;we<X.length;++we){var be=X[we],He=typeof be=="object"&&typeof be.value<"u"?be.value:E[be];if(!(o&&He===null)){var ce=Ys(E)?typeof r=="function"?r(ge,be):ge:ge+(m?"."+be:"["+be+"]");j.set(e,z);var ve=nF();ve.set(zy,j),rF(pe,n(He,ce,r,i,s,o,r==="comma"&&M&&Ys(E)?null:u,d,f,m,g,P,D,M,U,ve))}}return pe},JH=function(e){if(!e)return gr;if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var t=e.charset||gr.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=Kd.default;if(typeof e.format<"u"){if(!HH.call(Kd.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var i=Kd.formatters[r],s=gr.filter;return(typeof e.filter=="function"||Ys(e.filter))&&(s=e.filter),{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:gr.addQueryPrefix,allowDots:typeof e.allowDots>"u"?gr.allowDots:!!e.allowDots,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:gr.charsetSentinel,delimiter:typeof e.delimiter>"u"?gr.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:gr.encode,encoder:typeof e.encoder=="function"?e.encoder:gr.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:gr.encodeValuesOnly,filter:s,format:r,formatter:i,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:gr.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:gr.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:gr.strictNullHandling}},QH=function(n,e){var t=n,r=JH(e),i,s;typeof r.filter=="function"?(s=r.filter,t=s("",t)):Ys(r.filter)&&(s=r.filter,i=s);var o=[];if(typeof t!="object"||t===null)return"";var u;e&&e.arrayFormat in ZT?u=e.arrayFormat:e&&"indices"in e?u=e.indices?"indices":"repeat":u="indices";var d=ZT[u];if(e&&"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var f=d==="comma"&&e&&e.commaRoundTrip;i||(i=Object.keys(t)),r.sort&&i.sort(r.sort);for(var m=nF(),g=0;g<i.length;++g){var P=i[g];r.skipNulls&&t[P]===null||rF(o,KH(t[P],P,d,f,r.strictNullHandling,r.skipNulls,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,m))}var D=o.join(r.delimiter),M=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?M+="utf8=%26%2310003%3B&":M+="utf8=%E2%9C%93&"),D.length>0?M+D:""},ec=tF,Nb=Object.prototype.hasOwnProperty,XH=Array.isArray,Rn={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:ec.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},YH=function(n){return n.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},iF=function(n,e){return n&&typeof n=="string"&&e.comma&&n.indexOf(",")>-1?n.split(","):n},ZH="utf8=%26%2310003%3B",eV="utf8=%E2%9C%93",tV=function(e,t){var r={__proto__:null},i=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,s=t.parameterLimit===1/0?void 0:t.parameterLimit,o=i.split(t.delimiter,s),u=-1,d,f=t.charset;if(t.charsetSentinel)for(d=0;d<o.length;++d)o[d].indexOf("utf8=")===0&&(o[d]===eV?f="utf-8":o[d]===ZH&&(f="iso-8859-1"),u=d,d=o.length);for(d=0;d<o.length;++d)if(d!==u){var m=o[d],g=m.indexOf("]="),P=g===-1?m.indexOf("="):g+1,D,M;P===-1?(D=t.decoder(m,Rn.decoder,f,"key"),M=t.strictNullHandling?null:""):(D=t.decoder(m.slice(0,P),Rn.decoder,f,"key"),M=ec.maybeMap(iF(m.slice(P+1),t),function(U){return t.decoder(U,Rn.decoder,f,"value")})),M&&t.interpretNumericEntities&&f==="iso-8859-1"&&(M=YH(M)),m.indexOf("[]=")>-1&&(M=XH(M)?[M]:M),Nb.call(r,D)?r[D]=ec.combine(r[D],M):r[D]=M}return r},nV=function(n,e,t,r){for(var i=r?e:iF(e,t),s=n.length-1;s>=0;--s){var o,u=n[s];if(u==="[]"&&t.parseArrays)o=[].concat(i);else{o=t.plainObjects?Object.create(null):{};var d=u.charAt(0)==="["&&u.charAt(u.length-1)==="]"?u.slice(1,-1):u,f=parseInt(d,10);!t.parseArrays&&d===""?o={0:i}:!isNaN(f)&&u!==d&&String(f)===d&&f>=0&&t.parseArrays&&f<=t.arrayLimit?(o=[],o[f]=i):d!=="__proto__"&&(o[d]=i)}i=o}return i},rV=function(e,t,r,i){if(e){var s=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/,u=/(\[[^[\]]*])/g,d=r.depth>0&&o.exec(s),f=d?s.slice(0,d.index):s,m=[];if(f){if(!r.plainObjects&&Nb.call(Object.prototype,f)&&!r.allowPrototypes)return;m.push(f)}for(var g=0;r.depth>0&&(d=u.exec(s))!==null&&g<r.depth;){if(g+=1,!r.plainObjects&&Nb.call(Object.prototype,d[1].slice(1,-1))&&!r.allowPrototypes)return;m.push(d[1])}return d&&m.push("["+s.slice(d.index)+"]"),nV(m,t,r,i)}},iV=function(e){if(!e)return Rn;if(e.decoder!==null&&e.decoder!==void 0&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=typeof e.charset>"u"?Rn.charset:e.charset;return{allowDots:typeof e.allowDots>"u"?Rn.allowDots:!!e.allowDots,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:Rn.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:Rn.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:Rn.arrayLimit,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:Rn.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:Rn.comma,decoder:typeof e.decoder=="function"?e.decoder:Rn.decoder,delimiter:typeof e.delimiter=="string"||ec.isRegExp(e.delimiter)?e.delimiter:Rn.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:Rn.depth,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:Rn.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:Rn.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:Rn.plainObjects,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:Rn.strictNullHandling}},sV=function(n,e){var t=iV(e);if(n===""||n===null||typeof n>"u")return t.plainObjects?Object.create(null):{};for(var r=typeof n=="string"?tV(n,t):n,i=t.plainObjects?Object.create(null):{},s=Object.keys(r),o=0;o<s.length;++o){var u=s[o],d=rV(u,r[u],t,typeof n=="string");i=ec.merge(i,d,t)}return t.allowSparse===!0?i:ec.compact(i)},oV=QH,aV=sV,uV=bx,lV={formats:uV,parse:aV,stringify:oV},cV=p$;function so(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var dV=/^([a-z0-9.+-]+:)/i,hV=/:[0-9]*$/,fV=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,pV=["<",">",'"',"`"," ","\r",`
`,"	"],mV=["{","}","|","\\","^","`"].concat(pV),Db=["'"].concat(mV),tP=["%","/","?",";","#"].concat(Db),nP=["/","?","#"],gV=255,rP=/^[+a-z0-9A-Z_-]{0,63}$/,vV=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,yV={javascript:!0,"javascript:":!0},Lb={javascript:!0,"javascript:":!0},Ll={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Mb=lV;function sF(n,e,t){if(n&&typeof n=="object"&&n instanceof so)return n;var r=new so;return r.parse(n,e,t),r}so.prototype.parse=function(n,e,t){if(typeof n!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof n);var r=n.indexOf("?"),i=r!==-1&&r<n.indexOf("#")?"?":"#",s=n.split(i),o=/\\/g;s[0]=s[0].replace(o,"/"),n=s.join(i);var u=n;if(u=u.trim(),!t&&n.split("#").length===1){var d=fV.exec(u);if(d)return this.path=u,this.href=u,this.pathname=d[1],d[2]?(this.search=d[2],e?this.query=Mb.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var f=dV.exec(u);if(f){f=f[0];var m=f.toLowerCase();this.protocol=m,u=u.substr(f.length)}if(t||f||u.match(/^\/\/[^@/]+@[^@/]+/)){var g=u.substr(0,2)==="//";g&&!(f&&Lb[f])&&(u=u.substr(2),this.slashes=!0)}if(!Lb[f]&&(g||f&&!Ll[f])){for(var P=-1,D=0;D<nP.length;D++){var M=u.indexOf(nP[D]);M!==-1&&(P===-1||M<P)&&(P=M)}var U,j;P===-1?j=u.lastIndexOf("@"):j=u.lastIndexOf("@",P),j!==-1&&(U=u.slice(0,j),u=u.slice(j+1),this.auth=decodeURIComponent(U)),P=-1;for(var D=0;D<tP.length;D++){var M=u.indexOf(tP[D]);M!==-1&&(P===-1||M<P)&&(P=M)}P===-1&&(P=u.length),this.host=u.slice(0,P),u=u.slice(P),this.parseHost(),this.hostname=this.hostname||"";var E=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!E)for(var k=this.hostname.split(/\./),D=0,z=k.length;D<z;D++){var K=k[D];if(K&&!K.match(rP)){for(var ie="",he=0,pe=K.length;he<pe;he++)K.charCodeAt(he)>127?ie+="x":ie+=K[he];if(!ie.match(rP)){var X=k.slice(0,D),fe=k.slice(D+1),ge=K.match(vV);ge&&(X.push(ge[1]),fe.unshift(ge[2])),fe.length&&(u="/"+fe.join(".")+u),this.hostname=X.join(".");break}}}this.hostname.length>gV?this.hostname="":this.hostname=this.hostname.toLowerCase(),E||(this.hostname=cV.toASCII(this.hostname));var we=this.port?":"+this.port:"",be=this.hostname||"";this.host=be+we,this.href+=this.host,E&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),u[0]!=="/"&&(u="/"+u))}if(!yV[m])for(var D=0,z=Db.length;D<z;D++){var He=Db[D];if(u.indexOf(He)!==-1){var ce=encodeURIComponent(He);ce===He&&(ce=escape(He)),u=u.split(He).join(ce)}}var ve=u.indexOf("#");ve!==-1&&(this.hash=u.substr(ve),u=u.slice(0,ve));var De=u.indexOf("?");if(De!==-1?(this.search=u.substr(De),this.query=u.substr(De+1),e&&(this.query=Mb.parse(this.query)),u=u.slice(0,De)):e&&(this.search="",this.query={}),u&&(this.pathname=u),Ll[m]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var we=this.pathname||"",Xe=this.search||"";this.path=we+Xe}return this.href=this.format(),this};so.prototype.format=function(){var n=this.auth||"";n&&(n=encodeURIComponent(n),n=n.replace(/%3A/i,":"),n+="@");var e=this.protocol||"",t=this.pathname||"",r=this.hash||"",i=!1,s="";this.host?i=n+this.host:this.hostname&&(i=n+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=Mb.stringify(this.query));var o=this.search||s&&"?"+s||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||Ll[e])&&i!==!1?(i="//"+(i||""),t&&t.charAt(0)!=="/"&&(t="/"+t)):i||(i=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),t=t.replace(/[?#]/g,function(u){return encodeURIComponent(u)}),o=o.replace("#","%23"),e+i+t+o+r};so.prototype.resolve=function(n){return this.resolveObject(sF(n,!1,!0)).format()};so.prototype.resolveObject=function(n){if(typeof n=="string"){var e=new so;e.parse(n,!1,!0),n=e}for(var t=new so,r=Object.keys(this),i=0;i<r.length;i++){var s=r[i];t[s]=this[s]}if(t.hash=n.hash,n.href==="")return t.href=t.format(),t;if(n.slashes&&!n.protocol){for(var o=Object.keys(n),u=0;u<o.length;u++){var d=o[u];d!=="protocol"&&(t[d]=n[d])}return Ll[t.protocol]&&t.hostname&&!t.pathname&&(t.pathname="/",t.path=t.pathname),t.href=t.format(),t}if(n.protocol&&n.protocol!==t.protocol){if(!Ll[n.protocol]){for(var f=Object.keys(n),m=0;m<f.length;m++){var g=f[m];t[g]=n[g]}return t.href=t.format(),t}if(t.protocol=n.protocol,!n.host&&!Lb[n.protocol]){for(var z=(n.pathname||"").split("/");z.length&&!(n.host=z.shift()););n.host||(n.host=""),n.hostname||(n.hostname=""),z[0]!==""&&z.unshift(""),z.length<2&&z.unshift(""),t.pathname=z.join("/")}else t.pathname=n.pathname;if(t.search=n.search,t.query=n.query,t.host=n.host||"",t.auth=n.auth,t.hostname=n.hostname||n.host,t.port=n.port,t.pathname||t.search){var P=t.pathname||"",D=t.search||"";t.path=P+D}return t.slashes=t.slashes||n.slashes,t.href=t.format(),t}var M=t.pathname&&t.pathname.charAt(0)==="/",U=n.host||n.pathname&&n.pathname.charAt(0)==="/",j=U||M||t.host&&n.pathname,E=j,k=t.pathname&&t.pathname.split("/")||[],z=n.pathname&&n.pathname.split("/")||[],K=t.protocol&&!Ll[t.protocol];if(K&&(t.hostname="",t.port=null,t.host&&(k[0]===""?k[0]=t.host:k.unshift(t.host)),t.host="",n.protocol&&(n.hostname=null,n.port=null,n.host&&(z[0]===""?z[0]=n.host:z.unshift(n.host)),n.host=null),j=j&&(z[0]===""||k[0]==="")),U)t.host=n.host||n.host===""?n.host:t.host,t.hostname=n.hostname||n.hostname===""?n.hostname:t.hostname,t.search=n.search,t.query=n.query,k=z;else if(z.length)k||(k=[]),k.pop(),k=k.concat(z),t.search=n.search,t.query=n.query;else if(n.search!=null){if(K){t.host=k.shift(),t.hostname=t.host;var ie=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;ie&&(t.auth=ie.shift(),t.hostname=ie.shift(),t.host=t.hostname)}return t.search=n.search,t.query=n.query,(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t}if(!k.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var he=k.slice(-1)[0],pe=(t.host||n.host||k.length>1)&&(he==="."||he==="..")||he==="",X=0,fe=k.length;fe>=0;fe--)he=k[fe],he==="."?k.splice(fe,1):he===".."?(k.splice(fe,1),X++):X&&(k.splice(fe,1),X--);if(!j&&!E)for(;X--;X)k.unshift("..");j&&k[0]!==""&&(!k[0]||k[0].charAt(0)!=="/")&&k.unshift(""),pe&&k.join("/").substr(-1)!=="/"&&k.push("");var ge=k[0]===""||k[0]&&k[0].charAt(0)==="/";if(K){t.hostname=ge?"":k.length?k.shift():"",t.host=t.hostname;var ie=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;ie&&(t.auth=ie.shift(),t.hostname=ie.shift(),t.host=t.hostname)}return j=j||t.host&&k.length,j&&!ge&&k.unshift(""),k.length>0?t.pathname=k.join("/"):(t.pathname=null,t.path=null),(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=n.auth||t.auth,t.slashes=t.slashes||n.slashes,t.href=t.format(),t};so.prototype.parseHost=function(){var n=this.host,e=hV.exec(n);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),n=n.substr(0,n.length-e.length)),n&&(this.hostname=n)};var Bb=sF;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var mi;(function(n){n.genericError="genericError",n.genericNetworkError="genericNetworkError",n.authorizationError="authorizationError",n.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError",n.throttlingError="throttlingError",n.offlineError="offlineError",n.unsupportedClientProtocolVersion="unsupportedClientProtocolVersion",n.writeError="writeError",n.fetchFailure="fetchFailure",n.incorrectServerResponse="incorrectServerResponse",n.fileOverwrittenInStorage="fileOverwrittenInStorage",n.deltaStreamConnectionForbidden="deltaStreamConnectionForbidden",n.locationRedirection="locationRedirection"})(mi||(mi={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var tc;(function(n){n[n.NoCaching=0]="NoCaching",n[n.Prefetch=1]="Prefetch"})(tc||(tc={}));var nc;(function(n){n.summarizingClient="fluid-client-summarizer",n.createNew="createNew"})(nc||(nc={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const wx=n=>(n==null?void 0:n.type)==="fluid";function Ns(n){if(!wx(n))throw new Error(`resolved is not a Fluid url. Type: ${n==null?void 0:n.type}`)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Cx{constructor(e){this.protocolName="none:",this.protocolToDocumentFactoryMap=new Map,e.forEach(t=>{this.protocolToDocumentFactoryMap.set(t.protocolName,t)})}static create(e){if(Array.isArray(e)){const t=[];return e.forEach(r=>{const i=r;i.protocolToDocumentFactoryMap!==void 0?t.push(...i.protocolToDocumentFactoryMap.values()):t.push(r)}),t.length===1?t[0]:new Cx(t)}return e}async createDocumentService(e,t,r){Ns(e);const i=Bb(e.url);if(i.protocol===void 0||i.protocol===null)throw new Error("No protocol provided");const s=this.protocolToDocumentFactoryMap.get(i.protocol);if(s===void 0)throw new Error("Unknown Fluid protocol");return s.createDocumentService(e,t,r)}async createContainer(e,t,r,i){Ns(t);const s=Bb(t.url);if(s.protocol===void 0||s.protocol===null)throw new Error("No protocol provided");const o=this.protocolToDocumentFactoryMap.get(s.protocol);if(o===void 0)throw new Error("Unknown Fluid protocol");return o.createContainer(e,t,r,i)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function SV(n,e){let t;for(const r of n)if(t=await r.resolve(Object.assign({},e)),t!==void 0)return t}class xx{constructor(e){this.urlResolvers=e}static create(e){return Array.isArray(e)?e.length===1?e[0]:new xx(e):e}async resolve(e){return SV(this.urlResolvers,e)}async getAbsoluteUrl(e,t){throw new Error("Not implmented")}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var $y,Qo;(function(n){n[n.Offline=0]="Offline",n[n.Online=1]="Online",n[n.Unknown=2]="Unknown"})(Qo||(Qo={}));function Ex(){return typeof navigator=="object"&&navigator!==null&&typeof navigator.onLine=="boolean"?navigator.onLine?Qo.Online:Qo.Offline:Qo.Unknown}class jb extends st{constructor(e,t,r){super(e,r),this.canRetry=t,this.errorType=mi.genericNetworkError}}const iP="deltaStreamConnectionForbidden";class Dg extends st{constructor(e,t){super(e,Object.assign(Object.assign({},t),{statusCode:400})),this.errorType=Dg.errorType,this.canRetry=!1}}Dg.errorType=($y=mi[iP])!==null&&$y!==void 0?$y:iP;class bV extends st{constructor(e,t,r,i){super(e,i,new Set(["claims","tenantId"])),this.claims=t,this.tenantId=r,this.errorType=mi.authorizationError,this.canRetry=!1}}class wV extends st{constructor(e,t,r,i){super(e,i),this.errorType=t,this.canRetry=r}}class Lg extends wV{constructor(e,t,r){super(e,t,!1,r),this.errorType=t}}class CV extends st{constructor(e,t,r){super(e,r),this.retryAfterSeconds=t,this.errorType=mi.throttlingError,this.canRetry=!0}}const xV=(n,e)=>new Lg(n,mi.writeError,e);function rc(n,e,t){return e.retryAfterMs!==void 0&&e.canRetry?new CV(n,e.retryAfterMs/1e3,t):new jb(n,e.canRetry,t)}const Kh=n=>(n==null?void 0:n.canRetry)===!0,sP=n=>n==null?void 0:n.retryAfterSeconds,Hm=n=>(n==null?void 0:n.retryAfterSeconds)!==void 0?n.retryAfterSeconds*1e3:void 0;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function En(n,e){const t=await n.readBlob(e),r=Xz(t,"utf8");return JSON.parse(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function em(n,e){return{type:eu.Tree,tree:{".protocol":e,".app":n}}}function EV(n){var e;const t=n.tree.attributes,r=JSON.parse(t.content);return r.term=(e=r.term)!==null&&e!==void 0?e:1,r}function TV(n){const e=n.tree.quorumValues;return JSON.parse(e.content)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function qb(n,e,t){var r,i;const s=Object.assign({},e),o=t.online;if(s.online=typeof o=="string"?o:Qo[Ex()],typeof navigator=="object"&&navigator!==null){const u=navigator,d=(i=(r=u.connection)!==null&&r!==void 0?r:u.mozConnection)!==null&&i!==void 0?i:u.webkitConnection;d!==null&&typeof d=="object"&&(s.connectionType=d.type)}s.category=Kh(t)?"generic":"error",n.sendTelemetryEvent(s,t)}function Ub(n){return new Promise(t=>{let r=t,i=n;Ex()===Qo.Offline&&(window==null?void 0:window.addEventListener)!==void 0&&(r=()=>{t(),window.removeEventListener("online",r)},window.addEventListener("online",r,!1),i=Math.max(n,3e4)),setTimeout(r,i)})}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const oF="1.3.6";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const PV=1e4,RV=100;class _V{constructor(e,t,r,i,s,o){this.to=t,this.payloadSize=r,this.logger=i,this.requestCallback=s,this.responseCallback=o,this.results=new Map,this.workingState="working",this.requestsInFlight=0,this.endEvent=new BO,this.requests=0,this.latestRequested=e,this.nextToDeliver=e,this.knewTo=t!==void 0}get working(){return this.workingState==="working"}get canceled(){return this.workingState==="canceled"}cancel(){this.working&&(this.workingState="canceled",this.endEvent.resolve())}async run(e){At(e>0,258),At(this.working,259);let t=e;for(;t>0;)t--,this.addRequest();return this.dispatch(),this.endEvent.promise}done(){At(this.to!==void 0,260),At(this.nextToDeliver>=this.to,261),this.working&&(this.workingState="done",this.endEvent.resolve())}fail(e){this.working&&(this.workingState="done",this.endEvent.reject(e))}dispatch(){for(;this.working;){const e=this.results.get(this.nextToDeliver);if(e===void 0)break;this.results.delete(this.nextToDeliver),At(e.length<=this.payloadSize,473),this.nextToDeliver+=e.length,this.responseCallback(e)}this.working&&(this.requestsInFlight===0?(At(this.results.size===0,263),this.done()):this.to!==void 0&&this.nextToDeliver>=this.to&&(At(!this.knewTo,264),this.done()))}getNextChunk(){if(!this.working)return;const e=this.latestRequested;if(!(this.to!==void 0&&this.to<=e))return this.latestRequested+=this.payloadSize,this.to!==void 0&&(this.latestRequested=Math.min(this.to,this.latestRequested)),At(e<this.latestRequested,265),{from:e,to:this.latestRequested}}addRequest(){const e=this.getNextChunk();e!==void 0&&this.addRequestCore(e.from,e.to).catch(this.fail.bind(this))}async addRequestCore(e,t){At(this.working,266);let r=e,i=t;for(this.requestsInFlight++;this.working;){const s=i-r;At(s>0,267),this.to!==void 0&&(At(r<this.to,268),At(i<=this.to,269)),this.requests++;const o=this.requestCallback(this.requests,r,i,this.to!==void 0,{});this.dispatch();const{payload:u,cancel:d,partial:f}=await o;if(d&&this.cancel(),this.to!==void 0&&r>=this.to){At(!this.knewTo,270),u.length!==0&&this.logger.sendErrorEvent({eventName:"ParallelRequests_GotExtra",from:r,to:i,end:this.to,length:u.length});break}if(this.working){const m=r,g=u.length;let P=s<=g;if(g!==0){s<g&&this.logger.sendTelemetryEvent({eventName:"ParallelRequests_Over",from:r,to:i,length:g});const D=u.splice(0,s);this.results.set(r,D),r+=D.length}else At(!f,271),At(!this.knewTo,272);if(!f&&!P){if(!this.knewTo){(this.to===void 0||this.to>r)&&(this.to=r);break}this.logger.sendPerformanceEvent({eventName:"ParallelRequests_Partial",from:m,to:i,length:g})}if(i===this.latestRequested&&(u.length!==0&&(this.results.set(r,u),r+=u.length),this.latestRequested=r,P=!0),P){const D=this.getNextChunk();if(D===void 0)break;r=D.from,i=D.to}}}this.requestsInFlight--,this.dispatch()}}class IV{constructor(){this.queue=[],this.done=!1}pushValue(e){this.pushCore(Promise.resolve({done:!1,value:e}))}pushError(e){this.pushCore(Promise.reject(e)),this.done=!0}pushDone(){this.pushCore(Promise.resolve({done:!0})),this.done=!0}pushCore(e){At(!this.done,274),this.deferred?(At(this.queue.length===0,275),this.deferred.resolve(e),this.deferred=void 0):this.queue.push(e)}async read(){At(this.deferred===void 0,276);const e=this.queue.shift();return e!==void 0?e:(At(!this.done,277),this.deferred=new BO,this.deferred.promise)}}async function AV(n,e,t,r,i,s){let o,u=0;const d=[],f={partial:!1,cancel:!0,payload:[]};for(;(i==null?void 0:i.aborted)!==!0;){u++;let m=Math.min(PV,RV*Math.pow(2,u));const g=No.now();try{const P=n(Object.assign(Object.assign({},e),{retry:u})),{messages:D,partialResult:M}=await P;if(d.push(...D),D.length!==0||!t)return{payload:d,cancel:!1,partial:M};if(o===void 0)o=No.now();else if(No.now()-o>3e4)throw rc("Failed to retrieve ops from storage (Too Many Retries)",{canRetry:!1},Object.assign({retry:u,driverVersion:oF},e))}catch(P){const D=Kh(P);o=void 0;const M=Hm(P);if(qb(r,Object.assign(Object.assign({eventName:"GetDeltas_Error"},e),{retry:u,duration:No.now()-g,retryAfter:M,reason:s}),P),!D)throw P;M!==void 0&&M>=0&&(m=M)}await Ub(m)}return f}function kV(n,e,t,r,i,s,o,u){let d=0,f,m=0;const g=new IV,P={fromTotal:t,toTotal:r},D=dt.start(s,Object.assign(Object.assign({eventName:"GetDeltas"},P),{reason:u})),M=new _V(t,r,i,s,async(j,E,k,z,K)=>(d++,AV(async ie=>n(E,k,ie),Object.assign(Object.assign({request:j,from:E,to:k},P),K),z,s,o,u)),j=>{f===void 0?At(j[0].sequenceNumber===t,621):At(j[0].sequenceNumber===f+1,622),f=j[j.length-1].sequenceNumber,At(f-j[0].sequenceNumber+1===j.length,623),m+=j.length,g.pushValue(j)}),U=j=>{M.cancel()};return o!==void 0&&o.addEventListener("abort",U),M.run(e).finally(()=>{o!==void 0&&o.removeEventListener("abort",U)}).then(()=>{const j={lastFetch:f,length:m,requests:d};M.canceled?D.cancel(Object.assign(Object.assign({},j),{error:"ops request cancelled by client"})):(At(r===void 0||f!==void 0&&f>=r-1,624),D.end(j)),g.pushDone()}).catch(j=>{D.cancel({lastFetch:f,length:m,requests:d},j),g.pushError(j)}),g}const OV={read:async()=>({done:!0})};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class FV extends lx{constructor(){super(...arguments),this.prefetchCache=new Map,this.prefetchEnabled=!0}get policies(){const e=this.internalStorageService.policies;if(e)return Object.assign(Object.assign({},e),{caching:tc.NoCaching})}async getSnapshotTree(e){const t=this.internalStorageService.getSnapshotTree(e);return this.prefetchEnabled&&t.then(r=>{r!=null&&this.prefetchTree(r)}),t}async readBlob(e){return this.cachedRead(e)}stopPrefetch(){this.prefetchEnabled=!1,this.prefetchCache.clear()}async cachedRead(e){if(this.prefetchEnabled){const t=this.prefetchCache.get(e);if(t!==void 0)return t;const r=this.internalStorageService.readBlob(e);return this.prefetchCache.set(e,r.catch(i=>{throw Kh(i)&&this.prefetchCache.delete(e),i})),r}return this.internalStorageService.readBlob(e)}prefetchTree(e){const t=[];this.prefetchTreeCore(e,t);for(const r of t)this.cachedRead(r)}prefetchTreeCore(e,t){for(const r of Object.keys(e.blobs)){const i=e.blobs[r];r.startsWith(".")||r==="header"||r.startsWith("quorum")?i!==null&&this.cachedRead(i):r.startsWith("deltas")||i!==null&&t.push(i)}for(const r of Object.keys(e.trees))this.prefetchTreeCore(e.trees[r],t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Vm=class{constructor(e){this.maxRequests=e,this.tasks=[],this.release=()=>{const t=this.tasks.shift();if(t!==void 0)return t();this.maxRequests++},At(e>0,174)}get waitQueueLength(){return this.tasks.length}async acquire(){if(this.maxRequests>0){this.maxRequests--;return}return new Promise(e=>{this.tasks.push(e)})}async schedule(e){return await this.acquire(),e().finally(this.release)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function Tx(n,e,t,r){var i,s;let o,u=!1,d=1e3,f=0;const m=No.now();let g;do try{o=await n(r.cancel),u=!0}catch(P){if(!Kh(P))throw t.sendTelemetryEvent({eventName:`${e}_cancel`,retry:f,duration:No.now()-m,fetchCallName:e},P),P;if(((i=r.cancel)===null||i===void 0?void 0:i.aborted)===!0)throw t.sendTelemetryEvent({eventName:`${e}_runWithRetryAborted`,retry:f,duration:No.now()-m,fetchCallName:e},P),new Lg("runWithRetry was Aborted",mi.genericError,{driverVersion:oF,fetchCallName:e});f++,g=P,d=(s=Hm(P))!==null&&s!==void 0?s:Math.min(d*2,8e3),r.onRetry&&r.onRetry(d,P),await Yz(d)}while(!u);return f>0&&t.sendTelemetryEvent({eventName:`${e}_lastError`,retry:f,duration:No.now()-m,fetchCallName:e},g),o}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class NV{constructor(e){this.props=e,this.attachmentCounter=0,this.summaryTree={}}get summary(){var e;return{type:eu.Tree,tree:Object.assign({},this.summaryTree),unreferenced:(e=this.props)===null||e===void 0?void 0:e.unreferenced}}addBlob(e,t){this.summaryTree[e]={type:eu.Blob,content:t}}addHandle(e,t,r){this.summaryTree[e]={type:eu.Handle,handleType:t,handle:r}}addTree(e,t){this.summaryTree[e]=t}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:eu.Attachment}}}function aF(n,e){const t=new NV({unreferenced:n.unreferenced});for(const[r,i]of Object.entries(n.blobs)){const s=e.get(i);At(s!==void 0,733),t.addBlob(r,cx.from(s).toString("utf-8"))}for(const[r,i]of Object.entries(n.trees)){const s=aF(i,e);t.addTree(r,s)}return t.summary}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function DV(n){if(wh(n))return!0;switch(n.type){case su.Propose:case su.Reject:case su.NoOp:return!0;default:return!1}}function wh(n){return n.type===su.Operation||n.type===su.Summarize}var zb;(function(n){n.FluidDataStoreOp="component",n.Attach="attach",n.ChunkedOp="chunkedOp",n.BlobAttach="blobAttach",n.Rejoin="rejoin",n.Alias="alias",n.Operation="op"})(zb||(zb={}));function Ch(n){return!!Object.values(zb).includes(n.type)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Pi;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Pi||(Pi={}));var oP;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(oP||(oP={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var ii;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(ii||(ii={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Wm;(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(Wm||(Wm={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class LV extends Fn.EventEmitter{constructor(){super(...arguments),this.members=new Map}on(e,t){return super.on(e,t)}addMember(e,t){this.members.set(e,t),this.emit("addMember",e,t)}removeMember(e){const t=this.members.get(e);return t!==void 0?(this.members.delete(e),this.emit("removeMember",e,t),!0):!1}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}clear(){const e=this.members.keys();for(const t of e)this.removeMember(t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const MV="Code package does not implement IRuntimeFactory";class Px{constructor(e,t,r,i,s,o,u,d,f,m,g,P,D,M,U){this.container=e,this.scope=t,this.codeLoader=r,this._codeDetails=i,this._baseSnapshot=s,this.deltaManager=o,this.loader=d,this.submitFn=f,this.submitSignalFn=m,this.closeFn=g,this.version=P,this.updateDirtyContainerState=D,this.existing=M,this.pendingLocalState=U,this._disposed=!1,this._quorum=u,this.taggedLogger=e.subLogger,this._fluidModuleP=new Qq(async()=>this.loadCodeModule(i)),this.attachListener()}static async createOrLoad(e,t,r,i,s,o,u,d,f,m,g,P,D,M,U){const j=new Px(e,t,r,i,s,o,u,d,f,m,g,P,D,M,U);return await j.instantiateRuntime(M),j}get clientId(){return this.container.clientId}get id(){const e=this.container.resolvedUrl;return wx(e)?e.id:""}get clientDetails(){return this.container.clientDetails}get connected(){return this.container.connected}get canSummarize(){return"summarize"in this.runtime}get serviceConfiguration(){return this.container.serviceConfiguration}get audience(){return this.container.audience}get options(){return this.container.options}get baseSnapshot(){return this._baseSnapshot}get storage(){return this.container.storage}get runtime(){if(this._runtime===void 0)throw new Error("Attempted to access runtime before it was defined");return this._runtime}get disposed(){return this._disposed}get codeDetails(){return this._codeDetails}get quorum(){return this._quorum}getSpecifiedCodeDetails(){var e;return(e=this._quorum.get("code"))!==null&&e!==void 0?e:this._quorum.get("code2")}dispose(e){this._disposed||(this._disposed=!0,this.runtime.dispose(e),this._quorum.dispose(),this.deltaManager.dispose())}getLoadedFromVersion(){return this.container.loadedFromVersion}get attachState(){return this.container.attachState}createSummary(e){return this.runtime.createSummary(e)}setConnectionState(e,t){const r=this.runtime;$e(e===this.connected,222),r.setConnectionState(e,t)}process(e,t,r){this.runtime.process(e,t,r)}processSignal(e,t){this.runtime.processSignal(e,t)}async request(e){return this.runtime.request(e)}async getAbsoluteUrl(e){return this.container.getAbsoluteUrl(e)}getPendingLocalState(){return this.runtime.getPendingLocalState()}async satisfies(e){var t;const r=[],i=this.codeLoader;i.IFluidCodeDetailsComparer!==void 0&&r.push(i.IFluidCodeDetailsComparer);const s=await this._fluidModuleP,o=(t=s.module)===null||t===void 0?void 0:t.fluidExport;if((o==null?void 0:o.IFluidCodeDetailsComparer)!==void 0&&r.push(o.IFluidCodeDetailsComparer),r.length===0)return!1;for(const u of r)if(await u.satisfies(s.details,e)===!1)return!1;return!0}notifyAttaching(e){var t,r;this._baseSnapshot=e,(r=(t=this.runtime).notifyAttaching)===null||r===void 0||r.call(t,e),this.runtime.setAttachState(Qe.Attaching)}async getRuntimeFactory(){var e;const t=(e=(await this._fluidModuleP).module)===null||e===void 0?void 0:e.fluidExport,r=t==null?void 0:t.IRuntimeFactory;if(r===void 0)throw new Error(MV);return r}async instantiateRuntime(e){const t=await this.getRuntimeFactory();this._runtime=await t.instantiateRuntime(this,e)}attachListener(){this.container.once("attached",()=>{this.runtime.setAttachState(Qe.Attached)})}async loadCodeModule(e){const t=await dt.timedExecAsync(this.taggedLogger,{eventName:"CodeLoad"},async()=>this.codeLoader.load(e));if("module"in t){const{module:r,details:i}=t;return{module:r,details:i??e}}else return this.taggedLogger.sendTelemetryEvent({eventName:"LegacyCodeLoader"}),t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ir;(function(n){n.Never="Never",n.Disabled="Disabled",n.Enabled="Enabled"})(Ir||(Ir={}));const BV=n=>{let e;return n&&"name"in n?e=n:bg(n==null?void 0:n.package)?e=n==null?void 0:n.package.name:e=n==null?void 0:n.package,{name:e}};var Mg={exports:{}};const{AbortController:uF,AbortSignal:jV}=typeof self<"u"?self:typeof window<"u"?window:void 0;Mg.exports=uF;Mg.exports.AbortSignal=jV;Mg.exports.default=uF;var qV=Mg.exports;const $b=Ms(qV);function xt(n){if(this._capacity=cF(n),this._length=0,this._front=0,lF(n)){for(var e=n.length,t=0;t<e;++t)this[t]=n[t];this._length=e}}xt.prototype.toArray=function(){for(var e=this._length,t=new Array(e),r=this._front,i=this._capacity,s=0;s<e;++s)t[s]=this[r+s&i-1];return t};xt.prototype.push=function(e){var t=arguments.length,r=this._length;if(t>1){var i=this._capacity;if(r+t>i){for(var o=0;o<t;++o){this._checkCapacity(r+1);var s=this._front+r&this._capacity-1;this[s]=arguments[o],r++,this._length=r}return r}else{for(var s=this._front,o=0;o<t;++o)this[s+r&i-1]=arguments[o],s++;return this._length=r+t,r+t}}if(t===0)return r;this._checkCapacity(r+1);var o=this._front+r&this._capacity-1;return this[o]=e,this._length=r+1,r+1};xt.prototype.pop=function(){var e=this._length;if(e!==0){var t=this._front+e-1&this._capacity-1,r=this[t];return this[t]=void 0,this._length=e-1,r}};xt.prototype.shift=function(){var e=this._length;if(e!==0){var t=this._front,r=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,r}};xt.prototype.unshift=function(e){var t=this._length,r=arguments.length;if(r>1){var o=this._capacity;if(t+r>o){for(var u=r-1;u>=0;u--){this._checkCapacity(t+1);var o=this._capacity,i=(this._front-1&o-1^o)-o;this[i]=arguments[u],t++,this._length=t,this._front=i}return t}else{for(var s=this._front,u=r-1;u>=0;u--){var i=(s-1&o-1^o)-o;this[i]=arguments[u],s=i}return this._front=s,this._length=t+r,t+r}}if(r===0)return t;this._checkCapacity(t+1);var o=this._capacity,u=(this._front-1&o-1^o)-o;return this[u]=e,this._length=t+1,this._front=u,t+1};xt.prototype.peekBack=function(){var e=this._length;if(e!==0){var t=this._front+e-1&this._capacity-1;return this[t]}};xt.prototype.peekFront=function(){if(this._length!==0)return this[this._front]};xt.prototype.get=function(e){var t=e;if(t===(t|0)){var r=this._length;if(t<0&&(t=t+r),!(t<0||t>=r))return this[this._front+t&this._capacity-1]}};xt.prototype.isEmpty=function(){return this._length===0};xt.prototype.clear=function(){for(var e=this._length,t=this._front,r=this._capacity,i=0;i<e;++i)this[t+i&r-1]=void 0;this._length=0,this._front=0};xt.prototype.toString=function(){return this.toArray().toString()};xt.prototype.valueOf=xt.prototype.toString;xt.prototype.removeFront=xt.prototype.shift;xt.prototype.removeBack=xt.prototype.pop;xt.prototype.insertFront=xt.prototype.unshift;xt.prototype.insertBack=xt.prototype.push;xt.prototype.enqueue=xt.prototype.push;xt.prototype.dequeue=xt.prototype.shift;xt.prototype.toJSON=xt.prototype.toArray;Object.defineProperty(xt.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}});xt.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(cF(this._capacity*1.5+16))};xt.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,i=this._length;if(r+i>t){var s=r+i&t-1;UV(this,0,this,t,s)}};var lF=Array.isArray;function UV(n,e,t,r,i){for(var s=0;s<i;++s)t[s+r]=n[s+e],n[s+e]=void 0}function zV(n){return n=n>>>0,n=n-1,n=n|n>>1,n=n|n>>2,n=n|n>>4,n=n|n>>8,n=n|n>>16,n+1}function cF(n){if(typeof n!="number")if(lF(n))n=n.length;else return 16;return zV(Math.min(Math.max(16,n),1073741824))}var $V=xt;const Hb=Ms($V);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Vb extends Ig{constructor(e){super(),this.worker=e,this.isDisposed=!1,this.q=new Hb,this.pauseCount=1}get disposed(){return this.isDisposed}get paused(){return this.pauseCount!==0}get length(){return this.q.length}get idle(){return this.processingPromise===void 0&&this.q.length===0}async waitTillProcessingDone(){var e;return(e=this.processingPromise)!==null&&e!==void 0?e:{count:0,duration:0}}dispose(){throw new Error("Not implemented.")}clear(){this.q.clear()}peek(){return this.q.peekFront()}toArray(){return this.q.toArray()}push(e){try{this.q.push(e),this.emit("push",e),this.ensureProcessing()}catch(t){this.emit("error",t)}}async pause(){this.pauseCount++,await this.waitTillProcessingDone()}resume(){$e(this.pauseCount>0,244),this.pauseCount--,this.ensureProcessing()}ensureProcessing(){this.anythingToProcess()&&this.processingPromise===void 0&&(this.processingPromise=Promise.resolve().then(()=>{$e(this.processingPromise!==void 0,"reentrancy?");const e=this.processDeltas();return $e(this.processingPromise!==void 0,"reentrancy?"),this.processingPromise=void 0,e}).catch(e=>(this.error=e,this.processingPromise=void 0,this.emit("error",e),{count:0,duration:0})),$e(this.processingPromise!==void 0,"processDeltas() should run async"))}anythingToProcess(){return this.q.length!==0&&!this.paused&&this.error===void 0}processDeltas(){const e=vr.now();let t=0;for(;this.anythingToProcess();){const i=this.q.shift();t++,this.worker(i),this.emit("op",i)}const r=vr.now()-e;return this.q.length===0&&this.emit("idle",t,r),{count:t,duration:r}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class HV extends Ig{constructor(e,t,r,i){super(),this.serviceProvider=e,this.logger=t,this._active=r,this.pending=[],this.minSequenceNumber=0,this.lastQueuedSequenceNumber=0,this.lastObservedSeqNumber=0,this.lastProcessedSequenceNumber=0,this.baseTerm=0,this.opsSize=0,this.initSequenceNumber=0,this.closed=!1,this.throttlingIdSet=new Set,this.timeTillThrottling=0,this.closeAbortController=new $b,this.deltaStorageDelayId=Xl(),this.deltaStreamDelayId=Xl(),this.messageBuffer=[];const s={incomingOpHandler:(o,u)=>{try{this.enqueueMessages(o,u)}catch(d){this.logger.sendErrorEvent({eventName:"EnqueueMessages_Exception"},d),this.close(Oi(d))}},signalHandler:o=>this._inboundSignal.push(o),reconnectionDelayHandler:(o,u)=>this.emitDelayInfo(this.deltaStreamDelayId,o,u),closeHandler:o=>this.close(o),disconnectHandler:o=>this.disconnectHandler(o),connectHandler:o=>this.connectHandler(o),pongHandler:o=>this.emit("pong",o),readonlyChangeHandler:o=>LO(this,this.logger,"readonly",o)};this.connectionManager=i(s),this._inbound=new Vb(o=>{this.processInboundMessage(o)}),this._inbound.on("error",o=>{this.close(pi.wrapIfUnrecognized(o,"deltaManagerInboundErrorHandler",this.lastMessage))}),this._inboundSignal=new Vb(o=>{if(this.handler===void 0)throw new Error("Attempted to process an inbound signal without a handler attached");this.handler.processSignal({clientId:o.clientId,content:JSON.parse(o.content)})}),this._inboundSignal.on("error",o=>{this.close(Oi(o))})}get active(){return this._active()}get disposed(){return this.closed}get IDeltaSender(){return this}get inbound(){return this._inbound}get inboundSignal(){return this._inboundSignal}get initialSequenceNumber(){return this.initSequenceNumber}get lastSequenceNumber(){return this.lastProcessedSequenceNumber}get lastMessage(){return this.lastProcessedMessage}get lastKnownSeqNumber(){return this.lastObservedSeqNumber}get referenceTerm(){return this.baseTerm}get minimumSequenceNumber(){return this.minSequenceNumber}get hasCheckpointSequenceNumber(){return $e(this.connectionManager.connected,223),this._checkpointSequenceNumber!==void 0}get maxMessageSize(){return this.connectionManager.maxMessageSize}get version(){return this.connectionManager.version}get serviceConfiguration(){return this.connectionManager.serviceConfiguration}get outbound(){return this.connectionManager.outbound}get readOnlyInfo(){return this.connectionManager.readOnlyInfo}get clientDetails(){return this.connectionManager.clientDetails}submit(e,t,r=!1,i){const s={contents:JSON.stringify(t),metadata:i,referenceSequenceNumber:this.lastProcessedSequenceNumber,type:e};r||this.flush();const o=this.connectionManager.prepareMessageToSend(s);return o===void 0?-1:(this.opsSize+=o.contents.length,this.messageBuffer.push(o),this.emit("submitOp",o),r||this.flush(),o.clientSequenceNumber)}submitSignal(e){return this.connectionManager.submitSignal(e)}flush(){this.messageBuffer.length!==0&&(this.emit("prepareSend",this.messageBuffer),this.connectionManager.sendMessages(this.messageBuffer),this.messageBuffer=[])}get connectionProps(){return Object.assign({sequenceNumber:this.lastSequenceNumber,opsSize:this.opsSize>0?this.opsSize:void 0},this.connectionManager.connectionProps)}logConnectionIssue(e){var t;$e(this.connectionManager.connected,568);const r=this.pending.sort((i,s)=>i.sequenceNumber-s.sequenceNumber);this.logger.sendErrorEvent(Object.assign(Object.assign(Object.assign(Object.assign({},e),{fetchReason:this.fetchReason,lastQueuedSequenceNumber:this.lastQueuedSequenceNumber,lastProcessedSequenceNumber:this.lastProcessedSequenceNumber,lastObserved:this.lastObservedSeqNumber}),this.connectionManager.connectionVerboseProps),{pendingOps:this.pending.length,pendingFirst:(t=r[0])===null||t===void 0?void 0:t.sequenceNumber,haveHandler:this.handler!==void 0,inboundLength:this.inbound.length,inboundPaused:this.inbound.paused}))}connectHandler(e){this.refreshDelayInfo(this.deltaStreamDelayId);const t=this.connectionManager.connectionVerboseProps;t.connectionLastQueuedSequenceNumber=this.lastQueuedSequenceNumber,t.connectionLastObservedSeqNumber=this.lastObservedSeqNumber;const r=e.checkpointSequenceNumber;this._checkpointSequenceNumber=r,r!==void 0&&this.updateLatestKnownOpSeqNumber(r),$e(this.messageBuffer.length===0,233),this.opsSize=0,this.emit("connect",e,r!==void 0?this.lastObservedSeqNumber-this.lastSequenceNumber:void 0),r!==void 0?r>this.lastQueuedSequenceNumber&&this.fetchMissingDeltas("AfterConnection"):e.mode==="read"&&this.fetchMissingDeltas("AfterReadConnection")}dispose(){throw new Error("Not implemented.")}async attachOpHandler(e,t,r,i,s="none"){if(this.initSequenceNumber=t,this.lastProcessedSequenceNumber=t,this.baseTerm=r,this.minSequenceNumber=e,this.lastQueuedSequenceNumber=t,this.lastObservedSeqNumber=t,$e(this.handler===void 0,226),this.handler=i,$e(!!this.handler,227),$e(this.fetchReason===void 0,616),!this.closed){if(this._inbound.resume(),this._inboundSignal.resume(),s!=="none"){const o=s==="cached";await this.fetchMissingDeltasCore(`DocumentOpen_${s}`,o),o&&this.fetchMissingDeltas("PostDocumentOpen")}$e(this.fetchReason!==void 0||this.pending.length===0,617)}}connect(e){var t;const r=(t=e.fetchOpsFromStorage)!==null&&t!==void 0?t:!0;MO(this.handler!==void 0||!r,this.logger,"CantFetchWithoutBaseline"),r&&this.fetchMissingDeltas(e.reason),this.connectionManager.connect(e.mode)}async getDeltas(e,t,r,i,s){const o=this.serviceProvider();if(o===void 0)throw new Error("Delta manager is not attached");this.deltaStorage===void 0&&(this.deltaStorage=await o.connectToDeltaStorage());let u;if(t!==void 0){const g=t-1;if(this.lastQueuedSequenceNumber>=g){this.logger.sendPerformanceEvent(Object.assign({reason:r,eventName:"ExtraStorageCall",early:!0,from:e,to:t},this.connectionManager.connectionVerboseProps));return}u=P=>P.sequenceNumber>=g}else u=g=>g.sequenceNumber>=this.lastObservedSeqNumber;const d=new $b;let f=!1;const m=g=>{$e(g.sequenceNumber===this.lastQueuedSequenceNumber,570),!f&&u(g)&&(d.abort(),this._inbound.off("push",m))};try{this._inbound.on("push",m),$e(this.closeAbortController.signal.onabort===null,488),this.closeAbortController.signal.onabort=()=>d.abort();const g=this.deltaStorage.fetchMessages(e,t,d.signal,s,r);for(;;){const P=await g.read();if(P.done)break;try{f=!0,i(P.value)}finally{f=!1}}}finally{this.closeAbortController.signal.onabort=null,this._inbound.off("push",m),$e(!f,649)}}close(e){this.closed||(this.closed=!0,this.connectionManager.dispose(e),this.closeAbortController.abort(),this._inbound.clear(),this._inboundSignal.clear(),this._inbound.pause(),this._inboundSignal.pause(),this.pending=[],this.emit("closed",e),this.removeAllListeners())}refreshDelayInfo(e){this.throttlingIdSet.delete(e),this.throttlingIdSet.size===0&&(this.timeTillThrottling=0)}disconnectHandler(e){this.messageBuffer.length=0,this.emit("disconnect",e)}emitDelayInfo(e,t,r){const i=Date.now();if(this.throttlingIdSet.add(e),t>0&&i+t>this.timeTillThrottling){this.timeTillThrottling=i+t;const s=ux.wrap(r,t/1e3,this.logger);this.emit("throttled",s)}}comparableMessagePayload(e){return`${e.clientId}-${e.type}-${e.minimumSequenceNumber}-${e.referenceSequenceNumber}-${e.timestamp}`}enqueueMessages(e,t,r=!1){var i,s;if(this.handler===void 0){this.pending=this.pending.concat(e);return}if($e(this.pending.length===0||this.fetchReason!==void 0,489),e.length===0)return;const o=e[0].sequenceNumber,u=e[e.length-1].sequenceNumber;if(u>this.lastQueuedSequenceNumber){let f=o-1;const m=f-this.lastQueuedSequenceNumber;let g,P=0,D=0;for(const U of e)U.sequenceNumber===f?P++:U.sequenceNumber!==f+1&&(D++,g===void 0&&(g=f+1)),f=U.sequenceNumber;let M;P!==0||D!==0&&!r||m>0&&this.fetchReason===void 0?M="enqueueMessages":this.fetchReason!==void 0&&this.fetchReason!==t&&o<=this.lastQueuedSequenceNumber+1&&u>this.lastQueuedSequenceNumber&&(M="enqueueMessagesExtraFetch"),M!==void 0&&this.logger.sendPerformanceEvent(Object.assign({eventName:M,reason:t,previousReason:this.prevEnqueueMessagesReason,from:o,to:u+1,length:e.length,fetchReason:this.fetchReason,duplicate:P>0?P:void 0,initialGap:m!==0?m:void 0,gap:D>0?D:void 0,firstMissing:g,dmInitialSeqNumber:this.initialSequenceNumber},this.connectionManager.connectionVerboseProps))}this.updateLatestKnownOpSeqNumber(e[e.length-1].sequenceNumber);const d=(i=this.previouslyProcessedMessage)===null||i===void 0?void 0:i.sequenceNumber;$e(d===void 0||d===this.lastQueuedSequenceNumber,236);for(const f of e)if(f.sequenceNumber<=this.lastQueuedSequenceNumber){if(((s=this.previouslyProcessedMessage)===null||s===void 0?void 0:s.sequenceNumber)===f.sequenceNumber){const m=this.comparableMessagePayload(this.previouslyProcessedMessage),g=this.comparableMessagePayload(f);if(m!==g){const P=new Lg("Found two messages with the same sequenceNumber but different payloads. Likely to be a service issue",mi.fileOverwrittenInStorage,{clientId:this.connectionManager.clientId,sequenceNumber:f.sequenceNumber,message1:m,message2:g,driverVersion:void 0});this.close(P)}}}else f.sequenceNumber!==this.lastQueuedSequenceNumber+1?(this.pending.push(f),this.fetchMissingDeltas(t,f.sequenceNumber)):(this.lastQueuedSequenceNumber=f.sequenceNumber,this.previouslyProcessedMessage=f,this._inbound.push(f));this.prevEnqueueMessagesReason=this.pending.length>0?"unknown":t}processInboundMessage(e){const t=Date.now();if(this.lastProcessedMessage=e,$e(e.clientId!==void 0||!DV(e),237),typeof e.contents=="string"&&e.contents!==""&&e.type!==Pi.ClientLeave&&(e.contents=JSON.parse(e.contents)),this.connectionManager.beforeProcessingIncomingOp(e),this.minSequenceNumber>e.minimumSequenceNumber)throw new Rs("Found a lower minimumSequenceNumber (msn) than previously recorded",Object.assign(Object.assign({},mu(e)),{clientId:this.connectionManager.clientId}));if(this.minSequenceNumber=e.minimumSequenceNumber,e.sequenceNumber!==this.lastProcessedSequenceNumber+1)throw new Rs("Found a non-Sequential sequenceNumber",Object.assign(Object.assign({},mu(e)),{clientId:this.connectionManager.clientId}));if(this.lastProcessedSequenceNumber=e.sequenceNumber,$e(this.lastProcessedSequenceNumber<=this.lastObservedSeqNumber,615),e.term===void 0&&(e.term=1),this.baseTerm=e.term,this.handler===void 0)throw new Error("Attempted to process an inbound message without a handler attached");this.handler.process(e);const r=Date.now();this.emit("op",e,r-t)}fetchMissingDeltas(e,t){this.fetchMissingDeltasCore(e,!1,t).catch(r=>{this.logger.sendErrorEvent({eventName:"fetchMissingDeltasException"},r)})}async fetchMissingDeltasCore(e,t,r){var i;if(this.fetchReason===void 0){if(this.closed){this.logger.sendTelemetryEvent({eventName:"fetchMissingDeltasClosedConnection",reason:e});return}if(this.handler===void 0){$e(this.lastQueuedSequenceNumber===0,619);return}try{let s=this.lastQueuedSequenceNumber+1;const o=(i=this.previouslyProcessedMessage)===null||i===void 0?void 0:i.sequenceNumber;o!==void 0&&($e(o===this.lastQueuedSequenceNumber,242),$e(s>1,243),s--);const u=`${e}_fetch`;this.fetchReason=u,await this.getDeltas(s,r,u,d=>{this.refreshDelayInfo(this.deltaStorageDelayId),this.enqueueMessages(d,u)},t)}catch(s){this.logger.sendErrorEvent({eventName:"GetDeltas_Exception"},s),this.close(Oi(s))}finally{this.refreshDelayInfo(this.deltaStorageDelayId),this.fetchReason=void 0,this.processPendingOps(e)}}}processPendingOps(e){if(this.closed)return;$e(this.handler!==void 0,620);const t=this.pending.sort((r,i)=>r.sequenceNumber-i.sequenceNumber);this.pending=[],this.enqueueMessages(t,`${e}_pending`,!0),this.fetchReason===void 0&&this.lastQueuedSequenceNumber<this.lastObservedSeqNumber&&this.fetchMissingDeltas("OpsBehind")}updateLatestKnownOpSeqNumber(e){this.lastObservedSeqNumber<e&&(this.lastObservedSeqNumber=e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Hy extends zh{constructor(e){super(e),this.queue=e}get paused(){return this.queue.paused}get length(){return this.queue.length}get idle(){return this.queue.idle}peek(){return this.queue.peek()}toArray(){return this.queue.toArray()}async systemPause(){return this.pause()}async pause(){return this.queue.pause()}async systemResume(){return this.resume()}async resume(){this.queue.resume()}async waitTillProcessingDone(){return this.queue.waitTillProcessingDone()}}class VV extends zh{constructor(e){super(e),this.deltaManager=e,this.inbound=new Hy(e.inbound),this.outbound=new Hy(e.outbound),this.inboundSignal=new Hy(e.inboundSignal)}get IDeltaSender(){return this}get minimumSequenceNumber(){return this.deltaManager.minimumSequenceNumber}get lastSequenceNumber(){return this.deltaManager.lastSequenceNumber}get lastMessage(){return this.deltaManager.lastMessage}get lastKnownSeqNumber(){return this.deltaManager.lastKnownSeqNumber}get initialSequenceNumber(){return this.deltaManager.initialSequenceNumber}get hasCheckpointSequenceNumber(){return this.deltaManager.hasCheckpointSequenceNumber}get clientDetails(){return this.deltaManager.clientDetails}get version(){return this.deltaManager.version}get maxMessageSize(){return this.deltaManager.maxMessageSize}get serviceConfiguration(){return this.deltaManager.serviceConfiguration}get active(){return this.deltaManager.active}get readOnlyInfo(){return this.deltaManager.readOnlyInfo}dispose(){this.inbound.dispose(),this.outbound.dispose(),this.inboundSignal.dispose(),super.dispose()}submitSignal(e){return this.deltaManager.submitSignal(e)}flush(){return this.deltaManager.flush()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Vy(n){var e;const t=Bb(n,!0);if(typeof t.pathname!="string")throw new st("Failed to parse pathname");const r=(e=t.search)!==null&&e!==void 0?e:"",s=/^\/([^/]*\/[^/]*)(\/?.*)$/.exec(t.pathname);return(s==null?void 0:s.length)===3?{id:s[1],path:s[2],query:r,version:t.query.version}:void 0}function dF(n){const e={blobs:{},blobsContents:{},trees:{},id:Xl(),unreferenced:n.unreferenced},t=Object.keys(n.tree);for(const r of t){const i=n.tree[r];switch(i.type){case ii.Tree:{e.trees[r]=dF(i);break}case ii.Attachment:e.blobs[r]=i.id;break;case ii.Blob:{const s=Xl();e.blobs[r]=s;const o=typeof i.content=="string"?qq(i.content,"utf8"):Pz(i.content);e.blobsContents[s]=o;break}case ii.Handle:throw new st("No handles should be there in summary in detached container!!");default:Eb(i,`Unknown tree type ${i.type}`)}}return e}function WV(n,e){const t={type:ii.Tree,tree:Object.assign({},e.tree)};return t.tree[".protocol"]=n,dF(t)}const Wy=n=>{const e=n.tree[".protocol"],t=n.tree[".app"];return $e(e!==void 0&&t!==void 0,480),WV(e,t)};function aP(n){return".protocol"in n.trees?n.trees[".protocol"]:n}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const hF="1.3.6";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function fF(n){return n.headers===void 0?!0:n.headers[Ht.cache]!==!1}class GV{constructor(e,t){this.container=e,this.loader=t}get IFluidRouter(){return this}async resolve(e){var t,r,i,s,o;if(e.url.startsWith("/")){if(fF(e))return this.container;{const u=this.container.resolvedUrl;return Ns(u),await Es.load(this.loader,{canReconnect:(t=e.headers)===null||t===void 0?void 0:t[Ht.reconnect],clientDetailsOverride:(r=e.headers)===null||r===void 0?void 0:r[Ht.clientDetails],resolvedUrl:Object.assign({},u),version:(s=(i=e.headers)===null||i===void 0?void 0:i[Ht.version])!==null&&s!==void 0?s:void 0,loadMode:(o=e.headers)===null||o===void 0?void 0:o[Ht.loadMode]})}}if(this.loader===void 0)throw new Error("Cannot resolve external containers");return this.loader.resolve(e)}async request(e){return e.url.startsWith("/")?(await this.resolve(e)).request(e):this.loader===void 0?{status:404,value:"Cannot request external containers",mimeType:"plain/text"}:this.loader.request(e)}}function KV(n){const e=Object.create(n),t=new Map;return e.resolve=async r=>fF(r)?(t.has(r.url)||t.set(r.url,n.resolve(r)),t.get(r.url)):n.resolve(r),e}class JV{constructor(e){var t,r;this.containers=new Map;const i=Object.assign({},e.scope);((t=e.options)===null||t===void 0?void 0:t.provideScopeLoader)!==!1&&(i.ILoader=this);const s={loaderId:Xl(),loaderVersion:hF},o=Ag(Nl.mixinDebugLogger("fluid:telemetry",e.logger,{all:s}),XC.value,e.configProvider);this.services={urlResolver:KV(xx.create(e.urlResolver)),documentServiceFactory:Cx.create(e.documentServiceFactory),codeLoader:e.codeLoader,options:(r=e.options)!==null&&r!==void 0?r:{},scope:i,subLogger:o.logger,detachedBlobStorage:e.detachedBlobStorage},this.mc=Iu(at.create(this.services.subLogger,"Loader"))}get IFluidRouter(){return this}async createDetachedContainer(e){const t=await Es.createDetached(this,e);return this.cachingEnabled&&t.once("attached",()=>{Ns(t.resolvedUrl);const r=Vy(t.resolvedUrl.url);r!==void 0&&this.addToContainerCache(r.id,Promise.resolve(t))}),t}async rehydrateDetachedContainerFromSnapshot(e){return Es.rehydrateDetachedFromSnapshot(this,e)}async resolve(e,t){const r=t===void 0?"Resolve":"ResolveWithPendingState";return dt.timedExecAsync(this.mc.logger,{eventName:r},async()=>(await this.resolveCore(e,t!==void 0?JSON.parse(t):void 0)).container)}async request(e){return dt.timedExecAsync(this.mc.logger,{eventName:"Request"},async()=>{const t=await this.resolveCore(e);return t.container.request(Object.assign(Object.assign({},e),{url:`${t.parsed.path}${t.parsed.query}`}))})}getKeyForContainerCache(e,t){var r;return((r=e.headers)===null||r===void 0?void 0:r[Ht.version])!==void 0?`${t.id}@${e.headers[Ht.version]}`:t.id}addToContainerCache(e,t){this.containers.set(e,t),t.then(r=>{r.closed?this.containers.delete(e):r.once("closed",()=>{this.containers.delete(e)})}).catch(r=>{})}async resolveCore(e,t){const r=await this.services.urlResolver.resolve(e);Ns(r);const i=Vy(r.url);if(i===void 0)throw new Error(`Invalid URL ${r.url}`);if(t!==void 0){const f=Vy(t.url);if((f==null?void 0:f.id)!==i.id||(f==null?void 0:f.path.replace(/\/$/,""))!==i.path.replace(/\/$/,"")){const m=`URL ${r.url} does not match pending state URL ${t.url}`;throw new Error(m)}}const{canCache:s,fromSequenceNumber:o}=this.parseHeader(i,e),u=t!==void 0?!1:s;let d;if(u){const f=this.getKeyForContainerCache(e,i),m=await this.containers.get(f);if(m!==void 0)d=m;else{const g=this.loadContainer(e,r);this.addToContainerCache(f,g),d=await g}}else d=await this.loadContainer(e,r,t);return d.deltaManager.lastSequenceNumber<=o&&await new Promise((f,m)=>{function g(P){P.sequenceNumber>o&&(f(),d.removeListener("op",g))}d.on("op",g)}),{container:d,parsed:i}}get cachingEnabled(){return this.services.options.cache!==!1}canCacheForRequest(e){return this.cachingEnabled&&e[Ht.cache]!==!1}parseHeader(e,t){var r,i;let s=-1;t.headers=(r=t.headers)!==null&&r!==void 0?r:{};const o=t.headers[Ht.sequenceNumber];return o!==void 0&&(s=o),t.headers[Ht.version]=(i=e.version)!==null&&i!==void 0?i:t.headers[Ht.version],{canCache:this.canCacheForRequest(t.headers),fromSequenceNumber:s}}async loadContainer(e,t,r){var i,s,o,u,d;return Es.load(this,{canReconnect:(i=e.headers)===null||i===void 0?void 0:i[Ht.reconnect],clientDetailsOverride:(s=e.headers)===null||s===void 0?void 0:s[Ht.clientDetails],resolvedUrl:t,version:(u=(o=e.headers)===null||o===void 0?void 0:o[Ht.version])!==null&&u!==void 0?u:void 0,loadMode:(d=e.headers)===null||d===void 0?void 0:d[Ht.loadMode]},r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const QV=45e3;class XV{constructor(e,t,r){var i;this.handler=e,this.logger=t,this._clientId=r,this._connectionState=Tt.Disconnected,this.prevClientLeftTimer=new xb((i=this.handler.maxClientLeaveWaitTime)!==null&&i!==void 0?i:3e5,()=>{$e(!this.connected,684),this.applyForConnectedState("timeout")}),this.joinOpTimer=new xb(QV,()=>{var s;if(this.connectionState!==Tt.CatchingUp)return;const o=this.handler.quorumClients(),u={quorumInitialized:o!==void 0,hasPendingClientId:this.pendingClientId!==void 0,inQuorum:(o==null?void 0:o.getMember((s=this.pendingClientId)!==null&&s!==void 0?s:""))!==void 0,waitingForLeaveOp:this.waitingForLeaveOp};this.handler.logConnectionIssue("NoJoinOp",u)})}get connectionState(){return this._connectionState}get connected(){return this.connectionState===Tt.Connected}get clientId(){return this._clientId}get pendingClientId(){return this._pendingClientId}startJoinOpTimer(){$e(!this.joinOpTimer.hasTimer,564),this.joinOpTimer.start()}stopJoinOpTimer(){$e(this.joinOpTimer.hasTimer,565),this.joinOpTimer.clear()}get waitingForLeaveOp(){return this.prevClientLeftTimer.hasTimer}dispose(){$e(!this.joinOpTimer.hasTimer,677),this.prevClientLeftTimer.clear()}containerSaved(){this.waitingForLeaveOp&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("containerSaved"))}receivedAddMemberEvent(e){e===this.pendingClientId&&(this.joinOpTimer.hasTimer?this.stopJoinOpTimer():this.handler.logConnectionIssue("ReceivedJoinOp"),this.waitingForLeaveOp&&(this.waitEvent=dt.start(this.logger,{eventName:"WaitBeforeClientLeave",details:JSON.stringify({waitOnClientId:this._clientId,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.applyForConnectedState("addMemberEvent"))}applyForConnectedState(e){var t,r;const i=this.handler.quorumClients();$e(i!==void 0,566),$e(this.waitingForLeaveOp===!1||this.clientId!==void 0&&i.getMember(this.clientId)!==void 0,738),this.pendingClientId!==this.clientId&&this.pendingClientId!==void 0&&i.getMember(this.pendingClientId)!==void 0&&!this.waitingForLeaveOp?((t=this.waitEvent)===null||t===void 0||t.end({source:e}),this.setConnectionState(Tt.Connected)):this.logger.sendTelemetryEvent({eventName:"connectedStateRejected",category:e==="timeout"?"error":"generic",details:JSON.stringify({source:e,pendingClientId:this.pendingClientId,clientId:this.clientId,waitingForLeaveOp:this.waitingForLeaveOp,inQuorum:(i==null?void 0:i.getMember((r=this.pendingClientId)!==null&&r!==void 0?r:""))!==void 0})})}receivedRemoveMemberEvent(e){this.clientId===e&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("removeMemberEvent"))}receivedDisconnectEvent(e){this.joinOpTimer.hasTimer&&this.stopJoinOpTimer(),this.setConnectionState(Tt.Disconnected,e)}receivedConnectEvent(e,t){const r=this._connectionState;this._connectionState=Tt.CatchingUp;const i=e==="write";$e(i||!this.handler.shouldClientJoinWrite(),778),$e(i||!this.waitingForLeaveOp,678);const s=this.handler.quorumClients();this._pendingClientId=t.clientId,this.handler.logConnectionStateChangeTelemetry(Tt.CatchingUp,r),i&&(s==null?void 0:s.getMember(this._pendingClientId))===void 0?this.startJoinOpTimer():this.waitingForLeaveOp||this.setConnectionState(Tt.Connected)}setConnectionState(e,t){if(this.connectionState===e){this.logger.sendErrorEvent({eventName:"setConnectionStateSame",value:e});return}const r=this._connectionState;this._connectionState=e;const i=this.handler.quorumClients();let s;this._clientId!==void 0&&(s=i==null?void 0:i.getMember(this._clientId)),e===Tt.Connected?($e(r===Tt.CatchingUp,472),s!==void 0&&(s.shouldHaveLeft=!0),this._clientId=this.pendingClientId):e===Tt.Disconnected&&(this._pendingClientId=void 0,s!==void 0&&this.handler.shouldClientJoinWrite()&&this.prevClientLeftTimer.hasTimer===!1?this.prevClientLeftTimer.restart():this.logger.sendTelemetryEvent({eventName:"noWaitOnDisconnected",details:JSON.stringify({inQuorum:s!==void 0,waitingForLeaveOp:this.waitingForLeaveOp,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.handler.logConnectionStateChangeTelemetry(this._connectionState,r,t),this.handler.connectionStateChanged()}initProtocol(e){e.quorum.on("addMember",(t,r)=>{this.receivedAddMemberEvent(t)}),e.quorum.on("removeMember",t=>{this.receivedRemoveMemberEvent(t)}),this.clientId!==void 0&&e.quorum.getMember(this.clientId)!==void 0&&this.prevClientLeftTimer.restart()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class YV{constructor(e,t){this.internalStorageService=e,this.logger=t,this._disposed=!1}get policies(){return this.internalStorageService.policies}get disposed(){return this._disposed}dispose(){this._disposed=!0}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.runWithRetry(async()=>this.internalStorageService.getSnapshotTree(e,t),"storage_getSnapshotTree")}async readBlob(e){return this.runWithRetry(async()=>this.internalStorageService.readBlob(e),"storage_readBlob")}async getVersions(e,t,r){return this.runWithRetry(async()=>this.internalStorageService.getVersions(e,t,r),"storage_getVersions")}async uploadSummaryWithContext(e,t){return $e(t.referenceSequenceNumber===0==(t.ackHandle===void 0),593),t.referenceSequenceNumber!==0?this.internalStorageService.uploadSummaryWithContext(e,t):this.runWithRetry(async()=>this.internalStorageService.uploadSummaryWithContext(e,t),"storage_uploadSummaryWithContext")}async downloadSummary(e){return this.runWithRetry(async()=>this.internalStorageService.downloadSummary(e),"storage_downloadSummary")}async createBlob(e){return this.runWithRetry(async()=>this.internalStorageService.createBlob(e),"storage_createBlob")}checkStorageDisposed(){if(this._disposed)throw new ro("Storage Service is disposed. Cannot retry",{canRetry:!1})}async runWithRetry(e,t){return Tx(e,t,this.logger,{onRetry:()=>this.checkStorageDisposed()})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ZV{constructor(e,t){this.internalStorageService=e,this.generateProtocolTree=t,this.getSnapshotTree=this.internalStorageService.getSnapshotTree.bind(this.internalStorageService),this.getVersions=this.internalStorageService.getVersions.bind(this.internalStorageService),this.createBlob=this.internalStorageService.createBlob.bind(this.internalStorageService),this.readBlob=this.internalStorageService.readBlob.bind(this.internalStorageService),this.downloadSummary=this.internalStorageService.downloadSummary.bind(this.internalStorageService),this.dispose=this.internalStorageService.dispose.bind(this.internalStorageService)}get policies(){return this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}get disposed(){return this.internalStorageService.disposed}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(em(e,this.generateProtocolTree()),t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class eW{constructor(e){this.storageGetter=e,this.blobContents={}}loadSnapshotForRehydratingContainer(e){this.getBlobContents(e)}getBlobContents(e){for(const[t,r]of Object.entries(e.blobsContents))this.blobContents[t]=r;for(const[t,r]of Object.entries(e.trees))this.getBlobContents(r)}get policies(){try{return this.storageGetter().policies}catch{}}get repositoryUrl(){return this.storageGetter().repositoryUrl}async getSnapshotTree(e,t){return this.storageGetter().getSnapshotTree(e,t)}async readBlob(e){const t=this.blobContents[e];return t!==void 0?t:this.storageGetter().readBlob(e)}async getVersions(e,t,r){return this.storageGetter().getVersions(e,t,r)}async uploadSummaryWithContext(e,t){return this.storageGetter().uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storageGetter().downloadSummary(e)}async createBlob(e){return this.storageGetter().createBlob(e)}}class tW{constructor(e,t){this.blobStorage=e,this.logger=t,this.getSnapshotTree=this.notCalled,this.getVersions=this.notCalled,this.write=this.notCalled,this.uploadSummaryWithContext=this.notCalled,this.downloadSummary=this.notCalled}async createBlob(e){return this.blobStorage.createBlob(e)}async readBlob(e){return this.blobStorage.readBlob(e)}get policies(){return this.notCalled()}get repositoryUrl(){return this.notCalled()}notCalled(){try{throw new Error("BlobOnlyStorage not implemented method used")}catch(e){throw this.logger.sendErrorEvent({eventName:"BlobOnlyStorageWrongCall"},e),e}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class nW extends zh{constructor(e){super(e),super.setMaxListeners(50),this.propose=cd(this,e.propose.bind(e)),this.has=cd(this,e.has.bind(e)),this.get=cd(this,e.get.bind(e)),this.getMembers=cd(this,e.getMembers.bind(e)),this.getMember=cd(this,e.getMember.bind(e))}}function rW(n){const t=new Map(n).get("code");return $e(t!==void 0,732),t==null?void 0:t.value}function uP(n){return[["code",{key:"code",value:n,approvalSequenceNumber:0,commitSequenceNumber:0,sequenceNumber:0}]]}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const iW=2e3,sW=50;class oW{constructor(e,t=iW,r=sW){this.submit=e,this.NoopCountFrequency=r,this.opsCountSinceNoop=0,t!==1/0&&(this.timer=new xb(t,()=>{this.opsCountSinceNoop!==0&&this.submitNoop(!1)}))}scheduleSequenceNumberUpdate(e,t){if(t){this.submitNoop(!0);return}if(wh(e)){if(this.opsCountSinceNoop++,this.opsCountSinceNoop>=this.NoopCountFrequency){this.submitNoop(!1);return}this.timer!==void 0&&(this.opsCountSinceNoop===1&&this.timer.restart(),$e(this.timer.hasTimer,578))}}submitNoop(e){this.submit(Pi.NoOp,e?"":null),$e(this.opsCountSinceNoop===0,579)}stopSequenceNumberUpdate(){this.opsCountSinceNoop=0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const aW=8e3,uW=1e3,lW=16*1024,lP={fatalConnectError:!0};function cW(n){const e=`Nack (${n.type}): ${n.message}`,t=n.code!==403,r=n.retryAfter!==void 0?n.retryAfter*1e3:void 0;return rc(e,{canRetry:t,retryAfterMs:r},{statusCode:n.code,driverVersion:void 0})}class Gy extends Ig{constructor(){super(...arguments),this.clientId="storage-only client",this.claims={scopes:[Wm.DocRead]},this.mode="read",this.existing=!0,this.maxMessageSize=0,this.version="",this.initialMessages=[],this.initialSignals=[],this.initialClients=[],this.serviceConfiguration={maxMessageSize:0,blockSize:0,summary:void 0},this.checkpointSequenceNumber=void 0,this._disposed=!1}submit(e){this.emit("nack",this.clientId,e.map(t=>({operation:t,content:{message:"Cannot submit with storage-only connection",code:403}})))}submitSignal(e){this.emit("nack",this.clientId,{operation:e,content:{message:"Cannot submit signal with storage-only connection",code:403}})}get disposed(){return this._disposed}dispose(){this._disposed=!0}}class Rx{constructor(e,t,r,i,s){this.serviceProvider=e,this.client=t,this.logger=i,this.props=s,this._forceReadonly=!1,this.pendingReconnect=!1,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0,this.trailingNoopCount=0,this.connectFirstConnection=!0,this._connectionVerboseProps={},this._connectionProps={},this.closed=!1,this.opHandler=(o,u)=>{const d=Array.isArray(u)?u:[u];this.props.incomingOpHandler(d,"opHandler")},this.nackHandler=(o,u)=>{const d=u[0];if(this._readonlyPermissions===!0){this.props.closeHandler(xV("writeOnReadOnlyDocument",{driverVersion:void 0}));return}const f=cW(d.content);if(!f.canRetry){this.props.closeHandler(f);return}this.reconnectOnError("write",f)},this.disconnectHandlerInternal=o=>{this.reconnectOnError(this.defaultReconnectionMode,o)},this.errorHandler=o=>{this.reconnectOnError(this.defaultReconnectionMode,o)},this.clientDetails=this.client.details,this.defaultReconnectionMode=this.client.mode,this._reconnectMode=r?Ir.Enabled:Ir.Never,this._outbound=new Vb(o=>{if(this.connection===void 0)throw new Error("Attempted to submit an outbound message without connection");this.connection.submit(o)}),this._outbound.on("error",o=>{this.props.closeHandler(Oi(o))})}get connectionVerboseProps(){return this._connectionVerboseProps}get connectionMode(){var e,t;return(t=(e=this.connection)===null||e===void 0?void 0:e.mode)!==null&&t!==void 0?t:"read"}get connected(){return this.connection!==void 0}get clientId(){var e;return(e=this.connection)===null||e===void 0?void 0:e.clientId}get reconnectMode(){return this._reconnectMode}get maxMessageSize(){var e,t,r;return(r=(t=(e=this.connection)===null||e===void 0?void 0:e.serviceConfiguration)===null||t===void 0?void 0:t.maxMessageSize)!==null&&r!==void 0?r:lW}get version(){if(this.connection===void 0)throw new Error("Cannot check version without a connection");return this.connection.version}get serviceConfiguration(){var e;return(e=this.connection)===null||e===void 0?void 0:e.serviceConfiguration}get scopes(){var e;return(e=this.connection)===null||e===void 0?void 0:e.claims.scopes}get outbound(){return this._outbound}get connectionProps(){return this.connection!==void 0?this._connectionProps:Object.assign(Object.assign({},this._connectionProps),{sentOps:this.clientSequenceNumber})}shouldJoinWrite(){return this.clientSequenceNumberObserved<this.clientSequenceNumber-this.trailingNoopCount}get readonly(){return this._forceReadonly?!0:this._readonlyPermissions}get readOnlyInfo(){const e=this.connection!==void 0&&this.connection instanceof Gy;return e||this._forceReadonly||this._readonlyPermissions===!0?{readonly:!0,forced:this._forceReadonly,permissions:this._readonlyPermissions,storageOnly:e}:{readonly:this._readonlyPermissions}}static detailsFromConnection(e){return{claims:e.claims,clientId:e.clientId,existing:e.existing,checkpointSequenceNumber:e.checkpointSequenceNumber,get initialClients(){return e.initialClients},mode:e.mode,serviceConfiguration:e.serviceConfiguration,version:e.version}}dispose(e){if(this.closed)return;this.closed=!0,this.pendingConnection=void 0,this._reconnectMode=Ir.Never,this._outbound.clear();const t=e!==void 0?`Closing DeltaManager (${e.message})`:"Closing DeltaManager";this.disconnectFromDeltaStream(t),this.set_readonlyPermissions(!0)}setAutoReconnect(e){$e(e!==Ir.Never&&this._reconnectMode!==Ir.Never,632),this._reconnectMode=e,e!==Ir.Enabled&&this.disconnectFromDeltaStream("setAutoReconnect")}forceReadonly(e){e!==this._forceReadonly&&this.logger.sendTelemetryEvent({eventName:"ForceReadOnly",value:e});const t=this.readonly;if(this._forceReadonly=e,t!==this.readonly){if(this._reconnectMode===Ir.Never)throw new Ct("API is not supported for non-connecting or closed container");let r=!1;this.readonly===!0&&(this.shouldJoinWrite()&&this.logger.sendErrorEvent({eventName:"ForceReadonlyPendingChanged"}),r=this.disconnectFromDeltaStream("Force readonly")),this.props.readonlyChangeHandler(this.readonly),r&&this.triggerConnect("read")}}set_readonlyPermissions(e){const t=this.readonly;this._readonlyPermissions=e,t!==this.readonly&&this.props.readonlyChangeHandler(this.readonly)}connect(e){this.connectCore(e).catch(t=>{const r=Oi(t,{props:lP});this.props.closeHandler(r)})}async connectCore(e){var t,r;if($e(!this.closed,618),this.connection!==void 0)return;let i;this.pendingConnection!==void 0&&(i=this.pendingConnection.connectionMode,this.cancelConnection(),$e(this.pendingConnection===void 0,836));let s=(t=e??i)!==null&&t!==void 0?t:this.defaultReconnectionMode;this.shouldJoinWrite()&&(s="write");const o=this.serviceProvider();$e(o!==void 0,679);let u;if(((r=o.policies)===null||r===void 0?void 0:r.storageOnly)===!0){u=new Gy,this.setupNewSuccessfulConnection(u,"read"),$e(this.pendingConnection===void 0,691);return}let d=uW,f=0;const m=vr.now();let g;const P=new $b,D=P.signal;for(this.pendingConnection={abort:()=>{P.abort()},connectionMode:s};u===void 0;){if(this.closed)throw new Error("Attempting to connect a closed DeltaManager");if(D.aborted===!0){this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:f,duration:qt.formatTick(vr.now()-m),connectionEstablished:!1});return}f++;try{this.client.mode=s,u=await o.connectToDeltaStream(Object.assign(Object.assign({},this.client),{mode:s})),u.disposed&&(this.logger.sendTelemetryEvent({eventName:"ReceivedClosedConnection"}),u=void 0)}catch(M){if(typeof M=="object"&&M!==null&&(M==null?void 0:M.errorType)===Dg.errorType){u=new Gy,s="read";break}if(!Kh(M)){const j=Oi(M,{props:lP});throw this.props.closeHandler(j),j}qb(this.logger,{attempts:f,delay:d,eventName:"DeltaConnectionFailureToConnect",duration:qt.formatTick(vr.now()-m)},M),g=M;const U=Hm(M);d=U??Math.min(d*2,aW),U!==void 0&&this.props.reconnectionDelayHandler(U,M),await Ub(d)}}if(f>1&&qb(this.logger,{eventName:"MultipleDeltaConnectionFailures",attempts:f,duration:qt.formatTick(vr.now()-m)},g),D.aborted===!0){u.dispose(),this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:f,duration:qt.formatTick(vr.now()-m),connectionEstablished:!0});return}this.setupNewSuccessfulConnection(u,s)}triggerConnect(e){$e(this.connection===void 0,569),this.reconnectMode===Ir.Enabled&&this.connect(e)}disconnectFromDeltaStream(e){if(this.pendingReconnect=!1,this.connection===void 0)return this.pendingConnection!==void 0?(this.cancelConnection(),!0):!1;$e(this.pendingConnection===void 0,635);const t=this.connection;return this.connection=void 0,t.off("op",this.opHandler),t.off("signal",this.props.signalHandler),t.off("nack",this.nackHandler),t.off("disconnect",this.disconnectHandlerInternal),t.off("error",this.errorHandler),t.off("pong",this.props.pongHandler),this._outbound.pause(),this._outbound.clear(),this.props.disconnectHandler(e),t.dispose(),this._connectionVerboseProps={},!0}cancelConnection(){$e(this.pendingConnection!==void 0,837),this.pendingConnection.abort(),this.pendingConnection=void 0,this.logger.sendTelemetryEvent({eventName:"ConnectionCancelReceived"})}setupNewSuccessfulConnection(e,t){$e(this.connection===void 0,230),$e(!e.disposed,650),this.pendingConnection=void 0,this.connection=e;const r=!e.claims.scopes.includes(Wm.DocWrite);if($e(t==="read"||r===(this.connectionMode==="read"),231),$e(!r||this.connectionMode==="read",232),this.set_readonlyPermissions(r),this.closed){this.disconnectFromDeltaStream("ConnectionManager already closed");return}this._outbound.resume(),e.on("op",this.opHandler),e.on("signal",this.props.signalHandler),e.on("nack",this.nackHandler),e.on("disconnect",this.disconnectHandlerInternal),e.on("error",this.errorHandler),e.on("pong",this.props.pongHandler);const i=e.initialMessages.sort((d,f)=>d.sequenceNumber-f.sequenceNumber);let s=e.checkpointSequenceNumber;this._connectionVerboseProps={clientId:e.clientId,mode:e.mode},this._connectionProps={},e.relayServiceAgent!==void 0&&(this._connectionVerboseProps.relayServiceAgent=e.relayServiceAgent,this._connectionProps.relayServiceAgent=e.relayServiceAgent),this._connectionProps.socketDocumentId=e.claims.documentId,this._connectionProps.connectionMode=e.mode;let o=-1;if(i.length!==0&&(this._connectionVerboseProps.connectionInitialOpsFrom=i[0].sequenceNumber,o=i[i.length-1].sequenceNumber,this._connectionVerboseProps.connectionInitialOpsTo=o+1,(s===void 0||s<o)&&(s=o)),this.props.incomingOpHandler(i,this.connectFirstConnection?"InitialOps":"ReconnectOps"),e.initialSignals!==void 0)for(const d of e.initialSignals)this.props.signalHandler(d);const u=Rx.detailsFromConnection(e);u.checkpointSequenceNumber=s,this.props.connectHandler(u),this.connectFirstConnection=!1}reconnectOnError(e,t){this.reconnect(e,t.message,t).catch(this.props.closeHandler)}async reconnect(e,t,r){if($e(this.connection!==void 0,235),this.disconnectFromDeltaStream(t),r!==void 0&&!r.canRetry&&this.logger.sendTelemetryEvent({eventName:"reconnectingDespiteFatalError",reconnectMode:this.reconnectMode},r),this.reconnectMode===Ir.Never&&this.props.closeHandler(),this.closed||this.reconnectMode!==Ir.Enabled)return;const i=Hm(r);r!==void 0&&i!==void 0&&(this.props.reconnectionDelayHandler(i,r),await Ub(i)),this.triggerConnect(e)}prepareMessageToSend(e){var t,r;if(this.readonly===!0){$e(this.readOnlyInfo.readonly===!0,496);const i=new ro("deltaManagerReadonlySubmit",void 0,{readonly:this.readOnlyInfo.readonly,forcedReadonly:this.readOnlyInfo.forced,readonlyPermissions:this.readOnlyInfo.permissions,storageOnly:this.readOnlyInfo.storageOnly});this.props.closeHandler(i);return}return $e(!!this.connection,228),this.lastSubmittedClientId!==((t=this.connection)===null||t===void 0?void 0:t.clientId)&&(this.lastSubmittedClientId=(r=this.connection)===null||r===void 0?void 0:r.clientId,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0),e.type===Pi.NoOp?this.trailingNoopCount++:this.trailingNoopCount=0,Object.assign(Object.assign({},e),{clientSequenceNumber:++this.clientSequenceNumber})}submitSignal(e){this.connection!==void 0?this.connection.submitSignal(e):this.logger.sendErrorEvent({eventName:"submitSignalDisconnected"})}sendMessages(e){if($e(this.connected,692),this.connectionMode==="read"){this.pendingReconnect||(this.pendingReconnect=!0,Promise.resolve().then(async()=>{this.pendingReconnect&&await this.reconnect("write","Switch to write")}).catch(()=>{}));return}$e(!this.pendingReconnect,693),this._outbound.push(e)}beforeProcessingIncomingOp(e){if($e(this.clientId!==e.clientId||this.lastSubmittedClientId===e.clientId,238),this.lastSubmittedClientId!==void 0&&this.lastSubmittedClientId===e.clientId){const t=e.clientSequenceNumber;$e(this.clientSequenceNumberObserved<t,239),$e(t<=this.clientSequenceNumber,240),this.clientSequenceNumberObserved=t}e.type===Pi.ClientLeave&&JSON.parse(e.data)===this.clientId&&(this.logger.sendPerformanceEvent({eventName:"ReadConnectionTransition"}),this.reconnect("read","Switch to read").catch(i=>{this.logger.sendErrorEvent({eventName:"SwitchToReadConnection"},i)}))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const dW=0,cP="dirty",Ky="saved",hW=n=>{var e;return(e=n.get("code"))!==null&&e!==void 0?e:n.get("code2")};async function dP(n,e,t){const r=dt.start(n,{eventName:e}),i=await t();r.duration>1e3&&r.end(i)}const hP="summarizer";class Es extends Fg{constructor(e,t){var r,i;super((m,g)=>{this.mc.logger.sendErrorEvent({eventName:"ContainerEventHandlerException",name:typeof m=="string"?m:void 0},g)}),this.loader=e,this._canReconnect=!0,this._lifecycleState="loading",this._attachState=Qe.Detached,this.inboundQueuePausedFromInit=!0,this.firstConnection=!0,this.connectionTransitionTimes=[],this.messageCountAfterDisconnection=0,this.attachStarted=!1,this._dirtyContainer=!1,this.setAutoReconnectTime=vr.now(),this._audience=new LV,this.clientDetailsOverride=t.clientDetailsOverride,this._resolvedUrl=t.resolvedUrl,t.canReconnect!==void 0&&(this._canReconnect=t.canReconnect);const s=this.client.details.type,u=`${this.client.details.capabilities.interactive?"interactive":"noninteractive"}${s!==void 0&&s!==""?`/${s}`:""}`;this.subLogger=at.create(e.services.subLogger,void 0,{all:{clientType:u,containerId:Xl(),docId:()=>{var m,g;return(g=(m=this._resolvedUrl)===null||m===void 0?void 0:m.id)!==null&&g!==void 0?g:void 0},containerAttachState:()=>this._attachState,containerLifecycleState:()=>this._lifecycleState,containerConnectionState:()=>Tt[this.connectionState],serializedContainer:t.serializedContainerState!==void 0},error:{dmInitialSeqNumber:()=>{var m;return(m=this._deltaManager)===null||m===void 0?void 0:m.initialSequenceNumber},dmLastProcessedSeqNumber:()=>{var m;return(m=this._deltaManager)===null||m===void 0?void 0:m.lastSequenceNumber},dmLastKnownSeqNumber:()=>{var m;return(m=this._deltaManager)===null||m===void 0?void 0:m.lastKnownSeqNumber},containerLoadedFromVersionId:()=>{var m;return(m=this.loadedFromVersion)===null||m===void 0?void 0:m.id},containerLoadedFromVersionDate:()=>{var m;return(m=this.loadedFromVersion)===null||m===void 0?void 0:m.date},dmLastMsqSeqNumber:()=>{var m,g;return(g=(m=this.deltaManager)===null||m===void 0?void 0:m.lastMessage)===null||g===void 0?void 0:g.sequenceNumber},dmLastMsqSeqTimestamp:()=>{var m,g;return(g=(m=this.deltaManager)===null||m===void 0?void 0:m.lastMessage)===null||g===void 0?void 0:g.timestamp},dmLastMsqSeqClientId:()=>{var m,g;return(g=(m=this.deltaManager)===null||m===void 0?void 0:m.lastMessage)===null||g===void 0?void 0:g.clientId},connectionStateDuration:()=>vr.now()-this.connectionTransitionTimes[this.connectionState]}}),this.mc=Iu(at.create(this.subLogger,"Container"));const d=(r=this.mc.config.getBoolean("Fluid.Container.summarizeProtocolTree"))!==null&&r!==void 0?r:this.loader.services.options.summarizeProtocolTree;this.options=Object.assign(Object.assign({},this.loader.services.options),{summarizeProtocolTree:d}),this.connectionStateHandler=new XV({quorumClients:()=>{var m;return(m=this._protocolHandler)===null||m===void 0?void 0:m.quorum},logConnectionStateChangeTelemetry:(m,g,P)=>this.logConnectionStateChangeTelemetry(m,g,P),shouldClientJoinWrite:()=>this._deltaManager.connectionManager.shouldJoinWrite(),maxClientLeaveWaitTime:this.loader.services.options.maxClientLeaveWaitTime,logConnectionIssue:(m,g)=>{this._deltaManager.logConnectionIssue(Object.assign({eventName:m,duration:vr.now()-this.connectionTransitionTimes[Tt.CatchingUp]},g===void 0?{}:{details:JSON.stringify(g)}))},connectionStateChanged:()=>{this._lifecycleState==="loaded"&&this.propagateConnectionState()}},this.mc.logger,(i=t.serializedContainerState)===null||i===void 0?void 0:i.clientId),this.on(Ky,()=>{this.connectionStateHandler.containerSaved()}),this._deltaManager=this.createDeltaManager(),this._storage=new eW(()=>{if(this.attachState!==Qe.Attached){if(this.loader.services.detachedBlobStorage!==void 0)return new tW(this.loader.services.detachedBlobStorage,this.mc.logger);throw this.mc.logger.sendErrorEvent({eventName:"NoRealStorageInDetachedContainer"}),new Error("Real storage calls not allowed in Unattached container")}return this.storageService}),typeof document=="object"&&document!==null&&typeof document.addEventListener=="function"&&document.addEventListener!==null&&(this.lastVisible=document.hidden?vr.now():void 0,this.visibilityEventHandler=()=>{document.hidden?this.lastVisible=vr.now():setTimeout(()=>{this.lastVisible=void 0},0)},document.addEventListener("visibilitychange",this.visibilityEventHandler)),this.on("newListener",(m,g)=>{Promise.resolve().then(()=>{switch(m){case cP:this._dirtyContainer&&g();break;case Ky:this._dirtyContainer||g();break;case ix:this.connected&&g(this.clientId);break;case sx:this.connected||g();break}}).catch(P=>{this.mc.logger.sendErrorEvent({eventName:"RaiseConnectedEventError"},P)})})}static async load(e,t,r){const i=new Es(e,{clientDetailsOverride:t.clientDetailsOverride,resolvedUrl:t.resolvedUrl,canReconnect:t.canReconnect,serializedContainerState:r});return dt.timedExecAsync(i.mc.logger,{eventName:"Load"},async s=>new Promise((o,u)=>{var d,f;const m=t.version,g={opsBeforeReturn:"cached"},P=r?Object.assign(Object.assign({},(d=t.loadMode)!==null&&d!==void 0?d:g),{opsBeforeReturn:void 0}):(f=t.loadMode)!==null&&f!==void 0?f:g,D=M=>{u(M??new ro("Container closed without error during load"))};i.on("closed",D),i.load(m,P,r).finally(()=>{i.removeListener("closed",D)}).then(M=>{s.end(Object.assign(Object.assign({},M),t.loadMode)),o(i)},M=>{const U=Oi(M);i.close(U),D(U)})}),{start:!0,end:!0,cancel:"generic"})}static async createDetached(e,t){const r=new Es(e,{});return dt.timedExecAsync(r.mc.logger,{eventName:"CreateDetached"},async i=>(await r.createDetached(t),r),{start:!0,end:!0,cancel:"generic"})}static async rehydrateDetachedFromSnapshot(e,t){const r=new Es(e,{});return dt.timedExecAsync(r.mc.logger,{eventName:"RehydrateDetachedFromSnapshot"},async i=>{const s=JSON.parse(t);return await r.rehydrateDetachedFromSnapshot(s),r},{start:!0,end:!0,cancel:"generic"})}setLoaded(){this._lifecycleState==="loading"&&(this.propagateConnectionState(),this._lifecycleState="loaded")}get closed(){return this._lifecycleState==="closing"||this._lifecycleState==="closed"}get storage(){return this._storage}get storageService(){if(this._storageService===void 0)throw new Error("Attempted to access storageService before it was defined");return this._storageService}get context(){if(this._context===void 0)throw new ro("Attempted to access context before it was defined");return this._context}get protocolHandler(){if(this._protocolHandler===void 0)throw new Error("Attempted to access protocolHandler before it was defined");return this._protocolHandler}get connectionMode(){return this._deltaManager.connectionManager.connectionMode}get IFluidRouter(){return this}get resolvedUrl(){return this._resolvedUrl}get loadedFromVersion(){return this._loadedFromVersion}get readOnlyInfo(){return this._deltaManager.readOnlyInfo}get closeSignal(){return this._deltaManager.closeAbortController.signal}forceReadonly(e){this._deltaManager.connectionManager.forceReadonly(e)}get deltaManager(){return this._deltaManager}get connectionState(){return this.connectionStateHandler.connectionState}get connected(){return this.connectionStateHandler.connected}get serviceConfiguration(){return this._deltaManager.serviceConfiguration}get clientId(){return this.connectionStateHandler.clientId}get scopes(){return this._deltaManager.connectionManager.scopes}get clientDetails(){return this._deltaManager.clientDetails}getSpecifiedCodeDetails(){return this.getCodeDetailsFromQuorum()}getLoadedCodeDetails(){var e;return(e=this._context)===null||e===void 0?void 0:e.codeDetails}get audience(){return this._audience}get isDirty(){return this._dirtyContainer}get serviceFactory(){return this.loader.services.documentServiceFactory}get urlResolver(){return this.loader.services.urlResolver}get scope(){return this.loader.services.scope}get codeLoader(){return this.loader.services.codeLoader}getQuorum(){return this.protocolHandler.quorum}close(e){this._deltaManager.close(e),$e(this.connectionState===Tt.Disconnected,207),$e(this._lifecycleState==="closed",788)}closeCore(e){var t,r,i,s;$e(!this.closed,789);try{try{this.mc.logger.sendTelemetryEvent({eventName:"ContainerClose",category:e===void 0?"generic":"error"},e),this._lifecycleState="closing",(t=this._protocolHandler)===null||t===void 0||t.close(),this.connectionStateHandler.dispose(),(r=this._context)===null||r===void 0||r.dispose(e!==void 0?new Error(e.message):void 0),(i=this._storageService)===null||i===void 0||i.dispose(),(s=this.service)===null||s===void 0||s.dispose(e)}catch(o){this.mc.logger.sendErrorEvent({eventName:"ContainerCloseException"},o)}this.emit("closed",e),this.removeAllListeners(),this.visibilityEventHandler!==void 0&&document.removeEventListener("visibilitychange",this.visibilityEventHandler)}finally{this._lifecycleState="closed"}}closeAndGetPendingLocalState(){$e(this.attachState===Qe.Attached,209),$e(this.resolvedUrl!==void 0&&this.resolvedUrl.type==="fluid",210),$e(!!this._protocolHandler,739),$e(this._protocolHandler.attributes.term!==void 0,779);const e={pendingRuntimeState:this.context.getPendingLocalState(),url:this.resolvedUrl.url,protocol:this.protocolHandler.getProtocolState(),term:this._protocolHandler.attributes.term,clientId:this.clientId};return this.close(),JSON.stringify(e)}get attachState(){return this._attachState}serialize(){$e(this.attachState===Qe.Detached,211);const e=this.context.createSummary(),t=this.captureProtocolSummary(),r=em(e,t);return this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0&&(r.tree[".hasAttachmentBlobs"]={type:ii.Blob,content:"true"}),JSON.stringify(r)}async attach(e){await dt.timedExecAsync(this.mc.logger,{eventName:"Attach"},async()=>{if(this._lifecycleState!=="loaded")throw new Ct(`The Container is not in a valid state for attach [${this._lifecycleState}]`);$e(this._attachState===Qe.Detached&&!this.attachStarted,517),this.attachStarted=!0;const t=this.loader.services.detachedBlobStorage!==void 0&&this.loader.services.detachedBlobStorage.size>0;try{$e(this.deltaManager.inbound.length===0,214);let r;if(!t){const o=this.context.createSummary(),u=this.captureProtocolSummary();r=em(o,u),this._attachState=Qe.Attaching,this.context.notifyAttaching(Wy(r))}const i=await this.urlResolver.resolve(e);Ns(i),this.service===void 0&&($e(this.client.details.type!==hP,708),this.service=await Tx(async()=>this.serviceFactory.createContainer(r,i,this.subLogger,!1),"containerAttach",this.mc.logger,{cancel:this.closeSignal}));const s=this.service.resolvedUrl;if(Ns(s),this._resolvedUrl=s,await this.connectStorageService(),t){$e(!!this.loader.services.detachedBlobStorage,590);const o=new Map;for(;o.size<this.loader.services.detachedBlobStorage.size;){const f=this.loader.services.detachedBlobStorage.getBlobIds().filter(m=>!o.has(m));for(const m of f){const g=await this.loader.services.detachedBlobStorage.readBlob(m),P=await this.storageService.createBlob(g);o.set(m,P.id)}}const u=this.context.createSummary(o),d=this.captureProtocolSummary();r=em(u,d),this._attachState=Qe.Attaching,this.context.notifyAttaching(Wy(r)),await this.storageService.uploadSummaryWithContext(r,{referenceSequenceNumber:0,ackHandle:void 0,proposalHandle:void 0})}this._attachState=Qe.Attached,this.emit("attached"),this.propagateConnectionState(),this.closed||this.resumeInternal({fetchOpsFromStorage:!1,reason:"createDetached"})}catch(r){const i=Oi(r),s=this.resolvedUrl;throw wx(s)&&i.addTelemetryProperties({resolvedUrl:s.url}),this.close(i),i}},{start:!0,end:!0,cancel:"generic"})}async request(e){return dt.timedExecAsync(this.mc.logger,{eventName:"Request"},async()=>this.context.request(e),{end:!0,cancel:"error"})}setAutoReconnectInternal(e){if(this._deltaManager.connectionManager.reconnectMode===e)return;const r=vr.now(),i=r-this.setAutoReconnectTime;this.setAutoReconnectTime=r,this.mc.logger.sendTelemetryEvent({eventName:e===Ir.Enabled?"AutoReconnectEnabled":"AutoReconnectDisabled",connectionMode:this.connectionMode,connectionState:Tt[this.connectionState],duration:i}),this._deltaManager.connectionManager.setAutoReconnect(e)}connect(){if(this.closed)throw new Ct("The Container is closed and cannot be connected");if(this._attachState!==Qe.Attached)throw new Ct("The Container is not attached and cannot be connected");this.connected||this.connectInternal({reason:"DocumentConnect",fetchOpsFromStorage:!1})}connectInternal(e){$e(!this.closed,709),$e(this._attachState===Qe.Attached,710),this.resumeInternal(e);const t=Ir.Enabled;this.setAutoReconnectInternal(t)}disconnect(){if(this.closed)throw new Ct("The Container is closed and cannot be disconnected");this.disconnectInternal()}disconnectInternal(){$e(!this.closed,711);const e=Ir.Disabled;this.setAutoReconnectInternal(e)}resumeInternal(e){$e(!this.closed,217),this.inboundQueuePausedFromInit&&(this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume()),this.connectToDeltaStream(e)}async getAbsoluteUrl(e){var t;if(this.resolvedUrl!==void 0)return this.urlResolver.getAbsoluteUrl(this.resolvedUrl,e,BV((t=this._context)===null||t===void 0?void 0:t.codeDetails))}async proposeCodeDetails(e){if(!vb(e))throw new Error("Provided codeDetails are not IFluidCodeDetails");if(this.codeLoader.IFluidCodeDetailsComparer){const t=await this.codeLoader.IFluidCodeDetailsComparer.compare(e,this.getCodeDetailsFromQuorum());if(t!==void 0&&t<=0)throw new Error("Proposed code details should be greater than the current")}return this.protocolHandler.quorum.propose("code",e).then(()=>!0).catch(()=>!1)}async processCodeProposal(){const e=this.getCodeDetailsFromQuorum();if(await Promise.all([this.deltaManager.inbound.pause(),this.deltaManager.inboundSignal.pause()]),await this.context.satisfies(e)===!0){this.deltaManager.inbound.resume(),this.deltaManager.inboundSignal.resume();return}this.close(new ro("Existing context does not satisfy incoming proposal"))}async getVersion(e){return(await this.storageService.getVersions(e,1))[0]}recordConnectStartTime(){this.connectionTransitionTimes[Tt.Disconnected]===void 0&&(this.connectionTransitionTimes[Tt.Disconnected]=vr.now())}connectToDeltaStream(e){this.recordConnectStartTime(),(!this._canReconnect||!this.client.details.capabilities.interactive)&&(e.mode="write"),this._deltaManager.connect(e)}async load(e,t,r){if(this._resolvedUrl===void 0)throw new Error("Attempting to load without a resolved url");this.service=await this.serviceFactory.createDocumentService(this._resolvedUrl,this.subLogger,this.client.details.type===hP);const i={reason:"DocumentOpen",mode:"write",fetchOpsFromStorage:!1};t.deltaConnection===void 0&&this.connectToDeltaStream(i),r?this.connectStorageService().catch(m=>this.close(m)):await this.connectStorageService(),this._attachState=Qe.Attached;const{snapshot:s,versionId:o}=r===void 0?await this.fetchSnapshotTree(e):{snapshot:void 0,versionId:void 0};$e(s!==void 0||r!==void 0,567);const u=r===void 0?await this.getDocumentAttributes(this.storageService,s):{sequenceNumber:r.protocol.sequenceNumber,minimumSequenceNumber:r.protocol.minimumSequenceNumber,term:r.term};let d;switch(t.opsBeforeReturn){case void 0:this.attachDeltaManagerOpHandler(u,t.deltaConnection!=="none"?"all":"none");break;case"cached":d=this.attachDeltaManagerOpHandler(u,"cached");break;case"all":d=this.attachDeltaManagerOpHandler(u,"all");break;default:Eb(t.opsBeforeReturn)}this._protocolHandler=r===void 0?await this.initializeProtocolStateFromSnapshot(u,this.storageService,s):await this.initializeProtocolState(u,r.protocol.members,r.protocol.proposals,r.protocol.values);const f=this.getCodeDetailsFromQuorum();if(await this.instantiateContext(!0,f,s,r==null?void 0:r.pendingRuntimeState),!this.closed)switch(d!==void 0&&(this._deltaManager.inbound.resume(),await dP(this.mc.logger,"WaitOps",async()=>(await d,{})),await dP(this.mc.logger,"WaitOpProcessing",async()=>this._deltaManager.inbound.waitTillProcessingDone()),this._deltaManager.inbound.pause()),t.deltaConnection){case void 0:case"delayed":$e(this.inboundQueuePausedFromInit,838),this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume();break;case"none":break;default:Eb(t.deltaConnection)}if(this.closed)throw new Error("Container was closed while load()");return this.setLoaded(),{sequenceNumber:u.sequenceNumber,version:o,dmLastProcessedSeqNumber:this._deltaManager.lastSequenceNumber,dmLastKnownSeqNumber:this._deltaManager.lastKnownSeqNumber}}async createDetached(e){const t={sequenceNumber:dW,term:1,minimumSequenceNumber:0};await this.attachDeltaManagerOpHandler(t);const r=uP(e);this._protocolHandler=await this.initializeProtocolState(t,[],[],r),await this.instantiateContextDetached(!1),this.setLoaded()}async rehydrateDetachedFromSnapshot(e){e.tree[".hasAttachmentBlobs"]!==void 0&&($e(!!this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0,592),delete e.tree[".hasAttachmentBlobs"]);const t=Wy(e);this._storage.loadSnapshotForRehydratingContainer(t);const r=await this.getDocumentAttributes(this._storage,t);await this.attachDeltaManagerOpHandler(r);const i=aP(t),s=await En(this._storage,i.blobs.quorumValues),o=rW(s);this._protocolHandler=await this.initializeProtocolState(r,[],[],o!==void 0?uP(o):[]),await this.instantiateContextDetached(!0,t),this.setLoaded()}async connectStorageService(){var e,t;if(this._storageService!==void 0)return;$e(this.service!==void 0,495);const r=await this.service.connectToStorage();this._storageService=new YV(r,this.mc.logger),this.options.summarizeProtocolTree===!0&&(this.mc.logger.sendTelemetryEvent({eventName:"summarizeProtocolTreeEnabled"}),this._storageService=new ZV(this._storageService,()=>this.captureProtocolSummary())),$e(((e=r.policies)===null||e===void 0?void 0:e.minBlobSize)===((t=this.storageService.policies)===null||t===void 0?void 0:t.minBlobSize),224)}async getDocumentAttributes(e,t){if(t===void 0)return{minimumSequenceNumber:0,sequenceNumber:0,term:1};const r=".protocol"in t.trees?t.trees[".protocol"].blobs.attributes:t.blobs[".attributes"],i=await En(e,r);return i.term===void 0&&(i.term=1),i}async initializeProtocolStateFromSnapshot(e,t,r){let i=[],s=[],o=[];if(r!==void 0){const d=aP(r);[i,s,o]=await Promise.all([En(t,d.blobs.quorumMembers),En(t,d.blobs.quorumProposals),En(t,d.blobs.quorumValues)])}return await this.initializeProtocolState(e,i,s,o)}async initializeProtocolState(e,t,r,i){const s=new o$(e.minimumSequenceNumber,e.sequenceNumber,e.term,t,r,i,(u,d)=>this.submitMessage(Pi.Propose,{key:u,value:d})),o=at.create(this.subLogger,"ProtocolHandler");return s.quorum.on("error",u=>{o.sendErrorEvent(u)}),this.connectionStateHandler.initProtocol(s),s.quorum.on("addProposal",u=>{(u.key==="code"||u.key==="code2")&&this.emit("codeDetailsProposed",u.value,u)}),s.quorum.on("approveProposal",(u,d,f)=>{(d==="code"||d==="code2")&&(vb(f)||this.mc.logger.sendErrorEvent({eventName:"CodeProposalNotIFluidCodeDetails"}),this.processCodeProposal().catch(m=>{throw this.close(Oi(m)),m}))}),s}captureProtocolSummary(){const e=this.protocolHandler.snapshot();return{tree:{attributes:{content:JSON.stringify(this.protocolHandler.attributes),type:ii.Blob},quorumMembers:{content:JSON.stringify(e.members),type:ii.Blob},quorumProposals:{content:JSON.stringify(e.proposals),type:ii.Blob},quorumValues:{content:JSON.stringify(e.values),type:ii.Blob}},type:ii.Tree}}getCodeDetailsFromQuorum(){const e=this.protocolHandler.quorum;return hW(e)}get client(){var e;const t=((e=this.options)===null||e===void 0?void 0:e.client)!==void 0?this.options.client:{details:{capabilities:{interactive:!0}},mode:"read",permission:[],scopes:[],user:{id:""}};return this.clientDetailsOverride!==void 0&&Tq(t.details,this.clientDetailsOverride),t.details.environment=[t.details.environment,` loaderVersion:${hF}`].join(";"),t}activeConnection(){return this.connectionState===Tt.Connected&&this.connectionMode==="write"}createDeltaManager(){const e=()=>this.service,t=new HV(e,at.create(this.subLogger,"DeltaManager"),()=>this.activeConnection(),r=>new Rx(e,this.client,this._canReconnect,at.create(this.subLogger,"ConnectionManager"),r));return t.inbound.pause(),t.inboundSignal.pause(),t.on("connect",(r,i)=>{var s;this._audience.clear();for(const o of(s=r.initialClients)!==null&&s!==void 0?s:[])this._audience.addMember(o.clientId,o.client);this.connectionStateHandler.receivedConnectEvent(this.connectionMode,r)}),t.on("disconnect",r=>{var i;(i=this.collabWindowTracker)===null||i===void 0||i.stopSequenceNumberUpdate(),this.connectionStateHandler.receivedDisconnectEvent(r)}),t.on("throttled",r=>{const i=r;i.logged!==!0&&this.logContainerError(i),this.emit("warning",i)}),t.on("readonly",r=>{this.emit("readonly",r)}),t.on("closed",r=>{this.closeCore(r)}),t}async attachDeltaManagerOpHandler(e,t){var r;return this._deltaManager.attachOpHandler(e.minimumSequenceNumber,e.sequenceNumber,(r=e.term)!==null&&r!==void 0?r:1,{process:i=>this.processRemoteMessage(i),processSignal:i=>{this.processSignal(i)}},t)}logConnectionStateChangeTelemetry(e,t,r){var i;const s=vr.now();this.connectionTransitionTimes[e]=s;const o=s-this.connectionTransitionTimes[t];let u,d,f,m,g;e===Tt.Disconnected?f=this._deltaManager.connectionManager.reconnectMode:(e===Tt.Connected?(u=s-this.connectionTransitionTimes[Tt.Disconnected],u=qt.formatTick(u)):(m=this.deltaManager.lastKnownSeqNumber,this.deltaManager.hasCheckpointSequenceNumber&&(g=m-this.deltaManager.lastSequenceNumber)),this.firstConnection?d="InitialConnect":d="AutoReconnect"),this.mc.logger.sendPerformanceEvent(Object.assign({eventName:`ConnectionStateChange_${Tt[e]}`,from:Tt[t],duration:o,durationFromDisconnected:u,reason:r,connectionInitiationReason:d,pendingClientId:this.connectionStateHandler.pendingClientId,clientId:this.clientId,autoReconnect:f,opsBehind:g,online:Qo[Ex()],lastVisible:this.lastVisible!==void 0?vr.now()-this.lastVisible:void 0,checkpointSequenceNumber:m,quorumSize:(i=this._protocolHandler)===null||i===void 0?void 0:i.quorum.getMembers().size},this._deltaManager.connectionProps)),e===Tt.Connected&&(this.firstConnection=!1)}propagateConnectionState(){var e;const t=this.connectionState===Tt.Connected&&!this.firstConnection&&this.connectionMode==="write";t&&(this.messageCountAfterDisconnection=0);const r=this.connectionState===Tt.Connected;((e=this._context)===null||e===void 0?void 0:e.disposed)===!1&&this.context.setConnectionState(r,this.clientId),this.protocolHandler.setConnectionState(r,this.clientId),Ng(this.mc.logger,this,r,this.clientId),t&&this.mc.logger.sendTelemetryEvent({eventName:"OpsSentOnReconnect",count:this.messageCountAfterDisconnection})}submitContainerMessage(e,t,r,i){switch(e){case Pi.Operation:case Pi.RemoteHelp:break;case Pi.Summarize:{const o=t;o.details===void 0&&(o.details={}),o.details.includesProtocolTree=this.options.summarizeProtocolTree===!0;break}default:return this.close(new ro("invalidContainerSubmitOpType",void 0,{messageType:e})),-1}return this.submitMessage(e,t,r,i)}submitMessage(e,t,r,i){var s;return this.connectionState!==Tt.Connected?(this.mc.logger.sendErrorEvent({eventName:"SubmitMessageWithNoConnection",type:e}),-1):(this.messageCountAfterDisconnection+=1,(s=this.collabWindowTracker)===null||s===void 0||s.stopSequenceNumberUpdate(),this._deltaManager.submit(e,t,r,i))}processRemoteMessage(e){const t=this.clientId===e.clientId;let r={immediateNoOp:!1};try{r=this.protocolHandler.processMessage(e,t)}catch(i){this.close(Vh(i,s=>new Rs(s,mu(e))))}return Ch(e)&&!wh(e)&&this.mc.logger.sendTelemetryEvent({eventName:"UnpackedRuntimeMessage",type:e.type}),(wh(e)||Ch(e))&&this.context.process(e,t,void 0),this.activeConnection()&&(this.collabWindowTracker===void 0&&($e(this.serviceConfiguration!==void 0,740),this.collabWindowTracker=new oW((i,s)=>{$e(this.activeConnection(),577),this.submitMessage(i,s)},this.serviceConfiguration.noopTimeFrequency,this.serviceConfiguration.noopCountFrequency)),this.collabWindowTracker.scheduleSequenceNumberUpdate(e,r.immediateNoOp===!0)),this.emit("op",e),r}submitSignal(e){this._deltaManager.submitSignal(JSON.stringify(e))}processSignal(e){if(e.clientId===null){const t=e.content;if(t.type===Pi.ClientJoin){const r=t.content;this._audience.addMember(r.clientId,r.client)}else if(t.type===Pi.ClientLeave){const r=t.content;this._audience.removeMember(r)}}else{const t=this.clientId===e.clientId;this.context.processSignal(e,t)}}async fetchSnapshotTree(e){var t;const r=await this.getVersion(e??null);r===void 0&&e!==void 0&&this.mc.logger.sendErrorEvent({eventName:"NoVersionFoundWhenSpecified",id:e}),this._loadedFromVersion=r;const i=(t=await this.storageService.getSnapshotTree(r))!==null&&t!==void 0?t:void 0;return i===void 0&&r!==void 0&&this.mc.logger.sendErrorEvent({eventName:"getSnapshotTreeFailed",id:r.id}),{snapshot:i,versionId:r==null?void 0:r.id}}async instantiateContextDetached(e,t){const r=this.getCodeDetailsFromQuorum();if(r===void 0)throw new Error("pkg should be provided in create flow!!");await this.instantiateContext(e,r,t)}async instantiateContext(e,t,r,i){var s;$e(((s=this._context)===null||s===void 0?void 0:s.disposed)!==!1,221);const o=new GV(this,this.loader);this._context=await Px.createOrLoad(this,this.scope,this.codeLoader,t,r,new VV(this._deltaManager),new nW(this.protocolHandler.quorum),o,(u,d,f,m)=>this.submitContainerMessage(u,d,f,m),u=>this.submitSignal(u),u=>this.close(u),Es.version,u=>this.updateDirtyContainerState(u),e,i),this.emit("contextChanged",t)}updateDirtyContainerState(e){this._dirtyContainer!==e&&(this._dirtyContainer=e,this.emit(e?cP:Ky))}logContainerError(e){this.mc.logger.sendErrorEvent({eventName:"ContainerWarning"},e)}}Es.version="^0.1.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let pF=class extends Fn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Wb extends pF{constructor(e,t){super(),this.container=e,this.rootDataObject=t,this.connectedHandler=()=>this.emit("connected"),this.disconnectedHandler=()=>this.emit("disconnected"),this.disposedHandler=r=>this.emit("disposed",r),this.savedHandler=()=>this.emit("saved"),this.dirtyHandler=()=>this.emit("dirty"),e.on("connected",this.connectedHandler),e.on("closed",this.disposedHandler),e.on("disconnected",this.disconnectedHandler),e.on("saved",this.savedHandler),e.on("dirty",this.dirtyHandler)}get isDirty(){return this.container.isDirty}get attachState(){return this.container.attachState}get disposed(){return this.container.closed}get connectionState(){return this.container.connectionState}get initialObjects(){return this.rootDataObject.initialObjects}async attach(){throw new Error("Cannot attach container. Container is not in detached state")}async connect(){var e,t;(t=(e=this.container).connect)===null||t===void 0||t.call(e)}async disconnect(){var e,t;(t=(e=this.container).disconnect)===null||t===void 0||t.call(e)}async create(e){return this.rootDataObject.create(e)}dispose(){this.container.close(),this.container.off("connected",this.connectedHandler),this.container.off("closed",this.disposedHandler),this.container.off("disconnected",this.disconnectedHandler),this.container.off("saved",this.savedHandler),this.container.off("dirty",this.dirtyHandler)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Gm;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Gm||(Gm={}));var fP;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(fP||(fP={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function yc(n,e){if(n==="")return e===void 0?"":e.absolutePath;{let t=n.startsWith("/")?n.slice(1):n;return t=t.endsWith("/")?t.slice(0,-1):t,e===void 0?`/${t}`:`${e.absolutePath==="/"?"":e.absolutePath}/${t}`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function _t(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function mF(n,e){switch(e){case"base64":return yi(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const fW=(n,e)=>_x.from(n).toString(e);function pP(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let _x=class Ma extends Uint8Array{toString(e){return mF(this,e)}static from(e,t,r){if(typeof e=="string")return Ma.fromString(e,t);if(e!==null&&typeof e=="object"&&pP(e.buffer))return _t(e.byteOffset===0,0),_t(e.byteLength===e.buffer.byteLength,1),Ma.fromArrayBuffer(e.buffer,t,r);if(pP(e))return Ma.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Ma(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=js(r);return new Ma(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Ma(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const pW=n=>_x.from(n,"base64").toString("utf-8");/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let mW=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function gF(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function xh(n){if(n!==null&&typeof n=="object"&&n.errorFromRequestFluidObject===!0){const r=n;return{mimeType:"text/plain",status:r.code,value:r.message,get stack(){return r.stack}}}const t=Hh();return{mimeType:"text/plain",status:500,value:`${n}`,get stack(){var r;return(r=n==null?void 0:n.stack)!==null&&r!==void 0?r:t.stack}}}function Jh(n,e){const t=n.value,r=Hh();return{errorFromRequestFluidObject:!0,message:t,name:"Error",code:n.status,get stack(){var s;return(s=n.stack)!==null&&s!==void 0?s:r.stack}}}async function ic(n,e){const t=typeof e=="string"?{url:e}:e,r=await n.request(t);if(r.status!==200||r.mimeType!=="fluid/object")throw Jh(r);return _t(r.value,410),r.value}const si=n=>Eh(404,"not found",n);function Eh(n,e,t){var r;_t(n!==200,411);const i=(r=t.url)===null||r===void 0?void 0:r.split("?")[0],s=Hh();return{mimeType:"text/plain",status:n,value:i===void 0?e:`${e}: ${i}`,get stack(){return s.stack}}}function gW(n,e){return{type:n,get IFluidDataStoreFactory(){return this},get IFluidDataStoreRegistry(){return this},instantiateDataStore:async(t,r)=>(await e).instantiateDataStore(t,r),get:async t=>{var r;return(r=(await e).IFluidDataStoreRegistry)===null||r===void 0?void 0:r.get(t)}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class vF{constructor(e,t){this.storage=e,this.path=t,_t(!t.endsWith("/"),412)}async readBlob(e){return this.storage.readBlob(`${this.path}/${e}`)}async contains(e){return this.storage.contains(`${this.path}/${e}`)}async list(e){return this.storage.list(`${this.path}/${e}`)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Ix(n){let e=n;return e.startsWith("/")&&(e=e.substr(1)),e.endsWith("/")&&(e=e.substr(0,e.length-1)),e.length>0?e.split("/"):[]}async function vW(n,e){const t=Ix(e);let r=n;for(;(r==null?void 0:r.entries)!==void 0&&t.length>0;){const i=t.shift(),s=r.entries.find(o=>o.type==="Tree"&&o.path===i);(s==null?void 0:s.type)==="Tree"?r=s.value:r=void 0}if((r==null?void 0:r.entries)===void 0||t.length!==0)throw new Error("path does not exist");return r.entries.filter(i=>i.type==="Blob").map(i=>i.path)}class ns{constructor(e){this.request=e;const t=this.request.url.indexOf("?");t>=0?this.query=this.request.url.substring(t):this.query=""}static getPathParts(e){const t=e.indexOf("?");return e.substring(0,t<0?e.length:t).split("/").reduce((r,i)=>(i!==void 0&&i.length>0&&r.push(decodeURIComponent(i)),r),[])}static create(e){return e instanceof ns?e:new ns(e)}get url(){return this.request.url}get headers(){return this.request.headers}get pathParts(){return this.requestPathParts===void 0&&(this.requestPathParts=ns.getPathParts(this.url)),this.requestPathParts}isLeaf(e){return this.query===""&&this.pathParts.length===e}createSubRequest(e){const t=this.pathParts.length;if(e<0||e>t)throw new Error("incorrect sub-request");if(e===t&&this.url.includes("?"))return{url:`/${this.query}`,headers:this.headers};const r=`/${this.pathParts.slice(e).join("/")}`;return{url:this.query===""?r:`${r}/${this.query}`,headers:this.headers}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class yF{get IRuntimeFactory(){return this}async instantiateRuntime(e,t){const r=t===void 0?e.existing===!0:t,i=await this.preInitialize(e,r);return r?await this.instantiateFromExisting(i):await this.instantiateFirstTime(i),await this.hasInitialized(i),i}async instantiateFirstTime(e){}async instantiateFromExisting(e){}async hasInitialized(e){}}var nt={},Bg={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Bg,"__esModule",{value:!0});Bg.IFluidDataStoreFactory=void 0;Bg.IFluidDataStoreFactory="IFluidDataStoreFactory";var jg={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(jg,"__esModule",{value:!0});jg.IFluidDataStoreRegistry=void 0;jg.IFluidDataStoreRegistry="IFluidDataStoreRegistry";var SF={};(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.VisibilityState=n.FlushMode=void 0,function(e){e[e.Immediate=0]="Immediate",e[e.TurnBased=1]="TurnBased"}(n.FlushMode||(n.FlushMode={})),n.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}})(SF);var qg={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(qg,"__esModule",{value:!0});qg.gcBlobKey=void 0;qg.gcBlobKey="gc";var bF={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(bF,"__esModule",{value:!0});var wF={};(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.totalBlobSizePropertyName=n.blobCountPropertyName=n.channelsTreeName=n.CreateSummarizerNodeSource=void 0,function(e){e[e.FromSummary=0]="FromSummary",e[e.FromAttach=1]="FromAttach",e[e.Local=2]="Local"}(n.CreateSummarizerNodeSource||(n.CreateSummarizerNodeSource={})),n.channelsTreeName=".channels",n.blobCountPropertyName="BlobCount",n.totalBlobSizePropertyName="TotalBlobSize"})(wF);(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Ne&&Ne.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s),Object.defineProperty(r,o,{enumerable:!0,get:function(){return i[s]}})}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=Ne&&Ne.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(Bg,n),t(jg,n),t(SF,n),t(qg,n),t(bF,n),t(wF,n)})(nt);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var mP;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(mP||(mP={}));var Jd;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(Jd||(Jd={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var un;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(un||(un={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function mo(...n){const e={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0};for(const t of n)e.treeNodeCount+=t.treeNodeCount,e.blobNodeCount+=t.blobNodeCount,e.handleNodeCount+=t.handleNodeCount,e.totalBlobSize+=t.totalBlobSize,e.unreferencedBlobSize+=t.unreferencedBlobSize;return e}function CF(n){let e=n.length;for(let t=n.length-1;t>=0;t--){const r=n.charCodeAt(t);r>127&&r<=2047?e++:r>2047&&r<=65535&&(e+=2),r>=56320&&r<=57343&&t--}return e}function Ax(n){return typeof n=="string"?CF(n):n.byteLength}function xF(n,e){switch(n.type){case un.Tree:{e.treeNodeCount++;for(const t of Object.values(n.tree))xF(t,e);return}case un.Handle:{e.handleNodeCount++;return}case un.Blob:{e.blobNodeCount++,e.totalBlobSize+=Ax(n.content);return}default:return}}function kx(n){const e=mo();return xF(n,e),e}function Zi(n,e,t){const r={type:un.Blob,content:t};n.summary.tree[e]=r,n.stats.blobNodeCount++,n.stats.totalBlobSize+=Ax(t)}function EF(n,e,t){n.summary.tree[e]=t.summary,n.stats=mo(n.stats,t.stats)}function TF(n,e,t){n.summary.tree[e]=t.summary,n.stats=mo(n.stats,t.stats)}class Tr{constructor(){this.attachmentCounter=0,this.summaryTree={},this.summaryStats=mo(),this.summaryStats.treeNodeCount++}get summary(){return{type:un.Tree,tree:Object.assign({},this.summaryTree)}}get stats(){return Object.assign({},this.summaryStats)}addBlob(e,t){Zi({summary:{type:un.Tree,tree:this.summaryTree},stats:this.summaryStats},e,t)}addHandle(e,t,r){this.summaryTree[e]={type:un.Handle,handleType:t,handle:r},this.summaryStats.handleNodeCount++}addWithStats(e,t){this.summaryTree[e]=t.summary,this.summaryStats=mo(this.summaryStats,t.stats)}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:un.Attachment}}getSummaryTree(){return{summary:this.summary,stats:this.stats}}}function PF(n,e=!1){const t=new Tr;for(const i of n.entries)switch(i.type){case Jd.Blob:{const s=i.value;let o;s.encoding==="base64"?o=_x.from(s.contents,"base64"):o=s.contents,t.addBlob(i.path,o);break}case Jd.Tree:{const s=Ug(i.value,e);t.addWithStats(i.path,s);break}case Jd.Attachment:{const s=i.value.id;t.addAttachment(s);break}default:throw new Error("Unexpected TreeEntry type")}const r=t.getSummaryTree();return r.summary.unreferenced=n.unreferenced,r}function Ug(n,e=!1){if(n.id&&!e){const t=mo();return t.handleNodeCount++,{summary:{handle:n.id,handleType:un.Tree,type:un.Handle},stats:t}}else return PF(n,e)}function zg(n){const e=new Tr;for(const[r,i]of Object.entries(n.blobs)){let s;if(n.blobsContents!==void 0){const o=n.blobsContents[i];o!==void 0&&(s=fW(o,"utf-8"))}else n.blobs[i]!==void 0&&(s=pW(n.blobs[i]));s!==void 0&&e.addBlob(r,s)}for(const[r,i]of Object.entries(n.trees)){const s=zg(i);e.addWithStats(r,s)}const t=e.getSummaryTree();return t.summary.unreferenced=n.unreferenced,t}function $g(n){const e=[];for(const[t,r]of Object.entries(n.tree))switch(r.type){case un.Blob:{let i,s="utf-8";typeof r.content=="string"?i=r.content:(i=mF(r.content,"base64"),s="base64"),e.push(new UO(t,i,s));break}case un.Tree:{e.push(new e$(t,$g(r)));break}case un.Attachment:{e.push(new t$(t,r.id));break}case un.Handle:throw new Error("Should not have Handle type in summary tree");default:gF(r,"Unexpected summary tree type")}return{entries:e,unreferenced:n.unreferenced}}class RF{constructor(){this.telemetry=new Map}set(e,t,r){this.telemetry.set(`${e}${t}`,r)}get(e,t){return this.telemetry.get(`${e}${t}`)}serialize(){const e={};return this.telemetry.forEach((t,r)=>{e[r]=t}),JSON.stringify(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Qd="_baseSummary",_F="_outstandingOps",gP=100;class yr{constructor(e){this.path=e}static create(e){return new yr(encodeURIComponent(e))}static createAndConcat(e){var t;let r=yr.create((t=e[0])!==null&&t!==void 0?t:"");for(let i=1;i<e.length;i++)r=r.concat(yr.create(e[i]));return r}toString(){return this.path}concat(e){return new yr(`${this.path}/${e.path}`)}}class oo{constructor(e){this.summary=e}static createForRoot(e){return new oo({referenceSequenceNumber:e,basePath:void 0,localPath:yr.create("")})}get referenceSequenceNumber(){return this.summary.referenceSequenceNumber}get basePath(){return this.summary.basePath}get localPath(){return this.summary.localPath}get additionalPath(){return this.summary.additionalPath}set additionalPath(e){this.summary.additionalPath=e}get fullPath(){var e,t;return(t=(e=this.basePath)===null||e===void 0?void 0:e.concat(this.localPath))!==null&&t!==void 0?t:this.localPath}get fullPathForChildren(){return this.additionalPath!==void 0?this.fullPath.concat(this.additionalPath):this.fullPath}createForChild(e){return new oo({referenceSequenceNumber:this.referenceSequenceNumber,basePath:this.fullPathForChildren,localPath:yr.create(e)})}}function vP(n,e){let t=n;const r=[],i=[];for(let s=0;;s++){s>gP&&e.sendTelemetryEvent({eventName:"DecodeSummaryMaxDepth",maxDecodeDepth:gP});const o=t.blobs[_F],u=t.trees[Qd];if(o===void 0&&u===void 0)return{baseSummary:t,pathParts:r,async getOutstandingOps(d){let f=[];for(const m of i){const g=await d(m);if(f.length>0&&g.length>0){const P=f[f.length-1].sequenceNumber,D=g[0].sequenceNumber;if(D<=P)for(e.sendTelemetryEvent({eventName:"DuplicateOutstandingOps",message:`newEarliestSeq <= latestSeq in decodeSummary: ${D} <= ${P}`});g.length>0&&g[0].sequenceNumber<=P;)g.shift()}f=f.concat(g)}return f}};_t(!!o,431),_t(u!==void 0,432),t=u,r.push(Qd),i.unshift(o)}}function yW(n,e){let t=yr.create(Qd);const r=new Tr;if(r.addBlob(_F,JSON.stringify(e)),n.fromSummary){const s=n.summaryNode;s.additionalPath!==void 0&&(t=t.concat(s.additionalPath)),r.addHandle(Qd,un.Tree,s.fullPath.path)}else r.addWithStats(Qd,n.initialSummary);const i=r.getSummaryTree();return Object.assign(Object.assign({},i),{additionalPath:t})}function Jy(n){const e=n.trees[nt.channelsTreeName];return e!==void 0?{childrenTree:e,childrenPathPart:nt.channelsTreeName}:{childrenTree:n,childrenPathPart:void 0}}function SW(n){const e=n.tree[nt.channelsTreeName];return e!==void 0?{childrenTree:e,childrenPathPart:nt.channelsTreeName}:{childrenTree:n,childrenPathPart:void 0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Hg{constructor(e,t,r,i,s,o,u){var d;this.defaultLogger=e,this.summarizeInternalFn=t,this._changeSequenceNumber=i,this._latestSummary=s,this.initialSummary=o,this.wipSummaryLogger=u,this.children=new Map,this.pendingSummaries=new Map,this.outstandingOps=[],this.wipSkipRecursion=!1,this.canReuseHandle=(d=r.canReuseHandle)!==null&&d!==void 0?d:!0,this.throwOnError=!0,this.trackingSequenceNumber=this._changeSequenceNumber}get referenceSequenceNumber(){var e,t;return(t=(e=this._latestSummary)===null||e===void 0?void 0:e.referenceSequenceNumber)!==null&&t!==void 0?t:0}startSummary(e,t){_t(this.wipSummaryLogger===void 0,415),_t(this.wipReferenceSequenceNumber===void 0,416),this.wipSummaryLogger=t;for(const r of this.children.values())r.startSummary(e,this.wipSummaryLogger);this.wipReferenceSequenceNumber=e}async summarize(e,t=!0,r){if(_t(this.isTrackingInProgress(),417),_t(this.wipSummaryLogger!==void 0,418),this.canReuseHandle&&!e&&!this.hasChanged()){const i=this._latestSummary;if(i!==void 0){this.wipLocalPaths={localPath:i.localPath,additionalPath:i.additionalPath},this.wipSkipRecursion=!0;const s=mo();return s.handleNodeCount++,{summary:{type:un.Handle,handle:i.fullPath.path,handleType:un.Tree},stats:s}}}try{const i=await this.summarizeInternalFn(e,!0,r);return this.wipLocalPaths={localPath:yr.create(i.id)},i.pathPartsForChildren!==void 0&&(this.wipLocalPaths.additionalPath=yr.createAndConcat(i.pathPartsForChildren)),{summary:i.summary,stats:i.stats}}catch(i){if(this.throwOnError||this.trackingSequenceNumber<this._changeSequenceNumber)throw i;const s=this._latestSummary,o=this.initialSummary;let u,d;if(s!==void 0)u={fromSummary:!0,summaryNode:s},d=s.localPath;else if((o==null?void 0:o.summary)!==void 0)u={fromSummary:!1,initialSummary:o.summary},d=yr.create(o.id);else throw i;this.wipSummaryLogger.sendErrorEvent({eventName:"SummarizingWithBasePlusOps"},i);const f=yW(u,this.outstandingOps);return this.wipLocalPaths={localPath:d,additionalPath:f.additionalPath},this.wipSkipRecursion=!0,{summary:f.summary,stats:f.stats}}}completeSummary(e){this.completeSummaryCore(e,void 0,!1)}completeSummaryCore(e,t,r){_t(this.wipSummaryLogger!==void 0,419),_t(this.wipReferenceSequenceNumber!==void 0,420);let i=this.wipLocalPaths;if(r){const u=this._latestSummary;if(u!==void 0)i={localPath:u.localPath,additionalPath:u.additionalPath};else{this.clearSummary();return}}_t(!!i,421);const s=new oo(Object.assign(Object.assign({},i),{referenceSequenceNumber:this.wipReferenceSequenceNumber,basePath:t})),o=s.fullPathForChildren;for(const u of this.children.values())u.completeSummaryCore(e,o,this.wipSkipRecursion||r);this.pendingSummaries.set(e,s),this.clearSummary()}clearSummary(){this.wipReferenceSequenceNumber=void 0,this.wipLocalPaths=void 0,this.wipSkipRecursion=!1,this.wipSummaryLogger=void 0;for(const e of this.children.values())e.clearSummary()}async refreshLatestSummary(e,t,r,i,s){if(e!==void 0){const u=this.pendingSummaries.get(e);if(u!==void 0)return this.refreshLatestSummaryFromPending(e,u.referenceSequenceNumber),{latestSummaryUpdated:!0,wasSummaryTracked:!0}}if(this.referenceSequenceNumber>=t)return{latestSummaryUpdated:!1};const o=await r();return await this.refreshLatestSummaryFromSnapshot(t,o,void 0,yr.create(""),s,i),{latestSummaryUpdated:!0,wasSummaryTracked:!1,snapshot:o}}refreshLatestSummaryFromPending(e,t){const r=this.pendingSummaries.get(e);if(r===void 0){_t(this._latestSummary===void 0,422);return}else _t(t===r.referenceSequenceNumber,423),this.pendingSummaries.delete(e);this.refreshLatestSummaryCore(t),this._latestSummary=r;for(const i of this.children.values())i.refreshLatestSummaryFromPending(e,t)}async refreshLatestSummaryFromSnapshot(e,t,r,i,s,o){if(this.referenceSequenceNumber>=e)return;this.refreshLatestSummaryCore(e);const{baseSummary:u,pathParts:d}=vP(t,s);this._latestSummary=new oo({referenceSequenceNumber:e,basePath:r,localPath:i});const{childrenTree:f,childrenPathPart:m}=Jy(u);m!==void 0&&d.push(m),d.length>0&&(this._latestSummary.additionalPath=yr.createAndConcat(d));const g=this._latestSummary.fullPathForChildren;await Promise.all(Array.from(this.children).filter(([P])=>f.trees[P]!==void 0).map(async([P,D])=>D.refreshLatestSummaryFromSnapshot(e,f.trees[P],g,yr.create(P),s,o)))}refreshLatestSummaryCore(e){for(const[t,r]of this.pendingSummaries)r.referenceSequenceNumber<e&&this.pendingSummaries.delete(t);for(;this.outstandingOps.length>0&&this.outstandingOps[0].sequenceNumber<=e;)this.outstandingOps.shift()}loadBaseSummaryWithoutDifferential(e){const{childrenPathPart:t}=Jy(e);t!==void 0&&this._latestSummary!==void 0&&(this._latestSummary.additionalPath=yr.create(t))}async loadBaseSummary(e,t){const r=vP(e,this.defaultLogger),i=await r.getOutstandingOps(t),{childrenPathPart:s}=Jy(r.baseSummary);if(s!==void 0&&r.pathParts.push(s),r.pathParts.length>0&&this._latestSummary!==void 0&&(this._latestSummary.additionalPath=yr.createAndConcat(r.pathParts)),i.length>0){const o=i[i.length-1].sequenceNumber;_t(o<=this.trackingSequenceNumber,425)}return{baseSummary:r.baseSummary,outstandingOps:i}}recordChange(e){const t=this.outstandingOps[this.outstandingOps.length-1];t!==void 0&&_t(t.sequenceNumber<e.sequenceNumber,426),this.invalidate(e.sequenceNumber),this.trackingSequenceNumber=e.sequenceNumber,this.outstandingOps.push(e)}invalidate(e){e>this._changeSequenceNumber&&(this._changeSequenceNumber=e)}hasChanged(){return this._changeSequenceNumber>this.referenceSequenceNumber}get latestSummary(){return this._latestSummary}createChild(e,t,r,i={}){_t(!this.children.has(t),427);const s=this.getCreateDetailsForChild(t,r),o=new Hg(this.defaultLogger,e,i,s.changeSequenceNumber,s.latestSummary,s.initialSummary,this.wipSummaryLogger);return this.maybeUpdateChildState(o),this.children.set(t,o),o}getChild(e){return this.children.get(e)}getCreateDetailsForChild(e,t){var r;let i,s,o;const u=this._latestSummary;switch(t.type){case nt.CreateSummarizerNodeSource.FromAttach:{if(u!==void 0&&t.sequenceNumber<=u.referenceSequenceNumber)s=u.createForChild(e);else{const d=Ug(t.snapshot);i={sequenceNumber:t.sequenceNumber,id:e,summary:d}}o=t.sequenceNumber;break}case nt.CreateSummarizerNodeSource.FromSummary:this.initialSummary===void 0&&_t(!!u,428);case nt.CreateSummarizerNodeSource.Local:{const d=this.initialSummary;if(d!==void 0){let f;if(d.summary!==void 0){const{childrenTree:g}=SW(d.summary.summary);_t(g.type===un.Tree,470),f=g.tree[e]}t.type===nt.CreateSummarizerNodeSource.FromSummary&&_t(!!f,429);let m;f!==void 0&&(_t(f.type===un.Tree,430),m={summary:f,stats:kx(f)}),i={sequenceNumber:d.sequenceNumber,id:e,summary:m}}s=u==null?void 0:u.createForChild(e),o=(r=u==null?void 0:u.referenceSequenceNumber)!==null&&r!==void 0?r:-1;break}default:{const d=t.type;gF(t,`Unexpected CreateSummarizerNodeSource: ${d}`)}}return{initialSummary:i,latestSummary:s,changeSequenceNumber:o}}maybeUpdateChildState(e){if(this.isTrackingInProgress()&&(e.wipReferenceSequenceNumber=this.wipReferenceSequenceNumber),e._latestSummary!==void 0)for(const[t,r]of this.pendingSummaries.entries()){const i=new oo({referenceSequenceNumber:r.referenceSequenceNumber,basePath:e._latestSummary.basePath,localPath:e._latestSummary.localPath});e.addPendingSummary(t,i)}}addPendingSummary(e,t){this.pendingSummaries.set(e,t)}isTrackingInProgress(){return this.wipReferenceSequenceNumber!==void 0}}const bW=(n,e,t,r,i={})=>new Hg(n,e,i,t,r===void 0?void 0:oo.createForRoot(r));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Qy(n,e){const t=new Set,r=[...e];for(const o of r){if(t.has(o))continue;t.add(o);const u=n[o];u!==void 0&&r.push(...u)}const i=[],s=[];for(const o of Object.keys(n))t.has(o)?i.push(o):s.push(o);return{referencedNodeIds:i,deletedNodeIds:s}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Tl(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function wW(n){return n.replace(/^\/+|\/+$/g,"")}function CW(n){return n.replace(/^\/+/g,"")}function xW(n){return n.replace(/\/+$/g,"")}function Xd(n){const e={};for(const[t,r]of Object.entries(n.gcNodes))e[t]=Array.from(r);return{gcNodes:e}}function IF(n){const e=new Map;if(n.gcData===void 0)return e;const t=n.gcData.gcNodes;delete t["/"];for(const[i,s]of Object.entries(t)){Tl(i.startsWith("/"),686);const o=i.split("/")[1];let u=i.slice(o.length+1);u===""&&(u="/");let d=e.get(o);d===void 0&&(d={gcData:{gcNodes:{}},usedRoutes:[]}),Tl(d.gcData!==void 0,687),d.gcData.gcNodes[u]=[...new Set(s)],e.set(o,d)}if(n.usedRoutes===void 0)return e;const r=n.usedRoutes.filter(i=>i!==""&&i!=="/");for(const i of r){Tl(i.startsWith("/"),688);const s=i.split("/")[1],o=i.slice(s.length+1),u=e.get(s);Tl((u==null?void 0:u.usedRoutes)!==void 0,689),u.usedRoutes.push(o),e.set(s,u)}return e}function AF(n){const e=n.filter(r=>r!==""&&r!=="/"),t=new Map;for(const r of e){Tl(r.startsWith("/"),408);const i=r.split("/")[1],s=r.slice(i.length+1),o=t.get(i);o!==void 0?o.push(s):t.set(i,[s])}return t}function EW(n,e){const t=Object.entries(n);for(const[r,i]of t){const s=new Set(i);s.delete(e),n[r]=[...s]}}function TW(n,e){var t;const r={};for(const[i,s]of Object.entries(n.gcNodes))r[i]={outboundRoutes:Array.from(s.outboundRoutes),unreferencedTimestampMs:s.unreferencedTimestampMs};for(const[i,s]of Object.entries(e.gcNodes)){let o=r[i];o===void 0?o={outboundRoutes:Array.from(s.outboundRoutes),unreferencedTimestampMs:s.unreferencedTimestampMs}:(s.unreferencedTimestampMs!==void 0&&o.unreferencedTimestampMs!==void 0&&Tl(s.unreferencedTimestampMs===o.unreferencedTimestampMs,690),o={outboundRoutes:[...new Set([...s.outboundRoutes,...o.outboundRoutes])],unreferencedTimestampMs:(t=s.unreferencedTimestampMs)!==null&&t!==void 0?t:o.unreferencedTimestampMs}),r[i]=o}return{gcNodes:r}}function PW(n,e){const t=Xd(n);for(const[r,i]of Object.entries(e.gcNodes))if(t.gcNodes[r]===void 0)t.gcNodes[r]=Array.from(i);else{const s=[...i,...t.gcNodes[r]];t.gcNodes[r]=[...new Set(s)]}return t}class Ox{constructor(){this.gcNodesSet={}}get gcNodes(){const e={};for(const[t,r]of Object.entries(this.gcNodesSet))e[t]=[...r];return e}addNode(e,t){this.gcNodesSet[e]=new Set(t)}prefixAndAddNodes(e,t){for(const[r,i]of Object.entries(t)){let s=CW(r);s=`/${e}/${s}`,s=xW(s),this.gcNodesSet[s]=new Set(i)}}addNodes(e){for(const[t,r]of Object.entries(e))this.gcNodesSet[t]=new Set(r)}addRouteToAllNodes(e){for(const t of Object.values(this.gcNodesSet))t.add(e)}getGCData(){return{gcNodes:this.gcNodes}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class RW extends oo{constructor(e,t){super(t),this.serializedUsedRoutes=e}}class Fx extends Hg{constructor(e,t,r,i,s,o,u,d,f){super(e,async(m,g,P)=>t(m,!0,P),r,i,s,o,u),this.summarizeFn=t,this.getGCDataFn=d,this.baseGCDetailsLoaded=!1,this.usedRoutes=[""],this.gcDisabled=r.gcDisabled===!0,this.baseGCDetailsP=new mW(async()=>{var m;return(m=await(f==null?void 0:f()))!==null&&m!==void 0?m:{usedRoutes:[]}})}getGCSummaryDetails(){return this.getBaseGCDetails()}getBaseGCDetails(){return{gcData:this.gcData,usedRoutes:this.usedRoutes,unrefTimestamp:this.unreferencedTimestampMs}}async loadBaseGCDetails(){var e;const t=await this.baseGCDetailsP;this.baseGCDetailsLoaded||(this.baseGCDetailsLoaded=!0,t.gcData!==void 0&&(this.gcData=Xd(t.gcData)),this.referenceUsedRoutes=(e=t.usedRoutes)===null||e===void 0?void 0:e.sort(),this.unreferencedTimestampMs=t.unrefTimestamp)}async summarize(e,t=!0,r){return!this.gcDisabled&&this.isTrackingInProgress()&&_t(this.wipSerializedUsedRoutes!==void 0,433),t?super.summarize(e,!0,r):this.summarizeFn(e,t,r)}async getGCData(e=!1){if(_t(!this.gcDisabled,434),_t(this.getGCDataFn!==void 0,435),await this.loadBaseGCDetails(),!e&&!this.hasDataChanged()&&this.gcData!==void 0)return Xd(this.gcData);const t=await this.getGCDataFn(e);return this.gcData=Xd(t),t}startSummary(e,t){this.gcDisabled||_t(this.wipSerializedUsedRoutes===void 0,436),super.startSummary(e,t)}completeSummaryCore(e,t,r){let i;if(this.gcDisabled||(i=this.wipSerializedUsedRoutes,_t(i!==void 0,437)),super.completeSummaryCore(e,t,r),!this.gcDisabled){const s=this.pendingSummaries.get(e);if(s!==void 0){const o=new RW(i,s);this.pendingSummaries.set(e,o)}}}clearSummary(){this.wipSerializedUsedRoutes=void 0,super.clearSummary()}refreshLatestSummaryFromPending(e,t){if(!this.gcDisabled){const r=this.pendingSummaries.get(e);r!==void 0&&(this.referenceUsedRoutes=JSON.parse(r.serializedUsedRoutes))}return super.refreshLatestSummaryFromPending(e,t)}async refreshLatestSummaryFromSnapshot(e,t,r,i,s,o){if(!this.gcDisabled){const u=t.blobs[nt.gcBlobKey];if(u!==void 0){const d=await o(u);if(this.referenceSequenceNumber>=e)return;this.referenceUsedRoutes=d.usedRoutes}}return super.refreshLatestSummaryFromSnapshot(e,t,r,i,s,o)}createChild(e,t,r,i={},s,o){var u;_t(!this.children.has(t),438);const d=this.getCreateDetailsForChild(t,r),f=new Fx(this.defaultLogger,e,Object.assign(Object.assign({},i),{gcDisabled:(u=i.gcDisabled)!==null&&u!==void 0?u:this.gcDisabled}),d.changeSequenceNumber,d.latestSummary,d.initialSummary,this.wipSummaryLogger,s,o);return this.maybeUpdateChildState(f),this.children.set(t,f),f}deleteChild(e){this.children.delete(e)}getChild(e){return this.children.get(e)}isReferenced(){return this.usedRoutes.includes("")||this.usedRoutes.includes("/")}updateUsedRoutes(e,t){if(this.usedRoutes=e.sort(),!this.gcDisabled&&this.isTrackingInProgress()&&(this.wipSerializedUsedRoutes=JSON.stringify(this.usedRoutes)),this.isReferenced()){this.unreferencedTimestampMs=void 0;return}this.unreferencedTimestampMs===void 0&&(this.unreferencedTimestampMs=t)}hasChanged(){return this.hasDataChanged()||this.hasUsedStateChanged()}hasDataChanged(){return super.hasChanged()}hasUsedStateChanged(){return this.gcDisabled?!1:this.referenceUsedRoutes===void 0||JSON.stringify(this.usedRoutes)!==JSON.stringify(this.referenceUsedRoutes)}}const kF=(n,e,t,r,i={},s,o)=>new Fx(n,e,i,t,r===void 0?void 0:oo.createForRoot(r),void 0,void 0,s,o);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function OF(n,e){const t=n.trees[".protocol"].blobs.attributes;return(await e(t)).sequenceNumber}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const _W=Object.freeze(Object.defineProperty({__proto__:null,ObjectStoragePartition:vF,RequestParser:ns,RuntimeFactoryHelper:yF,SummaryTreeBuilder:Tr,TelemetryContext:RF,addBlobToSummary:Zi,addSummarizeResultToSummary:TF,addTreeToSummary:EF,calculateStats:kx,convertSnapshotTreeToSummaryTree:zg,convertSummaryTreeToITree:$g,convertToSummaryTree:Ug,convertToSummaryTreeWithStats:PF,create404Response:si,createDataStoreFactory:gW,createResponseError:Eh,createRootSummarizerNode:bW,createRootSummarizerNodeWithGC:kF,exceptionToResponse:xh,generateHandleContextPath:yc,getBlobSize:Ax,getNormalizedObjectStoragePathParts:Ix,listBlobsAtTreePath:vW,mergeStats:mo,requestFluidObject:ic,responseToException:Jh,seqFromTree:OF,utf8ByteLength:CF},Symbol.toStringTag,{value:"Module"}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function uu(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ye(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function IW(n,e){switch(e){case"base64":return yi(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const AW=(n,e)=>FF.from(n,e).buffer,yP=(n,e)=>FF.from(n).toString(e);function SP(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let FF=class Ba extends Uint8Array{toString(e){return IW(this,e)}static from(e,t,r){if(typeof e=="string")return Ba.fromString(e,t);if(e!==null&&typeof e=="object"&&SP(e.buffer))return ye(e.byteOffset===0,0),ye(e.byteLength===e.buffer.byteLength,1),Ba.fromArrayBuffer(e.buffer,t,r);if(SP(e))return Ba.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Ba(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=js(r);return new Ba(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Ba(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const oi=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Sc=class extends Fn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Cr=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}},Ml=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Vg=class{constructor(e,t,r=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,i;if(!this.runningState)this.start(e,t);else{const s=e??this.runningState.intendedDuration,o=(i=t??((r=this.runningState.restart)===null||r===void 0?void 0:r.handler))!==null&&i!==void 0?i:this.runningState.handler,u=this.calculateRemainingTime(this.runningState);s<u?this.start(s,o):s===u?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:setTimeout(()=>this.handler(),e)}}handler(){ye(!!this.runningState,10);const e=this.runningState.restart;if(e!==void 0){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}},kW=class{constructor(e,t){this.timer=new Vg(e,()=>this.wrapHandler(t))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new Cr,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),ye(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let bP=class NF{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=oi.now();return new NF(e)}trace(){const e=oi.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Gb(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Nx=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const OW=async n=>new Promise(e=>setTimeout(()=>e(),n));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var an;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(an||(an={}));var wP;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(wP||(wP={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Xo;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(Xo||(Xo={}));var wp,FW=new Uint8Array(16);function NW(){if(!wp&&(wp=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!wp))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return wp(FW)}const DW=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function LW(n){return typeof n=="string"&&DW.test(n)}var jn=[];for(var Xy=0;Xy<256;++Xy)jn.push((Xy+256).toString(16).substr(1));function MW(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(jn[n[e+0]]+jn[n[e+1]]+jn[n[e+2]]+jn[n[e+3]]+"-"+jn[n[e+4]]+jn[n[e+5]]+"-"+jn[n[e+6]]+jn[n[e+7]]+"-"+jn[n[e+8]]+jn[n[e+9]]+"-"+jn[n[e+10]]+jn[n[e+11]]+jn[n[e+12]]+jn[n[e+13]]+jn[n[e+14]]+jn[n[e+15]]).toLowerCase();if(!LW(t))throw TypeError("Stringified UUID is invalid");return t}function ul(n,e,t){n=n||{};var r=n.random||(n.rng||NW)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return MW(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class BW{constructor(e,t,r){this.path=e,this.runtime=t,this.routeContext=r,this.absolutePath=yc(e,this.routeContext)}get IFluidHandleContext(){return this}attachGraph(){throw new Error("can't attach container runtime form within container!")}get isAttached(){return this.runtime.attachState!==Qe.Detached}async resolveHandle(e){return this.runtime.resolveHandle(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Dx{constructor(e){this.map=new Map;for(const t of e){if(this.map.has(t[0]))throw new Ct("Duplicate entry names exist");this.map.set(t[0],t[1])}}get IFluidDataStoreRegistry(){return this}async get(e){if(this.map.has(e))return this.map.get(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Ur="summarizer";class Bl extends Sc{constructor(e,t,r,i,s){super(),this.logger=e,this.summaryCollection=t,this.clientElection=r,this.maxOpsSinceLastSummary=i,this.electionEnabled=s,this.lastReportedSeq=0,this.summaryCollection.on("default",({sequenceNumber:o})=>{var u,d,f;const m=this.electedClientId;if(m===void 0){this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(o);return}let g=this.clientElection.electionSequenceNumber;if(o-((u=this.lastSummaryAckSeqForClient)!==null&&u!==void 0?u:g)>this.maxOpsSinceLastSummary){const D=o-this.lastReportedSeq;if(D>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"ElectedClientNotSummarizing",electedClientId:m,lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:g,nextElectedClientId:(d=this.clientElection.peekNextElectedClient())===null||d===void 0?void 0:d.clientId,electionEnabled:this.electionEnabled}),this.lastReportedSeq=o),this.electionEnabled){const M=this.electedParentId;this.clientElection.incrementElectedClient(o),g=this.clientElection.electionSequenceNumber,o>((f=this.lastSummaryAckSeqForClient)!==null&&f!==void 0?f:g)&&D>this.maxOpsSinceLastSummary&&this.logger.sendErrorEvent({eventName:"UnexpectedElectionSequenceNumber",lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:g,sequenceNumber:o,previousClientId:m,previousParentId:M,electedParentId:this.electedParentId,electedClientId:this.electedClientId,opsSinceLastReport:D,maxOpsSinceLastSummary:i})}}}),this.summaryCollection.on(an.SummaryAck,o=>{this.lastSummaryAckSeqForClient=o.sequenceNumber}),this.clientElection.on("election",(o,u)=>{this.lastSummaryAckSeqForClient=void 0,o===void 0&&this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(u),this.emit("electedSummarizerChanged")})}get electedClientId(){var e;return(e=this.clientElection.electedClient)===null||e===void 0?void 0:e.clientId}get electedParentId(){var e;return(e=this.clientElection.electedParent)===null||e===void 0?void 0:e.clientId}serialize(){var e;const{electedClientId:t,electedParentId:r,electionSequenceNumber:i}=this.clientElection.serialize();return{electedClientId:t,electedParentId:r,electionSequenceNumber:(e=this.lastSummaryAckSeqForClient)!==null&&e!==void 0?e:i}}static isClientEligible(e){const t=e.client.details;return t===void 0?!0:Bl.clientDetailsPermitElection(t)}}Bl.clientDetailsPermitElection=n=>n.capabilities.interactive||n.type===Ur;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ot(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let jW=class extends Fn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let hd=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}},qW=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function UW(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let DF=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Kb;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(Kb||(Kb={}));var Cp,zW=new Uint8Array(16);function $W(){if(!Cp&&(Cp=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Cp))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Cp(zW)}const HW=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function VW(n){return typeof n=="string"&&HW.test(n)}var qn=[];for(var Yy=0;Yy<256;++Yy)qn.push((Yy+256).toString(16).substr(1));function WW(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(qn[n[e+0]]+qn[n[e+1]]+qn[n[e+2]]+qn[n[e+3]]+"-"+qn[n[e+4]]+qn[n[e+5]]+"-"+qn[n[e+6]]+qn[n[e+7]]+"-"+qn[n[e+8]]+qn[n[e+9]]+"-"+qn[n[e+10]]+qn[n[e+11]]+qn[n[e+12]]+qn[n[e+13]]+qn[n[e+14]]+qn[n[e+15]]).toLowerCase();if(!VW(t))throw TypeError("Stringified UUID is invalid");return t}function CP(n,e,t){n=n||{};var r=n.random||(n.rng||$W)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return WW(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class GW{constructor(e,t,r,i,s){this.objectId=e,this._connected=t,this.submit=r,this.dirty=i,this.addedGCOutboundReference=s}get handler(){return ot(!!this._handler,375),this._handler}get connected(){return this._connected}attach(e){ot(this._handler===void 0,376),this._handler=e}setConnectionState(e){this._connected=e,this.handler.setConnectionState(e)}process(e,t,r){try{this.handler.process(e,t,r)}catch(i){throw pi.wrapIfUnrecognized(i,"channelDeltaConnectionFailedToProcessMessage",e)}}reSubmit(e,t){this.handler.reSubmit(e,t)}rollback(e,t){if(this.handler.rollback===void 0)throw new Error("Handler doesn't support rollback");this.handler.rollback(e,t)}applyStashedOp(e){return this.handler.applyStashedOp(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Km{constructor(e,t,r,i){this.tree=e,this.storage=t,this.logger=r,this.extraBlobs=i,this.flattenedTree={},e!==void 0&&Km.flattenTree("",e,this.flattenedTree)}static flattenTree(e,t,r){for(const i in t.trees)Km.flattenTree(`${e}${i}/`,t.trees[i],r);for(const i in t.blobs)r[`${e}${i}`]=t.blobs[i]}async contains(e){return this.flattenedTree[e]!==void 0}async readBlob(e){const t=await this.getIdForPath(e),r=this.extraBlobs!==void 0?this.extraBlobs.get(t):void 0;if(r!==void 0)return r;const i=this.storage.readBlob(t);return i.catch(s=>this.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},s)),i}async list(e){var t;let r=this.tree;const i=Ix(e);for(;r!==void 0&&i.length>0;){const s=i.shift();r=r.trees[s]}if(r===void 0||i.length!==0)throw new Error("path does not exist");return Object.keys((t=r==null?void 0:r.blobs)!==null&&t!==void 0?t:{})}async getIdForPath(e){return this.flattenedTree[e]}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Jm=".attributes";function Lx(n,e,t,r,i,s,o,u,d){const f=new GW(n,e,(g,P)=>t(g,P),r,i),m=new Km(u,s,o,d);return{deltaConnection:f,objectStorage:m}}function LF(n,e=!1,t=!1,r){const i=n.getAttachSummary(e,t,r);return Zi(i,Jm,JSON.stringify(n.attributes)),i}async function MF(n,e=!1,t=!1,r){const i=await n.summarize(e,t,r);return Zi(i,Jm,JSON.stringify(n.attributes)),i}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Mx{constructor(e,t,r,i){this.id=e,this.registry=t,this.runtime=r,this.servicesGetter=i,this.globallyVisible=!1,this.pending=[],ot(!this.id.includes("/"),783)}async getChannel(){return ot(this.channel!==void 0,519),this.channel}get isLoaded(){return this.channel!==void 0}setConnectionState(e,t){this.globallyVisible&&this.isLoaded&&this.servicesGetter().value.deltaConnection.setConnectionState(e)}processOp(e,t,r){ot(this.globallyVisible,723),this.isLoaded?this.servicesGetter().value.deltaConnection.process(e,t,r):(ot(t===!1,393),this.pending.push(e))}reSubmit(e,t){ot(this.isLoaded,394),ot(this.globallyVisible,724),this.servicesGetter().value.deltaConnection.reSubmit(e,t)}rollback(e,t){ot(this.isLoaded,750),ot(this.globallyVisible,751),this.servicesGetter().value.deltaConnection.rollback(e,t)}applyStashedOp(){throw new Error("no stashed ops on local channel")}async summarize(e=!1,t=!1,r){return ot(this.isLoaded&&this.channel!==void 0,396),MF(this.channel,e,t,r)}getAttachSummary(e){return ot(this.isLoaded&&this.channel!==void 0,397),LF(this.channel,!0,!1,e)}makeVisible(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&(ot(!!this.channel,402),this.channel.connect(this.servicesGetter().value)),this.globallyVisible=!0}async getGCData(e=!1){return ot(this.isLoaded&&this.channel!==void 0,403),this.channel.getGCData(e)}updateUsedRoutes(e,t){}}class KW extends Mx{constructor(e,t,r,i,s,o,u,d,f,m){super(e,t,r,()=>this.services),this.snapshotTree=m;const g=new Map,P=ia(this.snapshotTree);this.isSnapshotInOldFormatAndCollectBlobs(P,g)&&this.sanitizeSnapshot(P),this.services=new DF(()=>Lx(this.id,i.connected,u,this.dirtyFn,f,s,o,P,g)),this.dirtyFn=()=>{d(e)}}async getChannel(){return this.channel===void 0&&(this.channel=await this.loadChannel().catch(e=>{throw pi.wrapIfUnrecognized(e,"rehydratedLocalChannelContextFailedToLoadChannel",void 0)})),this.channel}async loadChannel(){ot(!this.isLoaded,398),ot(await this.services.value.objectStorage.contains(".attributes"),400);const e=await En(this.services.value.objectStorage,".attributes");if(ot(this.factory===void 0,520),this.factory=this.registry.get(e.type),this.factory===void 0)throw new Error(`Channel Factory ${e.type} not registered`);const t=await this.factory.load(this.runtime,this.id,this.services.value,e);this.channel=t;for(const r of this.pending)this.services.value.deltaConnection.process(r,!1,void 0);return this.channel}isSnapshotInOldFormatAndCollectBlobs(e,t){let r=!1;const i=e.blobsContents;Object.entries(i).forEach(([s,o])=>{t.set(s,o),e.blobs[s]!==void 0&&(r=!0)});for(const s of Object.values(e.trees))r=r||this.isSnapshotInOldFormatAndCollectBlobs(s,t);return r}sanitizeSnapshot(e){const t=new Map(Object.entries(e.blobs));for(const[r,i]of t.entries())t.get(i)===void 0&&delete e.blobs[r];for(const r of Object.values(e.trees))this.sanitizeSnapshot(r)}}class JW extends Mx{constructor(e,t,r,i,s,o,u,d,f,m){if(super(e,t,i,()=>this.services),ot(r!==void 0,521),this.factory=t.get(r),this.factory===void 0)throw new Error(`Channel Factory ${r} not registered`);this.channel=this.factory.create(i,e),this.services=new DF(()=>Lx(this.id,s.connected,d,this.dirtyFn,m,o,u)),this.dirtyFn=()=>{f(e)}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Th{constructor(e,t,r,i,s,o,u,d,f,m,g,P,D){this.runtime=e,this.dataStoreContext=t,this.id=u,this.registry=f,this.attachMessageType=D,this.isLoaded=!1,this.pending=[],ot(!this.id.includes("/"),784),this.subLogger=at.create(this.runtime.logger,"RemoteChannelContext"),this.services=Lx(this.id,this.dataStoreContext.connected,i,()=>s(this.id),o,r,this.subLogger,d,m);const M=async(U,j,E)=>this.summarizeInternal(U,j,E);this.summarizerNode=g(M,async U=>this.getGCDataInternal(U),async()=>P()),this.thresholdOpsCounter=new ax(Th.pendingOpsCountThreshold,this.subLogger)}getChannel(){return this.channelP===void 0&&(this.channelP=this.loadChannel()),this.channelP}setConnectionState(e,t){this.isLoaded&&this.services.deltaConnection.setConnectionState(e)}applyStashedOp(e){return ot(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(e)}processOp(e,t,r){this.summarizerNode.invalidate(e.sequenceNumber),this.isLoaded?this.services.deltaConnection.process(e,t,r):(ot(!t,405),ot(this.pending!==void 0,574),this.pending.push(e),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length))}reSubmit(e,t){ot(this.isLoaded,406),this.services.deltaConnection.reSubmit(e,t)}rollback(e,t){ot(this.isLoaded,752),this.services.deltaConnection.rollback(e,t)}async summarize(e=!1,t=!0,r){return this.summarizerNode.summarize(e,t,r)}async summarizeInternal(e,t,r){const i=await this.getChannel(),s=await MF(i,e,t,r);return Object.assign(Object.assign({},s),{id:this.id})}async loadChannel(){ot(!this.isLoaded,407);let e;await this.services.objectStorage.contains(Jm)&&(e=await En(this.services.objectStorage,Jm));let t;if(e===void 0){if(this.attachMessageType===void 0)throw new Rs("channelTypeNotAvailable",{channelId:{value:this.id,tag:Ot.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:Ot.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/")});if(t=this.registry.get(this.attachMessageType),t===void 0)throw new Rs("channelFactoryNotRegisteredForAttachMessageType",{channelId:{value:this.id,tag:Ot.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:Ot.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:this.attachMessageType});e=t.attributes}else if(t=this.registry.get(e.type),t===void 0)throw new Rs("channelFactoryNotRegisteredForGivenType",{channelId:{value:this.id,tag:Ot.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:Ot.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:e.type});e.snapshotFormatVersion!==void 0&&e.snapshotFormatVersion!==t.attributes.snapshotFormatVersion&&this.subLogger.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",channelType:{value:e.type,tag:Ot.PackageData},channelSnapshotVersion:{value:`${e.snapshotFormatVersion}@${e.packageVersion}`,tag:Ot.PackageData},channelCodeVersion:{value:`${t.attributes.snapshotFormatVersion}@${t.attributes.packageVersion}`,tag:Ot.PackageData}});const r=await t.load(this.runtime,this.id,this.services,e);ot(this.pending!==void 0,575);for(const i of this.pending)this.services.deltaConnection.process(i,!1,void 0);return this.thresholdOpsCounter.send("ProcessPendingOps",this.pending.length),this.channel=r,this.pending=void 0,this.isLoaded=!0,this.services.deltaConnection.setConnectionState(this.dataStoreContext.connected),this.channel}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return(await this.getChannel()).getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""])}}Th.pendingOpsCountThreshold=1e3;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Js;(function(n){n.Attach="attach",n.ChannelOp="op"})(Js||(Js={}));class Qh extends jW{constructor(e,t,r){super(),this.dataStoreContext=e,this.sharedObjectRegistry=t,this._disposed=!1,this.contexts=new Map,this.contextsDeferred=new Map,this.pendingAttach=new Map,this.deferredAttached=new hd,this.localChannelContextQueue=new Map,this.notBoundedChannelContextSet=new Set,this.pendingHandlesToMakeVisible=new Set,ot(!e.id.includes("/"),782),this.logger=at.create(e.logger,"FluidDataStoreRuntime",{all:{dataStoreId:CP()}}),this.id=e.id,this.options=e.options,this.deltaManager=e.deltaManager,this.quorum=e.getQuorum(),this.audience=e.getAudience();const i=e.baseSnapshot;this.channelsBaseGCDetails=new qW(async()=>{var s,o,u;const d=await((u=(o=(s=this.dataStoreContext).getBaseGCDetails)===null||o===void 0?void 0:o.call(s))!==null&&u!==void 0?u:this.dataStoreContext.getInitialGCSummaryDetails());return IF(d)}),(i==null?void 0:i.trees)!==void 0&&Object.keys(i.trees).forEach(s=>{if(s==="_search")return;let o;e.isLocalDataStore?(o=new KW(s,this.sharedObjectRegistry,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(d,f)=>this.submitChannelOp(s,d,f),d=>this.setChannelDirty(d),(d,f)=>this.addedGCOutboundReference(d,f),i.trees[s]),e.attachState!==Qe.Detached?o.makeVisible():this.localChannelContextQueue.set(s,o)):o=new Th(this,e,e.storage,(d,f)=>this.submitChannelOp(s,d,f),d=>this.setChannelDirty(d),(d,f)=>this.addedGCOutboundReference(d,f),s,i.trees[s],this.sharedObjectRegistry,void 0,this.dataStoreContext.getCreateChildSummarizerNodeFn(s,{type:nt.CreateSummarizerNodeSource.FromSummary}),async()=>this.getChannelBaseGCDetails(s));const u=new hd;u.resolve(o),this.contexts.set(s,o),this.contextsDeferred.set(s,u)}),this.attachListener(),this.bindState=r?Hr.Bound:Hr.NotBound,this._attachState=e.attachState,r?this.visibilityState=e.attachState===Qe.Detached?nt.VisibilityState.LocallyVisible:nt.VisibilityState.GloballyVisible:this.visibilityState=nt.VisibilityState.NotVisible,r&&this.deferredAttached.resolve()}static load(e,t,r){return new Qh(e,t,r)}get IFluidRouter(){return this}get connected(){return this.dataStoreContext.connected}get clientId(){return this.dataStoreContext.clientId}get clientDetails(){return this.dataStoreContext.clientDetails}get isAttached(){return this.attachState!==Qe.Detached}get attachState(){return this._attachState}get absolutePath(){return yc(this.id,this.routeContext)}get routeContext(){return this.dataStoreContext.IFluidHandleContext}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}async resolveHandle(e){return this.request(e)}async request(e){try{const t=ns.create(e),r=t.pathParts[0];if(r==="_channels"||r==="_custom")return this.request(t.createSubRequest(1));if(this.contextsDeferred.has(r)&&t.isLeaf(1))try{return{mimeType:"fluid/object",status:200,value:await(await this.contextsDeferred.get(r).promise).getChannel()}}catch(i){return this.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},i),Eh(500,`Failed to get Channel: ${i}`,e)}return si(e)}catch(t){return xh(t)}}async getChannel(e){return this.verifyNotClosed(),this.contextsDeferred.has(e)||this.contextsDeferred.set(e,new hd),await(await this.contextsDeferred.get(e).promise).getChannel()}createChannel(e=CP(),t){if(e.includes("/"))throw new Ct(`Id cannot contain slashes: ${e}`);this.verifyNotClosed(),ot(!this.contexts.has(e),377),this.notBoundedChannelContextSet.add(e);const r=new JW(e,this.sharedObjectRegistry,t,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(i,s)=>this.submitChannelOp(e,i,s),i=>this.setChannelDirty(i),(i,s)=>this.addedGCOutboundReference(i,s));if(this.contexts.set(e,r),this.contextsDeferred.has(e))this.contextsDeferred.get(e).resolve(r);else{const i=new hd;i.resolve(r),this.contextsDeferred.set(e,i)}return ot(!!r.channel,378),r.channel}bindChannel(e){if(ot(this.notBoundedChannelContextSet.has(e.id),379),this.notBoundedChannelContextSet.delete(e.id),this.isAttached){this.attachChannel(e);return}this.pendingHandlesToMakeVisible.has(e.handle)||(this.bind(e.handle),this.localChannelContextQueue.has(e.id)||this.localChannelContextQueue.set(e.id,this.contexts.get(e.id)))}makeVisibleAndAttachGraph(){this.visibilityState===nt.VisibilityState.NotVisible&&(this.visibilityState=nt.VisibilityState.LocallyVisible,this.pendingHandlesToMakeVisible.forEach(e=>{e.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.bindToContext())}attachGraph(){this.makeVisibleAndAttachGraph()}bindToContext(){this.bindState===Hr.NotBound&&(this.bindState=Hr.Binding,this.dataStoreContext.bindToContext(),this.bindState=Hr.Bound)}bind(e){if(this.visibilityState!==nt.VisibilityState.NotVisible){e.attachGraph();return}this.pendingHandlesToMakeVisible.add(e)}setConnectionState(e,t){this.verifyNotClosed();for(const[,r]of this.contexts)r.setConnectionState(e,t);Ng(this.logger,this,e,t)}getQuorum(){return this.quorum}getAudience(){return this.audience}async uploadBlob(e){return this.verifyNotClosed(),this.dataStoreContext.uploadBlob(e)}process(e,t,r){this.verifyNotClosed();try{switch(e.type){case Js.Attach:{const i=e.contents,s=i.id;if(t)ot(this.pendingAttach.has(s),380),this.pendingAttach.delete(s);else{ot(!this.contexts.has(s),381);const o=new Map,u=$O(i.snapshot.entries,o),d=new Th(this,this.dataStoreContext,this.dataStoreContext.storage,(f,m)=>this.submitChannelOp(s,f,m),f=>this.setChannelDirty(f),(f,m)=>this.addedGCOutboundReference(f,m),s,u,this.sharedObjectRegistry,o,this.dataStoreContext.getCreateChildSummarizerNodeFn(s,{type:nt.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:i.snapshot}),async()=>this.getChannelBaseGCDetails(s),i.type);if(this.contexts.set(s,d),this.contextsDeferred.has(s))this.contextsDeferred.get(s).resolve(d);else{const f=new hd;f.resolve(d),this.contextsDeferred.set(s,f)}}break}case Js.ChannelOp:this.processChannelOp(e,t,r);break;default:}this.emit("op",e)}catch(i){throw pi.wrapIfUnrecognized(i,"fluidDataStoreRuntimeFailedToProcessMessage",e)}}processSignal(e,t){this.emit("signal",e,t)}isChannelAttached(e){return!this.notBoundedChannelContextSet.has(e)&&!this.localChannelContextQueue.has(e)&&!this.pendingAttach.has(e)}getOutboundRoutes(){const e=[];for(const[t]of this.contexts)e.push(`${this.absolutePath}/${t}`);return e}updateGCNodes(e){e.addRouteToAllNodes(this.absolutePath),e.addNode("/",this.getOutboundRoutes())}async getGCData(e=!1){const t=new Ox;return await Promise.all(Array.from(this.contexts).filter(([r,i])=>this.isChannelAttached(r)).map(async([r,i])=>{const s=await i.getGCData(e);t.prefixAndAddNodes(r,s.gcNodes)})),this.updateGCNodes(t),t.getGCData()}updateUsedRoutes(e,t){var r;const i=AF(e);for(const[s]of i)ot(this.contexts.has(s),382);for(const[s,o]of this.contexts)o.updateUsedRoutes((r=i.get(s))!==null&&r!==void 0?r:[],t)}addedGCOutboundReference(e,t){var r,i;(i=(r=this.dataStoreContext).addedGCOutboundReference)===null||i===void 0||i.call(r,e,t)}async getChannelBaseGCDetails(e){var t;let r=(await this.channelsBaseGCDetails).get(e);return r===void 0?r={}:((t=r.gcData)===null||t===void 0?void 0:t.gcNodes)!==void 0&&EW(r.gcData.gcNodes,this.absolutePath),(r.usedRoutes===void 0||r.usedRoutes.length===0)&&(r.usedRoutes=[""]),r}async summarize(e=!1,t=!0,r){const i=new Tr;return await Promise.all(Array.from(this.contexts).filter(([s,o])=>{const u=this.isChannelAttached(s);return ot(u,383),u}).map(async([s,o])=>{const u=await o.summarize(e,t,r);i.addWithStats(s,u)})),i.getSummaryTree()}getAttachSummary(e){this.attachGraph();const t=new Tr;for(const[r,i]of this.contexts){if(!(i instanceof Mx))throw new st("Should only be called with local channel handles");if(!this.notBoundedChannelContextSet.has(r)){let s;if(i.isLoaded){const o=i.getAttachSummary(e);ot(o.summary.type===Kb.Tree,384),s={stats:o.stats,summary:o.summary}}else ot(!!this.dataStoreContext.baseSnapshot,385),s=zg(this.dataStoreContext.baseSnapshot.trees[r]);t.addWithStats(r,s)}}return t.getSummaryTree()}submitMessage(e,t,r){this.submit(e,t,r)}submitSignal(e,t){return this.verifyNotClosed(),this.dataStoreContext.submitSignal(e,t)}async waitAttached(){return this.deferredAttached.promise}attachChannel(e){if(this.verifyNotClosed(),e.handle.isAttached)return;e.handle.attachGraph(),ot(this.isAttached,386),ot(this.visibilityState===nt.VisibilityState.GloballyVisible,720);const t=LF(e,!0,!1),r=$g(t.summary),i={id:e.id,snapshot:r,type:e.attributes.type};this.pendingAttach.set(e.id,i),this.submit(Js.Attach,i),this.contexts.get(e.id).makeVisible()}submitChannelOp(e,t,r){const i={address:e,contents:t};this.submit(Js.ChannelOp,i,r)}submit(e,t,r=void 0){this.verifyNotClosed(),this.dataStoreContext.submitMessage(e,t,r)}reSubmit(e,t,r){switch(this.verifyNotClosed(),e){case Js.ChannelOp:{const i=t,s=this.contexts.get(i.address);ot(!!s,387),s.reSubmit(i.contents,r);break}case Js.Attach:this.submit(e,t,r);break;default:UW()}}rollback(e,t,r){switch(this.verifyNotClosed(),e){case Js.ChannelOp:{const i=t,s=this.contexts.get(i.address);ot(!!s,749),s.rollback(i.contents,r);break}default:throw new st(`Can't rollback ${e} message`)}}async applyStashedOp(e){const t=e,r=this.contexts.get(t.address);return ot(!!r,388),await r.getChannel(),r.applyStashedOp(t.contents)}setChannelDirty(e){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(e)}processChannelOp(e,t,r){this.verifyNotClosed();const i=e.contents,s=Object.assign(Object.assign({},e),{contents:i.contents}),o=this.contexts.get(i.address);return ot(!!o,389),o.processOp(s,t,r),o}attachListener(){this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once("attaching",()=>{this.attachGraph(),this._attachState=Qe.Attaching,ot(this.visibilityState===nt.VisibilityState.LocallyVisible,721),this.visibilityState=nt.VisibilityState.GloballyVisible,this.localChannelContextQueue.forEach(e=>{e.makeVisible()}),this.localChannelContextQueue.clear(),this.deferredAttached.resolve(),this.emit("attaching")}),this.dataStoreContext.once("attached",()=>{ot(this.visibilityState===nt.VisibilityState.GloballyVisible,722),this._attachState=Qe.Attached,this.emit("attached")})}verifyNotClosed(){if(this._disposed)throw new st("Runtime is closed")}}const QW=(n,e=Qh)=>class extends e{async request(r){const i=await super.request(r);return i.status===404?n(r,this):i}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class jl{constructor(e,t,r){this.value=e,this.path=t,this.routeContext=r,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=yc(t,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.routeContext.isAttached}get visible(){return this.isAttached||this.locallyVisible}async get(){return this.value}attachGraph(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach(e=>{e.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}bind(e){if(this.visible){e.attachGraph();return}this.pendingHandlesToMakeVisible.add(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class XW extends jl{async get(){throw Error("Do not try to get a summarizer object from the handle. Reference it directly.")}attach(){}bind(e){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class YW{constructor(e,t){this.lastOpSequenceNumber=e,this._lastAttempt=t,this._lastSuccessfulSummary=Object.assign({},t)}get lastAttempt(){return this._lastAttempt}get lastSuccessfulSummary(){return this._lastSuccessfulSummary}updateWithLastSummaryAckInfo(e){this._lastAttempt=e,this._lastSuccessfulSummary=Object.assign({},e)}recordAttempt(e){this._lastAttempt={refSequenceNumber:e??this.lastOpSequenceNumber,summaryTime:Date.now()}}markLastAttemptAsSuccessful(){this._lastSuccessfulSummary=Object.assign({},this.lastAttempt)}}class ZW{constructor(e,t,r,i){this.heuristicData=e,this.configuration=t,this.trySummarize=r,this.logger=i,this.idleTimer=new Vg(this.configuration.idleTime,()=>this.trySummarize("idle")),this.minOpsForLastSummaryAttempt=this.configuration.minOpsForLastSummaryAttempt}get opsSinceLastAck(){return this.heuristicData.lastOpSequenceNumber-this.heuristicData.lastSuccessfulSummary.refSequenceNumber}run(){const e=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime,t=this.opsSinceLastAck;e>this.configuration.maxTime?(this.idleTimer.clear(),this.trySummarize("maxTime")):t>this.configuration.maxOps?(this.idleTimer.clear(),this.trySummarize("maxOps")):this.idleTimer.restart()}shouldRunLastSummary(){const e=this.opsSinceLastAck,t=this.minOpsForLastSummaryAttempt;return this.logger.sendTelemetryEvent({eventName:"ShouldRunLastSummary",opsSinceLastAck:e,minOpsForLastSummaryAttempt:t}),e>=t}dispose(){this.idleTimer.clear()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function Jb(n,e,t){const r=[n.then(i=>({result:"done",value:i})),e.then(({timerResult:i})=>({result:i}))];return t!==void 0&&r.push(t.waitCancelled.then(()=>({result:"cancelled"}))),Promise.race(r)}const xP=2e4,eG=5,EP={submitSummaryFailure:"Error while generating, uploading, or submitting summary",summaryOpWaitTimeout:"Timeout while waiting for summarize op broadcast",summaryAckWaitTimeout:"Timeout while waiting for summaryAck/summaryNack op",summaryNack:"Server rejected summary via summaryNack op",disconnect:"Summary cancelled due to summarizer or main client disconnect"};class Yd{constructor(){this.summarySubmitted=new Cr,this.summaryOpBroadcasted=new Cr,this.receivedSummaryAckOrNack=new Cr}fail(e,t,r,i){ye(!this.receivedSummaryAckOrNack.isCompleted,606);const s={success:!1,message:e,data:void 0,error:t,retryAfterSeconds:i};this.summarySubmitted.resolve(s),this.summaryOpBroadcasted.resolve(s),this.receivedSummaryAckOrNack.resolve(Object.assign(Object.assign({},s),{data:r}))}build(){return{summarySubmitted:this.summarySubmitted.promise,summaryOpBroadcasted:this.summaryOpBroadcasted.promise,receivedSummaryAckOrNack:this.receivedSummaryAckOrNack.promise}}}class tG{constructor(e,t,r,i,s,o,u){this.pendingAckTimer=e,this.heuristicData=t,this.submitSummaryCallback=r,this.raiseSummarizingError=i,this.successfulSummaryCallback=s,this.summaryWatcher=o,this.logger=u,this.summarizeTimer=new Vg(xP,()=>this.summarizeTimerHandler(xP,1))}summarize(e,t,r,i=new Yd){return this.summarizeCore(e,t,i,r).catch(s=>{const o="UnexpectedSummarizeError";this.logger.sendErrorEvent(Object.assign({eventName:o},e),s),i.fail(o,s)}),i.build()}async summarizeCore(e,t,r,i){const{refreshLatestAck:s,fullTree:o}=t,u=at.create(this.logger,void 0,{all:e}),d=Date.now()-this.heuristicData.lastAttempt.summaryTime,f=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime;let m={fullTree:o,timeSinceLastAttempt:d,timeSinceLastSummary:f};const g=dt.start(u,Object.assign({eventName:"Summarize",refreshLatestAck:s},m)),P=U=>`${U}: ${EP[U]}`,D=(U,j,E,k)=>{this.raiseSummarizingError(EP[U]);const z=sP(j),K=i.cancelled||(j==null?void 0:j.errorType)===mi.offlineError?"generic":"error";g.cancel(Object.assign(Object.assign({},E),{reason:U,category:K,retryAfterSeconds:z}),j),r.fail(P(U),j,k,z)};this.summarizeTimer.start();let M;try{M=await this.submitSummaryCallback({fullTree:o,refreshLatestAck:s,summaryLogger:u,cancellationToken:i});const U=M.referenceSequenceNumber,j=U-this.heuristicData.lastSuccessfulSummary.refSequenceNumber;if(m=Object.assign(Object.assign({},m),{referenceSequenceNumber:U,minimumSequenceNumber:M.minimumSequenceNumber,opsSinceLastAttempt:U-this.heuristicData.lastAttempt.refSequenceNumber,opsSinceLastSummary:j}),M.stage!=="base"&&(m=Object.assign(Object.assign(Object.assign({},m),M.summaryStats),{generateDuration:M.generateDuration}),M.stage!=="generate"&&(m=Object.assign(Object.assign({},m),{handle:M.handle,uploadDuration:M.uploadDuration}),M.stage!=="upload"&&(m=Object.assign(Object.assign({},m),{clientSequenceNumber:M.clientSequenceNumber})))),M.stage!=="submit")return D("submitSummaryFailure",M.error,m);if(!o&&!M.forcedFullTree){const{summarizedDataStoreCount:E,gcStateUpdatedDataStoreCount:k=0}=M.summaryStats;E>k+j&&u.sendErrorEvent({eventName:"IncrementalSummaryViolation",summarizedDataStoreCount:E,gcStateUpdatedDataStoreCount:k,opsSinceLastSummary:j})}g.reportEvent("generate",Object.assign({},m)),r.summarySubmitted.resolve({success:!0,data:M})}catch(U){return D("submitSummaryFailure",U)}finally{this.heuristicData.recordAttempt(M==null?void 0:M.referenceSequenceNumber),this.summarizeTimer.clear()}try{const U=this.pendingAckTimer.start(),j=this.summaryWatcher.watchSummary(M.clientSequenceNumber),E=await Jb(j.waitBroadcast(),U,i);if(E.result==="cancelled")return D("disconnect");if(E.result!=="done")return D("summaryOpWaitTimeout");const k=E.value,z=Date.now()-this.heuristicData.lastAttempt.summaryTime;r.summaryOpBroadcasted.resolve({success:!0,data:{summarizeOp:k,broadcastDuration:z}}),this.heuristicData.lastAttempt.summarySequenceNumber=k.sequenceNumber,u.sendTelemetryEvent({eventName:"Summarize_Op",duration:z,referenceSequenceNumber:k.referenceSequenceNumber,summarySequenceNumber:k.sequenceNumber,handle:k.contents.handle});const K=await Jb(j.waitAckNack(),U,i);if(K.result==="cancelled")return D("disconnect");if(K.result!=="done")return D("summaryAckWaitTimeout");const ie=K.value;this.pendingAckTimer.clear();const he=Date.now()-this.heuristicData.lastAttempt.summaryTime;if(m=Object.assign({ackWaitDuration:he,ackNackSequenceNumber:ie.sequenceNumber,summarySequenceNumber:ie.contents.summaryProposal.summarySequenceNumber},m),ie.type===an.SummaryAck)this.heuristicData.markLastAttemptAsSuccessful(),this.successfulSummaryCallback(),g.end(Object.assign(Object.assign({},m),{handle:ie.contents.handle})),r.receivedSummaryAckOrNack.resolve({success:!0,data:{summaryAckOp:ie,ackNackDuration:he}});else{ye(ie.type===an.SummaryNack,628);const pe=ie.contents,X=pe==null?void 0:pe.message,fe=pe==null?void 0:pe.retryAfter,ge=new st(`Received summaryNack: ${X}`,{retryAfterSeconds:fe});return ye(sP(ge)===fe,607),D("summaryNack",ge,Object.assign(Object.assign({},m),{nackRetryAfter:fe}),{summaryNackOp:ie,ackNackDuration:he})}}finally{this.pendingAckTimer.clear()}}summarizeTimerHandler(e,t){if(this.logger.sendPerformanceEvent({eventName:"SummarizeTimeout",timeoutTime:e,timeoutCount:t}),t<eG){const r=e*2;this.summarizeTimer.start(r,()=>this.summarizeTimerHandler(r,t+1))}}dispose(){this.summarizeTimer.clear()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Zy=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const nG=10*60*1e3;class Bx{constructor(e,t,r,i,s,o,u,d,f){this.summaryWatcher=t,this.configuration=r,this.submitSummaryCallback=i,this.heuristicData=s,this.raiseSummarizingError=o,this.summaryCollection=u,this.cancellationToken=d,this.stopSummarizerCallback=f,this.stopping=!1,this._disposed=!1,this.tryWhileSummarizing=!1,this.summarizeCount=0,this.totalSuccessfulAttempts=0,this.tryGetCorrelatedLogger=P=>this.heuristicData.lastAttempt.refSequenceNumber===P?this.logger:void 0;const m={summarizeCount:()=>this.summarizeCount,summarizerSuccessfulAttempts:()=>this.totalSuccessfulAttempts};this.logger=at.create(e,"Running",{all:m}),r.state!=="disableHeuristics"&&(ye(this.configuration.state==="enabled",746),this.heuristicRunner=new ZW(s,this.configuration,P=>this.trySummarize(P),this.logger)),ye(this.configuration.state!=="disabled",747);const g=Math.min(this.configuration.maxAckWaitTime,nG);this.pendingAckTimer=new kW(g,()=>{this.raiseSummarizingError("Pending summary ack not received in time"),this.logger.sendErrorEvent({eventName:"SummaryAckWaitTimeout",maxAckWaitTime:g,referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber,timePending:Date.now()-this.heuristicData.lastAttempt.summaryTime})}),u.setPendingAckTimerTimeoutCallback(g,()=>{this.pendingAckTimer.hasTimer&&(this.logger.sendTelemetryEvent({eventName:"MissingSummaryAckFoundByOps",referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber}),this.pendingAckTimer.clear())}),this.generator=new tG(this.pendingAckTimer,this.heuristicData,this.submitSummaryCallback,this.raiseSummarizingError,()=>{this.totalSuccessfulAttempts++},this.summaryWatcher,this.logger)}static async start(e,t,r,i,s,o,u,d,f){var m;const g=new Bx(e,t,r,i,s,o,u,d,f);return await g.waitStart(),(m=g.heuristicRunner)===null||m===void 0||m.run(),g}get disposed(){return this._disposed}dispose(){var e;this.summaryWatcher.dispose(),(e=this.heuristicRunner)===null||e===void 0||e.dispose(),this.heuristicRunner=void 0,this.generator.dispose(),this.pendingAckTimer.clear(),this.disposeEnqueuedSummary(),this._disposed=!0,this.stopping=!0}handleSystemOp(e){switch(e.type){case an.ClientLeave:case an.ClientJoin:case an.Propose:{this.handleOp(void 0,e);return}default:return}}handleOp(e,{sequenceNumber:t,type:r,clientId:i,contents:s}){var o;e===void 0&&(this.heuristicData.lastOpSequenceNumber=t,this.tryRunEnqueuedSummary()||(o=this.heuristicRunner)===null||o===void 0||o.run())}async waitStop(e){var t;this.stopping||(this.stopping=!0,this.disposeEnqueuedSummary(),e&&(!((t=this.heuristicRunner)===null||t===void 0)&&t.shouldRunLastSummary())&&this.summarizingLock===void 0&&this.trySummarizeOnce({reason:"lastSummary"},{}),await this.summarizingLock)}async waitStart(){const e=await Jb(this.summaryWatcher.waitFlushed(),this.pendingAckTimer.start());this.pendingAckTimer.clear(),this.summaryCollection.unsetPendingAckTimerTimeoutCallback(),e.result==="done"&&e.value!==void 0&&this.heuristicData.updateWithLastSummaryAckInfo({refSequenceNumber:e.value.summaryOp.referenceSequenceNumber,summaryTime:Date.now(),summarySequenceNumber:e.value.summaryOp.sequenceNumber})}async lockedRefreshSummaryAckAction(e){ye(this.refreshSummaryAckLock===void 0,"Refresh Summary Ack - Caller is responsible for checking lock");const t=new Cr;return this.refreshSummaryAckLock=t.promise,e().finally(()=>{t.resolve(),this.refreshSummaryAckLock=void 0})}async lockedSummaryAction(e){ye(this.summarizingLock===void 0,603);const t=new Cr;return this.summarizingLock=t.promise,this.summarizeCount++,await this.refreshSummaryAckLock,e().finally(()=>{var r;t.resolve(),this.summarizingLock=void 0;const i=this.tryWhileSummarizing;this.tryWhileSummarizing=!1,!this.stopping&&!this.tryRunEnqueuedSummary()&&i&&((r=this.heuristicRunner)===null||r===void 0||r.run())})}trySummarizeOnce(e,t,r=this.cancellationToken,i=new Yd){return this.lockedSummaryAction(async()=>this.generator.summarize(e,t,r,i).receivedSummaryAckOrNack).catch(s=>{}),i.build()}trySummarize(e,t=this.cancellationToken){if(this.summarizingLock!==void 0){this.tryWhileSummarizing=!0;return}this.lockedSummaryAction(async()=>{const r=[{refreshLatestAck:!1,fullTree:!1},{refreshLatestAck:!0,fullTree:!1},{refreshLatestAck:!0,fullTree:!1,delaySeconds:120},{refreshLatestAck:!0,fullTree:!0,delaySeconds:600}];let i,s=0,o=0,u;for(let d=0;d<r.length;){if(this.cancellationToken.cancelled||++s>1&&e==="lastSummary")return;o++;const f=r[d],{delaySeconds:m=0}=f,g=Zy(f,["delaySeconds"]),P=i??m,D=Object.assign({reason:e,summaryAttempts:s,summaryAttemptsPerPhase:o,summaryAttemptPhase:d+1},g);P>0&&(this.logger.sendPerformanceEvent(Object.assign({eventName:"SummarizeAttemptDelay",duration:P,summaryNackDelay:i!==void 0},D)),await OW(P*1e3)),await this.refreshSummaryAckLock;const U=await this.generator.summarize(D,g,t).receivedSummaryAckOrNack;if(U.success)return;i=U.retryAfterSeconds,(i===void 0||o>1)&&(d++,o=0),u=U}this.logger.sendErrorEvent({eventName:"FailToSummarize",reason:e,message:u==null?void 0:u.message},u==null?void 0:u.error),this.stopSummarizerCallback("failToSummarize")}).catch(r=>{this.logger.sendErrorEvent({eventName:"UnexpectedSummarizeError"},r)})}summarizeOnDemand(e=new Yd,t){var{reason:r}=t,i=Zy(t,["reason"]);if(this.stopping)return e.fail("RunningSummarizer stopped or disposed",void 0),e.build();if(this.summarizingLock!==void 0)throw new Ct("Attempted to run an already-running summarizer on demand");return this.trySummarizeOnce({reason:`onDemand/${r}`},i,this.cancellationToken,e)}enqueueSummarize(e){var{reason:t,afterSequenceNumber:r=0,override:i=!1}=e,s=Zy(e,["reason","afterSequenceNumber","override"]);const o=`enqueue;${t}`;let u=!1;if(this.enqueuedSummary!==void 0){if(!i)return{alreadyEnqueued:!0};this.enqueuedSummary.resultsBuilder.fail("Aborted; overridden by another enqueue summarize attempt",void 0),this.enqueuedSummary=void 0,u=!0}this.enqueuedSummary={reason:o,afterSequenceNumber:r,options:s,resultsBuilder:new Yd};const d=this.enqueuedSummary.resultsBuilder.build();return this.tryRunEnqueuedSummary(),u?Object.assign(Object.assign({},d),{alreadyEnqueued:!0,overridden:!0}):d}tryRunEnqueuedSummary(){if(this.stopping)return this.disposeEnqueuedSummary(),!1;if(this.enqueuedSummary===void 0||this.heuristicData.lastOpSequenceNumber<this.enqueuedSummary.afterSequenceNumber||this.summarizingLock!==void 0)return!1;const{reason:e,resultsBuilder:t,options:r}=this.enqueuedSummary;return this.enqueuedSummary=void 0,this.trySummarizeOnce({reason:`enqueuedSummary/${e}`},r,this.cancellationToken,t),!0}disposeEnqueuedSummary(){this.enqueuedSummary!==void 0&&(this.enqueuedSummary.resultsBuilder.fail("RunningSummarizer stopped or disposed",void 0),this.enqueuedSummary=void 0)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const rG="summarizingError";class Ph extends st{constructor(e,t=!1){super(e),this.logged=t,this.errorType=rG,this.canRetry=!0}static wrap(e,t=!1,r){return nx(e,s=>new Ph(s,t),r)}}const iG=(n,e)=>new Ph(n,e);class jx extends Fn.EventEmitter{constructor(e,t,r,i,s,o,u){super(),this.runtime=t,this.configurationGetter=r,this.internalsProvider=i,this.summaryCollection=o,this.runCoordinatorCreateFn=u,this._disposed=!1,this.starting=!1,this.stopDeferred=new Cr,this.summarizeOnDemand=(...d)=>{var f;try{if(this._disposed||!((f=this.runningSummarizer)===null||f===void 0)&&f.disposed)throw new Ct("Summarizer is already disposed.");if(this.runtime.summarizerClientId!==void 0&&this.runtime.summarizerClientId!==this.runtime.clientId)throw new Ct("On-demand summary attempted while an elected summarizer is present");const m=new Yd;return this.runningSummarizer?this.runningSummarizer.summarizeOnDemand(m,...d):(this.runCoordinatorCreateFn(this.runtime).then(P=>{this.start(this.runtime.clientId,P).then(async M=>{M.summarizeOnDemand(m,...d);const U=await Promise.race([this.stopDeferred.promise,P.waitCancelled]);await M.waitStop(!1),P.stop(U),this.close()}).catch(M=>{m.fail("Failed to start summarizer",M)})}).catch(P=>{m.fail("Failed to create cancellation token",P)}),m.build())}catch(m){throw Ph.wrap(m,!1,this.logger)}},this.enqueueSummarize=(...d)=>{if(this._disposed||this.runningSummarizer===void 0||this.runningSummarizer.disposed)throw new Ct("Summarizer is not running or already disposed.");return this.runningSummarizer.enqueueSummarize(...d)},this.logger=at.create(this.runtime.logger,"Summarizer"),this.innerHandle=new XW(this,e,s)}get IFluidLoadable(){return this}get ISummarizer(){return this}get handle(){return this.innerHandle}static async create(e,t){const r={headers:{[Ht.cache]:!1,[Ht.clientDetails]:{capabilities:{interactive:!1},type:Ur},[nc.summarizingClient]:!0,[Ht.reconnect]:!1},url:t},i=await e.resolve(r),s=await ic(i,{url:"_summarizer"});if(s.ISummarizer===void 0)throw new Ct("Fluid object does not implement ISummarizer");return s.ISummarizer}async run(e){try{return await this.runCore(e)}catch(t){throw this.stop("summarizerException"),Ph.wrap(t,!1,this.logger)}finally{this.close()}}stop(e){this.stopDeferred.resolve(e)}close(){this.dispose(),this.runtime.closeFn()}async runCore(e){const t=await this.runCoordinatorCreateFn(this.runtime),r=Promise.race([t.waitCancelled,this.stopDeferred.promise]);if(r.then(o=>{this.logger.sendTelemetryEvent({eventName:"StoppingSummarizer",onBehalfOf:e,reason:o})}),t.cancelled)return t.waitCancelled;const i=await this.start(e,t),s=await r;return await i.waitStop(!t.cancelled&&jx.stopReasonCanRunLastSummary(s)),t.stop(s),s}static stopReasonCanRunLastSummary(e){return e==="parentNotConnected"}async start(e,t){if(this.runningSummarizer){if(this.runningSummarizer.disposed)throw new Ct("Starting a disposed summarizer");return this.runningSummarizer}if(this.starting)throw new Ct("Attempting to start a summarizer that is already starting");this.starting=!0,this.logger.sendTelemetryEvent({eventName:"RunningSummarizer",onBehalfOf:e,initSummarySeqNumber:this.runtime.deltaManager.initialSequenceNumber,config:JSON.stringify(this.configurationGetter())});const r=this.runtime.clientId;if(r===void 0)throw new Ct("clientId should be defined if connected.");const i=await Bx.start(this.logger,this.summaryCollection.createWatcher(r),this.configurationGetter(),async(...s)=>this.internalsProvider.submitSummary(...s),new YW(this.runtime.deltaManager.lastSequenceNumber,{refSequenceNumber:this.runtime.deltaManager.initialSequenceNumber,summaryTime:Date.now()}),s=>{this._disposed||this.logger.sendErrorEvent({eventName:"summarizingError"},iG(s,!0))},this.summaryCollection,t,s=>t.stop(s));return this.runningSummarizer=i,this.starting=!1,this.handleSummaryAcks().catch(s=>{this.logger.sendErrorEvent({eventName:"HandleSummaryAckFatalError"},s)}),this.systemOpListener=s=>i.handleSystemOp(s),this.runtime.deltaManager.inbound.on("op",this.systemOpListener),this.opListener=(s,o)=>i.handleOp(s,o),this.runtime.on("batchEnd",this.opListener),i}dispose(){this.stop("summarizerClientDisconnected"),this._disposed=!0,this.runningSummarizer&&(this.runningSummarizer.dispose(),this.runningSummarizer=void 0),this.systemOpListener&&this.runtime.deltaManager.inbound.off("op",this.systemOpListener),this.opListener&&this.runtime.removeListener("batchEnd",this.opListener)}async handleSummaryAcks(){var e,t,r,i,s;let o=this.runtime.deltaManager.initialSequenceNumber,u;for(;this.runningSummarizer;){const d=(e=this.runningSummarizer.tryGetCorrelatedLogger(o))!==null&&e!==void 0?e:this.logger;try{u=void 0,u=await this.summaryCollection.waitSummaryAck(o),o=u.summaryOp.referenceSequenceNumber;const f=u.summaryOp.contents.handle,m=u.summaryAck.contents.handle;await this.runningSummarizer.lockedRefreshSummaryAckAction(async()=>this.internalsProvider.refreshLatestSummaryAck(f,m,o,d).catch(async g=>{if(ex(g)&&g.errorType===mi.fileNotFoundOrAccessDeniedError)d.sendTelemetryEvent({eventName:"HandleSummaryAckErrorIgnored",referenceSequenceNumber:o,proposalHandle:f,ackHandle:m},g);else throw g}))}catch(f){d.sendErrorEvent({eventName:"HandleSummaryAckError",referenceSequenceNumber:o,handle:(r=(t=u==null?void 0:u.summaryOp)===null||t===void 0?void 0:t.contents)===null||r===void 0?void 0:r.handle,ackHandle:(s=(i=u==null?void 0:u.summaryAck)===null||i===void 0?void 0:i.contents)===null||s===void 0?void 0:s.handle},f)}o++}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const sG=5e3,oG=4e3;var _n;(function(n){n[n.Off=0]="Off",n[n.Starting=1]="Starting",n[n.Running=2]="Running",n[n.Stopping=3]="Stopping"})(_n||(_n={}));class Wg{constructor(e,t,r,i,s,o,{initialDelayMs:u=sG,opsToBypassInitialDelay:d=oG}={},f){this.clientElection=e,this.connectedState=t,this.summaryCollection=r,this.requestSummarizerFn=s,this.startThrottler=o,this.disableHeuristics=f,this.state=_n.Off,this._disposed=!1,this.handleConnected=m=>{this.latestClientId=m,this.refreshSummarizer()},this.handleDisconnected=()=>{this.refreshSummarizer()},this.refreshSummarizer=()=>{const m=this.getShouldSummarizeState();switch(this.state){case _n.Off:{m.shouldSummarize&&this.startSummarization();return}case _n.Starting:return;case _n.Running:{m.shouldSummarize===!1&&this.stop(m.stopReason);return}case _n.Stopping:return;default:return}},this.summarizeOnDemand=(...m)=>{if(this.summarizer===void 0)throw Error("No running summarizer client");return this.summarizer.summarizeOnDemand(...m)},this.enqueueSummarize=(...m)=>{if(this.summarizer===void 0)throw Error("No running summarizer client");return this.summarizer.enqueueSummarize(...m)},this.logger=at.create(i,"SummaryManager",{all:{clientId:()=>this.latestClientId}}),this.connectedState.on("connected",this.handleConnected),this.connectedState.on("disconnected",this.handleDisconnected),this.latestClientId=this.connectedState.clientId,this.opsToBypassInitialDelay=d,this.initialDelayMs=u}get disposed(){return this._disposed}get currentState(){return this.state}start(){this.clientElection.on("electedSummarizerChanged",this.refreshSummarizer),this.refreshSummarizer()}getShouldSummarizeState(){if(this.connectedState.clientId!==this.clientElection.electedParentId||this.state!==_n.Running&&this.connectedState.clientId!==this.clientElection.electedClientId)return{shouldSummarize:!1,stopReason:"parentShouldNotSummarize"};if(this.connectedState.connected)if(this.disposed)ye(!1,608);else return{shouldSummarize:!0};else return{shouldSummarize:!1,stopReason:"parentNotConnected"}}startSummarization(){ye(this.state===_n.Off,609),this.state=_n.Starting,ye(this.summarizer===void 0,610),this.delayBeforeCreatingSummarizer().then(async e=>{if(e&&this.getShouldSummarizeState().shouldSummarize===!1)return"early exit";ye(this.state===_n.Starting,611),this.state=_n.Running;const t=await this.requestSummarizerFn();this.summarizer=t;const r=this.getShouldSummarizeState();if(r.shouldSummarize===!1)return this.state=_n.Starting,t.stop(r.stopReason),"early exit after starting summarizer";const i=this.latestClientId;return dt.timedExecAsync(this.logger,{eventName:"RunningSummarizer",attempt:this.startThrottler.numAttempts},async()=>t.run(i,this.disableHeuristics))}).then(e=>{this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:e})}).catch(e=>{if(this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:"exception"},e),this.getShouldSummarizeState().shouldSummarize||this.summarizer!==void 0){const t=(e==null?void 0:e.errorType)===mi.offlineError?"generic":"error";this.logger.sendTelemetryEvent({eventName:"SummarizerException",category:t},e)}}).finally(()=>{var e;ye(this.state!==_n.Off,612),this.state=_n.Off,(e=this.summarizer)===null||e===void 0||e.close(),this.summarizer=void 0,this.getShouldSummarizeState().shouldSummarize&&this.startSummarization()})}stop(e){var t;Wg.isStartingOrRunning(this.state)&&(this.state=_n.Stopping,(t=this.summarizer)===null||t===void 0||t.stop(e))}async delayBeforeCreatingSummarizer(){let e=this.startThrottler.getDelay();this.logger.sendTelemetryEvent({eventName:"CreatingSummarizer",throttlerDelay:e,initialDelay:this.initialDelayMs,startThrottlerMaxDelayMs:this.startThrottler.maxDelayMs,opsSinceLastAck:this.summaryCollection.opsSinceLastAck,opsToBypassInitialDelay:this.opsToBypassInitialDelay});let t=!1;if(this.summaryCollection.opsSinceLastAck<this.opsToBypassInitialDelay&&(t=!0,e=Math.max(e,this.initialDelayMs)),e>0){let r,i;const s=()=>{this.summaryCollection.opsSinceLastAck>=this.opsToBypassInitialDelay&&(clearTimeout(r),i())},o=new Promise(d=>{r=setTimeout(()=>d(),e)}),u=new Promise(d=>{i=d});this.summaryCollection.addOpListener(s),await Promise.race([o,u]),this.summaryCollection.removeOpListener(s)}return t}dispose(){this.clientElection.off("electedSummarizerChanged",this.refreshSummarizer),this.connectedState.off("connected",this.handleConnected),this.connectedState.off("disconnected",this.handleDisconnected),this._disposed=!0}}Wg.isStartingOrRunning=n=>n===_n.Starting||n===_n.Running;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Rh{constructor(e,t){this.logger=t,this.processingTimeIncrement=10,this.currentAllowedProcessingTimeForTurn=Rh.processingTime,this.schedulingCount=0,this.deltaManager=e,this.deltaManager.inbound.on("idle",()=>{this.inboundQueueIdle()})}batchBegin(e){this.processingStartTime||(this.processingStartTime=oi.now()),this.schedulingLog===void 0&&this.schedulingCount%500===0&&(this.schedulingLog={opsRemainingToProcess:0,numberOfTurns:1,totalProcessingTime:0,numberOfBatchesProcessed:0,firstSequenceNumber:e.sequenceNumber,lastSequenceNumber:e.sequenceNumber,startTime:oi.now()})}batchEnd(e){if(this.schedulingLog&&(this.schedulingLog.numberOfBatchesProcessed++,this.schedulingLog.lastSequenceNumber=e.sequenceNumber,this.schedulingLog.opsRemainingToProcess=this.deltaManager.inbound.length),this.shouldRunScheduler()){const t=oi.now(),r=t-this.processingStartTime;r>this.currentAllowedProcessingTimeForTurn&&(this.deltaManager.inbound.pause(),this.currentAllowedProcessingTimeForTurn+=this.processingTimeIncrement,this.schedulingLog&&(this.schedulingLog.numberOfTurns++,this.schedulingLog.totalProcessingTime+=r),setTimeout(()=>{this.schedulingLog&&this.logger.sendTelemetryEvent({eventName:"InboundOpsPartialProcessingTime",duration:qt.formatTick(r),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,opsRemainingToProcess:this.deltaManager.inbound.length,processingTime:qt.formatTick(this.schedulingLog.totalProcessingTime),numberOfTurns:this.schedulingLog.numberOfTurns,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,timeToResume:qt.formatTick(oi.now()-t)}),this.deltaManager.inbound.resume()}),this.processingStartTime=void 0)}}inboundQueueIdle(){if(this.schedulingLog){const e=oi.now();this.schedulingLog.totalProcessingTime+=e-this.processingStartTime,this.logger.sendTelemetryEvent({eventName:"InboundOpsProcessingTime",opsRemainingToProcess:this.schedulingLog.opsRemainingToProcess,numberOfTurns:this.schedulingLog.numberOfTurns,processingTime:qt.formatTick(this.schedulingLog.totalProcessingTime),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,duration:qt.formatTick(e-this.schedulingLog.startTime),schedulingCount:this.schedulingCount}),this.schedulingLog=void 0}this.schedulingCount++,this.processingStartTime=void 0,this.currentAllowedProcessingTimeForTurn=Rh.processingTime}shouldRunScheduler(){return this.deltaManager.inbound.length>0}}Rh.processingTime=50;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const BF=5e3;class aG{constructor(e,t,r){this.clientId=e,this.deltaManager=t,this.pongCount=0,this.msnTrackingTimestamp=0,this.opProcessingTimes={},this.opPerfData={},this.firstConnection=!0,this.bootTime=oi.now(),this.connectionStartTime=0,this.gap=0,this.logger=at.create(r,"OpPerf"),this.deltaManager.on("pong",i=>this.recordPingTime(i)),this.deltaManager.on("submitOp",i=>this.beforeOpSubmit(i)),this.deltaManager.on("op",i=>this.afterProcessingOp(i)),this.deltaManager.on("connect",(i,s)=>{this.clientId=i.clientId,s!==void 0&&(this.connectionOpSeqNumber=this.deltaManager.lastKnownSeqNumber,this.gap=s,this.connectionStartTime=oi.now(),this.gap<=0&&this.reportGettingUpToDate())}),this.deltaManager.on("disconnect",()=>{this.sequenceNumberForMsnTracking=void 0,this.clientSequenceNumberForLatencyStatistics=void 0,this.opProcessingTimes={},this.opPerfData={},this.connectionOpSeqNumber=void 0,this.firstConnection=!1,this.pongCount=0}),this.deltaManager.outbound.on("push",i=>{for(const s of i)s.type===an.Operation&&this.clientSequenceNumberForLatencyStatistics===s.clientSequenceNumber&&(ye(this.opProcessingTimes.outboundPushEventTime===void 0,712),ye(this.opPerfData.durationNetwork===void 0,713),this.opProcessingTimes.outboundPushEventTime=Date.now(),ye(this.opPerfData.durationOutboundBatching===void 0,714),ye(this.opProcessingTimes.submitOpEventTime!==void 0,715),this.opPerfData.durationOutboundBatching=this.opProcessingTimes.outboundPushEventTime-this.opProcessingTimes.submitOpEventTime)}),this.deltaManager.inbound.on("push",i=>{this.clientId===i.clientId&&i.type===an.Operation&&this.clientSequenceNumberForLatencyStatistics===i.clientSequenceNumber&&this.opProcessingTimes.outboundPushEventTime!==void 0&&(this.opProcessingTimes.inboundPushEventTime=Date.now(),this.opPerfData.durationNetwork=this.opProcessingTimes.inboundPushEventTime-this.opProcessingTimes.outboundPushEventTime,this.opProcessingTimes.outboundPushEventTime=void 0,this.opPerfData.lengthInboundQueue=this.deltaManager.inbound.length)}),this.deltaManager.inbound.on("idle",(i,s)=>{typeof i=="number"&&i>=100&&this.logger.sendPerformanceEvent({eventName:"GetDeltas_OpProcessing",count:i,duration:s})})}reportGettingUpToDate(){this.connectionOpSeqNumber=void 0,this.logger.sendPerformanceEvent({eventName:"ConnectionSpeed",duration:oi.now()-this.connectionStartTime,ops:this.gap,timeToConnect:this.firstConnection?qt.formatTick(this.connectionStartTime-this.bootTime):void 0,firstConnection:this.firstConnection})}recordPingTime(e){this.pingLatency=e,this.pongCount%100===0&&this.deltaManager.active&&this.logger.sendPerformanceEvent({eventName:"DeltaLatency",duration:e}),this.pongCount++}beforeOpSubmit(e){this.clientSequenceNumberForLatencyStatistics===void 0&&e.clientSequenceNumber%500===1&&(ye(this.opProcessingTimes.outboundPushEventTime===void 0,716),ye(this.opPerfData.durationNetwork===void 0,717),this.opProcessingTimes.submitOpEventTime=Date.now(),this.clientSequenceNumberForLatencyStatistics=e.clientSequenceNumber)}afterProcessingOp(e){const t=e.sequenceNumber;if(t===this.connectionOpSeqNumber&&this.reportGettingUpToDate(),this.sequenceNumberForMsnTracking===void 0&&t%1e3===0&&(this.sequenceNumberForMsnTracking=t,this.msnTrackingTimestamp=e.timestamp),this.sequenceNumberForMsnTracking!==void 0&&e.minimumSequenceNumber>=this.sequenceNumberForMsnTracking&&(ye(this.msnTrackingTimestamp!==void 0,718),this.logger.sendPerformanceEvent({eventName:"MsnStatistics",sequenceNumber:t,msnDistance:t-this.sequenceNumberForMsnTracking,duration:e.timestamp-this.msnTrackingTimestamp}),this.sequenceNumberForMsnTracking=void 0),this.clientId===e.clientId&&this.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber){ye(this.opProcessingTimes.submitOpEventTime!==void 0,288);const r=Date.now();this.opProcessingTimes.inboundPushEventTime!==void 0&&(this.opPerfData.durationInboundToProcessing=r-this.opProcessingTimes.inboundPushEventTime);const i=r-this.opProcessingTimes.submitOpEventTime,s=i>BF?"error":"performance";this.logger.sendPerformanceEvent(Object.assign({eventName:"OpRoundtripTime",sequenceNumber:t,referenceSequenceNumber:e.referenceSequenceNumber,duration:i,category:s,pingLatency:this.pingLatency,msnDistance:this.deltaManager.lastSequenceNumber-this.deltaManager.minimumSequenceNumber},this.opPerfData)),this.clientSequenceNumberForLatencyStatistics=void 0,this.opPerfData={}}}}function uG(n,e,t){new aG(n,e,t)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class lG{constructor(e,t,r){var i;this.stateHandler=e,this.pendingStates=new Hb,this.disposeOnce=new Nx(()=>{this.initialStates.clear(),this.pendingStates.clear()}),this._pendingMessagesCount=0,this.isProcessingBatch=!1,this.dispose=()=>this.disposeOnce.value,this.initialStates=new Hb((i=r==null?void 0:r.pendingStates)!==null&&i!==void 0?i:[]),this.flushModeForNextMessage=t,this.onFlushModeUpdated(t)}get pendingMessagesCount(){return this._pendingMessagesCount}hasPendingMessages(){return this._pendingMessagesCount!==0||!this.initialStates.isEmpty()}getLocalState(){if(ye(this.initialStates.isEmpty(),745),this.hasPendingMessages())return{pendingStates:this.pendingStates.toArray().map(e=>e.type==="message"?Object.assign(Object.assign({},e),{localOpMetadata:void 0}):e)}}get disposed(){return this.disposeOnce.evaluated}onSubmitMessage(e,t,r,i,s,o){const u={type:"message",messageType:e,clientSequenceNumber:t,referenceSequenceNumber:r,content:i,localOpMetadata:s,opMetadata:o};this.pendingStates.push(u),this._pendingMessagesCount++}onFlushModeUpdated(e){this.pendingStates.push({type:"flushMode",flushMode:e})}onFlush(){if(this.stateHandler.flushMode()===nt.FlushMode.Immediate)return;const e=this.pendingStates.peekBack();(e==null?void 0:e.type)==="message"&&this.pendingStates.push({type:"flush"})}async applyStashedOpsAt(e){for(;!this.initialStates.isEmpty();){const t=this.initialStates.peekFront();if(t.type==="message"){if(e!==void 0){if(t.referenceSequenceNumber>e)break;if(t.referenceSequenceNumber<e)throw new Error("loaded from snapshot too recent to apply stashed ops")}const r=await this.stateHandler.applyStashedOp(t.messageType,t.content);t.localOpMetadata=r}this.pendingStates.push(this.initialStates.shift())}}processPendingLocalMessage(e){this.maybeProcessBatchBegin(e);const t=this.peekNextPendingState();if(ye(t.type==="message",361),this.pendingStates.shift(),t.clientSequenceNumber!==e.clientSequenceNumber){const r=pi.create("pending local message clientSequenceNumber mismatch","unexpectedAckReceived",e,{expectedClientSequenceNumber:t.clientSequenceNumber});this.stateHandler.close(r);return}return this._pendingMessagesCount--,this.maybeProcessBatchEnd(e),t.localOpMetadata}maybeProcessBatchBegin(e){let t,r=!1,i=this.peekNextPendingState();for(;i.type!=="message";)i.type==="flushMode"&&(t=i.flushMode),i.type==="flush"&&(r=!0),this.pendingStates.shift(),i=this.peekNextPendingState();t!==void 0&&(this.flushModeForNextMessage=t),t!==nt.FlushMode.Immediate&&(t===nt.FlushMode.TurnBased||r)&&(ye(!this.isProcessingBatch&&this.pendingBatchBeginMessage===void 0,363),this.pendingBatchBeginMessage=e,this.isProcessingBatch=!0)}maybeProcessBatchEnd(e){var t,r;if(!this.isProcessingBatch)return;const i=this.peekNextPendingState();if(i.type==="message")return;ye(i.type!=="flushMode",701),ye(this.pendingBatchBeginMessage!==void 0,365);const s=(t=this.pendingBatchBeginMessage.metadata)===null||t===void 0?void 0:t.batch;if(this.pendingBatchBeginMessage===e)ye(s===void 0,366);else{const o=(r=e.metadata)===null||r===void 0?void 0:r.batch;ye(s===!0,367),ye(o===!1,368)}this.pendingBatchBeginMessage=void 0,this.isProcessingBatch=!1}checkpoint(){const e=this.pendingStates.peekBack();return{rollback:()=>{try{for(;this.pendingStates.peekBack()!==e;)this.rollbackNextPendingState()}catch(t){const r=Vh(t,i=>pi.create(`RollbackError: ${i}`,"checkpointRollback",void 0));throw this.stateHandler.close(r),r}}}}peekNextPendingState(){const e=this.pendingStates.peekFront();return ye(!!e,369),e}rollbackNextPendingState(){if(this.pendingStates.length===0)return;this._pendingMessagesCount--;const t=this.pendingStates.pop();switch(t.type){case"message":this.stateHandler.rollback(t.messageType,t.content,t.localOpMetadata);break;default:throw new Error(`Can't rollback state ${t.type}`)}}replayPendingStates(){ye(this.stateHandler.connected(),370),ye(this.clientId!==this.stateHandler.clientId(),371),this.clientId=this.stateHandler.clientId(),ye(this.initialStates.isEmpty(),372);let e=this.pendingStates.length;if(e===0)return;this._pendingMessagesCount=0;const t=this.stateHandler.flushMode();for(this.stateHandler.setFlushMode(this.flushModeForNextMessage);e>0;){const r=this.pendingStates.shift();switch(r.type){case"message":this.stateHandler.reSubmit(r.messageType,r.content,r.localOpMetadata,r.opMetadata);break;case"flushMode":this.stateHandler.setFlushMode(r.flushMode);break;case"flush":this.stateHandler.flush();break}e--}this.stateHandler.setFlushMode(t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const tm="1.3.6";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class TP{constructor(e,t,r){this.path=e,this.routeContext=t,this.get=r,this.attached=!1,this.absolutePath=yc(e,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.attached}attachGraph(){this.attached=!0}bind(e){throw new Error("Cannot bind to blob handle")}}class ai{constructor(e,t,r,i,s,o,u){this.routeContext=e,this.getStorage=r,this.attachBlobCallback=i,this.gcNodeUpdated=s,this.runtime=o,this.logger=u,this.blobIds=new Set,this.pendingBlobIds=new Map,this.detachedBlobIds=new Set,this.runtime.once("dispose",()=>{for(const d of this.pendingBlobIds.values())d.reject(new Error("runtime disposed while blobAttach op in flight"))}),this.load(t)}hasBlob(e){return this.blobIds.has(e)||this.detachedBlobIds.has(e)}getBlobGCNodePath(e){return`/${ai.basePath}/${e}`}async getBlob(e){var t,r;const i=(r=(t=this.redirectTable)===null||t===void 0?void 0:t.get(e))!==null&&r!==void 0?r:e;return ye(this.hasBlob(i),287),this.gcNodeUpdated(this.getBlobGCNodePath(e)),new TP(`${ai.basePath}/${i}`,this.routeContext,async()=>dt.timedExecAsync(this.logger,{eventName:"AttachmentReadBlob",id:i},async()=>this.getStorage().readBlob(i),{end:!0,cancel:"error"}))}async createBlob(e){var t,r;this.runtime.attachState===Qe.Attaching&&(this.logger.sendTelemetryEvent({eventName:"CreateBlobWhileAttaching"}),await new Promise(o=>this.runtime.once("attached",o))),!this.runtime.connected&&this.runtime.attachState===Qe.Attached&&await new Promise(o=>this.runtime.once("connected",o));const i=await dt.timedExecAsync(this.logger,{eventName:"createBlob"},async()=>this.getStorage().createBlob(e),{end:!0,cancel:"error"}),s=new TP(`${ai.basePath}/${i.id}`,this.routeContext,async()=>this.getBlob(i.id).then(async o=>o.get()));return this.runtime.attachState===Qe.Detached?(this.detachedBlobIds.add(i.id),s):(this.pendingBlobIds.has(i.id)?await((t=this.pendingBlobIds.get(i.id))===null||t===void 0?void 0:t.promise):this.blobIds.has(i.id)||(this.pendingBlobIds.set(i.id,new Cr),this.attachBlobCallback(i.id),await((r=this.pendingBlobIds.get(i.id))===null||r===void 0?void 0:r.promise)),s)}processBlobAttachOp(e,t){if(t){const r=this.pendingBlobIds.get(e);ye(r!==void 0,504),r.resolve(),this.pendingBlobIds.delete(e)}this.blobIds.add(e)}static async load(e,t){if(!e)return{};let r;const i=e.blobs[this.redirectTableBlobName];return i&&(r=await t(i)),{ids:Object.entries(e.blobs).filter(([o,u])=>o!==this.redirectTableBlobName).map(([o,u])=>u),redirectTable:r}}load(e){var t,r,i;if(e.ids){const s=this.runtime.attachState===Qe.Detached;e.ids.map(o=>s?this.detachedBlobIds.add(o):this.blobIds.add(o))}e.redirectTable&&(this.redirectTable=new Map(e.redirectTable)),this.logger.sendTelemetryEvent({eventName:"AttachmentBlobsLoaded",count:(r=(t=e.ids)===null||t===void 0?void 0:t.length)!==null&&r!==void 0?r:0,redirectTable:(i=e.redirectTable)===null||i===void 0?void 0:i.length})}getGCData(e=!1){const t={gcNodes:{}};if(this.blobIds.forEach(r=>{t.gcNodes[this.getBlobGCNodePath(r)]=[]}),this.redirectTable!==void 0)for(const[r,i]of this.redirectTable)t.gcNodes[this.getBlobGCNodePath(r)]=[this.getBlobGCNodePath(i)];return t}deleteUnusedRoutes(e){var t;for(const r of e){const i=r.split("/");ye(i.length===3&&i[1]===ai.basePath,725);const s=i[2];if(!((t=this.redirectTable)===null||t===void 0)&&t.has(s)){this.redirectTable.delete(s);continue}this.blobIds.delete(s)}}summarize(e){const r=!!this.redirectTable||this.runtime.attachState!==Qe.Detached?this.blobIds:this.detachedBlobIds,i=new Tr;return r.forEach(s=>{i.addAttachment(s)}),this.redirectTable&&this.redirectTable.size>0&&i.addBlob(ai.redirectTableBlobName,JSON.stringify(Array.from(this.redirectTable.entries()))),i.getSummaryTree()}setRedirectTable(e){ye(this.runtime.attachState===Qe.Detached,594),ye(!this.redirectTable,595);for(const[t,r]of e)ye(this.detachedBlobIds.delete(t),596),this.blobIds.add(r);ye(this.detachedBlobIds.size===0,597),this.redirectTable=e}}ai.basePath="_blobs";ai.redirectTableBlobName=".redirectTable";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class cG{constructor(e){this.notBoundContexts=new Set,this._contexts=new Map,this.deferredContexts=new Map,this.disposeOnce=new Nx(()=>{for(const[t,r]of this.deferredContexts)r.promise.then(i=>{i.dispose()}).catch(i=>{this._logger.sendErrorEvent({eventName:"FluidDataStoreContextDisposeError",fluidDataStoreId:t},i)})}),this.dispose=()=>this.disposeOnce.value,this._logger=at.create(e)}[Symbol.iterator](){return this._contexts.entries()}get size(){return this._contexts.size}get disposed(){return this.disposeOnce.evaluated}notBoundLength(){return this.notBoundContexts.size}isNotBound(e){return this.notBoundContexts.has(e)}has(e){return this._contexts.has(e)}get(e){return this._contexts.get(e)}delete(e){return this.deferredContexts.delete(e),this.notBoundContexts.delete(e),this._contexts.delete(e)}getUnbound(e){if(!(this._contexts.get(e)===void 0||!this.notBoundContexts.has(e)))return this._contexts.get(e)}addUnbound(e){const t=e.id;ye(!this._contexts.has(t),344),this._contexts.set(t,e),this.notBoundContexts.add(t),this.ensureDeferred(t)}async getBoundOrRemoted(e,t){const r=this.ensureDeferred(e);if(!(!t&&!r.isCompleted))return r.promise}ensureDeferred(e){const t=this.deferredContexts.get(e);if(t)return t;const r=new Cr;return this.deferredContexts.set(e,r),r}bind(e){const t=this.notBoundContexts.delete(e);ye(t,345),this.resolveDeferred(e)}resolveDeferred(e){const t=this._contexts.get(e);ye(!!t,346),ye(!this.notBoundContexts.has(e),347);const r=this.deferredContexts.get(e);ye(!!r,348),r.resolve(t)}addBoundOrRemoted(e){const t=e.id;ye(!this._contexts.has(t),349),this._contexts.set(t,e),this.ensureDeferred(t),this.resolveDeferred(t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var dG=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const hG=1,Mo="gc",jF="__gc",fG="Fluid.GarbageCollection.RunGC",pG="Fluid.GarbageCollection.RunSweep",mG="Fluid.GarbageCollection.GCTestMode",gG="Fluid.GarbageCollection.WriteDataAtRoot",vG="Fluid.GarbageCollection.RunSessionExpiry",yG="Fluid.GarbageCollection.DisableSessionExpiry",SG="Fluid.GarbageCollection.TrackGCState",bG="Fluid.GarbageCollection.DisableSweepLog",qx=1*24*60*60*1e3,wG=7*qx,CG=30*qx,kr={DataStore:"DataStore",SubDataStore:"SubDataStore",Blob:"Blob",Other:"Other"},ri={Active:"Active",Inactive:"Inactive",SweepReady:"SweepReady"};class PP{constructor(e,t,r,i){this.unreferencedTimestampMs=e,this.inactiveTimeoutMs=t,this.sweepTimeoutMs=r,this._state=ri.Active,i!==void 0&&this.updateTracking(i)}get state(){return this._state}updateTracking(e){const t=e-this.unreferencedTimestampMs;if(this.sweepTimeoutMs!==void 0&&t>=this.sweepTimeoutMs){this._state=ri.SweepReady,this.clearTimers();return}if(t>=this.inactiveTimeoutMs){this._state=ri.Inactive,this.clearTimers(),this.sweepTimeoutMs!==void 0&&Qm(this.sweepTimeoutMs-t,()=>{this._state=ri.SweepReady},i=>{this.sweepTimer=i});return}const r=this.inactiveTimeoutMs-t;if(this.inactiveTimer===void 0){const i=()=>{this._state=ri.Inactive,this.sweepTimeoutMs!==void 0&&Qm(this.sweepTimeoutMs-this.inactiveTimeoutMs,()=>{this._state=ri.SweepReady},s=>{this.sweepTimer=s})};this.inactiveTimer=new Vg(r,()=>i())}this.inactiveTimer.restart(r)}clearTimers(){var e;(e=this.inactiveTimer)===null||e===void 0||e.clear(),this.sweepTimer!==void 0&&clearTimeout(this.sweepTimer)}stopTracking(){this.clearTimers(),this._state=ri.Active}}let xG=class qF{constructor(e){var t,r,i,s,o,u,d;this._writeDataAtRoot=!0,this.initialStateNeedsReset=!1,this.currentGCVersion=hG,this.newReferencesSinceLastRun=new Map,this.unreferencedNodesState=new Map,this.loggedUnreferencedEvents=new Set,this.pendingEventsQueue=[],this.completedRuns=0,this.runtime=e.runtime,this.isSummarizerClient=e.isSummarizerClient,this.gcOptions=e.gcOptions,this.getNodePackagePath=e.getNodePackagePath,this.getLastSummaryTimestampMs=e.getLastSummaryTimestampMs;const f=e.baseSnapshot,m=e.metadata,g=e.readAndParseBlob;this.mc=Iu(at.create(e.baseLogger,"GarbageCollector",{all:{completedGCRuns:()=>this.completedRuns}}));let P;if(e.existing)P=kP(m),this.gcEnabled=P>0,this.sweepEnabled=(t=m==null?void 0:m.sweepEnabled)!==null&&t!==void 0?t:!1,this.sessionExpiryTimeoutMs=m==null?void 0:m.sessionExpiryTimeoutMs;else{if(this.gcOptions.sweepAllowed&&this.gcOptions.gcAllowed===!1)throw new Ct("GC sweep phase cannot be enabled without enabling GC mark phase");this.gcEnabled=this.gcOptions.gcAllowed!==!1,this.sweepEnabled=this.gcOptions.sweepAllowed===!0,this.mc.config.getBoolean(vG)&&this.gcEnabled&&(this.sessionExpiryTimeoutMs=CG)}if(this.sessionExpiryTimeoutMs!==void 0&&this.mc.config.getBoolean(yG)!==!0){const U=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.SessionExpiryMs"),j=U??this.sessionExpiryTimeoutMs;Qm(j,()=>{this.runtime.closeFn(new Gz("Client session expired.",j))},E=>{this.sessionExpiryTimer=E}),e.snapshotCacheExpiryMs!==void 0&&(this.sweepTimeoutMs=this.sessionExpiryTimeoutMs+e.snapshotCacheExpiryMs+qx)}if(this.latestSummaryGCVersion=P??this.currentGCVersion,this.shouldRunGC=(r=this.mc.config.getBoolean(fG))!==null&&r!==void 0?r:this.gcEnabled&&!this.gcOptions.disableGC,this.shouldRunSweep=this.shouldRunGC&&this.sweepTimeoutMs!==void 0&&((i=this.mc.config.getBoolean(pG))!==null&&i!==void 0?i:this.sweepEnabled),this.trackGCState=this.mc.config.getBoolean(SG)===!0,this.inactiveTimeoutMs=(o=(s=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.InactiveTimeoutMs"))!==null&&s!==void 0?s:this.gcOptions.inactiveTimeoutMs)!==null&&o!==void 0?o:wG,this.sweepTimeoutMs!==void 0&&this.inactiveTimeoutMs>this.sweepTimeoutMs)throw new Ct("inactive timeout should not be greated than the sweep timeout");if(this.testMode=(u=this.mc.config.getBoolean(mG))!==null&&u!==void 0?u:this.gcOptions.runGCInTestMode===!0,this._writeDataAtRoot=(d=this.mc.config.getBoolean(gG))!==null&&d!==void 0?d:!0,this._writeDataAtRoot){const U=(f==null?void 0:f.trees[Mo])!==void 0;this.initialStateNeedsReset=U!==this.shouldRunGC}const D=new Ml(async()=>{var U;if(f===void 0)return;const j=f.trees[Mo];if(j!==void 0){this._writeDataAtRoot=!0;const z=await RP(j,g);return this.trackGCState&&(this.latestSerializedSummaryState=JSON.stringify(eS(z))),z}const E={gcNodes:{"/":{outboundRoutes:[]}}},k=VF(f,m);ye(k!==void 0,680);for(const[z,K]of Object.entries(k.trees)){const ie=K.blobs[nt.gcBlobKey];if(ie===void 0)continue;const he=await g(ie);if(((U=he.gcData)===null||U===void 0?void 0:U.gcNodes)===void 0)continue;const pe=`/${z}`;(await g(K.blobs[vu])).isRootDataStore&&E.gcNodes["/"].outboundRoutes.push(pe);for(const[fe,ge]of Object.entries(he.gcData.gcNodes)){const we=fe==="/"?pe:`${pe}${fe}`;E.gcNodes[we]={outboundRoutes:Array.from(ge)}}ye(E.gcNodes[pe]!==void 0,681),E.gcNodes[pe].unreferencedTimestampMs=he.unrefTimestamp}return Object.keys(E.gcNodes).length===1?void 0:E});this.initializeBaseStateP=new Ml(async()=>{const U=this.runtime.getCurrentReferenceTimestampMs(),j=await D;if(j===void 0)return;const E={};for(const[k,z]of Object.entries(j.gcNodes))z.unreferencedTimestampMs!==void 0&&this.unreferencedNodesState.set(k,new PP(z.unreferencedTimestampMs,this.inactiveTimeoutMs,this.sweepTimeoutMs,U)),E[k]=Array.from(z.outboundRoutes);this.previousGCDataFromLastRun={gcNodes:E}}),this.baseGCDetailsP=new Ml(async()=>{const U=await D;if(U===void 0)return new Map;const j={};for(const[z,K]of Object.entries(U.gcNodes))j[z]=Array.from(K.outboundRoutes);const E=Qy(j,["/"]).referencedNodeIds,k=IF({gcData:{gcNodes:j},usedRoutes:E});for(const[z,K]of Object.entries(U.gcNodes))if(K.unreferencedTimestampMs!==void 0){const ie=k.get(z.slice(1));ie!==void 0&&(ie.unrefTimestamp=K.unreferencedTimestampMs)}return k});const M=JSON.stringify(Object.assign({gcEnabled:this.gcEnabled,sweepEnabled:this.sweepEnabled,runGC:this.shouldRunGC,runSweep:this.shouldRunSweep,writeAtRoot:this._writeDataAtRoot,testMode:this.testMode,sessionExpiry:this.sessionExpiryTimeoutMs,inactiveTimeout:this.inactiveTimeoutMs,existing:e.existing,trackGCState:this.trackGCState},this.gcOptions));this.isSummarizerClient&&this.mc.logger.sendTelemetryEvent({eventName:"GarbageCollectorLoaded",gcConfigs:M}),this.shouldRunGC&&this.initializeBaseStateP.catch(U=>{const j=pi.wrapIfUnrecognized(U,"FailedToInitializeGC");throw j.addTelemetryProperties({gcConfigs:M}),j})}static create(e){return new qF(e)}get summaryStateNeedsReset(){return this.initialStateNeedsReset||this.shouldRunGC&&this.latestSummaryGCVersion!==this.currentGCVersion}get writeDataAtRoot(){return this._writeDataAtRoot}async collectGarbage(e){const{fullGC:t=this.gcOptions.runFullGC===!0||this.summaryStateNeedsReset}=e,r=e.logger?at.create(e.logger,void 0,{all:{completedGCRuns:()=>this.completedRuns}}):this.mc.logger;return dt.timedExecAsync(r,{eventName:"GarbageCollection"},async i=>{await this.runPreGCSteps();const s=await this.runtime.getGCData(t),o=Qy(s.gcNodes,["/"]),u=await this.runPostGCSteps(s,o,r);return i.end(Object.assign({},u)),this.completedRuns++,u},{end:!0,cancel:"error"})}async runPreGCSteps(){await this.initializeBaseStateP,await this.runtime.updateStateBeforeGC()}async runPostGCSteps(e,t,r){const i=this.generateStats(t);this.updateStateSinceLastRun(e,r);const s=this.runtime.getCurrentReferenceTimestampMs();return this.updateCurrentState(e,t,s),this.runtime.updateUsedRoutes(t.referencedNodeIds,s),this.logSweepEvents(r,s),this.testMode&&this.runtime.deleteUnusedRoutes(t.deletedNodeIds),await this.logUnreferencedEvents(r),i}summarize(e,t,r){var i;if(!this.shouldRunGC||this.previousGCDataFromLastRun===void 0)return;const s={gcNodes:{}};for(const[d,f]of Object.entries(this.previousGCDataFromLastRun.gcNodes))s.gcNodes[d]={outboundRoutes:f,unreferencedTimestampMs:(i=this.unreferencedNodesState.get(d))===null||i===void 0?void 0:i.unreferencedTimestampMs};const o=JSON.stringify(eS(s));if(this.trackGCState&&(this.pendingSerializedSummaryState=o,this.latestSerializedSummaryState!==void 0&&this.latestSerializedSummaryState===o&&!e&&t)){const d=mo();return d.handleNodeCount++,{summary:{type:Xo.Handle,handle:`/${Mo}`,handleType:Xo.Tree},stats:d}}const u=new Tr;return u.addBlob(`${jF}_root`,o),u.getSummaryTree()}getMetadata(){return{gcFeature:this.gcEnabled?this.currentGCVersion:0,sessionExpiryTimeoutMs:this.sessionExpiryTimeoutMs,sweepEnabled:this.sweepEnabled}}async getBaseGCDetails(){return this.baseGCDetailsP}async latestSummaryStateRefreshed(e,t){if(!this.shouldRunGC||!e.latestSummaryUpdated)return;if(e.wasSummaryTracked){this.latestSummaryGCVersion=this.currentGCVersion,this.initialStateNeedsReset=!1,this.trackGCState&&(this.latestSerializedSummaryState=this.pendingSerializedSummaryState,this.pendingSerializedSummaryState=void 0);return}const r=e.snapshot,i=r.blobs[Qb];if(i){const o=await t(i);this.latestSummaryGCVersion=kP(o)}const s=r.trees[Mo];if(s!==void 0&&this.trackGCState){const o=await RP(s,t);this.latestSerializedSummaryState=JSON.stringify(eS(o))}else this.latestSerializedSummaryState=void 0;this.pendingSerializedSummaryState=void 0}nodeUpdated(e,t,r,i,s){if(!this.shouldRunGC)return;const o=this.unreferencedNodesState.get(e);o&&o.state!==ri.Active&&this.inactiveNodeUsed(t,e,o,void 0,i,r,s)}addedOutboundReference(e,t){var r;if(!this.shouldRunGC)return;const i=(r=this.newReferencesSinceLastRun.get(e))!==null&&r!==void 0?r:[];i.push(t),this.newReferencesSinceLastRun.set(e,i);const s=this.unreferencedNodesState.get(t);s&&s.state!==ri.Active&&this.inactiveNodeUsed("Revived",t,s,e)}dispose(){this.sessionExpiryTimer!==void 0&&(clearTimeout(this.sessionExpiryTimer),this.sessionExpiryTimer=void 0)}updateCurrentState(e,t,r){this.previousGCDataFromLastRun=Xd(e),this.newReferencesSinceLastRun.clear();for(const i of t.referencedNodeIds){const s=this.unreferencedNodesState.get(i);s!==void 0&&(s.stopTracking(),this.unreferencedNodesState.delete(i))}if(r!==void 0)for(const i of t.deletedNodeIds){const s=this.unreferencedNodesState.get(i);s===void 0?this.unreferencedNodesState.set(i,new PP(r,this.inactiveTimeoutMs,this.sweepTimeoutMs,r)):s.updateTracking(r)}}updateStateSinceLastRun(e,t){if(this.previousGCDataFromLastRun===void 0)return;const r=this.findMissingExplicitReferences(e,this.previousGCDataFromLastRun,this.newReferencesSinceLastRun);if(this.writeDataAtRoot&&r.length>0&&r.forEach(o=>{const u={eventName:"gcUnknownOutboundReferences",gcNodeId:o[0],gcRoutes:JSON.stringify(o[1])};t.sendPerformanceEvent(u)}),this.newReferencesSinceLastRun.size===0)return;const i=PW(this.previousGCDataFromLastRun,e);this.newReferencesSinceLastRun.forEach((o,u)=>{i.gcNodes[u]===void 0?i.gcNodes[u]=o:i.gcNodes[u].push(...o)});const s=Qy(i.gcNodes,["/"]);for(const o of s.referencedNodeIds){const u=this.unreferencedNodesState.get(o);u!==void 0&&(u.stopTracking(),this.unreferencedNodesState.delete(o))}}findMissingExplicitReferences(e,t,r){ye(t!==void 0,695);const i=Object.entries(e.gcNodes),s=[];return i.forEach(([o,u])=>{var d,f;const m=(d=t.gcNodes[o])!==null&&d!==void 0?d:[],g=(f=r.get(o))!==null&&f!==void 0?f:[],P=[];u.forEach(D=>{const M=this.runtime.getNodeType(D)===kr.Blob||this.runtime.getNodeType(D)===kr.DataStore,U=!o.startsWith(D);M&&U&&!m.includes(D)&&!g.includes(D)&&P.push(D)}),P.length>0&&s.push([o,P])}),s}generateStats(e){const t={nodeCount:0,dataStoreCount:0,attachmentBlobCount:0,unrefNodeCount:0,unrefDataStoreCount:0,unrefAttachmentBlobCount:0,updatedNodeCount:0,updatedDataStoreCount:0,updatedAttachmentBlobCount:0},r=(i,s)=>{t.nodeCount++;const o=this.previousGCDataFromLastRun===void 0||this.unreferencedNodesState.has(i)===s;o&&t.updatedNodeCount++,s||t.unrefNodeCount++,this.runtime.getNodeType(i)===kr.DataStore&&(t.dataStoreCount++,o&&t.updatedDataStoreCount++,s||t.unrefDataStoreCount++),this.runtime.getNodeType(i)===kr.Blob&&(t.attachmentBlobCount++,o&&t.updatedAttachmentBlobCount++,s||t.unrefAttachmentBlobCount++)};for(const i of e.referencedNodeIds)r(i,!0);for(const i of e.deletedNodeIds)r(i,!1);return t}logSweepEvents(e,t){this.mc.config.getBoolean(bG)===!0||t===void 0||this.sweepTimeoutMs===void 0||this.unreferencedNodesState.forEach((r,i)=>{if(r.state!==ri.SweepReady)return;const s=this.runtime.getNodeType(i);if(s!==kr.DataStore&&s!==kr.Blob)return;const o=`Deleted-${i}`;this.loggedUnreferencedEvents.has(o)||(this.loggedUnreferencedEvents.add(o),e.sendTelemetryEvent({eventName:"GCObjectDeleted",id:i,type:s,age:t-r.unreferencedTimestampMs,timeout:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs()}))})}inactiveNodeUsed(e,t,r,i,s,o=this.runtime.getCurrentReferenceTimestampMs(),u){if(o===void 0||r.state===ri.Active||!this.isSummarizerClient&&e!=="Loaded")return;const d=this.runtime.getNodeType(t);if(d!==kr.DataStore&&d!==kr.Blob)return;const f=r.state,m=`${f}-${t}-${e}`;if(this.loggedUnreferencedEvents.has(m))return;this.loggedUnreferencedEvents.add(m);const g={id:t,type:d,unrefTime:r.unreferencedTimestampMs,age:o-r.unreferencedTimestampMs,timeout:r.state===ri.Inactive?this.inactiveTimeoutMs:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs(),externalRequest:u==null?void 0:u[Yo.externalRequest],viaHandle:u==null?void 0:u[Yo.viaHandle],fromId:i};this.isSummarizerClient?this.pendingEventsQueue.push(Object.assign(Object.assign({},g),{usageType:e,state:f})):this.mc.logger.sendErrorEvent(Object.assign(Object.assign({},g),{eventName:`${f}Object_${e}`,pkg:s?{value:s.join("/"),tag:Ot.CodeArtifact}:void 0}))}async logUnreferencedEvents(e){for(const t of this.pendingEventsQueue){const{usageType:r,state:i}=t,s=dG(t,["usageType","state"]),o=this.unreferencedNodesState.get(t.id),u=o===void 0||o.state===ri.Active;if(r==="Revived"===u){const d=await this.getNodePackagePath(t.id),f=t.fromId?await this.getNodePackagePath(t.fromId):void 0;e.sendErrorEvent(Object.assign(Object.assign({},s),{eventName:`${i}Object_${r}`,pkg:d?{value:d.join("/"),tag:Ot.CodeArtifact}:void 0,fromPkg:f?{value:f.join("/"),tag:Ot.CodeArtifact}:void 0}))}}this.pendingEventsQueue=[]}};async function RP(n,e){let t={gcNodes:{}};for(const r of Object.keys(n.blobs)){if(!r.startsWith(jF))continue;const i=n.blobs[r];if(i===void 0)continue;const s=await e(i);ye(s!==void 0,685),t=TW(t,s)}return t}function eS(n){const e=Object.entries(n.gcNodes);e.sort(([r],[i])=>r.localeCompare(i));const t={gcNodes:{}};for(const[r,i]of e)i.outboundRoutes.sort(),t.gcNodes[r]=i;return t}function Qm(n,e,t){let i;if(n>2147483647){const s=n-2147483647;i=setTimeout(()=>Qm(s,e,t),2147483647)}else i=setTimeout(()=>e(),n);t(i)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function UF(n){return n.summaryFormatVersion?n.summaryFormatVersion:n.snapshotFormatVersion==="0.1"?1:0}function zF(n){return!!n.summaryFormatVersion&&!n.disableIsolatedChannels}const EG=n=>n===void 0?void 0:{clientId:n.clientId,clientSequenceNumber:n.clientSequenceNumber,minimumSequenceNumber:n.minimumSequenceNumber,referenceSequenceNumber:n.referenceSequenceNumber,sequenceNumber:n.sequenceNumber,timestamp:n.timestamp,type:n.type},_P=".aliases",Qb=".metadata",IP=".chunks",AP=".electedSummarizer",Xb=".blobs";function TG(n){return!!n&&!n.disableIsolatedChannels}function kP(n){var e;return n&&(e=n.gcFeature)!==null&&e!==void 0?e:0}const PG=".protocol",RG=[PG,".logTail",".serviceProtocol",Xb,Mo],vu=".component";function Xm(n){n.summary={type:Xo.Tree,tree:{[nt.channelsTreeName]:n.summary}},n.stats.treeNodeCount++}async function _G(n,e){const t=await En(n,e.blobs[vu]),r=UF(t);return ye(r>0,469),t}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Ux(n,e,t){const r=JSON.stringify(n);return t?{pkg:r,snapshotFormatVersion:"0.1",isRootDataStore:e}:{pkg:r,summaryFormatVersion:2,isRootDataStore:e}}function IG(n,e,t){const r=Ux(n,e,t);return new UO(vu,JSON.stringify(r))}class Xh extends Sc{constructor(e,t,r,i,s){super(),this.existing=t,this.bindState=r,this.isLocalDataStore=i,this.makeLocallyVisibleFn=s,this._disposed=!1,this.detachedRuntimeCreation=!1,this.loaded=!1,this.pending=[],this._isInMemoryRoot=!1,this._containerRuntime=e.runtime,this.id=e.id,this.storage=e.storage,this.scope=e.scope,this.writeGCDataAtRoot=e.writeGCDataAtRoot,this.disableIsolatedChannels=e.disableIsolatedChannels,this.pkg=e.pkg,ye(!this.id.includes("/"),314),this._attachState=this.containerRuntime.attachState!==Qe.Detached&&this.existing?this.containerRuntime.attachState:Qe.Detached,this.bindToContext=()=>{ye(this.bindState===Hr.NotBound,315),this.bindState=Hr.Binding,ye(this.channel!==void 0,316),this.makeLocallyVisible(),this.bindState=Hr.Bound};const o=async(u,d,f)=>this.summarizeInternal(u,d,f);this.summarizerNode=e.createSummarizerNodeFn(o,async u=>this.getGCDataInternal(u),async()=>this.getBaseGCDetails()),this.subLogger=at.create(this.logger,"FluidDataStoreContext"),this.thresholdOpsCounter=new ax(Xh.pendingOpsCountThreshold,this.subLogger)}get packagePath(){return ye(this.pkg!==void 0,313),this.pkg}get options(){return this._containerRuntime.options}get clientId(){return this._containerRuntime.clientId}get clientDetails(){return this._containerRuntime.clientDetails}get logger(){return this._containerRuntime.logger}get deltaManager(){return this._containerRuntime.deltaManager}get connected(){return this._containerRuntime.connected}get IFluidHandleContext(){return this._containerRuntime.IFluidHandleContext}get containerRuntime(){return this._containerRuntime}get isLoaded(){return this.loaded}get baseSnapshot(){return this._baseSnapshot}get disposed(){return this._disposed}get attachState(){return this._attachState}get IFluidDataStoreRegistry(){return this.registry}async isRoot(){return this.isInMemoryRoot()||(await this.getInitialSnapshotDetails()).isRootDataStore}isInMemoryRoot(){return this._isInMemoryRoot}dispose(){this._disposed||(this._disposed=!0,this.channelDeferred&&this.channelDeferred.promise.then(e=>{e.dispose()}).catch(e=>{}))}rejectDeferredRealize(e,t){throw new st(e,{packageName:{value:t,tag:Ot.PackageData}})}async realize(){return ye(!this.detachedRuntimeCreation,317),this.channelDeferred||(this.channelDeferred=new Cr,this.realizeCore(this.existing).catch(e=>{var t;const r=pi.wrapIfUnrecognized(e,"realizeFluidDataStoreContext");r.addTelemetryProperties({fluidDataStoreId:{value:this.id,tag:"PackageData"}}),(t=this.channelDeferred)===null||t===void 0||t.reject(r),this.logger.sendErrorEvent({eventName:"RealizeError"},r)})),this.channelDeferred.promise}async factoryFromPackagePath(e){ye(this.pkg===e,318),e===void 0&&this.rejectDeferredRealize("packages is undefined");let t,r=this._containerRuntime.IFluidDataStoreRegistry,i;for(const o of e)r||this.rejectDeferredRealize("No registry for package",i),i=o,t=await r.get(o),t||this.rejectDeferredRealize("Registry does not contain entry for the package",o),r=t.IFluidDataStoreRegistry;const s=t==null?void 0:t.IFluidDataStoreFactory;return s===void 0&&this.rejectDeferredRealize("Can't find factory for package",i),{factory:s,registry:r}}async realizeCore(e){const t=await this.getInitialSnapshotDetails();this._baseSnapshot=t.snapshot;const r=t.pkg,{factory:i,registry:s}=await this.factoryFromPackagePath(r);ye(this.registry===void 0,319),this.registry=s;const o=await i.instantiateDataStore(this,e);ye(o!==void 0,320),this.bindRuntime(o)}setConnectionState(e,t){this.verifyNotClosed(),this.loaded&&(ye(this.connected===e,321),this.channel.setConnectionState(e,t))}process(e,t,r){var i;this.verifyNotClosed();const s=e.contents,o=Object.assign(Object.assign({},e),{type:s.type,contents:s.content});if(this.summarizerNode.recordChange(o),this.loaded)return(i=this.channel)===null||i===void 0?void 0:i.process(o,t,r);ye(!t,322),ye(this.pending!==void 0,573),this.pending.push(o),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length)}processSignal(e,t){var r;this.verifyNotClosed(),this.loaded&&((r=this.channel)===null||r===void 0||r.processSignal(e,t))}getQuorum(){return this._containerRuntime.getQuorum()}getAudience(){return this._containerRuntime.getAudience()}async summarize(e=!1,t=!0,r){return this.summarizerNode.summarize(e,t,r)}async summarizeInternal(e,t,r){await this.realize();const i=await this.channel.summarize(e,t,r);let s;this.disableIsolatedChannels||(Xm(i),s=[nt.channelsTreeName]);const{pkg:o}=await this.getInitialSnapshotDetails(),u=await this.isRoot(),d=Ux(o,u,this.disableIsolatedChannels);return Zi(i,vu,JSON.stringify(d)),this.writeGCDataAtRoot||Zi(i,nt.gcBlobKey,JSON.stringify(this.summarizerNode.getGCSummaryDetails())),this.summarizerNode.isReferenced()||(i.summary.unreferenced=!0,i.stats.unreferencedBlobSize=i.stats.totalBlobSize),Object.assign(Object.assign({},i),{id:this.id,pathPartsForChildren:s})}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return await this.realize(),ye(this.channel!==void 0,323),this.channel.getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes(e,t),this.lastUsedState={usedRoutes:e,gcTimestamp:t},this.loaded&&this.updateChannelUsedRoutes()}addedGCOutboundReference(e,t){this._containerRuntime.addedGCOutboundReference(e,t)}updateChannelUsedRoutes(){if(ye(this.loaded,324),ye(this.channel!==void 0,325),this.lastUsedState===void 0)return;const e=this.lastUsedState.usedRoutes.filter(t=>t!=="/"&&t!=="");this.channel.updateUsedRoutes(e,this.lastUsedState.gcTimestamp)}async request(e){return(await this.realize()).request(e)}submitMessage(e,t,r){this.verifyNotClosed(),ye(!!this.channel,326);const i={content:t,type:e};this._containerRuntime.submitDataStoreOp(this.id,i,r)}setChannelDirty(e){this.verifyNotClosed();const t=this.deltaManager.lastSequenceNumber;this.summarizerNode.invalidate(t);const r=this.summarizerNode.getChild(e);r&&r.invalidate(t)}submitSignal(e,t){return this.verifyNotClosed(),ye(!!this.channel,327),this._containerRuntime.submitDataStoreSignal(this.id,e,t)}makeLocallyVisible(){ye(this.channel!==void 0,719),this.makeLocallyVisibleFn()}bindRuntime(e){var t;if(this.channel)throw new Error("Runtime already bound");try{ye(!this.detachedRuntimeCreation,328),ye(this.channelDeferred!==void 0,329),ye(this.pkg!==void 0,330);const r=this.pending;for(const i of r)e.process(i,!1,void 0);this.thresholdOpsCounter.send("ProcessPendingOps",r.length),this.pending=void 0,this.loaded=!0,this.channel=e,Object.freeze(this.pkg),this.updateChannelUsedRoutes(),this.channelDeferred.resolve(this.channel)}catch(r){(t=this.channelDeferred)===null||t===void 0||t.reject(r),this.logger.sendErrorEvent({eventName:"BindRuntimeError",fluidDataStoreId:{value:this.id,tag:"PackageData"}},r)}}async getAbsoluteUrl(e){if(this.attachState===Qe.Attached)return this._containerRuntime.getAbsoluteUrl(e)}setInMemoryRoot(){this._isInMemoryRoot=!0}reSubmit(e,t){ye(!!this.channel,331);const r=e;this.channel.reSubmit(r.type,r.content,t)}rollback(e,t){if(!this.channel)throw new Error("Channel must exist when rolling back ops");if(!this.channel.rollback)throw new Error("Channel doesn't support rollback");const r=e;this.channel.rollback(r.type,r.content,t)}async applyStashedOp(e){this.channel||await this.realize(),ye(!!this.channel,332);const t=e;return this.channel.applyStashedOp(t.content)}verifyNotClosed(){if(this._disposed)throw new Error("Context is closed")}getCreateChildSummarizerNodeFn(e,t){return(r,i,s)=>this.summarizerNode.createChild(r,e,t,{throwOnFailure:!0},i,s)}async uploadBlob(e){return this.containerRuntime.uploadBlob(e)}}Xh.pendingOpsCountThreshold=1e3;class OP extends Xh{constructor(e){super(e,!0,Hr.Bound,!1,()=>{throw new Error("Already attached")}),this.initialSnapshotDetailsP=new Ml(async()=>{var t,r;let i,s=!0;if(typeof this.initSnapshotValue=="string"){const u=(await this.storage.getVersions(this.initSnapshotValue,1))[0];i=(t=await this.storage.getSnapshotTree(u))!==null&&t!==void 0?t:void 0}else i=this.initSnapshotValue;const o=async u=>En(this.storage,u);if(i){const u=await this.summarizerNode.loadBaseSummary(i,o);i=u.baseSummary,this.pending=u.outstandingOps.concat(this.pending)}if(i&&i.blobs[vu]!==void 0){const u=await o(i.blobs[vu]);let d;UF(u)<1?u.pkg.startsWith('["')&&u.pkg.endsWith('"]')?d=JSON.parse(u.pkg):d=[u.pkg]:d=JSON.parse(u.pkg),this.pkg=d,s=(r=u.isRootDataStore)!==null&&r!==void 0?r:!0,zF(u)&&(i=i.trees[nt.channelsTreeName],ye(i!==void 0,510))}return{pkg:this.pkg,isRootDataStore:s,snapshot:i}}),this.initSnapshotValue=e.snapshotTree,this.baseGCDetailsP=new Ml(async()=>{var t;return(t=await e.getBaseGCDetails())!==null&&t!==void 0?t:{}})}async getInitialSnapshotDetails(){return this.initialSnapshotDetailsP}async getInitialGCSummaryDetails(){return this.getBaseGCDetails()}async getBaseGCDetails(){return this.baseGCDetailsP}generateAttachMessage(){throw new Error("Cannot attach remote store")}}class $F extends Xh{constructor(e){super(e,e.snapshotTree!==void 0,e.snapshotTree?Hr.Bound:Hr.NotBound,!0,e.makeLocallyVisibleFn),this.snapshotTree=e.snapshotTree,e.isRootDataStore===!0&&this.setInMemoryRoot(),this.createProps=e.createProps,this.attachListeners()}attachListeners(){this.once("attaching",()=>{ye(this.attachState===Qe.Detached,333),this._attachState=Qe.Attaching}),this.once("attached",()=>{ye(this.attachState===Qe.Attaching,334),this._attachState=Qe.Attached})}generateAttachMessage(){ye(this.channel!==void 0,335),ye(this.pkg!==void 0,336);const e=this.channel.getAttachSummary();this.disableIsolatedChannels||Xm(e);const t=Ux(this.pkg,this.isInMemoryRoot(),this.disableIsolatedChannels);Zi(e,vu,JSON.stringify(t));const r=$g(e.summary);return{id:this.id,snapshot:r,type:this.pkg[this.pkg.length-1]}}async getInitialSnapshotDetails(){var e;let t=this.snapshotTree,r,i=!1;return t!==void 0&&(r=await _G(this.storage,t),zF(r)&&(t=t.trees[nt.channelsTreeName],ye(t!==void 0,511)),this.pkg===void 0&&(this.pkg=JSON.parse(r.pkg),(!((e=r.isRootDataStore)!==null&&e!==void 0)||e)&&(i=!0,this.setInMemoryRoot()))),ye(this.pkg!==void 0,338),{pkg:this.pkg,isRootDataStore:i,snapshot:t}}async getInitialGCSummaryDetails(){return{}}async getBaseGCDetails(){return{}}}class FP extends $F{constructor(e){super(e)}}class AG extends $F{constructor(e){super(e),this.detachedRuntimeCreation=!0}async attachRuntime(e,t){ye(this.detachedRuntimeCreation,340),ye(this.channelDeferred===void 0,341);const r=e.IFluidDataStoreFactory,i=await this.factoryFromPackagePath(this.pkg);ye(i.factory===r,342),ye(this.registry===void 0,343),this.registry=i.registry,this.detachedRuntimeCreation=!1,this.channelDeferred=new Cr,super.bindRuntime(t),await this.isRoot()&&(t.makeVisibleAndAttachGraph!==void 0?t.makeVisibleAndAttachGraph():t.bindToContext())}async getInitialSnapshotDetails(){if(this.detachedRuntimeCreation)throw new Error("Detached Fluid Data Store context can't be realized! Please attach runtime first!");return super.getInitialSnapshotDetails()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const HF=n=>typeof(n==null?void 0:n.internalId)=="string"&&typeof(n==null?void 0:n.alias)=="string",tS=(n,e,t,r,i)=>new kG(n,e,t,r,i);var ys;(function(n){n.Aliased="Aliased",n.Aliasing="Aliasing",n.None="None"})(ys||(ys={}));class kG{constructor(e,t,r,i,s){this.fluidDataStoreChannel=e,this.internalId=t,this.runtime=r,this.datastores=i,this.logger=s,this.aliasState=ys.None}async trySetAlias(e){if(e.includes("/"))throw new Ct(`The alias cannot contain slashes: '${e}'`);switch(this.aliasState){case ys.Aliasing:return ye(this.aliasResult!==void 0,790),await this.aliasResult,this.alias===e?"Success":"AlreadyAliased";case ys.Aliased:return this.alias===e?"Success":"AlreadyAliased";case ys.None:break;default:Gb(this.aliasState)}return this.aliasState=ys.Aliasing,this.aliasResult=this.trySetAliasInternal(e),this.aliasResult}async trySetAliasInternal(e){const t={internalId:this.internalId,alias:e};if(this.fluidDataStoreChannel.makeVisibleAndAttachGraph!==void 0?this.fluidDataStoreChannel.makeVisibleAndAttachGraph():this.fluidDataStoreChannel.bindToContext(),this.runtime.attachState===Qe.Detached){const i=this.datastores.processAliasMessageCore(t);return this.aliasState=ys.Aliased,i?"Success":"Conflict"}return await this.ackBasedPromise(i=>{this.runtime.submitDataStoreAliasOp(t,i)}).then(i=>(this.aliasState=ys.Aliased,i&&(this.alias=e),i)).catch(i=>(this.logger.sendErrorEvent({eventName:"AliasingException",alias:{value:e,tag:Ot.UserData},internalId:{value:this.internalId,tag:Ot.PackageData}},i),this.aliasState=ys.None,!1))?"Success":"Conflict"}async request(e){return this.fluidDataStoreChannel.request(e)}get IFluidRouter(){return this.fluidDataStoreChannel}async ackBasedPromise(e){let t;return new Promise((r,i)=>{if(t=()=>i(new Error("ContainerRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed){t();return}this.runtime.on("dispose",t),e(r,i)}).finally(()=>{this.runtime.off("dispose",t)})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class OG{constructor(e,t,r,i,s,o,u,d,f,m,g=new cG(o)){this.baseSnapshot=e,this.runtime=t,this.submitAttachFn=r,this.getCreateChildSummarizerNodeFn=i,this.deleteChildSummarizerNodeFn=s,this.gcNodeUpdated=d,this.aliasMap=f,this.writeGCDataAtRoot=m,this.contexts=g,this.pendingAttach=new Map,this.attachOpFiredForDataStore=new Set,this.disposeOnce=new Nx(()=>this.contexts.dispose()),this.dataStoresSinceLastGC=[],this.dispose=()=>this.disposeOnce.value,this.logger=at.create(o),this.containerRuntimeHandle=new jl(this.runtime,"/",this.runtime.IFluidHandleContext);const P=new Ml(async()=>u()),D=async j=>(await P).get(j),M=new Map;if(e)for(const[j,E]of Object.entries(e.trees))M.set(j,E);let U=0;for(const[j,E]of M){let k;if(E.unreferenced&&U++,this.runtime.attachState!==Qe.Detached)k=new OP({id:j,snapshotTree:E,getBaseGCDetails:async()=>D(j),runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(j,{type:nt.CreateSummarizerNodeSource.FromSummary}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});else{if(typeof E!="object")throw new st("Snapshot should be there to load from!!");const z=E;k=new FP({id:j,pkg:void 0,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(j,{type:nt.CreateSummarizerNodeSource.FromSummary}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(j),snapshotTree:z,isRootDataStore:void 0,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels})}this.contexts.addBoundOrRemoted(k)}this.containerLoadStats={containerLoadDataStoreCount:M.size,referencedDataStoreCount:M.size-U}}aliases(){return this.aliasMap}processAttachMessage(e,t){var r,i;const s=e.contents;if(this.dataStoresSinceLastGC.push(s.id),t){ye(this.pendingAttach.has(s.id),350),(r=this.contexts.get(s.id))===null||r===void 0||r.emit("attached"),this.pendingAttach.delete(s.id);return}if(this.alreadyProcessed(s.id))throw new Rs("Duplicate DataStore created with existing id",Object.assign(Object.assign({},mu(e)),{dataStoreId:{value:s.id,tag:Ot.PackageData}}));const o=new Map;let u;s.snapshot&&(u=$O(s.snapshot.entries,o));const d=[s.type],f=new OP({id:s.id,snapshotTree:u,getBaseGCDetails:async()=>({}),runtime:this.runtime,storage:new Kz(this.runtime.storage,o),scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(s.id,{type:nt.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:(i=s.snapshot)!==null&&i!==void 0?i:{entries:[IG(d,!0,this.runtime.disableIsolatedChannels)]}}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,pkg:d});this.contexts.addBoundOrRemoted(f)}processAliasMessage(e,t,r){const i=e.contents;if(!HF(i))throw new Rs("malformedDataStoreAliasMessage",Object.assign({},mu(e)));const s=t,o=this.processAliasMessageCore(i);r&&s(o)}processAliasMessageCore(e){if(this.alreadyProcessed(e.alias))return!1;const t=this.contexts.get(e.internalId);if(t===void 0)return this.logger.sendErrorEvent({eventName:"AliasFluidDataStoreNotFound",fluidDataStoreId:e.internalId}),!1;const r=new jl(t,e.internalId,this.runtime.IFluidHandleContext);return this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,r),this.aliasMap.set(e.alias,t.id),t.setInMemoryRoot(),!0}alreadyProcessed(e){return this.aliasMap.get(e)!==void 0||this.contexts.get(e)!==void 0}makeDataStoreLocallyVisible(e){const t=this.contexts.getUnbound(e);if(ye(!!t,351),this.runtime.attachState!==Qe.Detached){t.emit("attaching");const r=t.generateAttachMessage();this.pendingAttach.set(e,r),this.submitAttachFn(r),this.attachOpFiredForDataStore.add(e)}this.contexts.bind(e)}createDetachedDataStoreCore(e,t,r=ul()){ye(!r.includes("/"),780);const i=new AG({id:r,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(r,{type:nt.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(r),snapshotTree:void 0,isRootDataStore:t,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});return this.contexts.addUnbound(i),i}_createFluidDataStoreContext(e,t,r,i){ye(!t.includes("/"),781);const s=new FP({id:t,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(t,{type:nt.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(t),snapshotTree:void 0,isRootDataStore:r,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,createProps:i});return this.contexts.addUnbound(s),s}get disposed(){return this.disposeOnce.evaluated}resubmitDataStoreOp(e,t){const r=e,i=this.contexts.get(r.address);ye(!!i,352),i.reSubmit(r.contents,t)}rollbackDataStoreOp(e,t){const r=e,i=this.contexts.get(r.address);ye(!!i,744),i.rollback(r.contents,t)}async applyStashedOp(e){const t=e,r=this.contexts.get(t.address);return ye(!!r,353),r.applyStashedOp(t.contents)}async applyStashedAttachOp(e){this.pendingAttach.set(e.id,e),this.processAttachMessage({contents:e},!1)}processFluidDataStoreOp(e,t,r){const i=e.contents,s=Object.assign(Object.assign({},e),{contents:i.contents}),o=this.contexts.get(i.address);ye(!!o,354),o.process(s,t,r),this.gcNodeUpdated(`/${i.address}`,e.timestamp,o.isLoaded?o.packagePath:void 0)}async getDataStore(e,t){const r=await this.contexts.getBoundOrRemoted(e,t);if(r===void 0)throw Jh(si({url:e}));return r}processSignal(e,t,r){const i=this.contexts.get(e);if(!i){ye(!r,355),this.logger.sendTelemetryEvent({eventName:"SignalFluidDataStoreNotFound",fluidDataStoreId:{value:e,tag:Ot.PackageData}});return}i.processSignal(t,r)}setConnectionState(e,t){for(const[r,i]of this.contexts)try{i.setConnectionState(e,t)}catch(s){this.logger.sendErrorEvent({eventName:"SetConnectionStateError",clientId:t,fluidDataStore:r},s)}}setAttachState(e){let t;e===Qe.Attaching?t="attaching":t="attached";for(const[,r]of this.contexts)this.contexts.isNotBound(r.id)||r.emit(t)}get size(){return this.contexts.size}async summarize(e,t,r){const i=new Tr;return await Promise.all(Array.from(this.contexts).filter(([s,o])=>(ye(o.attachState!==Qe.Attaching,357),o.attachState===Qe.Attached)).map(async([s,o])=>{const u=await o.summarize(e,t,r);i.addWithStats(s,u)})),i.getSummaryTree()}createSummary(e){const t=new Tr;let r;do{const i=t.summary.tree;r=this.contexts.notBoundLength(),Array.from(this.contexts).filter(([s,o])=>!(this.contexts.isNotBound(s)||i[s]||this.attachOpFiredForDataStore.has(s))).map(([s,o])=>{let u;if(o.isLoaded){const d=o.generateAttachMessage().snapshot;u=Ug(d,!0)}else ye(!!this.baseSnapshot,358),u=zg(this.baseSnapshot.trees[s]);t.addWithStats(s,u)})}while(r!==this.contexts.notBoundLength());return t.getSummaryTree()}async updateStateBeforeGC(){for(const e of this.dataStoresSinceLastGC){const t=this.contexts.get(e);if(ye(t!==void 0,694),await t.isRoot()){const r=new jl(t,e,this.runtime.IFluidHandleContext);this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,r)}}this.dataStoresSinceLastGC=[]}async getGCData(e=!1){const t=new Ox;return await Promise.all(Array.from(this.contexts).filter(([r,i])=>i.attachState===Qe.Attached).map(async([r,i])=>{const s=await i.getGCData(e);t.prefixAndAddNodes(r,s.gcNodes)})),t.addNode("/",await this.getOutboundRoutes()),t.getGCData()}updateUsedRoutes(e,t){var r;const i=AF(e);for(const[s]of i)ye(this.contexts.has(s),359);for(const[s,o]of this.contexts)o.updateUsedRoutes((r=i.get(s))!==null&&r!==void 0?r:[],t)}deleteUnusedRoutes(e){for(const t of e){const r=t.split("/");if(r.length>2)continue;const i=r[1];ye(this.contexts.has(i),727),this.contexts.delete(i),this.deleteChildSummarizerNodeFn(i)}}async getOutboundRoutes(){const e=[];for(const[t,r]of this.contexts)await r.isRoot()&&e.push(`/${t}`);return e}async getDataStorePackagePath(e){var t;const r=this.contexts.get(e.split("/")[1]);return(t=await(r==null?void 0:r.getInitialSnapshotDetails()))===null||t===void 0?void 0:t.pkg}getGCNodeType(e){const t=e.split("/");if(this.contexts.has(t[1]))return t.length===2?kr.DataStore:kr.SubDataStore}}function VF(n,e){if(n)if(TG(e)){const t=n.trees[nt.channelsTreeName];return ye(!!t,360),t}else{const t={};for(const[r,i]of Object.entries(n.trees))RG.includes(r)||(t[r]=i);return Object.assign(Object.assign({},n),{trees:t})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Qs;(function(n){n[n.Local=0]="Local",n[n.Broadcast=1]="Broadcast",n[n.Acked=2]="Acked",n[n.Nacked=-1]="Nacked"})(Qs||(Qs={}));class _h{constructor(e,t){this.clientId=e,this.clientSequenceNumber=t,this.state=Qs.Local,this.defSummaryOp=new Cr,this.defSummaryAck=new Cr}static createLocal(e,t){return new _h(e,t)}static createFromOp(e){const t=new _h(e.clientId,e.clientSequenceNumber);return t.broadcast(e),t}get summaryOp(){return this._summaryOp}get summaryAckNack(){return this._summaryAckNack}hasBeenAcked(){return this.state===Qs.Acked}broadcast(e){return ye(this.state===Qs.Local,373),this._summaryOp=e,this.defSummaryOp.resolve(),this.state=Qs.Broadcast,!0}ackNack(e){return ye(this.state===Qs.Broadcast,374),this._summaryAckNack=e,this.defSummaryAck.resolve(),this.state=e.type===an.SummaryAck?Qs.Acked:Qs.Nacked,!0}async waitBroadcast(){return await this.defSummaryOp.promise,this._summaryOp}async waitAckNack(){return await this.defSummaryAck.promise,this._summaryAckNack}}class FG{constructor(e,t){this.clientId=e,this.summaryCollection=t,this.localSummaries=new Map,this._disposed=!1}get disposed(){return this._disposed}watchSummary(e){let t=this.localSummaries.get(e);return t||(t=_h.createLocal(this.clientId,e),this.localSummaries.set(t.clientSequenceNumber,t)),t}waitFlushed(){return this.summaryCollection.waitFlushed()}tryGetSummary(e){return this.localSummaries.get(e)}setSummary(e){this.localSummaries.set(e.clientSequenceNumber,e)}dispose(){this.summaryCollection.removeWatcher(this.clientId),this._disposed=!0}}class NG extends Sc{constructor(e,t){super(),this.deltaManager=e,this.logger=t,this.summaryWatchers=new Map,this.pendingSummaries=new Map,this.refreshWaitNextAck=new Cr,this.deltaManager.on("op",r=>this.handleOp(r))}get latestAck(){return this.lastAck}emit(e,...t){return super.emit(e,...t)}get opsSinceLastAck(){var e,t;return this.deltaManager.lastSequenceNumber-((t=(e=this.lastAck)===null||e===void 0?void 0:e.summaryAck.sequenceNumber)!==null&&t!==void 0?t:this.deltaManager.initialSequenceNumber)}addOpListener(e){this.deltaManager.on("op",e)}removeOpListener(e){this.deltaManager.off("op",e)}createWatcher(e){const t=new FG(e,this);return this.summaryWatchers.set(e,t),t}removeWatcher(e){this.summaryWatchers.delete(e)}setPendingAckTimerTimeoutCallback(e,t){this.maxAckWaitTime=e,this.pendingAckTimerTimeoutCallback=t}unsetPendingAckTimerTimeoutCallback(){this.maxAckWaitTime=void 0,this.pendingAckTimerTimeoutCallback=void 0}async waitFlushed(){for(;this.pendingSummaries.size>0;){const e=Array.from(this.pendingSummaries,([,t])=>t.waitAckNack());await Promise.all(e)}return this.lastAck}async waitSummaryAck(e){for(;!this.lastAck||this.lastAck.summaryOp.referenceSequenceNumber<e;)await this.refreshWaitNextAck.promise;return this.lastAck}handleOp(e){var t;switch(e.type){case an.Summarize:{this.handleSummaryOp(e);return}case an.SummaryAck:{this.handleSummaryAck(e);return}case an.SummaryNack:{this.handleSummaryNack(e);return}default:{const r=e.timestamp;this.lastSummaryTimestamp!==void 0&&this.maxAckWaitTime!==void 0&&r-this.lastSummaryTimestamp>=this.maxAckWaitTime&&((t=this.pendingAckTimerTimeoutCallback)===null||t===void 0||t.call(this)),this.emit("default",e);return}}}handleSummaryOp(e){let t;const r=this.summaryWatchers.get(e.clientId);r&&(t=r.tryGetSummary(e.clientSequenceNumber),t&&t.broadcast(e)),t||(t=_h.createFromOp(e),r&&r.setSummary(t)),this.pendingSummaries.set(e.sequenceNumber,t),this.lastSummaryTimestamp=e.timestamp,this.emit(an.Summarize,e)}handleSummaryAck(e){const t=e.contents.summaryProposal.summarySequenceNumber,r=this.pendingSummaries.get(t);if(!r||r.summaryOp===void 0){t>=this.deltaManager.initialSequenceNumber&&this.logger.sendErrorEvent({eventName:"SummaryAckWithoutOp",sequenceNumber:e.sequenceNumber,summarySequenceNumber:t,initialSequenceNumber:this.deltaManager.initialSequenceNumber});return}r.ackNack(e),this.pendingSummaries.delete(t),(!this.lastAck||t>this.lastAck.summaryAck.contents.summaryProposal.summarySequenceNumber)&&(this.lastAck={summaryOp:r.summaryOp,summaryAck:e},this.refreshWaitNextAck.resolve(),this.refreshWaitNextAck=new Cr,this.emit(an.SummaryAck,e))}handleSummaryNack(e){const t=e.contents.summaryProposal.summarySequenceNumber,r=this.pendingSummaries.get(t);r&&(r.ackNack(e),this.pendingSummaries.delete(t),this.emit(an.SummaryNack,e))}}class DG extends Sc{constructor(e,t,r){super(),this.clientMap=new Map,this.rootNode={sequenceNumber:-1,olderClient:void 0,youngerClient:void 0},this._youngestClient=this.rootNode,this.logger=at.create(e,"OrderedClientCollection");const i=r.getMembers();for(const[s,o]of i)this.addClient(s,o);r.on("addMember",(s,o)=>{const u=this.addClient(s,o);this.emit("addClient",u,t.lastSequenceNumber)}),r.on("removeMember",s=>{const o=t.lastSequenceNumber,u=this.removeClient(s);u===void 0?this.logger.sendErrorEvent({eventName:"ClientNotFound",clientId:s,sequenceNumber:o}):this.emit("removeClient",u,o)})}get count(){return this.clientMap.size}get oldestClient(){return this.rootNode.youngerClient}addClient(e,t){ye(t.sequenceNumber>-1,502);let r=this._youngestClient;for(;r.sequenceNumber>t.sequenceNumber;)ye(r.olderClient!==void 0,503),r=r.olderClient;const i={clientId:e,sequenceNumber:t.sequenceNumber,client:Object.assign({},t.client),olderClient:r,youngerClient:r.youngerClient};return i.olderClient.youngerClient=i,i.youngerClient===void 0?this._youngestClient=i:i.youngerClient.olderClient=i,this.clientMap.set(e,i),i}removeClient(e){const t=this.clientMap.get(e);if(t!==void 0)return t.olderClient.youngerClient=t.youngerClient,t.youngerClient===void 0?this._youngestClient=t.olderClient:t.youngerClient.olderClient=t.olderClient,this.clientMap.delete(e),t}getAllClients(){const e=[];let t=this.rootNode;for(;t.youngerClient!==void 0;)e.push(t.youngerClient),t=t.youngerClient;return e}}class LG extends Sc{constructor(e,t,r,i){super(),this.orderedClientCollection=t,this.isEligibleFn=i,this._eligibleCount=0;let s,o;for(const u of t.getAllClients())this.addClient(u,0),typeof r!="number"&&(u.clientId===r.electedClientId&&(s=u,r.electedParentId===void 0&&u.client.details.type!==Ur&&(o=u)),u.clientId===r.electedParentId&&(o=u));t.on("addClient",(u,d)=>this.addClient(u,d)),t.on("removeClient",(u,d)=>this.removeClient(u,d)),typeof r=="number"?this._electionSequenceNumber=r:((s==null?void 0:s.clientId)!==r.electedClientId?e.sendErrorEvent({eventName:"InitialElectedClientNotFound",electionSequenceNumber:r.electionSequenceNumber,expectedClientId:r.electedClientId,electedClientId:s==null?void 0:s.clientId,clientCount:t.count}):s!==void 0&&!i(s)&&(s=o=this.findFirstEligibleParent(o),e.sendErrorEvent({eventName:"InitialElectedClientIneligible",electionSequenceNumber:r.electionSequenceNumber,expectedClientId:r.electedClientId,electedClientId:s==null?void 0:s.clientId})),this._electedParent=o,this._electedClient=s,this._electionSequenceNumber=r.electionSequenceNumber)}get eligibleCount(){return this._eligibleCount}get electionSequenceNumber(){return this._electionSequenceNumber}get electedClient(){return this._electedClient}get electedParent(){return this._electedParent}tryElectingClient(e,t){let r=!1;const i=(e==null?void 0:e.client.details.type)===Ur,s=this._electedClient;this._electedClient!==e&&(this._electionSequenceNumber=t,this._electedClient=e,r=!0),this._electedParent!==e&&!i&&(this._electedParent=e,r=!0),r&&this.emit("election",e,t,s)}tryElectingParent(e,t){this._electedParent!==e&&(this._electedParent=e,this.emit("election",this._electedClient,t,this._electedClient))}findFirstEligibleParent(e){let t=e;for(;t!==void 0&&(!this.isEligibleFn(t)||t.client.details.type===Ur);)t=t.youngerClient;return t}addClient(e,t){var r;if(this.isEligibleFn(e)){this._eligibleCount++;const i=e.client.details.type===Ur,s=((r=this._electedClient)===null||r===void 0?void 0:r.client.details.type)===Ur;this._electedClient===void 0||!s&&i?this.tryElectingClient(e,t):this._electedParent===void 0&&!i&&this.tryElectingParent(e,t)}}removeClient(e,t){var r,i,s,o,u;if(this.isEligibleFn(e)){if(this._eligibleCount--,this._electedClient===e)if(this._electedParent!==e){if(this._electedClient.client.details.type!==Ur)throw new Ct("Elected client should be a summarizer client 1");this.tryElectingClient(this._electedParent,t)}else{const d=(i=this.findFirstEligibleParent((r=this._electedParent)===null||r===void 0?void 0:r.youngerClient))!==null&&i!==void 0?i:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingClient(d,t)}else if(this._electedParent===e){if(((s=this._electedClient)===null||s===void 0?void 0:s.client.details.type)!==Ur)throw new Ct("Elected client should be a summarizer client 2");const d=(u=this.findFirstEligibleParent((o=this._electedParent)===null||o===void 0?void 0:o.youngerClient))!==null&&u!==void 0?u:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingParent(d,t)}}}getAllEligibleClients(){return this.orderedClientCollection.getAllClients().filter(this.isEligibleFn)}incrementElectedClient(e){var t,r;const i=(r=this.findFirstEligibleParent((t=this._electedParent)===null||t===void 0?void 0:t.youngerClient))!==null&&r!==void 0?r:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this._electedClient===void 0||this._electedClient===this._electedParent?this.tryElectingClient(i,e):this.tryElectingParent(i,e)}resetElectedClient(e){const t=this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this._electedClient===void 0||this._electedClient===this._electedParent?this.tryElectingClient(t,e):this.tryElectingParent(t,e)}peekNextElectedClient(){var e,t;return(t=this.findFirstEligibleParent((e=this._electedParent)===null||e===void 0?void 0:e.youngerClient))!==null&&t!==void 0?t:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient)}serialize(){var e,t;return{electionSequenceNumber:this.electionSequenceNumber,electedClientId:(e=this.electedClient)===null||e===void 0?void 0:e.clientId,electedParentId:(t=this.electedParent)===null||t===void 0?void 0:t.clientId}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class MG{constructor(e,t,r){this.delayWindowMs=e,this.maxDelayMs=t,this.delayFn=r,this.startTimes=[]}get numAttempts(){return this.startTimes.length}getAttempts(){return[...this.startTimes]}get latestAttemptTime(){return this.startTimes.length>0?this.startTimes[this.startTimes.length-1]:void 0}getDelay(){const e=Date.now(),t=this.latestAttemptTime;if(t!==void 0){const i=t-e;i>0&&(this.startTimes=this.startTimes.map(s=>s-i))}this.startTimes=this.startTimes.filter(i=>e-i<this.delayWindowMs);const r=Math.min(this.delayFn(this.startTimes.length),this.maxDelayMs);return this.startTimes.push(e),this.startTimes=this.startTimes.map(i=>i+r),r===this.maxDelayMs&&this.startTimes.shift(),r}}const BG=({multiplier:n=2,coefficient:e=1,offset:t=0,initialDelay:r=void 0}={})=>i=>Math.max(0,i<=0&&r!==void 0?r:e*Math.pow(n,i)+t);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */new Promise(()=>{});class zx{constructor(e){this.runtime=e,this._cancelled=!1,this.stopDeferred=new Cr}get cancelled(){return this._cancelled||ye(this.runtime.deltaManager.active,605),this._cancelled}get waitCancelled(){return this.stopDeferred.promise}static async create(e){const t=new zx(e);return await t.waitStart(),t}async waitStart(){if(this.runtime.disposed){this.stop("summarizerClientDisconnected");return}if(this.runtime.once("dispose",()=>this.stop("summarizerClientDisconnected")),!this.runtime.connected){const e=new Promise(t=>this.runtime.once("connected",t));await Promise.race([e,this.waitCancelled])}this.runtime.once("disconnected",()=>this.stop("summarizerClientDisconnected"))}stop(e){this._cancelled||(this._cancelled=!0,this.stopDeferred.resolve(e))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class jG{constructor(e,t,r,i,s=()=>oi.now()){this.batchEventEmitter=e,this.trackedBatchCount=0,this.logger=at.create(t,"Batching"),this.batchEventEmitter.on("batchBegin",o=>{this.startBatchSequenceNumber=o.sequenceNumber,this.batchProcessingStartTimeStamp=s(),this.trackedBatchCount++}),this.batchEventEmitter.on("batchEnd",(o,u)=>{ye(this.startBatchSequenceNumber!==void 0&&this.batchProcessingStartTimeStamp!==void 0,698);const d=u.sequenceNumber-this.startBatchSequenceNumber+1;d>=r&&this.logger.sendErrorEvent({eventName:"LengthTooBig",length:d,threshold:r,batchEndSequenceNumber:u.sequenceNumber,duration:s()-this.batchProcessingStartTimeStamp,batchError:o!==void 0}),this.trackedBatchCount%i===0&&this.logger.sendPerformanceEvent({eventName:"Length",length:d,samplingRate:i,batchEndSequenceNumber:u.sequenceNumber,duration:s()-this.batchProcessingStartTimeStamp}),this.startBatchSequenceNumber=void 0,this.batchProcessingStartTimeStamp=void 0})}}const qG=(n,e,t=1e3,r=1e3)=>new jG(n,e,t,r);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class nS{constructor(e,t){this.storageGetter=e,this.blobs=t}static async serializeTree(e,t){const r={};return await this.serializeTreeCore(e,r,t),r}static async serializeTreeCore(e,t,r){const i=[];for(const s of Object.values(e.trees))i.push(this.serializeTreeCore(s,t,r));for(const s of Object.values(e.blobs)){const o=await r.readBlob(s);t[s]=yP(o,"utf8")}return Promise.all(i)}static serializeTreeWithBlobContents(e){const t={};return this.serializeTreeWithBlobContentsCore(e,t),t}static serializeTreeWithBlobContentsCore(e,t){for(const r of Object.values(e.trees))this.serializeTreeWithBlobContentsCore(r,t);for(const r of Object.values(e.blobs)){const i=e.blobsContents[r];ye(!!i,748),t[r]=yP(i,"utf8")}}get storage(){return this._storage?this._storage:(this._storage=this.storageGetter(),this._storage)}get repositoryUrl(){return this.storage.repositoryUrl}async readBlob(e){return this.blobs[e]!==void 0?AW(this.blobs[e],"utf8"):this.storage.readBlob(e)}async getSnapshotTree(e){return this.storage.getSnapshotTree(e)}async getVersions(e,t){return this.storage.getVersions(e,t)}async createBlob(e){return this.storage.createBlob(e)}async uploadSummaryWithContext(e,t){return this.storage.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storage.downloadSummary(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Zd{constructor(e,t){this.messageSize=new Map,this._nonSystemOpCount=0,this._opsSizeAccumulator=0,!t&&(e.inbound.on("push",r=>{var i;const s=typeof r.contents=="string"?r.contents:(i=JSON.stringify(r.contents))!==null&&i!==void 0?i:"",o=Zd.messageHasData(r)?r.data:"";this.messageSize[Zd.messageId(r)]=s.length+o.length}),e.on("op",r=>{var i;this._nonSystemOpCount+=wh(r)?1:0;const s=Zd.messageId(r);this._opsSizeAccumulator+=(i=this.messageSize[s])!==null&&i!==void 0?i:0,this.messageSize.delete(s)}))}get nonSystemOpCount(){return this._nonSystemOpCount}get opsSizeAccumulator(){return this._opsSizeAccumulator}static messageId(e){return e.sequenceNumber}static messageHasData(e){return e.data!==void 0}reset(){this._nonSystemOpCount=0,this._opsSizeAccumulator=0}}var Rt;(function(n){n.FluidDataStoreOp="component",n.Attach="attach",n.ChunkedOp="chunkedOp",n.BlobAttach="blobAttach",n.Rejoin="rejoin",n.Alias="alias"})(Rt||(Rt={}));const UG={state:"enabled",idleTime:5e3*3,maxTime:5e3*12,maxOps:100,minOpsForLastSummaryAttempt:10,maxAckWaitTime:6*10*1e3,maxOpsSinceLastSummary:7e3,initialSummarizerDelayMs:5e3,summarizerClientElection:!1};var Yo;(function(n){n.wait="wait",n.externalRequest="externalRequest",n.viaHandle="viaHandle"})(Yo||(Yo={}));const zG="Fluid.ContainerRuntime.UseDataStoreAliasing",$G="Fluid.ContainerRuntime.MaxConsecutiveReconnects",HG="Fluid.ContainerRuntime.MaxOpSizeInBytes",VG=768e3,WG="Fluid.ContainerRuntime.DisableOpTracking",GG=nt.FlushMode.TurnBased;var NP;(function(n){n.FluidDataStoreOp="component",n.Attach="attach",n.ChunkedOp="chunkedOp",n.BlobAttach="blobAttach",n.Rejoin="rejoin",n.Alias="alias",n.Operation="op"})(NP||(NP={}));function KG(n){if(n.type===an.Operation){if(n.contents.address!==void 0&&n.contents.type===void 0)n.type=Rt.FluidDataStoreOp;else{const e=n.contents;ye(e.type!==void 0,289),n.type=e.type,n.contents=e.contents}ye(Ch(n),290)}return n}class JG{constructor(e,t){this.deltaManager=e,this.logger=t,this.localPaused=!1,this.timePaused=0,this.batchCount=0,this.deltaManager.on("prepareSend",i=>{if(i.length===0)return;const s=i[0].metadata;if(!(s!=null&&s.batch))return;if(i.length===1){delete s.batch;return}const o=i[i.length-1];o.metadata=Object.assign(Object.assign({},o.metadata),{batch:!1})}),this.deltaManager.inbound.on("push",i=>{this.trackPending(i)}),ye(!this.localPaused,659);const r=this.deltaManager.inbound.toArray();for(const i of r)this.trackPending(i);this.deltaManager.on("op",i=>this.afterOpProcessing(i.sequenceNumber))}afterOpProcessing(e){if(ye(!this.localPaused,660),this.deltaManager.inbound.length===0){ye(this.pauseSequenceNumber===void 0,661);return}this.pauseSequenceNumber!==void 0&&(ye(e<this.pauseSequenceNumber,662),e+1===this.pauseSequenceNumber&&this.pauseQueue())}pauseQueue(){ye(!this.localPaused,663),this.localPaused=!0,this.timePaused=oi.now(),this.deltaManager.inbound.pause()}resumeQueue(e,t){const r=t.sequenceNumber,i=this.localPaused?oi.now()-this.timePaused:void 0;this.batchCount++,this.batchCount%1e3===1&&this.logger.sendTelemetryEvent({eventName:"BatchStats",sequenceNumber:r,length:r-e+1,msnDistance:r-t.minimumSequenceNumber,duration:i,batchCount:this.batchCount,interrupted:this.localPaused}),this.localPaused&&(this.localPaused=!1,i!==void 0&&i>BF&&this.logger.sendErrorEvent({eventName:"MaxBatchWaitTimeExceeded",duration:i,sequenceNumber:r,length:r-e}),this.deltaManager.inbound.resume())}trackPending(e){ye(this.deltaManager.inbound.length!==0,664),ye(this.currentBatchClientId===void 0==(this.pauseSequenceNumber===void 0),665);const t=e.metadata,r=t==null?void 0:t.batch;if(!Ch(e)){ye(this.currentBatchClientId===void 0,666),ye(r===void 0,667),ye(!this.localPaused,668);return}if(this.currentBatchClientId===void 0&&r===void 0){ye(!this.localPaused,669);return}if((this.currentBatchClientId!==void 0||r===!1)&&this.currentBatchClientId!==e.clientId)throw new Rs("OpBatchIncomplete",Object.assign({runtimeVersion:tm,batchClientId:this.currentBatchClientId},mu(e)));r?(ye(this.currentBatchClientId===void 0,670),ye(!this.localPaused,671),this.pauseSequenceNumber=e.sequenceNumber,this.currentBatchClientId=e.clientId,this.deltaManager.inbound.length===1&&this.pauseQueue()):r===!1?(ye(this.pauseSequenceNumber!==void 0,672),this.resumeQueue(this.pauseSequenceNumber,e),this.pauseSequenceNumber=void 0,this.currentBatchClientId=void 0):ye(this.currentBatchClientId!==void 0,673)}}class QG{constructor(e,t,r){this.deltaManager=e,this.emitter=t,this.logger=r,this.hitError=!1,this.deltaScheduler=new Rh(this.deltaManager,at.create(this.logger,"DeltaScheduler")),new JG(e,r)}beforeOpProcessing(e){var t;this.batchClientId!==e.clientId&&(ye(this.batchClientId===void 0,674),this.emitter.emit("batchBegin",e),this.deltaScheduler.batchBegin(e),((t=e==null?void 0:e.metadata)===null||t===void 0?void 0:t.batch)?this.batchClientId=e.clientId:this.batchClientId=void 0)}afterOpProcessing(e,t){var r;if(ye(!this.hitError,675),e){this.hitError=!0,this.batchClientId=void 0,this.emitter.emit("batchEnd",e,t),this.deltaScheduler.batchEnd(t);return}const i=(r=t==null?void 0:t.metadata)===null||r===void 0?void 0:r.batch;if(this.batchClientId===void 0||i===!1){this.batchClientId=void 0,this.emitter.emit("batchEnd",void 0,t),this.deltaScheduler.batchEnd(t);return}}}const DP="_scheduler";function XG(){try{if(typeof navigator=="object"&&navigator!==null)return{deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency}}catch{}return{}}class $x extends Sc{constructor(e,t,r,i,s,o,u,d,f,m,g,P,D,M){var U,j,E,k,z,K,ie,he,pe;M===void 0&&(M=Object.assign(Object.assign({},UG),(U=u.summaryOptions)===null||U===void 0?void 0:U.summaryConfigOverrides)),super(),this.context=e,this.registry=t,this.runtimeOptions=u,this.containerScope=d,this.logger=f,this._storage=P,this.requestHandler=D,this.summaryConfiguration=M,this.defaultMaxConsecutiveReconnects=15,this._orderSequentiallyCalls=0,this.needsFlush=!1,this.flushTrigger=!1,this.savedOps=[],this.consecutiveReconnects=0,this._disposed=!1,this.emitDirtyDocumentEvent=!0,this.defaultTelemetrySignalSampleCount=100,this._perfSignalData={signalsLost:0,signalSequenceNumber:0,signalTimestamp:0,trackingSignalSequenceNumber:void 0},this.summarizeOnDemand=(...be)=>{if(this.clientDetails.type===Ur)return this.summarizer.summarizeOnDemand(...be);if(this.summaryManager!==void 0)return this.summaryManager.summarizeOnDemand(...be);throw new Ct(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.enqueueSummarize=(...be)=>{if(this.clientDetails.type===Ur)return this.summarizer.enqueueSummarize(...be);if(this.summaryManager!==void 0)return this.summaryManager.enqueueSummarize(...be);throw new Ct(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.messageAtLastSummary=r==null?void 0:r.message,this.disableIsolatedChannels=(j=this.runtimeOptions.summaryOptions.disableIsolatedChannels)!==null&&j!==void 0?j:!1,this._connected=this.context.connected,this.chunkMap=new Map(s),this.handleContext=new BW("",this),this.mc=Iu(at.create(this.logger,"ContainerRuntime")),this.summariesDisabled=this.isSummariesDisabled(),this.heuristicsDisabled=this.isHeuristicsDisabled(),this.summarizerClientElectionEnabled=this.isSummarizerClientElectionEnabled(),this.maxOpsSinceLastSummary=this.getMaxOpsSinceLastSummary(),this.initialSummarizerDelayMs=this.getInitialSummarizerDelayMs(),this._aliasingEnabled=((E=this.mc.config.getBoolean(zG))!==null&&E!==void 0?E:!1)||((k=u.useDataStoreAliasing)!==null&&k!==void 0?k:!1),this._maxOpSizeInBytes=(z=this.mc.config.getNumber(HG))!==null&&z!==void 0?z:VG,this.maxConsecutiveReconnects=(K=this.mc.config.getNumber($G))!==null&&K!==void 0?K:this.defaultMaxConsecutiveReconnects,this._flushMode=u.flushMode;const X=e.pendingLocalState,fe=(ie=X==null?void 0:X.baseSnapshot)!==null&&ie!==void 0?ie:e.baseSnapshot;this.garbageCollector=xG.create({runtime:this,gcOptions:this.runtimeOptions.gcOptions,baseSnapshot:fe,baseLogger:this.mc.logger,existing:m,metadata:r,isSummarizerClient:this.context.clientDetails.type===Ur,getNodePackagePath:async be=>this.getGCNodePackagePath(be),getLastSummaryTimestampMs:()=>{var be;return(be=this.messageAtLastSummary)===null||be===void 0?void 0:be.timestamp},readAndParseBlob:async be=>En(this.storage,be)});const ge=this.deltaManager.initialSequenceNumber;if(this.summarizerNode=kF(at.create(this.logger,"SummarizerNode"),async(be,He,ce)=>this.summarizeInternal(be,He,ce),ge,fe?ge:void 0,{canReuseHandle:!1,throwOnFailure:!0,gcDisabled:!this.garbageCollector.shouldRunGC}),fe&&this.summarizerNode.loadBaseSummaryWithoutDifferential(fe),this.dataStores=new OG(VF(fe,r),this,be=>this.submit(Rt.Attach,be),(be,He)=>(ce,ve,De)=>this.summarizerNode.createChild(ce,be,He,void 0,ve,De),be=>this.summarizerNode.deleteChild(be),this.mc.logger,async()=>this.garbageCollector.getBaseGCDetails(),(be,He,ce)=>this.garbageCollector.nodeUpdated(be,"Changed",He,ce),new Map(o),this.garbageCollector.writeDataAtRoot),this.blobManager=new ai(this.handleContext,g,()=>this.storage,be=>this.submit(Rt.BlobAttach,void 0,void 0,{blobId:be}),be=>this.garbageCollector.nodeUpdated(be,"Loaded"),this,this.logger),this.scheduleManager=new QG(e.deltaManager,this,at.create(this.logger,"ScheduleManager")),this.deltaSender=this.deltaManager,this.pendingStateManager=new lG({applyStashedOp:this.applyStashedOp.bind(this),clientId:()=>this.clientId,close:this.closeFn,connected:()=>this.connected,flush:this.flush.bind(this),flushMode:()=>this.flushMode,reSubmit:this.reSubmit.bind(this),rollback:this.rollback.bind(this),setFlushMode:be=>this.setFlushMode(be)},this._flushMode,X==null?void 0:X.pending),this.context.quorum.on("removeMember",be=>{this.clearPartialChunks(be)}),this.summaryCollection=new NG(this.deltaManager,this.logger),this.dirtyContainer=this.context.attachState!==Qe.Attached||this.pendingStateManager.hasPendingMessages(),this.context.updateDirtyContainerState(this.dirtyContainer),this.summariesDisabled)this.mc.logger.sendTelemetryEvent({eventName:"SummariesDisabled"});else{const be=at.create(this.logger,"OrderedClientElection"),He=new DG(be,this.context.deltaManager,this.context.quorum),ce=new LG(be,He,i??this.context.deltaManager.lastSequenceNumber,Bl.isClientEligible);if(this.summarizerClientElection=new Bl(be,this.summaryCollection,ce,this.maxOpsSinceLastSummary,this.summarizerClientElectionEnabled),this.context.clientDetails.type===Ur)this._summarizer=new jx("/_summarizer",this,()=>this.summaryConfiguration,this,this.handleContext,this.summaryCollection,async ve=>zx.create(ve));else if(Bl.clientDetailsPermitElection(this.context.clientDetails)){const ve=()=>{this.summaryCollection.opsSinceLastAck>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"SummaryStatus:Behind"}),this.summaryCollection.once(an.SummaryAck,()=>{this.logger.sendTelemetryEvent({eventName:"SummaryStatus:CaughtUp"}),this.summaryCollection.on("default",ve)}),this.summaryCollection.off("default",ve))};this.summaryCollection.on("default",ve),this.summaryManager=new Wg(this.summarizerClientElection,this,this.summaryCollection,this.logger,this.formRequestSummarizerFn(this.context.loader),new MG(60*1e3,30*1e3,BG({coefficient:20,initialDelay:0})),{initialDelayMs:this.initialSummarizerDelayMs},this.heuristicsDisabled),this.summaryManager.start()}}this.deltaManager.on("readonly",be=>{ye(be===this.deltaManager.readOnlyInfo.readonly,292),ye(!be||!this.connected,293),this.replayPendingStates()}),f.sendTelemetryEvent(Object.assign({eventName:"DeviceSpec"},XG()));let we;m?(this.createContainerMetadata={createContainerRuntimeVersion:r==null?void 0:r.createContainerRuntimeVersion,createContainerTimestamp:r==null?void 0:r.createContainerTimestamp},we=(pe=(he=r==null?void 0:r.summaryNumber)!==null&&he!==void 0?he:r==null?void 0:r.summaryCount)!==null&&pe!==void 0?pe:0):(this.createContainerMetadata={createContainerRuntimeVersion:tm,createContainerTimestamp:Date.now()},we=0),this.nextSummaryNumber=we+1,this.logger.sendTelemetryEvent(Object.assign(Object.assign(Object.assign({eventName:"ContainerLoadStats"},this.createContainerMetadata),this.dataStores.containerLoadStats),{summaryNumber:we,summaryFormatVersion:r==null?void 0:r.summaryFormatVersion,disableIsolatedChannels:r==null?void 0:r.disableIsolatedChannels,gcVersion:r==null?void 0:r.gcFeature})),uG(this.context.clientId,this.deltaManager,this.logger),qG(this,this.logger),this.opTracker=new Zd(this.deltaManager,this.mc.config.getBoolean(WG)===!0)}get IContainerRuntime(){return this}get IFluidRouter(){return this}static async load(e,t,r,i={},s=e.scope,o){var u,d,f;const m=e,g=(u=m.taggedLogger)!==null&&u!==void 0?u:new NO(m.logger),P=at.create(g,void 0,{all:{runtimeVersion:tm}}),{summaryOptions:D={},gcOptions:M={},loadSequenceNumberVerification:U="close",useDataStoreAliasing:j=!1,flushMode:E=GG,enableOfflineLoad:k=!1}=i,z=e.pendingLocalState,K=(d=z==null?void 0:z.baseSnapshot)!==null&&d!==void 0?d:e.baseSnapshot,ie=z?new nS(()=>e.storage,z.snapshotBlobs):e.storage,he=new Dx(t),pe=async De=>{const Xe=K==null?void 0:K.blobs[De];if(K&&Xe)return ye(ie!==void 0,501),En(ie,Xe)},[X,fe,ge,we]=await Promise.all([pe(IP),pe(Qb),pe(AP),pe(_P)]),be=o===!0||e.existing===!0,He=await ai.load(K==null?void 0:K.trees[Xb],async De=>(ye(ie!==void 0,598),En(ie,De))),ce=(f=fe==null?void 0:fe.message)===null||f===void 0?void 0:f.sequenceNumber;if(!z&&ce!==void 0){const De=e.deltaManager.initialSequenceNumber;if(U!=="bypass"&&ce!==De){const Xe=new Rs("Summary metadata mismatch",{runtimeVersion:tm,runtimeSequenceNumber:ce,protocolSequenceNumber:De});U==="log"?P.sendErrorEvent({eventName:"SequenceNumberMismatch"},Xe):e.closeFn(Xe)}}const ve=new $x(e,he,fe,ge,X??[],we??[],{summaryOptions:D,gcOptions:M,loadSequenceNumberVerification:U,useDataStoreAliasing:j,flushMode:E,enableOfflineLoad:k},s,P,be,He,ie,r);return z&&(await ve.processSavedOps(z),z.savedOps=[]),await ve.getSnapshotBlobs(),ve}get options(){return this.context.options}get clientId(){return this.context.clientId}get clientDetails(){return this.context.clientDetails}get deltaManager(){return this.context.deltaManager}get storage(){return this._storage}get reSubmitFn(){return this.reSubmit}get closeFn(){return this.context.closeFn}get flushMode(){return this._flushMode}get scope(){return this.containerScope}get IFluidDataStoreRegistry(){return this.registry}get attachState(){return this.context.attachState}get IFluidHandleContext(){return this.handleContext}get connected(){return this._connected}get summarizerClientId(){var e;return(e=this.summarizerClientElection)===null||e===void 0?void 0:e.electedClientId}get disposed(){return this._disposed}get summarizer(){return ye(this._summarizer!==void 0,599),this._summarizer}isSummariesDisabled(){return this.runtimeOptions.summaryOptions.disableSummaries===!0?!0:this.summaryConfiguration.state==="disabled"}isHeuristicsDisabled(){var e;return((e=this.runtimeOptions.summaryOptions.summarizerOptions)===null||e===void 0?void 0:e.disableHeuristics)===!0?!0:this.summaryConfiguration.state==="disableHeuristics"}isSummarizerClientElectionEnabled(){var e;return this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection")?(e=this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection"))!==null&&e!==void 0?e:!0:this.runtimeOptions.summaryOptions.summarizerClientElection===!0?!0:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.summarizerClientElection===!0:!1}getMaxOpsSinceLastSummary(){return this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary!==void 0?this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.maxOpsSinceLastSummary:0}getInitialSummarizerDelayMs(){return this.runtimeOptions.summaryOptions.initialSummarizerDelayMs!==void 0?this.runtimeOptions.summaryOptions.initialSummarizerDelayMs:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.initialSummarizerDelayMs:0}dispose(e){var t;this._disposed||(this._disposed=!0,this.logger.sendTelemetryEvent({eventName:"ContainerRuntimeDisposed",isDirty:this.isDirty,lastSequenceNumber:this.deltaManager.lastSequenceNumber,attachState:this.attachState},e),this.summaryManager!==void 0&&this.summaryManager.dispose(),this.garbageCollector.dispose(),(t=this._summarizer)===null||t===void 0||t.dispose(),this.dataStores.dispose(),this.pendingStateManager.dispose(),this.emit("dispose"),this.removeAllListeners())}get IFluidTokenProvider(){var e;if(!((e=this.options)===null||e===void 0)&&e.intelligence)return{intelligence:this.options.intelligence}}async request(e){try{const t=ns.create(e);return t.pathParts[0]==="_summarizer"&&t.pathParts.length===1?this._summarizer!==void 0?{status:200,mimeType:"fluid/object",value:this.summarizer}:si(e):this.requestHandler!==void 0?this.requestHandler(t,this):si(e)}catch(t){return xh(t)}}async resolveHandle(e){try{const t=ns.create(e),r=t.pathParts[0];if(r==="_channels")return this.resolveHandle(t.createSubRequest(1));if(r===ai.basePath&&t.isLeaf(2)){const i=await this.blobManager.getBlob(t.pathParts[1]);return i?{status:200,mimeType:"fluid/object",value:i.get()}:si(e)}else if(t.pathParts.length>0){const i=await this.getDataStoreFromRequest(r,e),s=t.createSubRequest(1);return ye(s.url.startsWith("/"),294),i.IFluidRouter.request(s)}return si(e)}catch(t){return xh(t)}}internalId(e){var t;return(t=this.dataStores.aliases().get(e))!==null&&t!==void 0?t:e}async getDataStoreFromRequest(e,t){var r,i,s;const o=typeof((r=t.headers)===null||r===void 0?void 0:r[Yo.wait])=="boolean"?(i=t.headers)===null||i===void 0?void 0:i[Yo.wait]:!0,u=this.internalId(e),d=await this.dataStores.getDataStore(u,o);if(!((s=t.headers)===null||s===void 0)&&s[Yo.externalRequest]&&this.garbageCollector.shouldRunGC){const g=(await d.getBaseGCDetails()).usedRoutes;if(!(g===void 0||g.includes("")||g.includes("/")))throw Jh(si(t))}const f=await d.realize(),m=wW(t.url.split("?")[0]);return this.garbageCollector.nodeUpdated(`/${m}`,"Loaded",void 0,d.packagePath,t==null?void 0:t.headers),f}addMetadataToSummary(e){var t;const r=Object.assign(Object.assign(Object.assign(Object.assign({},this.createContainerMetadata),{summaryCount:this.nextSummaryNumber,summaryNumber:this.nextSummaryNumber++,summaryFormatVersion:1,disableIsolatedChannels:this.disableIsolatedChannels||void 0}),this.garbageCollector.getMetadata()),{message:(t=EG(this.deltaManager.lastMessage))!==null&&t!==void 0?t:this.messageAtLastSummary});Zi(e,Qb,JSON.stringify(r))}addContainerStateToSummary(e,t,r,i){var s;if(this.addMetadataToSummary(e),this.chunkMap.size>0){const d=JSON.stringify([...this.chunkMap]);Zi(e,IP,d)}const o=this.dataStores.aliases();if(o.size>0&&Zi(e,_P,JSON.stringify([...o])),this.summarizerClientElection){const d=JSON.stringify((s=this.summarizerClientElection)===null||s===void 0?void 0:s.serialize());Zi(e,AP,d)}const u=this.blobManager.summarize();if(Object.keys(u.summary.tree).length>0&&EF(e,Xb,u),this.garbageCollector.writeDataAtRoot){const d=this.garbageCollector.summarize(t,r,i);d!==void 0&&TF(e,Mo,d)}}shouldContinueReconnecting(){return this.maxConsecutiveReconnects<=0?!0:this.pendingStateManager.hasPendingMessages()?(this.consecutiveReconnects===Math.floor(this.maxConsecutiveReconnects/2)&&this.mc.logger.sendTelemetryEvent({eventName:"ReconnectsWithNoProgress",attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}),this.consecutiveReconnects<this.maxConsecutiveReconnects):(this.resetReconnectCount(),!0)}resetReconnectCount(){this.consecutiveReconnects=0}replayPendingStates(){if(!this.canSendOps())return;const e=this.dirtyContainer;this.dirtyContainer=!1,ye(this.emitDirtyDocumentEvent,295),this.emitDirtyDocumentEvent=!1;let t;try{this.pendingStateManager.replayPendingStates()}finally{t=this.dirtyContainer,this.dirtyContainer=e,this.emitDirtyDocumentEvent=!0}this.updateDocumentDirtyState(t)}async applyStashedOp(e,t){switch(e){case Rt.FluidDataStoreOp:return this.dataStores.applyStashedOp(t);case Rt.Attach:return this.dataStores.applyStashedAttachOp(t);case Rt.Alias:case Rt.BlobAttach:return;case Rt.ChunkedOp:throw new Error("chunkedOp not expected here");case Rt.Rejoin:throw new Error("rejoin not expected here");default:Gb(e,`Unknown ContainerMessageType: ${e}`)}}setConnectionState(e,t){this.verifyNotClosed();const r=this._connected!==e,i=r&&e;if(this._connected=e,e||(this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0,this._perfSignalData.trackingSignalSequenceNumber=void 0),i&&(this.consecutiveReconnects++,!this.shouldContinueReconnecting())){this.closeFn(pi.create("Runtime detected too many reconnects with no progress syncing local ops","setConnectionState",void 0,{dataLoss:1,attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}));return}r&&this.replayPendingStates(),this.dataStores.setConnectionState(e,t),Ng(this.mc.logger,this,e,t)}process(e,t){var r,i;if(this.verifyNotClosed(),!Ch(e))return;((r=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&r!==void 0?r:this.runtimeOptions.enableOfflineLoad)&&this.savedOps.push(e);let s=Object.assign({},e);this.scheduleManager.beforeOpProcessing(s);try{s=KG(s),s=this.processRemoteChunkedMessage(s);let o;switch(t&&s.type!==Rt.ChunkedOp&&(o=this.pendingStateManager.processPendingLocalMessage(s)),this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),s.type){case Rt.Attach:this.dataStores.processAttachMessage(s,t);break;case Rt.Alias:this.processAliasMessage(s,o,t);break;case Rt.FluidDataStoreOp:this.dataStores.processFluidDataStoreOp(s,t,o);break;case Rt.BlobAttach:ye((i=s==null?void 0:s.metadata)===null||i===void 0?void 0:i.blobId,298),this.blobManager.processBlobAttachOp(s.metadata.blobId,t);break;default:}this.emit("op",s),this.scheduleManager.afterOpProcessing(void 0,s),t&&this.resetReconnectCount()}catch(o){throw this.scheduleManager.afterOpProcessing(o,s),o}}processAliasMessage(e,t,r){this.dataStores.processAliasMessage(e,t,r)}sendSignalTelemetryEvent(e){const t=Date.now()-this._perfSignalData.signalTimestamp;this.logger.sendPerformanceEvent({eventName:"SignalLatency",duration:t,signalsLost:this._perfSignalData.signalsLost}),this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0}processSignal(e,t){const r=e.content,i={clientId:e.clientId,content:r.contents.content,type:r.contents.type};if(e.clientId===this.clientId&&this.connected&&(this._perfSignalData.trackingSignalSequenceNumber!==void 0&&r.clientSignalSequenceNumber>this._perfSignalData.trackingSignalSequenceNumber?(this._perfSignalData.signalsLost++,this._perfSignalData.trackingSignalSequenceNumber=void 0,this.logger.sendErrorEvent({eventName:"SignalLost",type:r.contents.type,signalsLost:this._perfSignalData.signalsLost,trackingSequenceNumber:this._perfSignalData.trackingSignalSequenceNumber,clientSignalSequenceNumber:r.clientSignalSequenceNumber})):r.clientSignalSequenceNumber===this._perfSignalData.trackingSignalSequenceNumber&&(this.sendSignalTelemetryEvent(r.clientSignalSequenceNumber),this._perfSignalData.trackingSignalSequenceNumber=void 0)),r.address===void 0){this.emit("signal",i,t);return}this.dataStores.processSignal(r.address,i,t)}async getRootDataStore(e,t=!0){const r=this.internalId(e),i=await this.dataStores.getDataStore(r,t);return ye(await i.isRoot(),299),i.realize()}setFlushMode(e){e!==this._flushMode&&(this.mc.logger.sendTelemetryEvent({eventName:"FlushMode Updated",old:this._flushMode,new:e}),e===nt.FlushMode.Immediate&&this.flush(),this._flushMode=e,this.pendingStateManager.onFlushModeUpdated(e))}flush(){if(ye(this._orderSequentiallyCalls===0,588),!!this.deltaSender&&(this.pendingStateManager.onFlush(),!!this.needsFlush&&(this.needsFlush=!1,!!this.canSendOps())))return this.deltaSender.flush()}orderSequentially(e){if(this.flushMode===nt.FlushMode.TurnBased){this.trackOrderSequentiallyCalls(e);return}const t=this.flushMode;this.setFlushMode(nt.FlushMode.TurnBased);try{this.trackOrderSequentiallyCalls(e),this.flush()}finally{this.setFlushMode(t)}}trackOrderSequentiallyCalls(e){let t;this.mc.config.getBoolean("Fluid.ContainerRuntime.EnableRollback")&&(t=this.pendingStateManager.checkpoint());try{this._orderSequentiallyCalls++,e()}catch(r){throw t?t.rollback():this.closeFn(new ro("orderSequentially callback exception",r)),r}finally{this._orderSequentiallyCalls--}}async createDataStore(e){const t=ul();return tS(await this._createDataStore(e,!1,t),t,this,this.dataStores,this.mc.logger)}async createRootDataStoreLegacy(e,t){const r=await this._createDataStore(e,!0,t);return r.makeVisibleAndAttachGraph!==void 0?r.makeVisibleAndAttachGraph():r.bindToContext(),r}async createRootDataStore(e,t){if(t.includes("/"))throw new Ct(`Id cannot contain slashes: '${t}'`);return this._aliasingEnabled===!0?this.createAndAliasDataStore(e,t):this.createRootDataStoreLegacy(e,t)}async createAndAliasDataStore(e,t,r){const i=ul(),s=await this._createDataStore(e,!1,i,r),o=tS(s,i,this,this.dataStores,this.mc.logger),u=await o.trySetAlias(t);if(u!=="Success")throw new ro("dataStoreAliasFailure",void 0,{alias:{value:t,tag:Ot.UserData},internalId:{value:i,tag:Ot.PackageData},aliasResult:u});return o}createDetachedRootDataStore(e,t){if(t.includes("/"))throw new Ct(`Id cannot contain slashes: '${t}'`);return this.dataStores.createDetachedDataStoreCore(e,!0,t)}createDetachedDataStore(e){return this.dataStores.createDetachedDataStoreCore(e,!1)}async _createDataStoreWithPropsLegacy(e,t,r=ul(),i=!1){const s=await this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],r,i,t).realize();return i&&(s.makeVisibleAndAttachGraph!==void 0?s.makeVisibleAndAttachGraph():s.bindToContext(),this.logger.sendTelemetryEvent({eventName:"Root datastore with props",hasProps:t!==void 0})),tS(s,r,this,this.dataStores,this.mc.logger)}async _createDataStoreWithProps(e,t,r=ul(),i=!1){return this._aliasingEnabled===!0&&i?this.createAndAliasDataStore(e,r,t):this._createDataStoreWithPropsLegacy(e,t,r,i)}async _createDataStore(e,t,r=ul(),i){return this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],r,t,i).realize()}canSendOps(){return this.connected&&!this.deltaManager.readOnlyInfo.readonly}getQuorum(){return this.context.quorum}getAudience(){return this.context.audience}get isDirty(){return this.dirtyContainer}isContainerMessageDirtyable(e,t){if(e===Rt.Attach){if(t.id===DP)return!1}else if(e===Rt.FluidDataStoreOp&&t.address===DP)return!1;return!0}createNewSignalEnvelope(e,t,r){const i=++this._perfSignalData.signalSequenceNumber,s={address:e,clientSignalSequenceNumber:i,contents:{type:t,content:r}};return i%this.defaultTelemetrySignalSampleCount===1&&this._perfSignalData.trackingSignalSequenceNumber===void 0&&(this._perfSignalData.signalTimestamp=Date.now(),this._perfSignalData.trackingSignalSequenceNumber=i),s}submitSignal(e,t){this.verifyNotClosed();const r=this.createNewSignalEnvelope(void 0,e,t);return this.context.submitSignalFn(r)}submitDataStoreSignal(e,t,r){const i=this.createNewSignalEnvelope(e,t,r);return this.context.submitSignalFn(i)}setAttachState(e){e===Qe.Attaching?ye(this.attachState===Qe.Attaching,301):(ye(this.attachState===Qe.Attached,302),this.emit("attached")),e===Qe.Attached&&!this.pendingStateManager.hasPendingMessages()&&this.updateDocumentDirtyState(!1),this.dataStores.setAttachState(e)}createSummary(e,t){e&&this.blobManager.setRedirectTable(e);const r=this.dataStores.createSummary(t);return this.disableIsolatedChannels||Xm(r),this.addContainerStateToSummary(r,!0,!1,t),r.summary}async getAbsoluteUrl(e){if(this.context.getAbsoluteUrl===void 0)throw new Error("Driver does not implement getAbsoluteUrl");if(this.attachState===Qe.Attached)return this.context.getAbsoluteUrl(e)}async summarizeInternal(e,t,r){const i=await this.dataStores.summarize(e,t,r);let s;return this.disableIsolatedChannels||(Xm(i),s=[nt.channelsTreeName]),this.addContainerStateToSummary(i,e,t,r),Object.assign(Object.assign({},i),{id:"",pathPartsForChildren:s})}async summarize(e){this.verifyNotClosed();const{fullTree:t=!1,trackState:r=!0,summaryLogger:i=this.mc.logger,runGC:s=this.garbageCollector.shouldRunGC,runSweep:o,fullGC:u}=e;let d;s&&(d=await this.collectGarbage({logger:i,runSweep:o,fullGC:u}));const f=new RF,{stats:m,summary:g}=await this.summarizerNode.summarize(t,r,f);return this.logger.sendTelemetryEvent({eventName:"SummarizeTelemetry",details:f.serialize()}),ye(g.type===Xo.Tree,303),{stats:m,summary:g,gcStats:d}}async updateStateBeforeGC(){return this.dataStores.updateStateBeforeGC()}async getGCData(e){const t=new Ox,r=await this.dataStores.getGCData(e);t.addNodes(r.gcNodes);const i=this.blobManager.getGCData(e);return t.addNodes(i.gcNodes),t.getGCData()}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""]);const r=[];for(const i of e)i.split("/")[1]!==ai.basePath&&r.push(i);return this.dataStores.updateUsedRoutes(r,t)}deleteUnusedRoutes(e){const t=[],r=[];for(const i of e)this.isBlobPath(i)?t.push(i):r.push(i);this.blobManager.deleteUnusedRoutes(t),this.dataStores.deleteUnusedRoutes(r)}getCurrentReferenceTimestampMs(){var e,t,r;return(t=(e=this.deltaManager.lastMessage)===null||e===void 0?void 0:e.timestamp)!==null&&t!==void 0?t:(r=this.messageAtLastSummary)===null||r===void 0?void 0:r.timestamp}getNodeType(e){var t;return this.isBlobPath(e)?kr.Blob:(t=this.dataStores.getGCNodeType(e))!==null&&t!==void 0?t:kr.Other}async getGCNodePackagePath(e){switch(this.getNodeType(e)){case kr.Blob:return["_blobs"];case kr.DataStore:case kr.SubDataStore:return this.dataStores.getDataStorePackagePath(e);default:ye(!1,734)}}isBlobPath(e){const t=e.split("/");return!(t.length<2||t[1]!==ai.basePath)}async collectGarbage(e){return this.garbageCollector.collectGarbage(e)}addedGCOutboundReference(e,t){this.garbageCollector.addedOutboundReference(e.absolutePath,t.absolutePath)}async submitSummary(e){var t,r,i;const{fullTree:s,refreshLatestAck:o,summaryLogger:u}=e,d=this.nextSummaryNumber,f=at.create(u,void 0,{all:{summaryNumber:d}});let m;if(o){const g=await this.refreshLatestSummaryAckFromServer(at.create(f,void 0,{all:{safeSummary:!0}})),P=g.latestSnapshotRefSeq;m=g.latestSnapshotVersionId,P>this.deltaManager.lastSequenceNumber&&await dt.timedExecAsync(f,{eventName:"WaitingForSeq",lastSequenceNumber:this.deltaManager.lastSequenceNumber,targetSequenceNumber:P,lastKnownSeqNumber:this.deltaManager.lastKnownSeqNumber},async()=>YG(this.deltaManager,P),{start:!0,end:!0,cancel:"error"})}try{await this.deltaManager.inbound.pause();const g=this.deltaManager.lastSequenceNumber,P=this.deltaManager.minimumSequenceNumber,D=`Summary @${g}:${this.deltaManager.minimumSequenceNumber}`;g!==((t=this.deltaManager.lastMessage)===null||t===void 0?void 0:t.sequenceNumber)&&f.sendErrorEvent({eventName:"LastSequenceMismatch",error:D}),this.summarizerNode.startSummary(g,f);const M=()=>e.cancellationToken.cancelled?{continue:!1,error:"disconnected"}:(ye(this.connected,600),this.deltaManager.lastSequenceNumber!==g?{continue:!1,error:`lastSequenceNumber changed before uploading to storage. ${this.deltaManager.lastSequenceNumber} !== ${g}`}:{continue:!0});let U=M();if(!U.continue)return{stage:"base",referenceSequenceNumber:g,minimumSequenceNumber:P,error:U.error};const j=bP.start();let E;const k=this.garbageCollector.summaryStateNeedsReset;try{E=await this.summarize({fullTree:s||k,trackState:!0,summaryLogger:f,runGC:this.garbageCollector.shouldRunGC})}catch(Re){return{stage:"base",referenceSequenceNumber:g,minimumSequenceNumber:P,error:Re}}const{summary:z,stats:K}=E;this.messageAtLastSummary=this.deltaManager.lastMessage;const ie=this.disableIsolatedChannels?z:z.tree[nt.channelsTreeName];ye(ie.type===Xo.Tree,508);const he=Object.values(ie.tree).filter(Re=>Re.type===Xo.Handle).length,pe=z.tree[Mo]?kx(z.tree[Mo]):void 0,X=Object.assign({dataStoreCount:this.dataStores.size,summarizedDataStoreCount:this.dataStores.size-he,gcStateUpdatedDataStoreCount:(r=E.gcStats)===null||r===void 0?void 0:r.updatedDataStoreCount,gcBlobNodeCount:pe==null?void 0:pe.blobNodeCount,gcTotalBlobsSize:pe==null?void 0:pe.totalBlobSize,opsSizesSinceLastSummary:this.opTracker.opsSizeAccumulator,nonSystemOpsSinceLastSummary:this.opTracker.nonSystemOpCount,summaryNumber:d},K),fe={referenceSequenceNumber:g,minimumSequenceNumber:P,summaryTree:z,summaryStats:X,generateDuration:j.trace().duration,forcedFullTree:k};if(U=M(),!U.continue)return Object.assign(Object.assign({stage:"generate"},fe),{error:U.error});const ge=this.summaryCollection.latestAck;let we;(ge==null?void 0:ge.summaryAck.contents.handle)!==m&&m!==void 0?we={proposalHandle:void 0,ackHandle:m,referenceSequenceNumber:g}:ge===void 0?we={proposalHandle:void 0,ackHandle:(i=this.context.getLoadedFromVersion())===null||i===void 0?void 0:i.id,referenceSequenceNumber:g}:we={proposalHandle:ge.summaryOp.contents.handle,ackHandle:ge.summaryAck.contents.handle,referenceSequenceNumber:g};let be;try{be=await this.storage.uploadSummaryWithContext(E.summary,we)}catch(Re){return Object.assign(Object.assign({stage:"generate"},fe),{error:Re})}const He=we.ackHandle,ce={handle:be,head:He,message:D,parents:He?[He]:[]},ve=Object.assign(Object.assign({},fe),{handle:be,uploadDuration:j.trace().duration});if(U=M(),!U.continue)return Object.assign(Object.assign({stage:"upload"},ve),{error:U.error});let De;try{De=this.submitSystemMessage(an.Summarize,ce)}catch(Re){return Object.assign(Object.assign({stage:"upload"},ve),{error:Re})}const Xe=Object.assign(Object.assign({stage:"submit"},ve),{clientSequenceNumber:De,submitOpDuration:j.trace().duration});return this.summarizerNode.completeSummary(be),this.opTracker.reset(),Xe}finally{this.summarizerNode.clearSummary(),this.deltaManager.inbound.resume()}}processRemoteChunkedMessage(e){if(e.type!==Rt.ChunkedOp)return e;const t=e.clientId,r=e.contents;if(this.addChunk(t,r),r.chunkId===r.totalChunks){const i=Object.assign({},e),s=this.chunkMap.get(t).join("");return i.contents=JSON.parse(s),i.type=r.originalType,this.clearPartialChunks(t),i}return e}addChunk(e,t){let r=this.chunkMap.get(e);r===void 0&&(r=[],this.chunkMap.set(e,r)),ye(t.chunkId===r.length+1,305),r.push(t.contents)}clearPartialChunks(e){this.chunkMap.has(e)&&this.chunkMap.delete(e)}updateDocumentDirtyState(e){this.dirtyContainer!==e&&(this.dirtyContainer=e,this.emitDirtyDocumentEvent&&(this.emit(e?"dirty":"saved"),this.context.updateDirtyContainerState(e)))}submitDataStoreOp(e,t,r=void 0){const i={address:e,contents:t};this.submit(Rt.FluidDataStoreOp,i,r)}submitDataStoreAliasOp(e,t){if(!HF(e))throw new Ct("malformedDataStoreAliasMessage");this.submit(Rt.Alias,e,t)}async uploadBlob(e){return this.verifyNotClosed(),this.blobManager.createBlob(e)}submit(e,t,r=void 0,i=void 0){this.verifyNotClosed(),ye(this.attachState!==Qe.Detached,306);let s=-1,o=i;if(this.canSendOps()){const u=JSON.stringify(t),d=this.context.deltaManager.maxMessageSize;this.flushMode===nt.FlushMode.TurnBased&&!this.needsFlush&&(o=Object.assign(Object.assign({},i),{batch:!0}),this.needsFlush=!0,this.flushTrigger||Promise.resolve().then(()=>{this.flushTrigger=!1,this.flush()})),s=this.submitMaybeChunkedMessages(e,t,u,d,this._flushMode===nt.FlushMode.TurnBased,o)}this.pendingStateManager.onSubmitMessage(e,s,this.deltaManager.lastSequenceNumber,t,r,o),this.isContainerMessageDirtyable(e,t)&&this.updateDocumentDirtyState(!0)}submitMaybeChunkedMessages(e,t,r,i,s,o=void 0){return this._maxOpSizeInBytes>=0?!r||r.length<=this._maxOpSizeInBytes?this.submitRuntimeMessage(e,t,s,o):(this.closeFn(new ro("OpTooLarge",void 0,{length:{value:r.length,tag:Ot.PackageData},limit:{value:this._maxOpSizeInBytes,tag:Ot.PackageData}})),-1):!r||r.length<=i?this.submitRuntimeMessage(e,t,s,o):this.submitChunkedMessage(e,r,i)}submitChunkedMessage(e,t,r){const i=t.length,s=Math.floor((i-1)/r)+1;let o=0,u=0;for(let d=1;d<=s;d=d+1){const f={chunkId:d,contents:t.substr(o,r),originalType:e,totalChunks:s};o+=r,u=this.submitRuntimeMessage(Rt.ChunkedOp,f,!1)}return u}submitSystemMessage(e,t){this.verifyNotClosed(),ye(this.connected,307);const r=this.flushMode===nt.FlushMode.TurnBased&&this.needsFlush;return r&&this.mc.logger.sendErrorEvent({eventName:"submitSystemMessageError",type:e}),this.context.submitFn(e,t,r)}submitRuntimeMessage(e,t,r,i){this.verifyNotClosed(),ye(this.connected,601);const s={type:e,contents:t};return this.context.submitFn(an.Operation,s,r,i)}verifyNotClosed(){if(this._disposed)throw new Error("Runtime is closed")}reSubmit(e,t,r,i){switch(e){case Rt.FluidDataStoreOp:this.dataStores.resubmitDataStoreOp(t,r);break;case Rt.Attach:case Rt.Alias:this.submit(e,t,r);break;case Rt.ChunkedOp:throw new Error("chunkedOp not expected here");case Rt.BlobAttach:this.submit(e,t,r,i);break;case Rt.Rejoin:this.submit(e,t);break;default:Gb(e,`Unknown ContainerMessageType: ${e}`)}}rollback(e,t,r){switch(e){case Rt.FluidDataStoreOp:this.dataStores.rollbackDataStoreOp(t,r);break;default:throw new Error(`Can't rollback ${e}`)}}async refreshLatestSummaryAck(e,t,r,i){const s=async d=>En(this.storage,d),{snapshotTree:o}=await this.fetchSnapshotFromStorage(t,i,{eventName:"RefreshLatestSummaryGetSnapshot",ackHandle:t,summaryRefSeq:r,fetchLatest:!1}),u=await this.summarizerNode.refreshLatestSummary(e,r,async()=>o,s,i);await this.garbageCollector.latestSummaryStateRefreshed(u,s)}async refreshLatestSummaryAckFromServer(e){const{snapshotTree:t,versionId:r}=await this.fetchSnapshotFromStorage(null,e,{eventName:"RefreshLatestSummaryGetSnapshot",fetchLatest:!0}),i=async u=>En(this.storage,u),s=await OF(t,i),o=await this.summarizerNode.refreshLatestSummary(void 0,s,async()=>t,i,e);return await this.garbageCollector.latestSummaryStateRefreshed(o,i),{latestSnapshotRefSeq:s,latestSnapshotVersionId:r}}async fetchSnapshotFromStorage(e,t,r){return dt.timedExecAsync(t,r,async i=>{const s={},o=bP.start(),u=await this.storage.getVersions(e,1);ye(!!u&&!!u[0],311),s.getVersionDuration=o.trace().duration;const d=await this.storage.getSnapshotTree(u[0]);return ye(!!d,312),s.getSnapshotDuration=o.trace().duration,i.end(s),{snapshotTree:d,versionId:u[0].id}})}notifyAttaching(e){var t;((t=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&t!==void 0?t:this.runtimeOptions.enableOfflineLoad)&&(this.baseSnapshotBlobs=nS.serializeTreeWithBlobContents(e))}async getSnapshotBlobs(){var e;!((e=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&e!==void 0?e:this.runtimeOptions.enableOfflineLoad)||this.attachState!==Qe.Attached||this.context.pendingLocalState||(ye(!!this.context.baseSnapshot,741),this.baseSnapshotBlobs=await nS.serializeTree(this.context.baseSnapshot,this.storage))}getPendingLocalState(){var e;if(!((e=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&e!==void 0?e:this.runtimeOptions.enableOfflineLoad))throw new Ct("can't get state when offline load disabled");const t=this.context.pendingLocalState;return t?{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:t.snapshotBlobs,baseSnapshot:t.baseSnapshot,savedOps:this.savedOps}:(ye(!!this.context.baseSnapshot,742),ye(!!this.baseSnapshotBlobs,743),{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:this.baseSnapshotBlobs,baseSnapshot:this.context.baseSnapshot,savedOps:this.savedOps})}formRequestSummarizerFn(e){return async()=>{const t={headers:{[Ht.cache]:!1,[Ht.clientDetails]:{capabilities:{interactive:!1},type:Ur},[nc.summarizingClient]:!0,[Ht.reconnect]:!1},url:"/_summarizer"},i=(await ic(e,t)).ISummarizer;if(!i)throw new Ct("Fluid object does not implement ISummarizer");return i}}async processSavedOps(e){for(const t of e.savedOps)this.process(t,!1),await this.pendingStateManager.applyStashedOpsAt(t.sequenceNumber);await this.pendingStateManager.applyStashedOpsAt()}}const YG=async(n,e)=>new Promise((t,r)=>{n.on("closed",r);const i=s=>{s.sequenceNumber>=e&&(t(),n.off("op",i))};n.on("op",i)});/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ZG{constructor(e,t){this.absolutePath=e,this.routeContext=t,this.isAttached=!0,uu(e.startsWith("/"),413)}get IFluidRouter(){return this}get IFluidHandleContext(){return this}get IFluidHandle(){return this}async get(){if(this.objectP===void 0){const e={url:this.absolutePath,headers:{[Yo.viaHandle]:!0}};this.objectP=this.routeContext.resolveHandle(e).then(t=>{if(t.mimeType==="fluid/object")return t.value;throw Jh(t)})}return this.objectP}attachGraph(){}bind(e){e.attachGraph()}async request(e){try{const r=(await this.get()).IFluidRouter;return r!==void 0?r.request(e):si(e)}catch(t){return xh(t)}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const eK=n=>(n==null?void 0:n.type)==="__fluid_handle__";class WF{constructor(e,t){for(this.context=e,this.handleParsedCb=t,this.encodeValue=(r,i)=>{const s=r==null?void 0:r.IFluidHandle;return s!==void 0?this.serializeHandle(s,i):r},this.decodeValue=r=>{if(eK(r)){const i=r.url.startsWith("/")?r.url:yc(r.url,this.context),s=new ZG(i,this.root);return this.handleParsedCb(s),s}else return r},this.root=this.context;this.root.routeContext!==void 0;)this.root=this.root.routeContext}get IFluidSerializer(){return this}encode(e,t){return e&&typeof e=="object"?this.recursivelyReplace(e,this.encodeValue,t):e}decode(e){return e&&typeof e=="object"?this.recursivelyReplace(e,this.decodeValue):e}stringify(e,t){return JSON.stringify(e,(r,i)=>this.encodeValue(i,t))}parse(e){return JSON.parse(e,(t,r)=>this.decodeValue(r))}recursivelyReplace(e,t,r){const i=t(e,r);if(i!==e)return i;let s;for(const o of Object.keys(e)){const u=e[o];if(u&&typeof u=="object"){const d=this.recursivelyReplace(u,t,r);d!==u&&(s=s??(Array.isArray(e)?[...e]:Object.assign({},e)),s[o]=d)}}return s??e}serializeHandle(e,t){return t.bind(e),{type:"__fluid_handle__",url:e.absolutePath}}}var xp,tK=new Uint8Array(16);function nK(){if(!xp&&(xp=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!xp))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return xp(tK)}const rK=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function iK(n){return typeof n=="string"&&rK.test(n)}var Un=[];for(var rS=0;rS<256;++rS)Un.push((rS+256).toString(16).substr(1));function sK(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Un[n[e+0]]+Un[n[e+1]]+Un[n[e+2]]+Un[n[e+3]]+"-"+Un[n[e+4]]+Un[n[e+5]]+"-"+Un[n[e+6]]+Un[n[e+7]]+"-"+Un[n[e+8]]+Un[n[e+9]]+"-"+Un[n[e+10]]+Un[n[e+11]]+Un[n[e+12]]+Un[n[e+13]]+Un[n[e+14]]+Un[n[e+15]]).toLowerCase();if(!iK(t))throw TypeError("Stringified UUID is invalid");return t}function oK(n,e,t){n=n||{};var r=n.random||(n.rng||nK)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return sK(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class aK extends jl{get isAttached(){return this.value.isAttached()}constructor(e,t,r){super(e,t,r)}attachGraph(){this.value.bindToContext(),super.attachGraph()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class uK extends WF{constructor(){super(...arguments),this.serializedRoutes=new Set}getSerializedRoutes(){return Array.from(this.serializedRoutes)}serializeHandle(e,t){return this.serializedRoutes.add(e.absolutePath),super.serializeHandle(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class lK extends Fg{constructor(e,t,r){super((i,s)=>this.eventListenerErrorHandler(i,s)),this.id=e,this.runtime=t,this.attributes=r,this._connected=!1,this._isBoundToContext=!1,uu(!e.includes("/"),772),this.handle=new aK(this,e,t.IFluidHandleContext),this.logger=at.create(t.logger,void 0,{all:{sharedObjectId:oK(),ddsType:{value:this.attributes.type,tag:Ot.CodeArtifact}}}),this.mc=Iu(this.logger),[this.opProcessingHelper,this.callbacksHelper]=this.setUpSampledTelemetryHelpers(),this.attachListeners()}get IFluidLoadable(){return this}get connected(){return this._connected}setUpSampledTelemetryHelpers(){var e,t;uu(this.mc!==void 0&&this.logger!==void 0,"this.mc and/or this.logger has not been set");const r=new Rb({eventName:"ddsOpProcessing",category:"performance"},this.logger,(e=this.mc.config.getNumber("Fluid.SharedObject.OpProcessingTelemetrySampling"))!==null&&e!==void 0?e:100,!0,new Map([["local",{localOp:!0}],["remote",{localOp:!1}]])),i=new Rb({eventName:"ddsEventCallbacks",category:"performance"},this.logger,(t=this.mc.config.getNumber("Fluid.SharedObject.DdsCallbacksTelemetrySampling"))!==null&&t!==void 0?t:100,!0);return this.runtime.once("dispose",()=>{this.callbacksHelper.dispose(),this.opProcessingHelper.dispose()}),[r,i]}closeWithError(e){this.closeError===void 0&&(this.closeError=e)}verifyNotClosed(){if(this.closeError!==void 0)throw this.closeError}eventListenerErrorHandler(e,t){const r=pi.wrapIfUnrecognized(t,"SharedObjectEventListenerException");throw r.addTelemetryProperties({emittedEventName:String(e)}),this.closeWithError(r),r}attachListeners(){this.isAttached()||this.runtime.once("attaching",()=>{this.didAttach()})}async load(e){this.runtime.attachState!==Qe.Detached&&(this.services=e),await this.loadCore(e.objectStorage),this.runtime.attachState!==Qe.Detached&&this.attachDeltaHandler()}initializeLocal(){this.initializeLocalCore()}bindToContext(){this._isBoundToContext||(this._isBoundToContext=!0,this.runtime.bindChannel(this))}connect(e){this.services=e,this.attachDeltaHandler()}isAttached(){return this.services!==void 0&&this.runtime.attachState!==Qe.Detached}handleDecoded(e){var t,r,i;this.isAttached()&&((i=(t=this.services)===null||t===void 0?void 0:(r=t.deltaConnection).addedGCOutboundReference)===null||i===void 0||i.call(r,this.handle,e))}initializeLocalCore(){}didAttach(){}submitLocalMessage(e,t=void 0){this.verifyNotClosed(),this.isAttached()&&this.services.deltaConnection.submit(e,t)}dirty(){this.isAttached()&&this.services.deltaConnection.dirty()}onConnect(){}reSubmitCore(e,t){this.submitLocalMessage(e,t)}async newAckBasedPromise(e){let t;return new Promise((r,i)=>{if(t=()=>i(new Error("FluidDataStoreRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed){t();return}this.runtime.on("dispose",t),e(r,i)}).finally(()=>{this.runtime.off("dispose",t)})}attachDeltaHandler(){uu(this.services!==void 0,122),this._isBoundToContext=!0,this.didAttach(),this.services.deltaConnection.attach({process:(e,t,r)=>{this.process(e,t,r)},setConnectionState:e=>{this.setConnectionState(e)},reSubmit:(e,t)=>{this.reSubmit(e,t)},applyStashedOp:e=>this.applyStashedOp(e),rollback:(e,t)=>{this.rollback(e,t)}}),this.setConnectionState(this.services.deltaConnection.connected)}setConnectionState(e){this._connected!==e&&(this._connected=e,e?this.onConnect():this.onDisconnect())}process(e,t,r){this.verifyNotClosed(),this.emitInternal("pre-op",e,t,this),this.opProcessingHelper.measure(()=>{this.processCore(e,t,r)},t?"local":"remote"),this.emitInternal("op",e,t,this)}reSubmit(e,t){this.reSubmitCore(e,t)}rollback(e,t){throw new Error("rollback not supported")}emit(e,...t){return this.callbacksHelper.measure(()=>super.emit(e,...t))}emitInternal(e,...t){return super.emit(e,...t)}}class Gg extends lK{constructor(e,t,r,i){super(e,t,r),this.telemetryContextPrefix=i,this._isGCing=!1,this._serializer=new WF(this.runtime.channelsRoutingContext,s=>this.handleDecoded(s))}get serializer(){return uu(!this._isGCing,117),this._serializer}getAttachSummary(e=!1,t=!1,r){const i=this.summarizeCore(this.serializer,r);return this.incrementTelemetryMetric(nt.blobCountPropertyName,i.stats.blobNodeCount,r),this.incrementTelemetryMetric(nt.totalBlobSizePropertyName,i.stats.totalBlobSize,r),i}async summarize(e=!1,t=!1,r){const i=this.summarizeCore(this.serializer,r);return this.incrementTelemetryMetric(nt.blobCountPropertyName,i.stats.blobNodeCount,r),this.incrementTelemetryMetric(nt.totalBlobSizePropertyName,i.stats.totalBlobSize,r),i}getGCData(e=!1){uu(!this._isGCing,120),this._isGCing=!0;let t;try{const r=new uK(this.runtime.channelsRoutingContext,i=>this.handleDecoded(i));this.processGCDataCore(r),t={gcNodes:{"/":r.getSerializedRoutes()}},uu(this._isGCing,121)}finally{this._isGCing=!1}return t}processGCDataCore(e){this.summarizeCore(e)}incrementTelemetryMetric(e,t,r){var i;const s=(i=r==null?void 0:r.get(this.telemetryContextPrefix,e))!==null&&i!==void 0?i:0;r==null||r.set(this.telemetryContextPrefix,e,s+t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function GF(n,e,t){return n!==void 0?e.stringify(n,t):n}function KF(n,e,t){return e.encode(n,t)}function Ym(n,e){return n!==void 0?e.parse(JSON.stringify(n)):n}function cK(n,e){const t=new Tr;return t.addBlob(n,e),t.getSummaryTree()}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Vt;(function(n){n[n.Shared=0]="Shared",n[n.Plain=1]="Plain"})(Vt||(Vt={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function jt(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let dK=class extends Fn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Yb(n,e,t){const r=n.makeSerialized(e,t);return{type:r.type,value:r.value&&JSON.parse(r.value)}}class LP{constructor(e){this.value=e}get type(){return Vt[Vt.Plain]}makeSerialized(e,t){const r=GF(this.value,e,t);return{type:this.type,value:r}}}class Kg{constructor(e){this.serializer=e}fromSerializable(e){if(e.type===Vt[Vt.Shared]){e.type=Vt[Vt.Plain];const r={type:"__fluid_handle__",url:e.value};e.value=r}const t=Ym(e.value,this.serializer);return new LP(t)}fromInMemory(e){return new LP(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function iS(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="add"||n.type==="edit")}function MP(n){return n!==void 0&&n.type==="clear"&&typeof n.pendingMessageId=="number"}function hK(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="add"||n.type==="edit"||n.type==="clear")}class fK{constructor(e,t,r,i,s){this.serializer=e,this.handle=t,this.submitMessage=r,this.isAttached=i,this.eventEmitter=s,this.messageHandlers=new Map,this.data=new Map,this.pendingKeys=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[],this.localValueMaker=new Kg(e),this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:[r.value[0],r.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:r.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach((t,r,i)=>{e(t.value,r,i)})}get(e){const t=this.data.get(e);return t===void 0?void 0:t.value}has(e){return this.data.has(e)}set(e,t){if(e==null)throw new Error("Undefined and null keys are not supported");const r=this.localValueMaker.fromInMemory(t),i=Yb(r,this.serializer,this.handle),s=this.setCore(e,r,!0);if(!this.isAttached())return;const o={key:e,type:"set",value:i};this.submitMapKeyMessage(o,s)}delete(e){const t=this.deleteCore(e,!0);if(!this.isAttached())return t!==void 0;const r={key:e,type:"delete"};return this.submitMapKeyMessage(r,t),t!==void 0}clear(){const e=this.isAttached()?new Map(this.data):void 0;if(this.clearCore(!0),!this.isAttached())return;const t={type:"clear"};this.submitMapClearMessage(t,e)}getSerializedStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=r.makeSerialized(e,this.handle)}),t}getSerializableStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=Yb(r,e,this.handle)}),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,r]of Object.entries(e)){const i={key:t,value:this.makeLocal(t,r)};this.data.set(i.key,i.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}trySubmitMessage(e,t){const r=this.messageHandlers.get(e.type);return r===void 0?!1:(r.submit(e,t),!0)}tryGetStashedOpLocalMetadata(e){const t=this.messageHandlers.get(e.type);if(t===void 0)throw new Error("no apply stashed op handler");return t.getStashedOpLocalMetadata(e)}tryProcessMessage(e,t,r){const i=this.messageHandlers.get(e.type);return i===void 0?!1:(i.process(e,t,r),!0)}rollback(e,t){if(!hK(t))throw new Error("Invalid localOpMetadata");if(e.type==="clear"&&t.type==="clear"){if(t.previousMap===void 0)throw new Error("Cannot rollback without previous map");t.previousMap.forEach((i,s)=>{this.setCore(s,i,!0)});const r=this.pendingClearMessageIds.pop();if(r===void 0||r!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if(e.type==="delete"||e.type==="set"){if(t.type==="add")this.deleteCore(e.key,!0);else if(t.type==="edit"&&t.previousValue!==void 0)this.setCore(e.key,t.previousValue,!0);else throw new Error("Cannot rollback without previous value");const r=this.pendingKeys.get(e.key),i=r==null?void 0:r.pop();if(!r||i!==t.pendingMessageId)throw new Error("Rollback op does not match last pending");r.length===0&&this.pendingKeys.delete(e.key)}else throw new Error("Unsupported op for rollback")}setCore(e,t,r){const i=this.data.get(e),s=i==null?void 0:i.value;return this.data.set(e,t),this.eventEmitter.emit("valueChanged",{key:e,previousValue:s},r,this.eventEmitter),i}clearCore(e){this.data.clear(),this.eventEmitter.emit("clear",e,this.eventEmitter)}deleteCore(e,t){const r=this.data.get(e),i=r==null?void 0:r.value;return this.data.delete(e)&&this.eventEmitter.emit("valueChanged",{key:e,previousValue:i},t,this.eventEmitter),r}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach((t,r)=>{e.set(r,this.data.get(r))}),this.clearCore(!1),e.forEach((t,r)=>{this.setCore(r,t,!0)})}makeLocal(e,t){if(t.type===Vt[Vt.Plain]||t.type===Vt[Vt.Shared])return this.localValueMaker.fromSerializable(t);throw new Error("Unknown local value type")}needProcessKeyOperation(e,t,r){if(this.pendingClearMessageIds.length>0)return t&&jt(r!==void 0&&iS(r)&&r.pendingMessageId<this.pendingClearMessageIds[0],19),!1;if(this.pendingKeys.get(e.key)!==void 0){if(t){jt(r!==void 0&&iS(r),20);const s=this.pendingKeys.get(e.key);jt(s!==void 0&&s[0]===r.pendingMessageId,762),s.shift(),s.length===0&&this.pendingKeys.delete(e.key)}return!1}return!t}getMessageHandlers(){const e=new Map;return e.set("clear",{process:(t,r,i)=>{if(r){jt(MP(i),21);const s=this.pendingClearMessageIds.shift();jt(s===i.pendingMessageId,763);return}if(this.pendingKeys.size!==0){this.clearExceptPendingKeys();return}this.clearCore(r)},submit:(t,r)=>{jt(MP(r),764);const i=this.pendingClearMessageIds.shift();jt(i===r.pendingMessageId,765),this.submitMapClearMessage(t,r.previousMap)},getStashedOpLocalMetadata:t=>({type:"clear",pendingMessageId:this.getMapClearMessageId()})}),e.set("delete",{process:(t,r,i)=>{this.needProcessKeyOperation(t,r,i)&&this.deleteCore(t.key,r)},submit:(t,r)=>{this.resubmitMapKeyMessage(t,r)},getStashedOpLocalMetadata:t=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(t)})}),e.set("set",{process:(t,r,i)=>{if(!this.needProcessKeyOperation(t,r,i))return;const s=this.makeLocal(t.key,t.value);this.setCore(t.key,s,r)},submit:(t,r)=>{this.resubmitMapKeyMessage(t,r)},getStashedOpLocalMetadata:t=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(t)})}),e}getMapClearMessageId(){const e=++this.pendingMessageId;return this.pendingClearMessageIds.push(e),e}submitMapClearMessage(e,t){const r={type:"clear",pendingMessageId:this.getMapClearMessageId(),previousMap:t};this.submitMessage(e,r)}getMapKeyMessageId(e){const t=++this.pendingMessageId,r=this.pendingKeys.get(e.key);return r!==void 0?r.push(t):this.pendingKeys.set(e.key,[t]),t}submitMapKeyMessage(e,t){const r=this.getMapKeyMessageId(e),i=t?{type:"edit",pendingMessageId:r,previousValue:t}:{type:"add",pendingMessageId:r};this.submitMessage(e,i)}resubmitMapKeyMessage(e,t){jt(iS(t),766);const r=this.pendingKeys.get(e.key);jt(r!==void 0&&r[0]===t.pendingMessageId,767),r.shift(),r.length===0&&this.pendingKeys.delete(e.key);const i=this.getMapKeyMessageId(e),s=t.type==="edit"?{type:"edit",pendingMessageId:i,previousValue:t.previousValue}:{type:"add",pendingMessageId:i};this.submitMessage(e,s)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const JF="1.3.6";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var BP;const jP="header";class hi{get type(){return hi.Type}get attributes(){return hi.Attributes}async load(e,t,r,i){const s=new Ih(t,e,i);return await s.load(r),s}create(e,t){const r=new Ih(t,e,hi.Attributes);return r.initializeLocal(),r}}hi.Type="https://graph.microsoft.com/types/map";hi.Attributes={type:hi.Type,snapshotFormatVersion:"0.2",packageVersion:JF};class Ih extends Gg{constructor(e,t,r){super(e,t,r,"fluid_map_"),this[BP]="SharedMap",this.kernel=new fK(this.serializer,this.handle,(i,s)=>this.submitLocalMessage(i,s),()=>this.isAttached(),this)}static create(e,t){return e.createChannel(t,hi.Type)}static getFactory(){return new hi}keys(){return this.kernel.keys()}entries(){return this.kernel.entries()}values(){return this.kernel.values()}[(BP=Symbol.toStringTag,Symbol.iterator)](){return this.kernel.entries()}get size(){return this.kernel.size}forEach(e){this.kernel.forEach(e)}get(e){return this.kernel.get(e)}has(e){return this.kernel.has(e)}set(e,t){return this.kernel.set(e,t),this}delete(e){return this.kernel.delete(e)}clear(){this.kernel.clear()}summarizeCore(e,t){let r=0,i=0,s={};const o=[],u=new Tr,d=this.kernel.getSerializedStorage(e),f=8*1024,m=16*1024;for(const P of Object.keys(d)){const D=d[P];if(D.value&&D.value.length>=f){const M=`blob${i}`;i++,o.push(M);const U={[P]:{type:D.type,value:JSON.parse(D.value)}};u.addBlob(M,JSON.stringify(U))}else{if(r+=D.type.length+21,D.value&&(r+=D.value.length),r>m){const M=`blob${i}`;i++,o.push(M),u.addBlob(M,JSON.stringify(s)),s={},r=0}s[P]={type:D.type,value:D.value===void 0?void 0:JSON.parse(D.value)}}}const g={blobs:o,content:s};return u.addBlob(jP,JSON.stringify(g)),u.getSummaryTree()}async loadCore(e){const t=await En(e,jP),r=t;Array.isArray(r.blobs)?(this.kernel.populateFromSerializable(r.content),await Promise.all(r.blobs.map(async i=>{const s=await En(e,i);this.kernel.populateFromSerializable(s)}))):this.kernel.populateFromSerializable(t)}onDisconnect(){}reSubmitCore(e,t){this.kernel.trySubmitMessage(e,t)}applyStashedOp(e){return this.kernel.tryProcessMessage(e,!1,void 0),this.kernel.tryGetStashedOpLocalMetadata(e)}processCore(e,t,r){e.type===Gm.Operation&&this.kernel.tryProcessMessage(e.contents,t,r)}rollback(e,t){this.kernel.rollback(e,t)}}function ms(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}function qP(n,e){for(var t="",r=0,i=-1,s=0,o,u=0;u<=n.length;++u){if(u<n.length)o=n.charCodeAt(u);else{if(o===47)break;o=47}if(o===47){if(!(i===u-1||s===1))if(i!==u-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var d=t.lastIndexOf("/");if(d!==t.length-1){d===-1?(t="",r=0):(t=t.slice(0,d),r=t.length-1-t.lastIndexOf("/")),i=u,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,i=u,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+n.slice(i+1,u):t=n.slice(i+1,u),r=u-i-1;i=u,s=0}else o===46&&s!==-1?++s:s=-1}return t}function pK(n,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+n+r:r}var ql={resolve:function(){for(var e="",t=!1,r,i=arguments.length-1;i>=-1&&!t;i--){var s;i>=0?s=arguments[i]:(r===void 0&&(r=process.cwd()),s=r),ms(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=qP(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(ms(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=qP(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return ms(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];ms(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":ql.normalize(e)},relative:function(e,t){if(ms(e),ms(t),e===t||(e=ql.resolve(e),t=ql.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var i=e.length,s=i-r,o=1;o<t.length&&t.charCodeAt(o)===47;++o);for(var u=t.length,d=u-o,f=s<d?s:d,m=-1,g=0;g<=f;++g){if(g===f){if(d>f){if(t.charCodeAt(o+g)===47)return t.slice(o+g+1);if(g===0)return t.slice(o+g)}else s>f&&(e.charCodeAt(r+g)===47?m=g:g===0&&(m=0));break}var P=e.charCodeAt(r+g),D=t.charCodeAt(o+g);if(P!==D)break;P===47&&(m=g)}var M="";for(g=r+m+1;g<=i;++g)(g===i||e.charCodeAt(g)===47)&&(M.length===0?M+="..":M+="/..");return M.length>0?M+t.slice(o+m):(o+=m,t.charCodeAt(o)===47&&++o,t.slice(o))},_makeLong:function(e){return e},dirname:function(e){if(ms(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,i=-1,s=!0,o=e.length-1;o>=1;--o)if(t=e.charCodeAt(o),t===47){if(!s){i=o;break}}else s=!1;return i===-1?r?"/":".":r&&i===1?"//":e.slice(0,i)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');ms(e);var r=0,i=-1,s=!0,o;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var u=t.length-1,d=-1;for(o=e.length-1;o>=0;--o){var f=e.charCodeAt(o);if(f===47){if(!s){r=o+1;break}}else d===-1&&(s=!1,d=o+1),u>=0&&(f===t.charCodeAt(u)?--u===-1&&(i=o):(u=-1,i=d))}return r===i?i=d:i===-1&&(i=e.length),e.slice(r,i)}else{for(o=e.length-1;o>=0;--o)if(e.charCodeAt(o)===47){if(!s){r=o+1;break}}else i===-1&&(s=!1,i=o+1);return i===-1?"":e.slice(r,i)}},extname:function(e){ms(e);for(var t=-1,r=0,i=-1,s=!0,o=0,u=e.length-1;u>=0;--u){var d=e.charCodeAt(u);if(d===47){if(!s){r=u+1;break}continue}i===-1&&(s=!1,i=u+1),d===46?t===-1?t=u:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||i===-1||o===0||o===1&&t===i-1&&t===r+1?"":e.slice(t,i)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return pK("/",e)},parse:function(e){ms(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),i=r===47,s;i?(t.root="/",s=1):s=0;for(var o=-1,u=0,d=-1,f=!0,m=e.length-1,g=0;m>=s;--m){if(r=e.charCodeAt(m),r===47){if(!f){u=m+1;break}continue}d===-1&&(f=!1,d=m+1),r===46?o===-1?o=m:g!==1&&(g=1):o!==-1&&(g=-1)}return o===-1||d===-1||g===0||g===1&&o===d-1&&o===u+1?d!==-1&&(u===0&&i?t.base=t.name=e.slice(1,d):t.base=t.name=e.slice(u,d)):(u===0&&i?(t.name=e.slice(1,o),t.base=e.slice(1,d)):(t.name=e.slice(u,o),t.base=e.slice(u,d)),t.ext=e.slice(o,d)),u>0?t.dir=e.slice(0,u-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};ql.posix=ql;var mK=ql;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var UP,zP;const qr=mK.posix,$P="header";class Fi{get type(){return Fi.Type}get attributes(){return Fi.Attributes}async load(e,t,r,i){const s=new sc(t,e,i);return await s.load(r),s}create(e,t){const r=new sc(t,e,Fi.Attributes);return r.initializeLocal(),r}}Fi.Type="https://graph.microsoft.com/types/directory";Fi.Attributes={type:Fi.Type,snapshotFormatVersion:"0.1",packageVersion:JF};class sc extends Gg{constructor(e,t,r){super(e,t,r,"fluid_directory_"),this[UP]="SharedDirectory",this.root=new Zm(this,this.runtime,this.serializer,qr.sep),this.messageHandlers=new Map,this.localValueMaker=new Kg(this.serializer),this.setMessageHandlers(),this.root.on("containedValueChanged",(i,s)=>{this.emit("containedValueChanged",i,s,this)}),this.root.on("subDirectoryCreated",(i,s)=>{this.emit("subDirectoryCreated",i,s,this)}),this.root.on("subDirectoryDeleted",(i,s)=>{this.emit("subDirectoryDeleted",i,s,this)})}static create(e,t){return e.createChannel(t,Fi.Type)}static getFactory(){return new Fi}get absolutePath(){return this.root.absolutePath}get(e){return this.root.get(e)}set(e,t){return this.root.set(e,t),this}dispose(e){this.root.dispose(e)}get disposed(){return this.root.disposed}delete(e){return this.root.delete(e)}clear(){this.root.clear()}has(e){return this.root.has(e)}get size(){return this.root.size}forEach(e){this.root.forEach(e)}[(UP=Symbol.toStringTag,Symbol.iterator)](){return this.root[Symbol.iterator]()}entries(){return this.root.entries()}countSubDirectory(){return this.root.countSubDirectory()}keys(){return this.root.keys()}values(){return this.root.values()}createSubDirectory(e){return this.root.createSubDirectory(e)}getSubDirectory(e){return this.root.getSubDirectory(e)}hasSubDirectory(e){return this.root.hasSubDirectory(e)}deleteSubDirectory(e){return this.root.deleteSubDirectory(e)}subdirectories(){return this.root.subdirectories()}getWorkingDirectory(e){const t=this.makeAbsolute(e);if(t===qr.sep)return this.root;let r=this.root;const i=t.substr(1).split(qr.sep);for(const s of i)if(r=r.getSubDirectory(s),!r)return;return r}summarizeCore(e,t){return this.serializeDirectory(this.root,e)}submitDirectoryMessage(e,t){this.submitLocalMessage(e,t)}onDisconnect(){}reSubmitCore(e,t){const r=e,i=this.messageHandlers.get(r.type);jt(i!==void 0,13),i.submit(r,t)}async loadCore(e){const t=await En(e,$P),r=t;Array.isArray(r.blobs)?(this.populate(r.content),await Promise.all(r.blobs.map(async i=>{const s=await En(e,i);this.populate(s)}))):this.populate(t)}populate(e){const t=[];for(t.push([this.root,e]);t.length>0;){const[r,i]=t.pop();if(i.subdirectories)for(const[s,o]of Object.entries(i.subdirectories)){let u=r.getSubDirectory(s);u||(u=new Zm(this,this.runtime,this.serializer,qr.join(r.absolutePath,s)),r.populateSubDirectory(s,u)),t.push([u,o])}if(i.storage)for(const[s,o]of Object.entries(i.storage)){const u=this.makeLocal(s,r.absolutePath,o);r.populateStorage(s,u)}}}processCore(e,t,r){if(e.type===Gm.Operation){const i=e.contents,s=this.messageHandlers.get(i.type);jt(s!==void 0,14),s.process(i,t,r)}}rollback(e,t){const r=e,i=this.getWorkingDirectory(r.path);i&&i.rollback(r,t)}makeAbsolute(e){return qr.resolve(qr.sep,e)}makeLocal(e,t,r){return jt(r.type===Vt[Vt.Plain]||r.type===Vt[Vt.Shared],484),this.localValueMaker.fromSerializable(r)}setMessageHandlers(){this.messageHandlers.set("clear",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processClearMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitClearMessage(e,t)}}),this.messageHandlers.set("delete",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processDeleteMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("set",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);if(i){const s=t?void 0:this.makeLocal(e.key,e.path,e.value);i.processSetMessage(e,s,t,r)}},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("createSubDirectory",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processCreateSubDirectoryMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitSubDirectoryMessage(e,t)}}),this.messageHandlers.set("deleteSubDirectory",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processDeleteSubDirectoryMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitSubDirectoryMessage(e,t)}})}applyStashedOp(){throw new Error("not implemented")}serializeDirectory(e,t,r){const s=new Tr;let o=0;const u=[],d=[],f={};for(d.push([e,f]);d.length>0;){const[g,P]=d.pop();for(const[D,M]of g.getSerializedStorage(t)){P.storage||(P.storage={});const U={type:M.type,value:M.value&&JSON.parse(M.value)};if(M.value&&M.value.length>=8192){const j={};let E=j;if(g.absolutePath!==qr.sep)for(const z of g.absolutePath.substr(1).split(qr.sep)){const K={};E.subdirectories={[z]:K},E=K}E.storage={[D]:U};const k=`blob${o}`;o++,u.push(k),s.addBlob(k,JSON.stringify(j))}else P.storage[D]=U}for(const[D,M]of g.subdirectories()){P.subdirectories||(P.subdirectories={});const U={};P.subdirectories[D]=U,d.push([M,U])}}const m={blobs:u,content:f};return s.addBlob($P,JSON.stringify(m)),s.getSummaryTree()}}function sS(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&n.type==="edit"}function HP(n){return n!==void 0&&n.type==="clear"&&typeof n.pendingMessageId=="number"&&typeof n.previousStorage=="object"}function VP(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="createSubDir"&&typeof n.previouslyExisted=="boolean"||n.type==="deleteSubDir")}function gK(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="edit"||n.type==="deleteSubDir"||n.type==="clear"&&typeof n.previousStorage=="object"||n.type==="createSubDir"&&typeof n.previouslyExisted=="boolean")}class Zm extends dK{constructor(e,t,r,i){super(),this.directory=e,this.runtime=t,this.serializer=r,this.absolutePath=i,this._deleted=!1,this[zP]="SubDirectory",this._storage=new Map,this._subdirectories=new Map,this.pendingKeys=new Map,this.pendingSubDirectories=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[]}dispose(e){this._deleted=!0,this.emit("disposed",this)}undispose(){this._deleted=!1}get disposed(){return this._deleted}throwIfDisposed(){if(this._deleted)throw new Ct("Cannot access Disposed subDirectory")}has(e){return this.throwIfDisposed(),this._storage.has(e)}get(e){var t;return this.throwIfDisposed(),(t=this._storage.get(e))===null||t===void 0?void 0:t.value}set(e,t){if(this.throwIfDisposed(),e==null)throw new Error("Undefined and null keys are not supported");const r=this.directory.localValueMaker.fromInMemory(t),i=Yb(r,this.serializer,this.directory.handle),s=this.setCore(e,r,!0);if(!this.directory.isAttached())return this;const o={key:e,path:this.absolutePath,type:"set",value:i};return this.submitKeyMessage(o,s),this}countSubDirectory(){return this._subdirectories.size}createSubDirectory(e){if(this.throwIfDisposed(),e==null)throw new Error("SubDirectory name may not be undefined or null");if(e.includes(qr.sep))throw new Error(`SubDirectory name may not contain ${qr.sep}`);const t=this.createSubDirectoryCore(e,!0),r=this._subdirectories.get(e);if(!this.directory.isAttached())return r;const i={path:this.absolutePath,subdirName:e,type:"createSubDirectory"};return this.submitCreateSubDirectoryMessage(i,!t),r}getSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.get(e)}hasSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.has(e)}deleteSubDirectory(e){this.throwIfDisposed();const t=this.deleteSubDirectoryCore(e,!0);if(!this.directory.isAttached())return t!==void 0;const r={path:this.absolutePath,subdirName:e,type:"deleteSubDirectory"};return this.submitDeleteSubDirectoryMessage(r,t),t!==void 0}subdirectories(){return this.throwIfDisposed(),this._subdirectories.entries()}getWorkingDirectory(e){return this.throwIfDisposed(),this.directory.getWorkingDirectory(this.makeAbsolute(e))}delete(e){this.throwIfDisposed();const t=this.deleteCore(e,!0);if(!this.directory.isAttached())return t!==void 0;const r={key:e,path:this.absolutePath,type:"delete"};return this.submitKeyMessage(r,t),t!==void 0}clear(){if(this.throwIfDisposed(),!this.directory.isAttached()){this.clearCore(!0);return}const e=new Map(this._storage);this.clearCore(!0);const t={path:this.absolutePath,type:"clear"};this.submitClearMessage(t,e)}forEach(e){this.throwIfDisposed(),this._storage.forEach((t,r,i)=>{e(t.value,r,i)})}get size(){return this.throwIfDisposed(),this._storage.size}entries(){this.throwIfDisposed();const e=this._storage.entries();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:[r.value[0],r.value[1].value],done:!1}},[Symbol.iterator](){return this}}}keys(){return this.throwIfDisposed(),this._storage.keys()}values(){this.throwIfDisposed();const e=this._storage.values();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:r.value.value,done:!1}},[Symbol.iterator](){return this}}}[(zP=Symbol.toStringTag,Symbol.iterator)](){return this.throwIfDisposed(),this.entries()}processClearMessage(e,t,r){if(this.throwIfDisposed(),t){jt(HP(r),15);const i=this.pendingClearMessageIds.shift();jt(i===r.pendingMessageId,810);return}this.clearExceptPendingKeys()}processDeleteMessage(e,t,r){this.throwIfDisposed(),this.needProcessStorageOperation(e,t,r)&&this.deleteCore(e.key,t)}processSetMessage(e,t,r,i){this.throwIfDisposed(),this.needProcessStorageOperation(e,r,i)&&this.setCore(e.key,t,r)}processCreateSubDirectoryMessage(e,t,r){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,r)&&this.createSubDirectoryCore(e.subdirName,t)}processDeleteSubDirectoryMessage(e,t,r){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,r)&&this.deleteSubDirectoryCore(e.subdirName,t)}submitClearMessage(e,t){this.throwIfDisposed();const r=++this.pendingMessageId;this.pendingClearMessageIds.push(r);const i={type:"clear",pendingMessageId:r,previousStorage:t};this.directory.submitDirectoryMessage(e,i)}resubmitClearMessage(e,t){jt(HP(t),811);const r=this.pendingClearMessageIds.shift();jt(r===t.pendingMessageId,812),this.submitClearMessage(e,t.previousStorage)}getKeyMessageId(e){const t=++this.pendingMessageId,r=this.pendingKeys.get(e.key);return r!==void 0?r.push(t):this.pendingKeys.set(e.key,[t]),t}submitKeyMessage(e,t){this.throwIfDisposed();const i={type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:t};this.directory.submitDirectoryMessage(e,i)}resubmitKeyMessage(e,t){jt(sS(t),813);const r=this.pendingKeys.get(e.key);jt(r!==void 0&&r[0]===t.pendingMessageId,814),r.shift(),r.length===0&&this.pendingKeys.delete(e.key),this.submitKeyMessage(e,t.previousValue)}getSubDirMessageId(e){const t=++this.pendingMessageId,r=this.pendingSubDirectories.get(e.subdirName);return r!==void 0?r.push(t):this.pendingSubDirectories.set(e.subdirName,[t]),t}submitCreateSubDirectoryMessage(e,t){this.throwIfDisposed();const i={type:"createSubDir",pendingMessageId:this.getSubDirMessageId(e),previouslyExisted:t};this.directory.submitDirectoryMessage(e,i)}submitDeleteSubDirectoryMessage(e,t){this.throwIfDisposed();const i={type:"deleteSubDir",pendingMessageId:this.getSubDirMessageId(e),subDirectory:t};this.directory.submitDirectoryMessage(e,i)}resubmitSubDirectoryMessage(e,t){jt(VP(t),815);const r=this.pendingSubDirectories.get(e.subdirName);jt(r!==void 0&&r[0]===t.pendingMessageId,816),r.shift(),r.length===0&&this.pendingSubDirectories.delete(e.subdirName),t.type==="createSubDir"?this.submitCreateSubDirectoryMessage(e,t.previouslyExisted):this.submitDeleteSubDirectoryMessage(e,t.subDirectory)}*getSerializedStorage(e){this.throwIfDisposed();for(const[t,r]of this._storage){const i=r.makeSerialized(e,this.directory.handle);yield[t,i]}}populateStorage(e,t){this.throwIfDisposed(),this._storage.set(e,t)}populateSubDirectory(e,t){this.throwIfDisposed(),this._subdirectories.set(e,t)}getLocalValue(e){return this.throwIfDisposed(),this._storage.get(e)}rollbackPendingMessageId(e,t,r){const i=e.get(t),s=i==null?void 0:i.pop();if(!i||s!==r)throw new Error("Rollback op does not match last pending");i.length===0&&e.delete(t)}rollback(e,t){if(!gK(t))throw new Error("Invalid localOpMetadata");if(e.type==="clear"&&t.type==="clear"){t.previousStorage.forEach((i,s)=>{this.setCore(s,i,!0)});const r=this.pendingClearMessageIds.pop();if(r===void 0||r!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if((e.type==="delete"||e.type==="set")&&t.type==="edit")t.previousValue===void 0?this.deleteCore(e.key,!0):this.setCore(e.key,t.previousValue,!0),this.rollbackPendingMessageId(this.pendingKeys,e.key,t.pendingMessageId);else if(e.type==="createSubDirectory"&&t.type==="createSubDir")t.previouslyExisted||this.deleteSubDirectoryCore(e.subdirName,!0),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else if(e.type==="deleteSubDirectory"&&t.type==="deleteSubDir")t.subDirectory!==void 0&&(this.undeleteSubDirectoryTree(t.subDirectory),this._subdirectories.set(e.subdirName,t.subDirectory),this.emit("subDirectoryCreated",e.subdirName,!0,this)),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else throw new Error("Unsupported op for rollback")}makeAbsolute(e){return qr.resolve(this.absolutePath,e)}needProcessStorageOperation(e,t,r){if(this.pendingClearMessageIds.length>0)return t&&jt(r!==void 0&&sS(r)&&r.pendingMessageId<this.pendingClearMessageIds[0],16),!1;if(this.pendingKeys.get(e.key)!==void 0){if(t){jt(r!==void 0&&sS(r),17);const s=this.pendingKeys.get(e.key);jt(s!==void 0&&s[0]===r.pendingMessageId,817),s.shift(),s.length===0&&this.pendingKeys.delete(e.key)}return!1}return!t}needProcessSubDirectoryOperation(e,t,r){if(this.pendingSubDirectories.get(e.subdirName)!==void 0){if(t){jt(VP(r),18);const s=this.pendingSubDirectories.get(e.subdirName);jt(s!==void 0&&s[0]===r.pendingMessageId,818),s.shift(),s.length===0&&this.pendingSubDirectories.delete(e.subdirName)}return!1}return!t}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach((t,r,i)=>{e.set(r,this._storage.get(r))}),this.clearCore(!1),e.forEach((t,r,i)=>{this.setCore(r,t,!0)})}clearCore(e){this._storage.clear(),this.directory.emit("clear",e,this.directory)}deleteCore(e,t){const r=this._storage.get(e),i=r==null?void 0:r.value;if(this._storage.delete(e)){const o={key:e,path:this.absolutePath,previousValue:i};this.directory.emit("valueChanged",o,t,this.directory);const u={key:e,previousValue:i};this.emit("containedValueChanged",u,t,this)}return r}setCore(e,t,r){const i=this._storage.get(e),s=i==null?void 0:i.value;this._storage.set(e,t);const o={key:e,path:this.absolutePath,previousValue:s};this.directory.emit("valueChanged",o,r,this.directory);const u={key:e,previousValue:s};return this.emit("containedValueChanged",u,r,this),i}createSubDirectoryCore(e,t){if(!this._subdirectories.has(e)){const r=qr.join(this.absolutePath,e),i=new Zm(this.directory,this.runtime,this.serializer,r);return this.registerEventsOnSubDirectory(i,e),this._subdirectories.set(e,i),this.emit("subDirectoryCreated",e,t,this),!0}return!1}registerEventsOnSubDirectory(e,t){e.on("subDirectoryCreated",(r,i)=>{this.emit("subDirectoryCreated",qr.join(t,r),i,this)}),e.on("subDirectoryDeleted",(r,i)=>{this.emit("subDirectoryDeleted",qr.join(t,r),i,this)})}deleteSubDirectoryCore(e,t){const r=this._subdirectories.get(e);return r!==void 0&&(this._subdirectories.delete(e),this.disposeSubDirectoryTree(r),this.emit("subDirectoryDeleted",e,t,this)),r}disposeSubDirectoryTree(e){if(!e)return;const t=e.subdirectories();for(const[r,i]of t)this.disposeSubDirectoryTree(i);typeof e.dispose=="function"&&e.dispose()}undeleteSubDirectoryTree(e){for(const[t,r]of this._subdirectories.entries())this.undeleteSubDirectoryTree(r);e.undispose()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const vK=Object.freeze(Object.defineProperty({__proto__:null,DirectoryFactory:Fi,LocalValueMaker:Kg,MapFactory:hi,SharedDirectory:sc,SharedMap:Ih},Symbol.toStringTag,{value:"Module"}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const WP="IFluidDependencySynthesizer";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Jg{constructor(...e){this.providers=new Map,this.parents=e.filter(t=>t!==void 0)}get IFluidDependencySynthesizer(){return this}register(e,t){if(this.providers.has(e))throw new Error(`Attempting to register a provider of type ${e} that already exists`);this.providers.set(e,t)}unregister(e){this.providers.has(e)&&this.providers.delete(e)}synthesize(e,t){const r={};return this.generateRequired(r,t),this.generateOptional(r,e),Object.defineProperty(r,WP,{get:()=>this}),r}has(e,t){return this.providers.has(e)?!0:t!==!0?this.parents.some(r=>r.has(e)):!1}getProvider(e){if(this.has(e)){if(this.providers.has(e))return this.providers.get(e);for(const t of this.parents){if(t instanceof Jg)return t.getProvider(e);{const r=t;if((r==null?void 0:r.getProvider)!==void 0)return r.getProvider(e)}}}}generateRequired(e,t){if(t!==void 0)for(const r of Object.keys(t)){const i=this.resolveProvider(r);if(i===void 0)throw new Error(`Object attempted to be created without registered required provider ${r}`);Object.defineProperty(e,r,i)}}generateOptional(e,t){var r;if(t!==void 0)for(const i of Object.keys(t)){const s=(r=this.resolveProvider(i))!==null&&r!==void 0?r:{get:async()=>{}};Object.defineProperty(e,i,s)}}resolveProvider(e){const t=this.providers.get(e);if(t===void 0){for(const r of this.parents){const i={[e]:e},s=r.synthesize(i,{}),o=Object.getOwnPropertyDescriptor(s,e);if(o!==void 0)return o}return}return typeof t=="function"?{get(){if(t&&typeof t=="function")return Promise.resolve(this[WP]).then(async r=>t(r)).then(r=>r==null?void 0:r[e])}}:{get(){if(t)return Promise.resolve(t).then(r=>{if(r)return r[e]})}}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function oS(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let yK=class extends Fn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Hx=class ja extends yK{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,e!==void 0){const t=i=>this.unforwardEvent(e,i),r=i=>this.forwardEvent(e,i);this.on(ja.removeListenerEvent,t),this.on(ja.newListenerEvent,r)}}static isEmitterEvent(e){return e===ja.newListenerEvent||e===ja.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(e!==void 0&&r!==void 0&&!ja.isEmitterEvent(r)){let i=this.forwardingEvents.get(r);if(i===void 0&&(i=new Map,this.forwardingEvents.set(r,i)),!i.has(e)){const s=(...o)=>this.emit(r,...o);i.set(e,()=>e.off(r,s)),e.on(r,s)}}}unforwardEvent(e,...t){for(const r of t)if(r!==void 0&&!ja.isEmitterEvent(r)){const i=this.forwardingEvents.get(r);if(i!=null&&i.has(e)&&this.listenerCount(r)===0){const s=i.get(e);s!==void 0&&s(),i.delete(e),i.size===0&&this.forwardingEvents.delete(r)}}}};Hx.newListenerEvent="newListener";Hx.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function SK(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class bK{constructor(e,t){this.absolutePath=e,this.runtime=t,this.isAttached=!0}get IFluidHandle(){return this}attachGraph(){SK(!1,202)}async get(){const e=await this.runtime.IFluidHandleContext.resolveHandle({url:this.absolutePath});if(e.status===200&&e.mimeType==="fluid/object")return e.value;throw new Error(`Failed to resolve container path ${this.absolutePath}`)}bind(e){throw new Error("Cannot bind to LegacyUriHandle")}}function wK(n,e){return new bK(n,e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class CK{constructor(){this.handlers=[]}pushHandler(...e){e!==void 0&&this.handlers.push(...e)}async handleRequest(e,t){const r=ns.create(e);for(const i of this.handlers){const s=await i(r,t);if(s!==void 0)return s}return si(e)}}function QF(...n){const e=new CK;return e.pushHandler(...n),async(t,r)=>e.handleRequest(t,r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Vx="_services";class xK{constructor(e){this.runtime=e}get IFluidRouter(){return this}async request(e){return{status:200,mimeType:"fluid/object",value:this}}}class EK{constructor(e){this.serviceFn=e}async getService(e){return this.service||(this.service=this.serviceFn(e)),this.service}}const TK=n=>{const e=new Map;return new Map(n).forEach((t,r)=>{e.set(r,new EK(t))}),async(t,r)=>{if(t.pathParts[0]!==Vx)return;if(t.pathParts.length<2)return Eh(400,"request did not specify a service to route to",t);const i=e.get(t.pathParts[1]);if(!i)return si(t);const s=await i.getService(r),o=s.IFluidRouter,u=t.createSubRequest(2);return o?o.request(u):t.isLeaf(2)?{status:200,mimeType:"fluid/object",value:s}:Eh(400,"request sub-url for service that doesn't support routing",t)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const PK=(n,e)=>{const t=QF(...e);return async(r,i)=>{var s;const o=((s=r.headers)===null||s===void 0?void 0:s.mountableView)===!0;let u=r;if(o){const f=Object.assign({},r.headers);delete f.mountableView,u={url:r.url,headers:f}}const d=await t(u,i);return o&&d.status===200&&n.canMount(d.value)?{status:200,mimeType:"fluid/object",value:new n(d.value)}:d}},Wx=n=>async(e,t)=>{const r=ns.create(e);if(r.pathParts.length===0)return t.IFluidHandleContext.resolveHandle({url:`/${n}${r.query}`,headers:e.headers})};function XF(n,e){return e.url===""||e.url==="/"||e.url.startsWith("/?")?{mimeType:"fluid/object",status:200,value:n}:si(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Gx extends Hx{constructor(e){super(),this._disposed=!1,this.runtime=e.runtime,this.context=e.context,this.providers=e.providers,this.initProps=e.initProps,oS(this.runtime._dataObject===void 0,189),this.runtime._dataObject=this,this.innerHandle=new jl(this,"",this.runtime.objectsRoutingContext),this.runtime.once("dispose",()=>{this._disposed=!0,this.dispose()})}get disposed(){return this._disposed}get id(){return this.runtime.id}get IFluidRouter(){return this}get IFluidLoadable(){return this}get IFluidHandle(){return this.innerHandle}get handle(){return this.innerHandle}static async getDataObject(e){const t=e._dataObject;return oS(t!==void 0,188),await t.finishInitialization(!0),t}async request(e){return XF(this,e)}async finishInitialization(e){return this.initializeP!==void 0?this.initializeP:(this.initializeP=this.initializeInternal(e),this.initializeP)}async initializeInternal(e){var t;await this.preInitialize(),e?(oS(this.initProps===void 0,190),await this.initializingFromExisting()):await this.initializingFirstTime((t=this.context.createProps)!==null&&t!==void 0?t:this.initProps),await this.hasInitialized()}async getFluidObjectFromDirectory(e,t,r){const i=r?r(e,t):t.get(e),s=i==null?void 0:i.IFluidHandle;if(s)return s.get()}async getService(e){return wK(`/${Vx}/${e}`,this.context.containerRuntime).get()}async preInitialize(){}async initializingFirstTime(e){}async initializingFromExisting(){}async hasInitialized(){}dispose(){super.dispose()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class YF extends Gx{constructor(){super(...arguments),this.rootDirectoryId="root"}async request(e){const t=ns.create(e);if(t.pathParts[0]==="bigBlobs"){const i=this.root.get(t.pathParts.join("/"));return i===void 0?si(t):{mimeType:"fluid/object",status:200,value:i}}else return super.request(t)}get root(){if(!this.internalRoot)throw new Error(this.getUninitializedErrorString("root"));return this.internalRoot}async initializeInternal(e){e?(this.internalRoot=await this.runtime.getChannel(this.rootDirectoryId),this.internalRoot.attributes.type===hi.Type&&this.runtime.logger.send({category:"generic",eventName:"MapDataObject",message:"Legacy document, SharedMap is masquerading as SharedDirectory in DataObject"})):(this.internalRoot=sc.create(this.runtime,this.rootDirectoryId),this.internalRoot.bindToContext()),await super.initializeInternal(e)}getUninitializedErrorString(e){return`${e} must be initialized before being accessed.`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function GP(n,e,t,r,i,s,o){let u=i;u=QW(async(D,M)=>(await Gx.getDataObject(M)).request(D),u);const d=new u(e,t,s),f=e.scope,g=new Jg(f.IFluidDependencySynthesizer).synthesize(r,{}),P=new n({runtime:d,context:e,providers:g,initProps:o});return s||await P.finishInitialization(s),{instance:P,runtime:d}}class ZF{constructor(e,t,r,i,s,o=Qh){if(this.type=e,this.ctor=t,this.optionalProviders=i,this.runtimeClass=o,this.type==="")throw new Error("undefined type member");s!==void 0&&(this.registry=new Dx(s)),this.sharedObjectRegistry=new Map(r.map(u=>[u.type,u]))}get IFluidDataStoreFactory(){return this}get IFluidDataStoreRegistry(){return this.registry}get registryEntry(){return[this.type,Promise.resolve(this)]}async instantiateDataStore(e,t){const{runtime:r}=await GP(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,t);return r}async createChildInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,[...e.packagePath,this.type],t)}async createPeerInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,e.packagePath,t)}async createInstance(e,t){return this.createNonRootInstanceCore(e,[this.type],t)}async createRootInstance(e,t,r){const i=t.createDetachedRootDataStore([this.type],e);return this.createInstanceCore(i,r)}async createNonRootInstanceCore(e,t,r){const i=e.createDetachedDataStore(t);return this.createInstanceCore(i,r)}async createInstanceCore(e,t){const{instance:r,runtime:i}=await GP(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,!1,t);return await e.attachRuntime(this,i),r}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class e3 extends ZF{constructor(e,t,r=[],i,s,o=Qh){const u=[...r];r.find(d=>d.type===Fi.Type)||u.push(sc.getFactory()),r.find(d=>d.type===hi.Type)||u.push(Ih.getFactory()),super(e,t,u,i,s,o)}}var t3={},Qg={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Qg,"__esModule",{value:!0});Qg.IContainerRuntime=void 0;Qg.IContainerRuntime="IContainerRuntime";(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Ne&&Ne.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s),Object.defineProperty(r,o,{enumerable:!0,get:function(){return i[s]}})}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=Ne&&Ne.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(Qg,n)})(t3);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Kx extends yF{constructor(e,t,r=[],i){super(),this.registryEntries=e,this.dependencyContainer=t,this.requestHandlers=r,this.runtimeOptions=i,this.registry=new Dx(e)}get IFluidDataStoreRegistry(){return this.registry}async instantiateFirstTime(e){await this.containerInitializingFirstTime(e),await this.containerHasInitialized(e)}async instantiateFromExisting(e){await this.containerHasInitialized(e)}async preInitialize(e,t){const r=e.scope,i=new Jg(this.dependencyContainer,r.IFluidDependencySynthesizer);r.IFluidDependencySynthesizer=i;const s=await $x.load(e,this.registryEntries,QF(...this.requestHandlers),this.runtimeOptions,r,t);return i.register(t3.IContainerRuntime,s),s}async containerInitializingFirstTime(e){}async containerHasInitialized(e){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Zb="default";class n3 extends Kx{constructor(e,t,r,i=[],s){super(t,r,[Wx(Zb),...i],s),this.defaultFactory=e}async containerInitializingFirstTime(e){await(await e.createDataStore(this.defaultFactory.type)).trySetAlias(Zb)}}n3.defaultDataStoreId=Zb;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function RK(n){if(n.attachState!==Qe.Attached)return new Promise(e=>{n.once("attached",()=>{Promise.resolve().then(()=>e()).catch(()=>{})})})}async function _K(n){const e="/",t=await n.request({url:e});if(t.status!==200||t.mimeType!=="fluid/object")throw new Error(`Unable to retrieve Fluid object at URL: "${e}"`);if(t.value===void 0)throw new Error(`Empty response from URL: "${e}"`);return t.value}async function IK(n,e){const t=`/${n}`,r=await e.request({url:t});if(r.status!==200||r.mimeType!=="fluid/object")throw new Error(`Unable to retrieve Fluid object with ID: "${n}" from URL: "${t}"`);if(r.value===void 0)throw new Error(`Empty response for ID: "${n}" from URL: "${t}"`);return r.value}async function AK(n,e){const t=await e.request({url:n});if(t.status!==200||t.mimeType!=="fluid/object")throw new Error(`Unable to retrieve Fluid object with from URL: "${n}"`);if(t.value===void 0)throw new Error(`Empty response for from URL: "${n}"`);return t.value}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const kK=Object.freeze(Object.defineProperty({__proto__:null,BaseContainerRuntimeFactory:Kx,BaseContainerService:xK,ContainerRuntimeFactoryWithDefaultDataStore:n3,DataObject:YF,DataObjectFactory:e3,PureDataObject:Gx,PureDataObjectFactory:ZF,defaultFluidObjectRequestHandler:XF,defaultRouteRequestHandler:Wx,generateContainerServicesRequestHandler:TK,getDefaultObjectFromContainer:_K,getObjectFromContainer:AK,getObjectWithIdFromContainer:IK,mountableViewRequestHandler:PK,serviceRoutePathRoot:Vx,waitForAttach:RK},Symbol.toStringTag,{value:"Module"}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const r3=n=>(n==null?void 0:n.factory)!==void 0,i3=n=>(n==null?void 0:n.getFactory)!==void 0,OK=n=>{var e;const t=new Set,r=new Set,i=o=>{if(i3(o))r.add(o.getFactory());else if(r3(o))t.add([o.factory.type,Promise.resolve(o.factory)]);else throw new Error("Entry is neither a DataObject or a SharedObject")};if(new Set([...Object.values(n.initialObjects),...(e=n.dynamicObjectTypes)!==null&&e!==void 0?e:[]]).forEach(i),t.size===0&&r.size===0)throw new Error("Container cannot be initialized without any DataTypes");return[Array.from(t),Array.from(r)]};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class s3 extends YF{constructor(){super(...arguments),this.initialObjectsDirKey="initial-objects-key",this._initialObjects={}}get initialObjectsDir(){const e=this.root.getSubDirectory(this.initialObjectsDirKey);if(e===void 0)throw new Error("InitialObjects sub-directory was not initialized");return e}async initializingFirstTime(e){this.root.createSubDirectory(this.initialObjectsDirKey);const t=[];Object.entries(e.initialObjects).forEach(([r,i])=>{const s=async()=>{const o=await this.create(i);this.initialObjectsDir.set(r,o.handle)};t.push(s())}),await Promise.all(t)}async hasInitialized(){const e=[];for(const[t,r]of Array.from(this.initialObjectsDir.entries())){const i=async()=>{const s=await r.get();Object.assign(this._initialObjects,{[t]:s})};e.push(i())}await Promise.all(e)}get initialObjects(){if(Object.keys(this._initialObjects).length===0)throw new Error("Initial Objects were not correctly initialized");return this._initialObjects}async create(e){if(r3(e))return this.createDataObject(e);if(i3(e))return this.createSharedObject(e);throw new Error("Could not create new Fluid object because an unknown object was passed")}async createDataObject(e){const t=e.factory,r=[...this.context.packagePath,t.type],i=await this.context.containerRuntime.createDataStore(r);return ic(i,"/")}createSharedObject(e){const t=e.getFactory();return this.runtime.createChannel(void 0,t.type)}}const KP="rootDOId";class o3 extends Kx{constructor(e){const[t,r]=OK(e),i=new e3("rootDO",s3,r,{},t);super([i.registryEntry],void 0,[Wx(KP)],{flushMode:nt.FlushMode.Immediate}),this.rootDataObjectFactory=i,this.initialObjects=e.initialObjects}async containerInitializingFirstTime(e){await this.rootDataObjectFactory.createRootInstance(KP,e,{initialObjects:this.initialObjects})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class a3 extends pF{constructor(e){super(),this.container=e,this.lastMembers=new Map,this.audience=e.audience,this.getMembers(),this.audience.on("addMember",(t,r)=>{if(this.shouldIncludeAsMember(r)){const i=this.getMember(t);this.emit("memberAdded",t,i),this.emit("membersChanged")}}),this.audience.on("removeMember",t=>{this.lastMembers.has(t)&&(this.emit("memberRemoved",t,this.lastMembers.get(t)),this.emit("membersChanged"))}),this.container.on("connected",()=>this.emit("membersChanged"))}getMembers(){const e=new Map,t=new Map;return this.audience.getMembers().forEach((r,i)=>{if(this.shouldIncludeAsMember(r)){const s=r.user.id;let o=e.get(s);o===void 0&&(o=this.createServiceMember(r),e.set(s,o)),o.connections.push({id:i,mode:r.mode}),t.set(i,o)}}),this.lastMembers=t,e}getMyself(){const e=this.container.clientId;if(e!==void 0)return this.getMember(e)}getMember(e){const t=this.audience.getMember(e);if(t===void 0)return;const i=this.getMembers().get(t==null?void 0:t.user.id);if(i===void 0)throw Error(`Attempted to fetch client ${e} that is not part of the current member list`);return i}shouldIncludeAsMember(e){return e.details.capabilities.interactive}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ci(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function FK(n,e){switch(e){case"base64":return yi(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const u3=(n,e)=>NK.from(n).toString(e);function JP(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let NK=class qa extends Uint8Array{toString(e){return FK(this,e)}static from(e,t,r){if(typeof e=="string")return qa.fromString(e,t);if(e!==null&&typeof e=="object"&&JP(e.buffer))return ci(e.byteOffset===0,0),ci(e.byteLength===e.buffer.byteLength,1),qa.fromArrayBuffer(e.buffer,t,r);if(JP(e))return qa.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new qa(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=js(r);return new qa(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new qa(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let l3=class extends Fn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let DK=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var ew;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(ew||(ew={}));var QP;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(QP||(QP={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Ge(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function LK(n,e){switch(e){case"base64":return yi(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const tw=(n,e)=>MK.from(n).toString(e);function XP(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let MK=class Ua extends Uint8Array{toString(e){return LK(this,e)}static from(e,t,r){if(typeof e=="string")return Ua.fromString(e,t);if(e!==null&&typeof e=="object"&&XP(e.buffer))return Ge(e.byteOffset===0,0),Ge(e.byteLength===e.buffer.byteLength,1),Ua.fromArrayBuffer(e.buffer,t,r);if(XP(e))return Ua.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Ua(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=js(r);return new Ua(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Ua(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const YP=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Yu=class c3{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=YP.now();return new c3(e)}trace(){const e=YP.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function BK(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Jx{constructor(){this.items=[]}push(e){this.items.push(e)}empty(){return this.items.length===0}top(){return this.items[this.items.length-1]}pop(){return this.items.pop()}}function d3(n){if(n!==void 0){{if(n.isHead)return;n.next.prev=n.prev,n.prev.next=n.next}return n}}function ZP(n){return new h3(!1,n)}function Pl(){return new h3(!0,void 0)}class h3{constructor(e,t){this.isHead=e,this.data=t,this.prev=this,this.next=this}clear(){this.isHead&&(this.prev=this,this.next=this)}add(e){const t=ZP(e);return this.prev.next=t,t.next=this,t.prev=this.prev,this.prev=t,t}dequeue(){if(!this.empty())return d3(this.next).data}enqueue(e){return this.add(e)}walk(e){for(let t=this.next;!t.isHead;t=t.next)e(t.data,t)}some(e,t){const r=[],i=t?this.prev:this.next;for(let s=i;!s.isHead;s=t?s.prev:s.next){const o=s.data;e(o,s)&&(t?r.unshift(o):r.push(o))}return r}count(){let e,t;for(e=this.next,t=0;!e.isHead;t++)e=e.next;return t}first(){if(!this.empty())return this.next.data}last(){if(!this.empty())return this.prev.data}empty(){return this.next===this}push(e){this.unshift(e)}unshift(e){const t=ZP(e);t.data=e,t.isHead=!1,t.next=this.next,t.prev=this,this.next=t,t.next.prev=t}[Symbol.iterator](){let e=this;return{next(){for(;e&&e.next.isHead===!1;)if(e=e.next,e.data!==void 0)return{value:e.data,done:!1};return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}}let eR=class{constructor(e,t){this.comp=t,this.L=[t.min];for(let r=0,i=e.length;r<i;r++)this.add(e[r])}count(){return this.L.length-1}peek(){return this.L[1]}get(){const e=this.L[1];return this.L[1]=this.L[this.count()],this.L.pop(),this.fixDown(1),e}add(e){this.L.push(e),this.fixup(this.count())}fixup(e){let t=e;for(;t>1&&this.comp.compare(this.L[t>>1],this.L[t])>0;){const r=this.L[t>>1];this.L[t>>1]=this.L[t],this.L[t]=r,t=t>>1}}fixDown(e){let t=e;for(;t<<1<=this.count();){let r=t<<1;if(r<this.count()&&this.comp.compare(this.L[r],this.L[r+1])>0&&r++,this.comp.compare(this.L[t],this.L[r])<=0)break;const i=this.L[t];this.L[t]=this.L[r],this.L[r]=i,t=r}}};const _r={RED:0,BLACK:1};class Ah{constructor(e,t){this.compareKeys=e,this.aug=t}makeNode(e,t,r,i){return{key:e,data:t,color:r,size:i}}isRed(e){return!!e&&e.color===_r.RED}nodeSize(e){return e?e.size:0}size(){return this.nodeSize(this.root)}isEmpty(){return!this.root}get(e){if(e!==void 0)return this.nodeGet(this.root,e)}nodeGet(e,t){let r=e;for(;r;){const i=this.compareKeys(t,r.key);if(i<0)r=r.left;else if(i>0)r=r.right;else return r}}contains(e){return this.get(e)}gather(e,t){const r=[];return e!==void 0&&this.nodeGather(this.root,r,e,t),r}nodeGather(e,t,r,i){e&&(i.continueSubtree(e.left,r)&&this.nodeGather(e.left,t,r,i),i.matchNode(e,r)&&t.push(e),i.continueSubtree(e.right,r)&&this.nodeGather(e.right,t,r,i))}walkExactMatchesForward(e,t,r,i){this.nodeWalkExactMatchesForward(this.root,e,t,r,i)}nodeWalkExactMatchesForward(e,t,r,i,s){if(!e)return;const o=t(e);i(o)&&this.nodeWalkExactMatchesForward(e.left,t,r,i,s),o===0&&r(e),s(o)&&this.nodeWalkExactMatchesForward(e.right,t,r,i,s)}walkExactMatchesBackward(e,t,r,i){this.nodeWalkExactMatchesBackward(this.root,e,t,r,i)}nodeWalkExactMatchesBackward(e,t,r,i,s){if(!e)return;const o=t(e);s(o)&&this.nodeWalkExactMatchesBackward(e.right,t,r,i,s),o===0&&r(e),i(o)&&this.nodeWalkExactMatchesBackward(e.left,t,r,i,s)}put(e,t,r){e!==void 0&&(t===void 0?this.remove(e):(this.root=this.nodePut(this.root,e,t,r),this.root.color=_r.BLACK))}nodePut(e,t,r,i){let s=e;if(s){const o=this.compareKeys(t,s.key);if(o<0)s.left=this.nodePut(s.left,t,r,i);else if(o>0)s.right=this.nodePut(s.right,t,r,i);else if(i){const u=i(t,s.key,r,s.data);u.key&&(s.key=u.key),u.data?s.data=u.data:s.data=r}else s.data=r;return this.isRed(s.right)&&!this.isRed(s.left)&&(s=this.rotateLeft(s)),this.isRed(s.left)&&this.isRed(s.left.left)&&(s=this.rotateRight(s)),this.isRed(s.left)&&this.isRed(s.right)&&this.flipColors(s),s.size=this.nodeSize(s.left)+this.nodeSize(s.right)+1,this.aug&&this.updateLocal(s),s}else return this.makeNode(t,r,_r.RED,1)}updateLocal(e){this.aug&&(this.isRed(e.left)&&this.aug.update(e.left),this.isRed(e.right)&&this.aug.update(e.right),this.aug.update(e))}nodeRemoveMin(e){let t=e;if(t.left)return!this.isRed(t.left)&&!this.isRed(t.left.left)&&(t=this.moveRedLeft(t)),t.left=this.nodeRemoveMin(t.left),this.balance(t)}remove(e){if(e!==void 0){if(!this.contains(e))return;this.removeExisting(e)}}removeExisting(e){!this.isRed(this.root.left)&&!this.isRed(this.root.right)&&(this.root.color=_r.RED),this.root=this.nodeRemove(this.root,e)}nodeRemove(e,t){let r=e;if(this.compareKeys(t,r.key)<0)!this.isRed(r.left)&&!this.isRed(r.left.left)&&(r=this.moveRedLeft(r)),r.left=this.nodeRemove(r.left,t);else{if(this.isRed(r.left)&&(r=this.rotateRight(r)),this.compareKeys(t,r.key)===0&&!r.right)return;if(!this.isRed(r.right)&&!this.isRed(r.right.left)&&(r=this.moveRedRight(r)),this.compareKeys(t,r.key)===0){const i=this.nodeMin(r.right);r.key=i.key,r.data=i.data,r.right=this.nodeRemoveMin(r.right)}else r.right=this.nodeRemove(r.right,t)}return this.balance(r)}floor(e){if(!this.isEmpty())return this.nodeFloor(this.root,e)}nodeFloor(e,t){if(e){const r=this.compareKeys(t,e.key);if(r===0)return e;if(r<0)return this.nodeFloor(e.left,t);{const i=this.nodeFloor(e.right,t);return i||e}}}ceil(e){if(!this.isEmpty())return this.nodeCeil(this.root,e)}nodeCeil(e,t){if(e){const r=this.compareKeys(t,e.key);if(r===0)return e;if(r>0)return this.nodeCeil(e.right,t);{const i=this.nodeCeil(e.left,t);return i||e}}}min(){if(this.root)return this.nodeMin(this.root)}nodeMin(e){return e.left?this.nodeMin(e.left):e}max(){if(this.root)return this.nodeMax(this.root)}nodeMax(e){return e.right?this.nodeMax(e.right):e}rotateRight(e){const t=e.left;return e.left=t.right,t.right=e,t.color=t.right.color,t.right.color=_r.RED,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}rotateLeft(e){const t=e.right;return e.right=t.left,t.left=e,t.color=t.left.color,t.left.color=_r.RED,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}oppositeColor(e){return e===_r.BLACK?_r.RED:_r.BLACK}flipColors(e){e.color=this.oppositeColor(e.color),e.left.color=this.oppositeColor(e.left.color),e.right.color=this.oppositeColor(e.right.color)}moveRedLeft(e){let t=e;return this.flipColors(t),this.isRed(t.right.left)&&(t.right=this.rotateRight(t.right),t=this.rotateLeft(t),this.flipColors(t)),t}moveRedRight(e){let t=e;return this.flipColors(t),this.isRed(t.left.left)&&(t=this.rotateRight(t),this.flipColors(t)),t}balance(e){let t=e;return this.isRed(t.right)&&(t=this.rotateLeft(t)),this.isRed(t.left)&&this.isRed(t.left.left)&&(t=this.rotateRight(t)),this.isRed(t.left)&&this.isRed(t.right)&&this.flipColors(t),t.size=this.nodeSize(t.left)+this.nodeSize(t.right)+1,this.aug&&this.aug.update(t),t}mapRange(e,t,r,i){this.nodeMap(this.root,e,r,i)}map(e,t){this.nodeMap(this.root,e,t)}keys(){const e=[],t={showStructure:!0,infix:r=>(e.push(r.key),!0)};return this.walk(t),e}walk(e){this.nodeWalk(this.root,e)}walkBackward(e){this.nodeWalkBackward(this.root,e)}nodeWalk(e,t){let r=!0;return e&&(t.pre&&(t.showStructure||e.color===_r.BLACK)&&(r=t.pre(e)),e.left&&(r=this.nodeWalk(e.left,t)),r&&t.infix&&(t.showStructure||e.color===_r.BLACK)&&(r=t.infix(e)),r&&(r=this.nodeWalk(e.right,t)),r&&t.post&&(t.showStructure||e.color===_r.BLACK)&&(r=t.post(e))),r}nodeWalkBackward(e,t){let r=!0;return e&&(t.pre&&(t.showStructure||e.color===_r.BLACK)&&(r=t.pre(e)),e.right&&(r=this.nodeWalkBackward(e.right,t)),r&&t.infix&&(t.showStructure||e.color===_r.BLACK)&&(r=t.infix(e)),r&&(r=this.nodeWalkBackward(e.left,t)),r&&t.post&&(t.showStructure||e.color===_r.BLACK)&&(r=t.post(e))),r}nodeMap(e,t,r,i,s){let o=i,u=s;if(!e)return!0;o===void 0&&(o=this.nodeMin(e).key),u===void 0&&(u=this.nodeMax(e).key);const d=this.compareKeys(o,e.key),f=this.compareKeys(u,e.key);let m=!0;return d<0&&(m=this.nodeMap(e.left,t,r,o,u)),m&&d<=0&&f>=0&&(m=t(e,r)),m&&f>0&&(m=this.nodeMap(e.right,t,r,o,u)),m}}const jK=(n,e)=>n.compare(e);class qK{constructor(){this.intervals=new Ah(jK,this)}remove(e){this.intervals.remove(e)}removeExisting(e){this.intervals.removeExisting(e)}put(e,t){let r;t&&(r=(i,s)=>({key:t(i,s)})),this.intervals.put(e,{minmax:e.clone()},r)}map(e){const t={infix:r=>(e(r.key),!0),showStructure:!0};this.intervals.walk(t)}mapUntil(e){const t={infix:r=>e(r.key),showStructure:!0};this.intervals.walk(t)}mapBackward(e){const t={infix:r=>(e(r.key),!0),showStructure:!0};this.intervals.walkBackward(t)}match(e){return this.intervals.gather(e,this)}matchNode(e,t){return!!e&&e.key.overlaps(t)}continueSubtree(e,t){return!!e&&e.data.minmax.overlaps(t)}update(e){e.left&&e.right?e.data.minmax=e.key.union(e.left.data.minmax.union(e.right.data.minmax)):e.left?e.data.minmax=e.key.union(e.left.data.minmax):e.right?e.data.minmax=e.key.union(e.right.data.minmax):e.data.minmax=e.key.clone()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Or=0,rt=-1,Ta=-2,Ga=-1,tu=-2;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var et;(function(n){n[n.Simple=0]="Simple",n[n.Tile=1]="Tile",n[n.NestBegin=2]="NestBegin",n[n.NestEnd=4]="NestEnd",n[n.RangeBegin=16]="RangeBegin",n[n.RangeEnd=32]="RangeEnd",n[n.SlideOnRemove=64]="SlideOnRemove",n[n.StayOnRemove=128]="StayOnRemove",n[n.Transient=256]="Transient"})(et||(et={}));const ut={INSERT:0,REMOVE:1,ANNOTATE:2,GROUP:3};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function f3(n,e,t,r){let i=e;switch(i===void 0&&(i=n.defaultValue),n.name){case"incr":i+=t,n.minValue&&i<n.minValue&&(i=n.minValue);break;case"consensus":if(i===void 0)i={value:t,seq:r};else{const s=i;s.seq===-1&&(s.seq=r)}break}return i}function Yh(n,e){if(n)if(e){for(const t in n){if(e[t]===void 0)return!1;if(typeof e[t]=="object"){if(!Yh(n[t],e[t]))return!1}else if(e[t]!==n[t])return!1}for(const t in e)if(n[t]===void 0)return!1}else return!1;else if(e)return!1;return!0}function p3(n,e,t,r){if(e!==void 0)for(const i in e){const s=e[i];s===null?delete n[i]:t&&t.name!=="rewrite"?n[i]=f3(t,n[i],s,r):n[i]=s}return n}function UK(n){if(n===void 0)return;const e=Dr();for(const t in n){const r=n[t];r!==null&&(e[t]=r)}return e}function m3(n,e,t,r){let i=n;return(!i||t&&t.name==="rewrite")&&(i=Dr()),p3(i,e,t,r),i}function zK(n,e){if(e!==void 0)for(const t in e)n[t]===void 0&&(n[t]=e[t]);return n}function Dr(){return Object.create(null)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const $K="referenceTileLabels",Zh="referenceRangeLabels";function Xt(n,e){return((typeof n=="number"?n:n.refType)&e)!==0}const yu=n=>Xt(n,et.Tile)&&n.properties?n.properties[$K]:void 0,Su=n=>Xt(n,et.NestBegin|et.NestEnd)&&n.properties?n.properties[Zh]:void 0;function Xg(n,e){const t=yu(n);if(t){for(const r of t)if(e===r)return!0}return!1}function Qx(n,e){const t=Su(n);if(t){for(const r of t)if(e===r)return!0}return!1}function Ka(n){return yu(n)!==void 0}function Ja(n){return Su(n)!==void 0}function HK(n,e){return Xx(n,e)<0?n:e}function VK(n,e){return Xx(n,e)>0?n:e}function Xx(n,e){const t=n.getSegment(),r=e.getSegment();return t===r?n.getOffset()-e.getOffset():t===void 0||r!==void 0&&t.ordinal<r.ordinal?-1:1}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function WK(n){let e=0;if(Xt(n,et.Transient)&&++e,Xt(n,et.SlideOnRemove)&&++e,Xt(n,et.StayOnRemove)&&++e,e>1)throw new Ct("Reference types can only be one of Transient, SlideOnRemove, and StayOnRemove")}class Au{constructor(e,t,r=0,i=et.Simple,s){this.client=e,this.offset=r,this.refType=i,WK(i),this.segment=t,this.properties=s}min(e){return HK(this,e)}max(e){return VK(this,e)}compare(e){return Xx(this,e)}toPosition(){return this.getClient().localReferencePositionToPosition(this)}hasTileLabels(){return Ka(this)}hasRangeLabels(){return Ja(this)}hasTileLabel(e){return Xg(this,e)}hasRangeLabel(e){return Qx(this,e)}getTileLabels(){return yu(this)}getRangeLabels(){return Su(this)}isLeaf(){return!1}addProperties(e,t){this.properties=m3(this.properties,e,t)}getClient(){return this.client}getSegment(){return this.segment}getOffset(){return this.offset}getProperties(){return this.properties}}Au.DetachedPosition=-1;function Ep(n){Ge(n instanceof Au,736)}class ao{constructor(e,t=new Array(e.cachedLength)){this.segment=e,this.hierRefCount=0,this.refCount=0,this.refsByOffset=t}static append(e,t){t.localRefs&&!t.localRefs.empty?(e.localRefs||(e.localRefs=new ao(e)),Ge(e.localRefs.refsByOffset.length===e.cachedLength,702),e.localRefs.append(t.localRefs)):e.localRefs&&(e.localRefs.refsByOffset.length+=t.cachedLength)}[Symbol.iterator](){const e=[];for(const r of this.refsByOffset)r&&(r.before&&e.push(r.before[Symbol.iterator]()),r.at&&e.push(r.at[Symbol.iterator]()),r.after&&e.push(r.after[Symbol.iterator]()));return{next(){for(;e.length>0;){const r=e[0].next();if(r.done===!0)e.shift();else return r}return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}clear(){this.refCount=0,this.hierRefCount=0;const e=t=>{if(t)for(const r of t)r.segment===this.segment&&(r.segment=void 0)};for(let t=0;t<this.refsByOffset.length;t++){const r=this.refsByOffset[t];r&&(e(r.before),e(r.at),e(r.before),this.refsByOffset[t]=void 0)}}get empty(){return this.refCount===0}createLocalRef(e,t,r,i){const s=new Au(i,this.segment,e,t,r);return Xt(s,et.Transient)||this.addLocalRef(s),s}addLocalRef(e){var t,r;Ge(!Xt(e,et.Transient),735),Ep(e);const i=this.refsByOffset[e.offset]=(t=this.refsByOffset[e.offset])!==null&&t!==void 0?t:{at:Pl()};(i.at=(r=i.at)!==null&&r!==void 0?r:Pl()).enqueue(e),(Ja(e)||Ka(e))&&this.hierRefCount++,this.refCount++}removeLocalRef(e){Ep(e);const t=i=>{if(i){let s=i;do if(s=s.next,s.data===e)return d3(s),(Ja(e)||Ka(e))&&this.hierRefCount--,this.refCount--,e;while(!s.isHead)}},r=this.refsByOffset[e.offset];if(r!==void 0){let i=t(r.before);if(i||(i=t(r.at),i)||(i=t(r.after),i))return i}}append(e){if(!(!e||e.empty)){this.hierRefCount+=e.hierRefCount,this.refCount+=e.refCount,e.hierRefCount=0;for(const t of e)t.segment=this.segment,t.offset+=this.refsByOffset.length;this.refsByOffset.push(...e.refsByOffset)}}split(e,t){if(this.empty)this.refsByOffset.length=e;else{const r=new ao(t,this.refsByOffset.splice(e,this.refsByOffset.length-e));t.localRefs=r;for(const i of r)i.segment=t,i.offset-=e,(Ja(i)||Ka(i))&&(this.hierRefCount--,r.hierRefCount++),this.refCount--,r.refCount++}}addBeforeTombstones(...e){var t,r,i,s,o;const u=(r=(t=this.refsByOffset[0])===null||t===void 0?void 0:t.before)!==null&&r!==void 0?r:Pl();for(const d of e)for(const f of d)Ep(f),Xt(f,et.SlideOnRemove)?(u.push(f),f.segment=this.segment,f.offset=0,(Ja(f)||Ka(f))&&this.hierRefCount++,this.refCount++):f.segment=void 0;if(!u.empty()&&((i=this.refsByOffset[0])===null||i===void 0?void 0:i.before)===void 0){const d=this.refsByOffset[0]=(s=this.refsByOffset[0])!==null&&s!==void 0?s:{before:u};d.before=(o=d.before)!==null&&o!==void 0?o:u}}addAfterTombstones(...e){var t,r,i,s,o;const u=this.refsByOffset.length-1,d=(r=(t=this.refsByOffset[u])===null||t===void 0?void 0:t.after)!==null&&r!==void 0?r:Pl();for(const f of e)for(const m of f)Ep(m),Xt(m,et.SlideOnRemove)?(d.push(m),m.segment=this.segment,m.offset=this.segment.cachedLength-1,(Ja(m)||Ka(m))&&this.hierRefCount++,this.refCount++):m.segment=void 0;if(!d.empty()&&((i=this.refsByOffset[u])===null||i===void 0?void 0:i.after)===void 0){const f=this.refsByOffset[u]=(s=this.refsByOffset[u])!==null&&s!==void 0?s:{after:d};f.after=(o=f.after)!==null&&o!==void 0?o:d}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Tp={APPEND:-1,SPLIT:-2,UNLINK:-3,ACKNOWLEDGED:-4};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class GK{constructor(){this.ordinalSortedItems=[]}get size(){return this.ordinalSortedItems.length}get items(){return this.ordinalSortedItems}addOrUpdate(e,t){const r=this.findOrdinalPosition(this.getOrdinal(e));r.exists?t&&t(this.ordinalSortedItems[r.index],e):this.ordinalSortedItems.splice(r.index,0,e)}remove(e){const t=this.findOrdinalPosition(this.getOrdinal(e));return t.exists?(this.ordinalSortedItems.splice(t.index,1),!0):!1}has(e){return this.findOrdinalPosition(this.getOrdinal(e)).exists}getOrdinal(e){const t=e;return t!=null&&t.segment?t.segment.ordinal:e.ordinal}findOrdinalPosition(e,t,r){if(this.ordinalSortedItems.length===0)return{exists:!1,index:0};if(t===void 0||r===void 0)return this.findOrdinalPosition(e,0,this.ordinalSortedItems.length-1);const i=t+Math.floor((r-t)/2);return this.getOrdinal(this.ordinalSortedItems[i])>e?t===i?{exists:!1,index:i}:this.findOrdinalPosition(e,t,i-1):this.getOrdinal(this.ordinalSortedItems[i])<e?i===r?{exists:!1,index:i+1}:this.findOrdinalPosition(e,i+1,r):{exists:!0,index:i}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class KK{constructor(e){this.segment=e,this.trackingGroups=new Set}link(e){e&&(this.trackingGroups.has(e)||this.trackingGroups.add(e),e.has(this.segment)||e.link(this.segment))}unlink(e){e.has(this.segment)&&e.unlink(this.segment),this.trackingGroups.delete(e)}copyTo(e){this.trackingGroups.forEach(t=>e.trackingCollection.link(t))}get empty(){return this.trackingGroups.size===0}matches(e){if(!e||this.trackingGroups.size!==e.trackingGroups.size)return!1;for(const t of this.trackingGroups.values())if(!e.trackingGroups.has(t))return!1;return!0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Zu(n,e){let t=-1,r=0,i=n.length-1;for(;r<=i;){const s=r+Math.floor((i-r)/2);n[s].seq<=e?((t<0||n[t].seq<n[s].seq)&&(t=s),r=s+1):i=s-1}return t}class sn{constructor(e){this.minSeq=e,this.minLength=0,this.segmentCount=0,this.partialLengths=[],this.clientSeqNumbers=[]}static combine(e,t,r,i=!1){return sn.combineBranch(e,t,r,i)}static combineBranch(e,t,r,i=!1){let s=new sn(r.minSeq);sn.fromLeaves(s,t,r);let o;function u(P){if(!P)return;const D=new Ah(iR);return P.map(M=>(D.put(M.data.clientId,Object.assign({},M.data)),!0)),D}function d(P,D){const M=P.overlapRemoveClients;M?D.overlapRemoveClients&&D.overlapRemoveClients.map(U=>{const j=M.get(U.key);return j?j.data.seglen+=U.data.seglen:M.put(U.data.clientId,Object.assign({},U.data)),!0}):P.overlapRemoveClients=u(D.overlapRemoveClients)}function f(P){const D=P.seq;let M=0;if(o)if(o.seq===P.seq){o.seglen+=P.seglen,o.len+=P.seglen,d(o,P);return}else M=o.len,s.addClientSeqNumberFromPartial(o);o={clientId:P.clientId,len:M+P.seglen,overlapRemoveClients:u(P.overlapRemoveClients),seglen:P.seglen,seq:D},s.partialLengths.push(o)}const m=[];for(let P=0;P<t.childCount;P++){const D=t.children[P];if(!D.isLeaf()){const M=D;i&&(M.partialLengths=sn.combine(e,M,r,!0)),m.push(M.partialLengths)}}let g=m.length;if(g!==0){s.partialLengths.length>0&&(m.push(s),g++,s=new sn(r.minSeq));const P=new Array(g),D=new Array(g);for(let j=0;j<g;j++)P[j]=0,D[j]=m[j].partialLengths.length,s.minLength+=m[j].minLength,s.segmentCount+=m[j].segmentCount;let M=0,U;for(;M>=0;){M=-1;for(let j=0;j<g;j++)if(P[j]<D[j]){const E=m[j].partialLengths[P[j]];(M<0||E.seq<U.seq)&&(M=j,U=E)}M>=0&&(f(U),P[M]++)}o&&s.addClientSeqNumberFromPartial(o)}return sn.options.zamboni&&s.zamboni(r),sn.options.verify&&s.verify(),s}static fromLeaves(e,t,r){e.minLength=0,e.segmentCount=t.childCount;function i(d,f){return d!==void 0&&d!==rt&&d<=f}for(let d=0;d<t.childCount;d++){const f=t.children[d];if(f.isLeaf()){const m=f;i(m.seq,r.minSeq)?e.minLength+=m.cachedLength:m.seq!==rt&&sn.insertSegment(e,m);const g=Zo(m);i(g==null?void 0:g.removedSeq,r.minSeq)?e.minLength-=m.cachedLength:g!==void 0&&g.removedSeq!==rt&&sn.insertSegment(e,m,g)}}const s=e.partialLengths,o=s.length;let u=0;for(let d=0;d<o;d++)s[d].len=u+s[d].seglen,u=s[d].len,e.addClientSeqNumberFromPartial(s[d]);sn.options.verify&&e.verify()}static getOverlapClients(e,t){const r=new Ah(iR);for(const i of e)r.put(i,{clientId:i,seglen:t});return r}static accumulateRemoveClientOverlap(e,t,r){if(e.overlapRemoveClients)for(const i of t){const s=e.overlapRemoveClients.get(i);s?s.data.seglen+=r:e.overlapRemoveClients.put(i,{clientId:i,seglen:r})}else e.overlapRemoveClients=sn.getOverlapClients(t,r)}static insertSegment(e,t,r){let i=t.seq,s=t.cachedLength,o=t.clientId,u;r&&(i=r.removedSeq,s=-s,o=r.removedClientIds[0],u=r.removedClientIds.length>1?r.removedClientIds.slice(1):void 0);const d=e.partialLengths,f=d.length;let m=0;for(;m<f&&!(d[m].seq>=i);m++);if(m<f&&d[m].seq===i)d[m].seglen+=s,u&&sn.accumulateRemoveClientOverlap(d[m],u,s);else{let g;if(u){const P=sn.getOverlapClients(u,s);g={seq:i,clientId:o,len:0,seglen:s,overlapRemoveClients:P}}else g={seq:i,clientId:o,len:0,seglen:s};if(m<f){for(let P=f;P>m;P--)d[P]=d[P-1];d[m]=g}else d.push(g)}}static addSeq(e,t,r,i){let s,o,u=Zu(e,t);if(u>=0){const d=e[u];d.seq===t?(s=d,u=Zu(e,t-1),u>=0&&(o=e[u])):o=d}s===void 0?(s={clientId:i,seglen:r,seq:t},e.push(s)):s.seglen=r,o!==void 0?s.len=s.seglen+o.len:s.len=s.seglen}update(e,t,r,i,s){let o=0,u=0;for(let d=0;d<t.childCount;d++){const f=t.children[d];if(f.isLeaf()){const m=f,g=Zo(m);m.seq===r?(g==null?void 0:g.removedSeq)!==r&&(o+=m.cachedLength):(g==null?void 0:g.removedSeq)===r&&(o-=m.cachedLength),u++}else{const g=f.partialLengths,P=g.partialLengths,D=Zu(P,r);if(D>=0){const M=P[D];M.seq===r&&(o+=M.seglen)}u+=g.segmentCount}}this.segmentCount=u,sn.addSeq(this.partialLengths,r,o,i),this.clientSeqNumbers[i]===void 0&&(this.clientSeqNumbers[i]=[]),sn.addSeq(this.clientSeqNumbers[i],r,o),sn.options.zamboni&&this.zamboni(s),sn.options.verify&&this.verify()}getPartialLength(e,t){let r=this.minLength;const i=Zu(this.partialLengths,e),s=this.cliLatest(t),o=this.clientSeqNumbers[t];if(i>=0){if(r+=this.partialLengths[i].len,s>=0){const u=o[s];if(u.seq>e){r+=u.len;const d=this.cliLatestLEQ(t,e);d>=0&&(r-=o[d].len)}}}else if(s>=0){const u=o[s];r+=u.len}return r}toString(e,t=0){let r="";for(const i of this.partialLengths)r+=`(${i.seq},${i.len}) `;for(const i in this.clientSeqNumbers)if(this.clientSeqNumbers[i].length>0){r+="Client ",e?r+=`${e(+i)}`:r+=`${i}`,r+="[";for(const s of this.clientSeqNumbers[i])r+=`(${s.seq},${s.len})`;r+="]"}return r=`min(seq ${this.minSeq}): ${this.minLength}; sc: ${this.segmentCount};${r}`,r}zamboni(e){function t(r){const i=Zu(r,e.minSeq);let s=0;if(i>=0){s=r[i].len;const o=r.length;if(i<=o-1){const u=o-i-1;for(let d=0;d<u;d++)r[d]=r[d+i+1],r[d].len-=s;r.length=u}}return s}this.minLength+=t(this.partialLengths);for(const r in this.clientSeqNumbers){const i=this.clientSeqNumbers[r];i&&t(i)}}addClientSeqNumber(e,t,r){this.clientSeqNumbers[e]===void 0&&(this.clientSeqNumbers[e]=[]);const i=this.clientSeqNumbers[e];let s=r;i.length>0&&(s+=i[i.length-1].len),i.push({seq:t,len:s,seglen:r})}addClientSeqNumberFromPartial(e){this.addClientSeqNumber(e.clientId,e.seq,e.seglen),e.overlapRemoveClients&&e.overlapRemoveClients.map(t=>(this.addClientSeqNumber(t.data.clientId,e.seq,t.data.seglen),!0))}cliLatestLEQ(e,t){const r=this.clientSeqNumbers[e];return r?Zu(r,t):-1}cliLatest(e){const t=this.clientSeqNumbers[e];return t&&t.length>0?t.length-1:-1}verifyPartialLengths(e,t){if(e.length===0)return 0;let r=0,i=0,s=0;for(const o of e)s++,Ge(this.minSeq<=o.seq,84),Ge(r<o.seq,85),r=o.seq,i+=o.seglen,i!==o.len&&Ge(!1,86),t||this.minLength+o.len<0&&Ge(!1,87),o.overlapRemoveClients&&(Ge(!t,88),s+=o.overlapRemoveClients.size());return s}verify(){if(this.clientSeqNumbers){let e=0;for(const r of this.clientSeqNumbers)r&&(e+=this.verifyPartialLengths(r,!0));Ge(!!this.partialLengths,89);const t=this.verifyPartialLengths(this.partialLengths,!1);Ge(t===e,90)}else Ge(!this.partialLengths,91)}}sn.options={verify:!1,zamboni:!0};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class JK{constructor(e){this.segment=e,this.segmentGroups=Pl()}get size(){return this.segmentGroups.count()}get empty(){return this.segmentGroups.empty()}enqueue(e){this.segmentGroups.enqueue(e),e.segments.push(this.segment)}dequeue(){return this.segmentGroups.dequeue()}clear(){this.segmentGroups.clear()}copyTo(e){this.segmentGroups.walk(t=>e.segmentGroups.enqueue(t))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class oc{constructor(){this.pendingRewriteCount=0}ackPendingProperties(e){var t,r;e.combiningOp&&e.combiningOp.name==="rewrite"&&this.pendingRewriteCount--;for(const i of Object.keys(e.props))((t=this.pendingKeyUpdateCount)===null||t===void 0?void 0:t[i])!==void 0&&(Ge(this.pendingKeyUpdateCount[i]>0,92),this.pendingKeyUpdateCount[i]--,((r=this.pendingKeyUpdateCount)===null||r===void 0?void 0:r[i])===0&&delete this.pendingKeyUpdateCount[i])}addProperties(e,t,r,i,s=!1){var o;if(this.pendingKeyUpdateCount||(this.pendingKeyUpdateCount=Dr()),this.pendingRewriteCount>0&&i!==rt&&s)return;const u=r&&r.name==="rewrite",d=u?void 0:r||void 0,f=g=>{var P;return!!(i===rt||((P=this.pendingKeyUpdateCount)===null||P===void 0?void 0:P[g])===void 0||d)},m={};if(u){s&&i===rt&&this.pendingRewriteCount++;for(const g of Object.keys(e))!t[g]&&f(g)&&(m[g]=e[g],delete e[g])}for(const g of Object.keys(t)){if(s){if(i===rt)((o=this.pendingKeyUpdateCount)===null||o===void 0?void 0:o[g])===void 0&&(this.pendingKeyUpdateCount[g]=0),this.pendingKeyUpdateCount[g]++;else if(!f(g))continue}const P=e[g];m[g]=P===void 0?null:P;let D;d?D=f3(d,P,D,i):D=t[g],D===null?delete e[g]:e[g]=D}return m}copyTo(e,t,r){if(e){if(t||(t=Dr()),!r)throw new Error("Must provide new PropertyManager");for(const i of Object.keys(e))t[i]=e[i];r.pendingRewriteCount=this.pendingRewriteCount,r.pendingKeyUpdateCount=Dr();for(const i of Object.keys(this.pendingKeyUpdateCount))r.pendingKeyUpdateCount[i]=this.pendingKeyUpdateCount[i]}return t}hasPendingProperties(){return this.pendingRewriteCount>0||Object.keys(this.pendingKeyUpdateCount).length>0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Zo(n){if((n==null?void 0:n.removedClientIds)!==void 0&&(n==null?void 0:n.removedSeq)!==void 0)return n;Ge((n==null?void 0:n.removedClientIds)===void 0&&(n==null?void 0:n.removedSeq)===void 0,703)}function QK(n){return Zo(n)!==void 0}function aS(n){const e=Zo(n);return e!==void 0&&e.removedSeq!==rt}class g3{constructor(){this.index=0,this.ordinal="",this.cachedLength=0}isLeaf(){return!1}}function tR(n,e){const t=yu(n);if(t)for(const r of t)e[r]=n}function nR(n,e){const t=yu(n);if(t)for(const r of t)e[r]===void 0&&(e[r]=n)}function v3(n,e){for(const t in e){const r=e[t];if(!r.empty()){let i=n[t];i===void 0&&(i=new Jx,n[t]=i);for(const s of r.items)Yx(i,s)}}}function Yx(n,e){if(Xt(e,et.NestBegin))return n.push(e),!0;{const t=n.top();return t&&Xt(t,et.NestBegin)?n.pop():n.push(e),!1}}function XK(n,e,t,r,i){var s;function o(u,d){let f=i[u];f===void 0&&(f=new Jx,i[u]=f),Yx(f,d)}if(e.isLeaf()){const u=e;if(((s=n.localNetLength(u))!==null&&s!==void 0?s:0)>0)if(Xn.is(u)){const d=u.getId();if(d&&n.mapIdToSegment(d,u),Xt(u,et.Tile)&&(tR(u,t),nR(u,r)),u.refType&(et.NestBegin|et.NestEnd)){const f=Su(u);if(f)for(const m of f)o(m,u)}}else{const d=e;if(d.localRefs&&d.localRefs.hierRefCount!==void 0&&d.localRefs.hierRefCount>0){for(const f of d.localRefs)if(Xt(f,et.Tile)&&(tR(f,t),nR(f,r)),f.refType&(et.NestBegin|et.NestEnd))for(const m of Su(f))o(m,f)}}}else{const u=e;v3(i,u.rangeStacks),p3(t,u.rightmostTiles),zK(r,u.leftmostTiles)}}const ti=8;class YK extends g3{constructor(e){super(),this.childCount=e,this.children=new Array(ti)}hierBlock(){}setOrdinal(e,t){let r=this.childCount;r===8&&(r=7),Ge(r>=1&&r<=7,64);let i;const s=1<<ti-(r+1);if(t===0)i=s-1;else{const o=this.children[t-1].ordinal;i=o.charCodeAt(o.length-1)+s}e.ordinal=this.ordinal+String.fromCharCode(i),Ge(e.ordinal.length===this.ordinal.length+1,65),t>0&&Ge(e.ordinal>this.children[t-1].ordinal,66)}assignChild(e,t,r=!0){e.parent=this,e.index=t,r&&this.setOrdinal(e,t),this.children[t]=e}}class ZK extends YK{constructor(e){super(e),this.rightmostTiles=Dr(),this.leftmostTiles=Dr(),this.rangeStacks=Dr()}addNodeReferences(e,t){XK(e,t,this.rightmostTiles,this.leftmostTiles,this.rangeStacks)}hierBlock(){return this}hierToString(e){let t="";for(const r in this.rangeStacks){const i=this.rangeStacks[r];t+=sJ(e),t+=`${r}: `;for(const s of i.items)t+=`${s.toString()} `;t+=`
`}return t}}function eJ(n,e){return e.isLeaf()?n.localNetLength(e):e.cachedLength}class Yg extends g3{constructor(){super(...arguments),this.clientId=Ga,this.seq=Or,this.segmentGroups=new JK(this),this.trackingCollection=new KK(this)}addProperties(e,t,r,i){return this.propertyManager||(this.propertyManager=new oc),this.properties||(this.properties=Dr()),this.propertyManager.addProperties(this.properties,e,t,r,i&&i.collaborating)}hasProperty(e){return!!this.properties&&this.properties[e]!==void 0}isLeaf(){return!0}cloneInto(e){var t;e.clientId=this.clientId,e.properties=UK(this.properties),e.removedClientIds=(t=this.removedClientIds)===null||t===void 0?void 0:t.slice(),e.removedSeq=this.removedSeq,e.seq=this.seq}canAppend(e){return!1}addSerializedProps(e){this.properties&&(e.props=this.properties)}ack(e,t,r){const i=this.segmentGroups.dequeue();switch(Ge(i===e,67),t.op.type){case ut.ANNOTATE:return Ge(!!this.propertyManager,68),this.propertyManager.ackPendingProperties(t.op),!0;case ut.INSERT:return Ge(this.seq===rt,69),this.seq=t.sequencedMessage.sequenceNumber,this.localSeq=void 0,!0;case ut.REMOVE:const s=Zo(this);return Ge(s!==void 0,70),this.localRemovedSeq=void 0,s.removedSeq===rt?(s.removedSeq=t.sequencedMessage.sequenceNumber,!0):!1;default:throw new Error(`${t.op.type} is in unrecognized operation type`)}}splitAt(e){var t;if(e>0){const r=this.createSplitSegmentAt(e);return r&&(this.copyPropertiesTo(r),r.parent=this.parent,r.ordinal=this.ordinal+String.fromCharCode(0),r.removedClientIds=(t=this.removedClientIds)===null||t===void 0?void 0:t.slice(),r.removedSeq=this.removedSeq,r.localRemovedSeq=this.localRemovedSeq,r.seq=this.seq,r.localSeq=this.localSeq,r.clientId=this.clientId,this.segmentGroups.copyTo(r),this.trackingCollection.copyTo(r),this.localRefs&&this.localRefs.split(e,r)),r}}copyPropertiesTo(e){this.propertyManager&&this.properties&&(e.propertyManager=new oc,e.properties=this.propertyManager.copyTo(this.properties,e.properties,e.propertyManager))}}const rR="markerId",tJ="markerSimpleType";class Xn extends Yg{constructor(e){super(),this.refType=e,this.type=Xn.type,this.cachedLength=1}static is(e){return e.type===Xn.type}static make(e,t){const r=new Xn(e);return t&&r.addProperties(t),r}toJSONObject(){const e={marker:{refType:this.refType}};return super.addSerializedProps(e),e}static fromJSONObject(e){if(e&&typeof e=="object"&&"marker"in e)return Xn.make(e.marker.refType,e.props)}clone(){const e=Xn.make(this.refType,this.properties);return this.cloneInto(e),e}getSegment(){return this}getOffset(){return 0}hasSimpleType(e){return!!this.properties&&this.properties[tJ]===e}getProperties(){return this.properties}getId(){if(this.properties&&this.properties[rR])return this.properties[rR]}hasTileLabels(){return Ka(this)}hasRangeLabels(){return Ja(this)}hasTileLabel(e){return Xg(this,e)}hasRangeLabel(e){return Qx(this,e)}getTileLabels(){return yu(this)}getRangeLabels(){return Su(this)}toString(){let e="";Xt(this,et.Tile)&&(e+="Tile"),Xt(this,et.NestBegin)&&(e.length>0&&(e+="; "),e+="RangeBegin"),Xt(this,et.NestEnd)&&(e.length>0&&(e+="; "),e+="RangeEnd");let t="";const r=this.getId();r&&(e+=` (${r}) `);const i=yu(this);if(i){t+="tile -- ";for(let u=0,d=i.length;u<d;u++){const f=i[u];u>0&&(t+="; "),t+=f}}const s=Su(this);if(s){let u="begin";Xt(this,et.NestEnd)&&(u="end"),i&&(t+=" "),t+=`range ${u} -- `;const d=s;for(let f=0,m=d.length;f<m;f++){const g=d[f];f>0&&(t+="; "),t+=g}}let o="";return this.properties&&(o+=JSON.stringify(this.properties,(u,d)=>{const f=!!d&&d.IFluidHandle;return f?`#Handle(${f.routeContext.path}/${f.path})`:d})),`M ${e}: ${t} ${o}`}createSplitSegmentAt(e){}canAppend(e){return!1}append(){throw new Error("Can not append to marker")}}Xn.type="Marker";var Ul;(function(n){n[n.Go=0]="Go",n[n.Stop=1]="Stop",n[n.Yield=2]="Yield"})(Ul||(Ul={}));class nJ{constructor(e,t,r,i,s,o,u,d,f=0){this.block=e,this.actions=t,this.pos=r,this.refSeq=i,this.clientId=s,this.context=o,this.start=u,this.end=d,this.childIndex=f,this.op=Ul.Go}}class rJ{constructor(){this.clientId=Ga,this.collaborating=!1,this.minSeq=0,this.currentSeq=0,this.localSeq=0}loadFrom(e){this.clientId=e.clientId,this.collaborating=e.collaborating,this.minSeq=e.minSeq,this.currentSeq=e.currentSeq}}const iR=(n,e)=>n-e,iJ=(n,e)=>n.localeCompare(e),Pp=[""," ","  "];function sJ(n){if(Pp[n]===void 0){Pp[n]="";for(let e=0;e<n;e++)Pp[n]+=" "}return Pp[n]}const oJ={min:{maxSeq:-2},compare:(n,e)=>n.maxSeq-e.maxSeq};function y3(n,e){for(const t of e.rangeLabels)if(Qx(n,t)){let r=e.stacks[t];r===void 0&&(r=new Jx,e.stacks[t]=r),Yx(r,n)}}function aJ(n,e,t,r,i,s,o){return Xn.is(n)&&n.refType&(et.NestBegin|et.NestEnd)&&y3(n,o),!1}function uJ(n,e,t,r,i,s,o){var u;if(n.isLeaf()){const d=n;((u=o.mergeTree.localNetLength(d))!==null&&u!==void 0?u:0)>0&&Xn.is(d)&&d.refType&(et.NestBegin|et.NestEnd)&&y3(d,o)}else{const d=n;v3(o.stacks,d.rangeStacks)}return!0}function sR(n,e,t,r,i,s,o){return Xn.is(n)&&Xg(n,o.tileLabel)&&(o.tile=n),!1}function oR(n,e,t,r,i,s,o){if(n.isLeaf()){const u=n;o.mergeTree.localNetLength(u)>0&&Xn.is(u)&&Xg(u,o.tileLabel)&&(o.tile=u)}else{const u=n;let d;o.posPrecedesTile?d=u.rightmostTiles[o.tileLabel]:d=u.leftmostTiles[o.tileLabel],d!==void 0&&(o.tile=d)}return!0}const lJ={min:{minRequired:Number.MIN_VALUE,onMinGE:()=>{Ge(!1,72)}},compare:(n,e)=>n.minRequired-e.minRequired};class hn{constructor(e){this.options=e,this.blockUpdateActions=hn.initBlockUpdateActions,this.collabWindow=new rJ,this.idToSegment=new Map,this.splitLeafSegment=(t,r)=>{if(!(r>0&&t))return{};const i=t.splitAt(r);return this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:Tp.SPLIT,deltaSegments:[{segment:t},{segment:i}]},void 0),{next:i}},this.root=this.makeBlock(0)}makeBlock(e){const t=new ZK(e);return t.ordinal="",t}clone(){const e=new hn(this.options);e.root=e.blockClone(this.root)}blockClone(e,t){const r=this.makeBlock(e.childCount);for(let i=0;i<e.childCount;i++){const s=e.children[i];if(s.isLeaf()){const o=this.segmentClone(s);r.assignChild(o,i),t&&t.push(o)}else r.assignChild(this.blockClone(s,t),i)}return this.nodeUpdateLengthNewStructure(r),this.nodeUpdateOrdinals(r),r}segmentClone(e){return e.clone()}localNetLength(e){return Zo(e)!==void 0?0:e.cachedLength}mapIdToSegment(e,t){this.idToSegment.set(e,t)}addNode(e,t){const r=e.childCount++;return e.assignChild(t,r,!1),r}reloadFromSegments(e){Ge(!this.collabWindow.collaborating,73);const t=ti-1,r=i=>{const s=Math.ceil(i.length/t),o=new Array(s);for(let u=0,d=0;d<s;d++){const f=o[d]=this.makeBlock(0);for(let m=0;m<t&&u<i.length;m++,u++)this.addNode(f,i[u]);this.blockUpdate(f)}return o.length===1?o[0]:r(o)};e.length>0?(this.root=r(e),this.nodeUpdateOrdinals(this.root)):this.root=this.makeBlock(0)}startCollaboration(e,t,r){this.collabWindow.clientId=e,this.collabWindow.minSeq=t,this.collabWindow.collaborating=!0,this.collabWindow.currentSeq=r,this.segmentsToScour=new eR([],oJ),this.pendingSegments=Pl(),this.nodeUpdateLengthNewStructure(this.root,!0)}addToLRUSet(e,t){e.parent.needsScour!==!0&&t>this.collabWindow.currentSeq&&(e.parent.needsScour=!0,this.segmentsToScour.add({segment:e,maxSeq:t}))}underflow(e){return e.childCount<ti/2}scourNode(e,t){let r;for(let i=0;i<e.childCount;i++){const s=e.children[i];if(s.isLeaf()){const o=s;o.segmentGroups.empty?o.removedSeq!==void 0?(o.removedSeq>this.collabWindow.minSeq?t.push(o):o.trackingCollection.empty?(this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:Tp.UNLINK,deltaSegments:[{segment:o}]},void 0),o.parent=void 0):t.push(o),r=void 0):o.seq<=this.collabWindow.minSeq?r&&r.canAppend(o)&&Yh(r.properties,o.properties)&&r.trackingCollection.matches(o.trackingCollection)&&this.localNetLength(o)>0?(r.append(o),this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:Tp.APPEND,deltaSegments:[{segment:r},{segment:o}]},void 0),o.parent=void 0,o.trackingCollection.trackingGroups.forEach(d=>d.unlink(o))):(t.push(o),this.localNetLength(o)>0?r=o:r=void 0):(t.push(o),r=void 0):(t.push(o),r=void 0)}else t.push(s),r=void 0}}packParent(e){const t=e.children;let r,i;const s=[];for(r=0;r<e.childCount;r++)i=t[r],this.scourNode(i,s),i.parent=void 0;const o=s.length,u=ti/2;let d=Math.min(ti-1,Math.floor(o/u));d<1&&(d=1);const f=Math.floor(o/d);let m=o%d;const g=new Array(ti);let P=0;for(let D=0;D<d;D++){let M=f;m>0&&(M++,m--);const U=this.makeBlock(M);for(let j=0;j<M;j++){const E=s[P++];U.assignChild(E,j,!1)}U.parent=e,g[D]=U,this.nodeUpdateLengthNewStructure(U)}e.children=g;for(let D=0;D<d;D++)e.assignChild(g[D],D,!1);e.childCount=d,this.underflow(e)&&e.parent?this.packParent(e.parent):(this.nodeUpdateOrdinals(e),this.blockUpdatePathLengths(e,rt,-1,!0))}zamboniSegments(e=hn.zamboniSegmentsMaxCount){if(this.collabWindow.collaborating)for(let t=0;t<e;t++){let r=this.segmentsToScour.peek();if(!r||r.maxSeq>this.collabWindow.minSeq)break;if(r=this.segmentsToScour.get(),r.segment.parent&&r.segment.parent.needsScour!==!1){const i=r.segment.parent,s=[];this.scourNode(i,s),i.needsScour=!1;const o=s.length;if(o<i.childCount){i.childCount=o,i.children=s;for(let u=0;u<o;u++)i.assignChild(s[u],u,!1);this.underflow(i)&&i.parent?this.packParent(i.parent):(this.nodeUpdateOrdinals(i),this.blockUpdatePathLengths(i,rt,-1,!0))}}}}getCollabWindow(){return this.collabWindow}getStats(){const e=r=>{const i={maxHeight:0,nodeCount:0,leafCount:0,removedLeafCount:0,liveCount:0,histo:[]};for(let s=0;s<ti;s++)i.histo[s]=0;for(let s=0;s<r.childCount;s++){const o=r.children[s];let u=1;if(o.isLeaf())i.leafCount++,o.removedSeq!==void 0&&i.removedLeafCount++;else{const d=e(o);u=1+d.maxHeight,i.nodeCount+=d.nodeCount,i.leafCount+=d.leafCount,i.removedLeafCount+=d.removedLeafCount,i.liveCount+=d.liveCount;for(let f=0;f<ti;f++)i.histo[f]+=d.histo[f]}u>i.maxHeight&&(i.maxHeight=u)}return i.histo[r.childCount]++,i.nodeCount++,i.liveCount+=r.childCount,i};return e(this.root)}getLength(e,t){return this.blockLength(this.root,e,t)}get length(){return this.root.cachedLength}getPosition(e,t,r){var i;let s=0,o=e.parent,u;for(;o;){const d=o.children;for(let f=0;f<o.childCount;f++){const m=d[f];if(u&&m===u||m===e)break;s+=(i=this.nodeLength(m,t,r))!==null&&i!==void 0?i:0}u=o,o=o.parent}return s}getContainingSegment(e,t,r){let i,s;const o=(u,d,f,m,g)=>(i=u,s=g,!1);return this.searchBlock(this.root,e,0,t,r,{leaf:o},void 0),{segment:i,offset:s}}_getSlideToSegment(e){if(!e.segment||!aS(e.segment))return e;let t;const r=i=>i.seq!==rt&&!aS(i)?(t=i,!1):!0;return this.rightExcursion(e.segment,r),t?{segment:t,offset:0}:(this.leftExcursion(e.segment,r),t=t,t?{segment:t,offset:t.cachedLength-1}:{segment:void 0,offset:0})}slideReferences(e,t){var r,i,s,o,u;Ge(aS(e),753),Ge(!!e.localRefs,754);const d=this._getSlideToSegment({segment:e,offset:0}),f=d.segment;f&&!f.localRefs&&(f.localRefs=new ao(f));for(const m of t){(i=(r=m.callbacks)===null||r===void 0?void 0:r.beforeSlide)===null||i===void 0||i.call(r);const g=e.localRefs.removeLocalRef(m);Ge(m===g,755),f?(m.segment=f,m.offset=(s=d.offset)!==null&&s!==void 0?s:0,Ge(!!f.localRefs,756),f.localRefs.addLocalRef(m)):(m.segment=void 0,m.offset=0),(u=(o=m.callbacks)===null||o===void 0?void 0:o.afterSlide)===null||u===void 0||u.call(o)}f&&this.blockUpdatePathLengths(f.parent,Ta,Ga)}updateSegmentRefsAfterMarkRemoved(e,t){if(!e.localRefs||e.localRefs.empty)return;const r=[],i=[];for(const s of e.localRefs)Xt(s,et.StayOnRemove)?i.push(s):Xt(s,et.SlideOnRemove)&&(t?i.push(s):r.push(s));t||this.slideReferences(e,r),e.localRefs.clear();for(const s of i)s.segment=e,e.localRefs.addLocalRef(s)}blockLength(e,t,r){return this.collabWindow.collaborating&&r!==this.collabWindow.clientId?e.partialLengths.getPartialLength(t,r):e.cachedLength}nodeLength(e,t,r){if(!this.collabWindow.collaborating||this.collabWindow.clientId===r)return e.isLeaf()?this.localNetLength(e):e.cachedLength;if(e.isLeaf()){const i=e,s=Zo(i);return s!==void 0&&s.removedSeq!==rt&&s.removedSeq<=t?void 0:i.clientId===r||i.seq!==rt&&i.seq<=t?s!==void 0&&s.removedClientIds.includes(r)?0:i.cachedLength:s!==void 0&&s.removedSeq!==rt?void 0:0}else return e.partialLengths.getPartialLength(t,r)}addMinSeqListener(e,t){this.minSeqListeners||(this.minSeqListeners=new eR([],lJ)),this.minSeqListeners.add({minRequired:e,onMinGE:t})}notifyMinSeqListeners(){if(this.minSeqListeners)for(;this.minSeqListeners.count()>0&&this.minSeqListeners.peek().minRequired<=this.collabWindow.minSeq;)this.minSeqListeners.get().onMinGE(this.collabWindow.minSeq)}setMinSeq(e){Ge(e<=this.collabWindow.currentSeq,78),Ge(this.collabWindow.minSeq<=e,79),e>this.collabWindow.minSeq&&(this.collabWindow.minSeq=e,hn.options.zamboniSegments&&this.zamboniSegments(),this.notifyMinSeqListeners())}referencePositionToLocalPosition(e,t=this.collabWindow.currentSeq,r=this.collabWindow.clientId){const i=e.getSegment();return i&&i.parent?(i.removedSeq?0:e.getOffset())+this.getPosition(i,t,r):Au.DetachedPosition}getStackContext(e,t,r){const i={mergeTree:this,stacks:Dr(),rangeLabels:r};return this.search(e,Or,t,{leaf:aJ,shift:uJ},i),i.stacks}findTile(e,t,r,i=!0){const s={mergeTree:this,posPrecedesTile:i,tileLabel:r};if(i?this.search(e,Or,t,{leaf:sR,shift:oR},s):this.backwardSearch(e,Or,t,{leaf:sR,shift:oR},s),s.tile){let o;if(s.tile.isLeaf()){const u=s.tile;o=this.getPosition(u,Or,t)}else o=s.tile.toPosition();return{tile:s.tile,pos:o}}}search(e,t,r,i,s){return this.searchBlock(this.root,e,0,t,r,i,s)}searchBlock(e,t,r,i,s,o,u){var d;let f=t,m=r;const g=e.children;o&&o.pre&&o.pre(e,m,i,s,void 0,void 0,u);const P=o&&o.contains;for(let D=0;D<e.childCount;D++){const M=g[D],U=(d=this.nodeLength(M,i,s))!==null&&d!==void 0?d:0;if(!P&&f<U||P&&P(M,f,i,s,void 0,void 0,u))return M.isLeaf()?(o&&o.leaf&&o.leaf(M,m,i,s,f,-1,u),M):this.searchBlock(M,f,m,i,s,o,u);o&&o.shift&&o.shift(M,m,i,s,f,void 0,u),f-=U,m+=U}o&&o.post&&o.post(e,m,i,s,void 0,void 0,u)}backwardSearch(e,t,r,i,s){const o=this.getLength(t,r);if(!(e>o))return this.backwardSearchBlock(this.root,e,o,t,r,i,s)}backwardSearchBlock(e,t,r,i,s,o,u){var d;let f=r;const m=e.children;o&&o.pre&&o.pre(e,f,i,s,void 0,void 0,u);const g=o&&o.contains;for(let P=e.childCount-1;P>=0;P--){const D=m[P],M=(d=this.nodeLength(D,i,s))!==null&&d!==void 0?d:0,U=f-M;if(!g&&t>=U||g&&g(D,t,i,s,void 0,void 0,u))return D.isLeaf()?(o&&o.leaf&&o.leaf(D,U,i,s,t,-1,u),D):this.backwardSearchBlock(D,t,f,i,s,o,u);o&&o.shift&&o.shift(D,U,i,s,t,void 0,u),f=U}o&&o.post&&o.post(e,f,i,s,void 0,void 0,u)}updateRoot(e){if(e!==void 0){const t=this.makeBlock(2);t.assignChild(this.root,0,!1),t.assignChild(e,1,!1),this.root=t,this.nodeUpdateOrdinals(this.root),this.nodeUpdateLengthNewStructure(this.root)}}ackPendingSegment(e){const t=e.sequencedMessage.sequenceNumber,r=this.pendingSegments.dequeue(),i=[];let s=!1;if(r!==void 0){const o=[];r.segments.map(d=>{const f=!d.ack(r,e,this);s=f||s,!f&&e.op.type===ut.REMOVE&&this.updateSegmentRefsAfterMarkRemoved(d,!1),hn.options.zamboniSegments&&this.addToLRUSet(d,t),i.includes(d.parent)||i.push(d.parent),o.push({segment:d})}),this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({deltaSegments:o,operation:Tp.ACKNOWLEDGED},e);const u=this.collabWindow.clientId;for(const d of i)this.blockUpdatePathLengths(d,t,u,s)}hn.options.zamboniSegments&&this.zamboniSegments()}addToPendingList(e,t,r){let i=t;return i===void 0&&(i={segments:[],localSeq:r},this.pendingSegments.enqueue(i)),e.segmentGroups.enqueue(i),i}getMarkerFromId(e){return this.idToSegment.get(e)}posFromRelativePos(e,t=this.collabWindow.currentSeq,r=this.collabWindow.clientId){let i=-1,s;return e.id&&(s=this.getMarkerFromId(e.id)),s&&(i=this.getPosition(s,t,r),e.before?e.offset!==void 0&&(i-=e.offset):(i+=s.cachedLength,e.offset!==void 0&&(i+=e.offset))),i}insertSegments(e,t,r,i,s,o){this.ensureIntervalBoundary(e,r,i);const u=s===rt?++this.collabWindow.localSeq:void 0;this.blockInsert(e,r,i,s,u,t),this.mergeTreeDeltaCallback&&o!==void 0&&this.mergeTreeDeltaCallback(o,{operation:ut.INSERT,deltaSegments:t.map(d=>({segment:d}))}),this.collabWindow.collaborating&&hn.options.zamboniSegments&&s!==rt&&this.zamboniSegments()}insertAtReferencePosition(e,t,r){if(t.cachedLength===0)return;if(t.parent||t.removedSeq||t.seq!==Or)throw new Error("Cannot insert segment that has already been inserted.");const i=m=>{let g=m.parent,P=g;for(;g!==void 0;){if(g.childCount>=ti){const D=this.split(g);g===this.root?(this.updateRoot(D),P=void 0):(this.insertChildNode(g.parent,D,g.index+1),P=D.parent,this.blockUpdateLength(g.parent,rt,s))}else this.blockUpdateLength(g,rt,s);g=g.parent}P&&this.nodeUpdateOrdinals(P)},s=this.collabWindow.clientId,o=e.getSegment(),u=e.getOffset(),d=this.nodeLength(o,this.collabWindow.currentSeq,s);let f=o;if(u!==0&&d!==void 0&&d!==0){const m=this.splitLeafSegment(o,u);Ge(!!m.next,80),this.insertChildNode(o.parent,m.next,o.index+1),i(m.next),f=m.next}if(this.leftExcursion(f,m=>{if(!m.isLeaf())return!0;const g=this.nodeLength(m,this.collabWindow.currentSeq,s);return g===void 0?!0:g===0?(this.breakTie(0,m,rt)&&(f=m),!0):!1}),this.collabWindow.collaborating?(t.localSeq=++this.collabWindow.localSeq,t.seq=rt):t.seq=Or,t.clientId=s,Xn.is(t)){const m=t.getId();m&&this.mapIdToSegment(m,t)}this.insertChildNode(f.parent,t,f.index),i(t),this.mergeTreeDeltaCallback&&this.mergeTreeDeltaCallback(r,{deltaSegments:[{segment:t}],operation:ut.INSERT}),this.collabWindow.collaborating&&this.addToPendingList(t,void 0,t.localSeq)}resolveRemoteClientPosition(e,t,r){if(t<this.collabWindow.minSeq)return;const i=this.getContainingSegment(e,t,r),s=this.getCollabWindow();if(i&&i.segment)return this.getPosition(i.segment,s.currentSeq,s.clientId)+i.offset;if(e===this.getLength(t,r))return this.getLength(s.currentSeq,s.clientId)}insertChildNode(e,t,r){Ge(e.childCount<ti,81);for(let i=e.childCount;i>r;i--)e.children[i]=e.children[i-1],e.children[i].index=i;e.childCount++,e.assignChild(t,r,!1)}blockInsert(e,t,r,i,s,o){let u=!1;const d=M=>(M.seq===rt&&(u=!0),!1),f=M=>(u=!1,this.rightExcursion(M,d),u);let m;const g=M=>{this.collabWindow.collaborating&&(M.seq===rt&&r===this.collabWindow.clientId?m=this.addToPendingList(M,m,s):M.seq>this.collabWindow.minSeq&&hn.options.zamboniSegments&&this.addToLRUSet(M,M.seq))},P=(M,U,j)=>{const E={};return M?(E.replaceCurrent=j.candidateSegment,E.next=M):E.next=j.candidateSegment,E};let D=e;for(const M of o)if(u=!1,M.cachedLength>0){if(M.seq=i,M.localSeq=s,M.clientId=r,Xn.is(M)){const j=M.getId();j&&this.mapIdToSegment(j,M)}const U=this.insertingWalk(this.root,D,t,r,i,{leaf:P,candidateSegment:M,continuePredicate:f});if(M.parent===void 0)throw new Error(`MergeTree insert failed: ${JSON.stringify({currentSeq:this.collabWindow.currentSeq,minSeq:this.collabWindow.minSeq,segSeq:M.seq})}`);this.updateRoot(U),g(M),D+=M.cachedLength}}ensureIntervalBoundary(e,t,r){const i=this.insertingWalk(this.root,e,t,r,Ta,{leaf:this.splitLeafSegment});this.updateRoot(i)}breakTie(e,t,r){var i;if(t.isLeaf()){if(e===0){const s=r===rt?Number.MAX_SAFE_INTEGER:r,o=t.seq===rt?Number.MAX_SAFE_INTEGER-1:(i=t.seq)!==null&&i!==void 0?i:0;return s>o}return!1}else return!0}leftExcursion(e,t){let r=!0,i=e,s=i.parent;for(;s;){const o=s.children;let u,d,f=!1;for(u=s.childCount-1;u>=0;u--)if(d=o[u],f){if(d.isLeaf())r=t(d,0,Or,this.collabWindow.clientId,0,0,void 0);else{const m=d;r=this.nodeMapReverse(m,t,0,Or,this.collabWindow.clientId)}if(!r)return}else f=i===d;i=s,s=s.parent}}rightExcursion(e,t){let r=!0,i=e,s=i.parent;for(;s;){const o=s.children;let u,d,f=!1;for(u=0;u<s.childCount;u++)if(d=o[u],f){if(d.isLeaf())r=t(d);else{const m=d;r=this.walkAllSegments(m,t)}if(!r)return}else f=i===d;i=s,s=s.parent}}insertingWalk(e,t,r,i,s,o){let u=t;const d=e.children;let f,m,g,P;for(f=0;f<e.childCount;f++){m=d[f];const D=this.nodeLength(m,r,i);if(D!==void 0)if(u<D||u===D&&this.breakTie(u,m,s)){if(m.isLeaf()){const M=m,U=o.leaf(M,u,o);if(U.replaceCurrent&&(e.assignChild(U.replaceCurrent,f,!1),U.replaceCurrent.ordinal=m.ordinal),U.next)g=U.next,f++;else{o.structureChange&&this.nodeUpdateLengthNewStructure(e);return}}else{const M=m,U=this.insertingWalk(M,u,r,i,s,o);if(U===void 0){o.structureChange?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,s,i);return}else if(U===hn.theUnfinishedNode){u-=D;continue}else g=U,P=U,f++}break}else u-=D}if(!g&&u===0){if(s!==rt&&o.continuePredicate&&o.continuePredicate(e))return hn.theUnfinishedNode;g=o.leaf(void 0,u,o).next}if(g){for(let D=e.childCount;D>f;D--)e.children[D]=e.children[D-1],e.children[D].index=D;if(e.assignChild(g,f,!1),e.childCount++,e.setOrdinal(g,f),e.childCount<ti){P&&this.nodeUpdateOrdinals(P),o.structureChange?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,s,i);return}else return this.split(e)}else return}split(e){const t=ti/2,r=this.makeBlock(t);e.childCount=t,this.nodeUpdateOrdinals(e);for(let i=0;i<t;i++)r.assignChild(e.children[t+i],i,!1),e.children[t+i]=void 0;return this.nodeUpdateLengthNewStructure(e),this.nodeUpdateLengthNewStructure(r),r}nodeUpdateOrdinals(e){for(let t=0;t<e.childCount;t++){const r=e.children[t];e.setOrdinal(r,t),r.isLeaf()||this.nodeUpdateOrdinals(r)}}annotateRange(e,t,r,i,s,o,u,d){this.ensureIntervalBoundary(e,s,o),this.ensureIntervalBoundary(t,s,o);const f=[],m=u===rt?++this.collabWindow.localSeq:void 0;let g;const P=D=>{const M=D.addProperties(r,i,u,this.collabWindow);return f.push({segment:D,propertyDeltas:M}),this.collabWindow.collaborating&&(u===rt?g=this.addToPendingList(D,g,m):hn.options.zamboniSegments&&this.addToLRUSet(D,u)),!0};this.mapRange({leaf:P},s,o,void 0,e,t),this.mergeTreeDeltaCallback&&f.length>0&&this.mergeTreeDeltaCallback(d,{operation:ut.ANNOTATE,deltaSegments:f}),this.collabWindow.collaborating&&u!==rt&&hn.options.zamboniSegments&&this.zamboniSegments()}markRangeRemoved(e,t,r,i,s,o=!1,u){let d=o;this.ensureIntervalBoundary(e,r,i),this.ensureIntervalBoundary(t,r,i);let f;const m=[],g=[],P=s===rt?++this.collabWindow.localSeq:void 0,D=(j,E,k,z)=>{const K=Zo(j);return K!==void 0?(d=!0,K.removedSeq===rt?(K.removedClientIds.unshift(i),K.removedSeq=s,j.localRemovedSeq=void 0):K.removedClientIds.push(i)):(j.removedClientIds=[i],j.removedSeq=s,j.localRemovedSeq=P,m.push({segment:j})),j.localRefs&&!j.localRefs.empty&&g.push(j),this.collabWindow.collaborating&&(j.removedSeq===rt&&i===this.collabWindow.clientId?f=this.addToPendingList(j,f,P):hn.options.zamboniSegments&&this.addToLRUSet(j,s)),!0},M=(j,E,k,z)=>(d?this.nodeUpdateLengthNewStructure(j):this.blockUpdateLength(j,s,i),!0);this.mapRange({leaf:D,post:M},r,i,void 0,e,t);const U=this.collabWindow.collaborating&&i===this.collabWindow.clientId;for(const j of g)this.updateSegmentRefsAfterMarkRemoved(j,U);this.mergeTreeDeltaCallback&&m.length>0&&this.mergeTreeDeltaCallback(u,{operation:ut.REMOVE,deltaSegments:m}),this.collabWindow.collaborating&&s!==rt&&hn.options.zamboniSegments&&this.zamboniSegments()}nodeUpdateLengthNewStructure(e,t=!1){this.blockUpdate(e),this.collabWindow.collaborating&&(e.partialLengths=sn.combine(this,e,this.collabWindow,t))}removeLocalReferencePosition(e){var t;const r=e.getSegment();if(r){const i=(t=r==null?void 0:r.localRefs)===null||t===void 0?void 0:t.removeLocalRef(e);return i!==void 0&&this.blockUpdatePathLengths(r.parent,Ta,Ga),i}}createLocalReferencePosition(e,t,r,i,s){var o;if(QK(e)&&!Xt(r,et.SlideOnRemove|et.Transient))throw new Ct("Can only create SlideOnRemove or Transient local reference position on a removed segment");const u=(o=e.localRefs)!==null&&o!==void 0?o:new ao(e);e.localRefs=u;const d=u.createLocalRef(t,r,i,s);return this.blockUpdatePathLengths(e.parent,Ta,Ga),d}removeLocalReference(e,t){e.localRefs&&e.localRefs.removeLocalRef(t)&&this.blockUpdatePathLengths(e.parent,Ta,Ga)}addLocalReference(e){const t=e.segment;let r=t.localRefs;r||(r=new ao(t),t.localRefs=r),r.addLocalRef(e),this.blockUpdatePathLengths(t.parent,Ta,Ga)}blockUpdate(e){var t;let r=0;const i=e.hierBlock();i&&(i.rightmostTiles=Dr(),i.leftmostTiles=Dr(),i.rangeStacks={});for(let s=0;s<e.childCount;s++){const o=e.children[s];r+=(t=eJ(this,o))!==null&&t!==void 0?t:0,i&&i.addNodeReferences(this,o),this.blockUpdateActions&&this.blockUpdateActions.child(e,s)}e.cachedLength=r}blockUpdatePathLengths(e,t,r,i=!1){let s=e;for(;s!==void 0;)i?this.nodeUpdateLengthNewStructure(s):this.blockUpdateLength(s,t,r),s=s.parent}blockUpdateLength(e,t,r){this.blockUpdate(e),this.collabWindow.collaborating&&t!==rt&&t!==Ta&&(e.partialLengths!==void 0&&hn.options.incrementalUpdate&&r!==tu?e.partialLengths.update(this,e,t,r,this.collabWindow):e.partialLengths=sn.combine(this,e,this.collabWindow))}map(e,t,r,i){this.nodeMap(this.root,e,0,t,r,i)}mapRange(e,t,r,i,s,o,u=!1){u&&(s&&this.ensureIntervalBoundary(s,t,r),o&&this.ensureIntervalBoundary(o,t,r)),this.nodeMap(this.root,e,0,t,r,i,s,o)}incrementalBlockMap(e){for(var t;!e.empty();){const r=e.top();if(r.op!==Ul.Go)return;if(r.childIndex===0&&(r.start===void 0&&(r.start=0),r.end===void 0&&(r.end=this.blockLength(r.block,r.refSeq,r.clientId)),r.actions.pre&&r.actions.pre(r)),r.op===Ul.Go&&r.childIndex<r.block.childCount){const i=r.block.children[r.childIndex],s=(t=this.nodeLength(i,r.refSeq,r.clientId))!==null&&t!==void 0?t:0;if(s>0&&r.start<s&&r.end>0)if(i.isLeaf())r.actions.leaf(i,r);else{const o=new nJ(i,r.actions,r.pos,r.refSeq,r.clientId,r.context,r.start,r.end,0);e.push(o)}r.pos+=s,r.start-=s,r.end-=s,r.childIndex++}else r.childIndex===r.block.childCount&&(r.op===Ul.Go&&r.actions.post&&r.actions.post(r),e.pop())}}nodeMap(e,t,r,i,s,o,u,d){var f;let m=u,g=d,P=r;m===void 0&&(m=0),g===void 0&&(g=this.blockLength(e,i,s));let D=!0;if(t.pre&&(D=t.pre(e,P,i,s,m,g,o),!D))return!0;const M=e.children;for(let U=0;U<e.childCount;U++){const j=M[U],E=(f=this.nodeLength(j,i,s))!==null&&f!==void 0?f:0;if(D&&g>0&&E>0&&m<E&&(j.isLeaf()?t.leaf&&(D=t.leaf(j,P,i,s,m,g,o)):D&&(D=this.nodeMap(j,t,P,i,s,o,m,g))),!D)break;t.shift&&t.shift(j,P,i,s,m,g,o),P+=E,m-=E,g-=E}return D&&t.post&&(D=t.post(e,P,i,s,m,g,o)),D}walkAllSegments(e,t,r){let i=!0;const s=e.children;for(let o=0;i&&o<e.childCount;o++){const u=s[o];i=u.isLeaf()?t(u,r):this.walkAllSegments(u,t,r)}return i}nodeMapReverse(e,t,r,i,s){let o=!0;const u=e.children;for(let d=e.childCount-1;d>=0;d--){const f=u[d];if(o&&(f.isLeaf()?o=t(f,r,i,s,0,0,void 0):o&&(o=this.nodeMapReverse(f,t,r,i,s))),!o)break}return o}}hn.zamboniSegmentsMaxCount=2;hn.options={incrementalUpdate:!0,insertAfterRemovedSegs:!0,zamboniSegments:!0};hn.theUnfinishedNode={childCount:-1};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function cJ(n,e,t){const r=n.getId();if(r)return{combiningOp:t,props:e,relativePos1:{id:r,before:!0},relativePos2:{id:r},type:ut.ANNOTATE}}function nw(n,e,t,r){return{combiningOp:r,pos1:n,pos2:e,props:t,type:ut.ANNOTATE}}function rw(n,e){return{pos1:n,pos2:e,type:ut.REMOVE}}function uS(n,e){return S3(n,e.toJSONObject())}function S3(n,e){return{pos1:n,seg:e,type:ut.INSERT}}function eg(...n){return{ops:n,type:ut.GROUP}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function dJ(n){return!!n&&typeof n=="object"&&"json"in n}function aR(n,e,t,r,i,s){let o;switch(e.version!==void 0&&t.send({eventName:"MergeTreeChunk:serializeAsMinSupportedVersion",category:"generic",fromChunkVersion:e.version,toChunkVersion:void 0}),e.version){case void 0:o=e,o.headerMetadata=w3(n,o);break;case"1":const u=e,d=n===nn.header?u.headerMetadata:void 0;o={version:void 0,chunkStartSegmentIndex:u.startIndex,chunkLengthChars:u.length,chunkSegmentCount:u.segmentCount,segmentTexts:u.segments,totalLengthChars:d==null?void 0:d.totalLength,totalSegmentCount:d==null?void 0:d.totalSegmentCount,chunkSequenceNumber:d==null?void 0:d.sequenceNumber,chunkMinSequenceNumber:d==null?void 0:d.minSequenceNumber,headerMetadata:d};break;default:throw new Error(`Unsupported chunk path: ${n} version: ${e.version}`)}return i.stringify(o,s)}function uR(n,e,t,r,i,s){const o=b3(n,e);return i.stringify(o,s)}function b3(n,e,t,r){switch(e.version){case void 0:{const i=e;return{version:"1",length:i.chunkLengthChars,segmentCount:i.chunkSegmentCount,headerMetadata:w3(n,i),segments:i.segmentTexts,startIndex:i.chunkStartSegmentIndex}}case"1":return e;default:throw new Error(`Unsupported chunk path: ${n} version: ${e.version}`)}}function w3(n,e,t){if(n===nn.header){if(e.headerMetadata!==void 0)return e.headerMetadata;const r=[{id:nn.header}];return e.chunkLengthChars<e.totalLengthChars&&r.push({id:nn.body}),{orderedChunkMetadata:r,minSequenceNumber:e.chunkMinSequenceNumber,sequenceNumber:e.chunkSequenceNumber,totalLength:e.totalLengthChars,totalSegmentCount:e.totalSegmentCount}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class nn{constructor(e,t,r,i){var s,o;this.mergeTree=e,this.filename=r,this.onCompletion=i,this.logger=at.create(t,"Snapshot"),this.chunkSize=(o=(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.mergeTreeSnapshotChunkSize)!==null&&o!==void 0?o:nn.sizeOfFirstChunk}getSeqLengthSegs(e,t,r,i=0){const s=[];let o=0,u=0;for(;o<r&&i+u<e.length;){const d=e[i+u];s.push(d),o+=t[i+u],u++}return{version:void 0,chunkStartSegmentIndex:i,chunkSegmentCount:u,chunkLengthChars:o,totalLengthChars:this.header.segmentsTotalLength,totalSegmentCount:e.length,chunkSequenceNumber:this.header.seq,segmentTexts:s}}emit(e,t,r){var i,s;const o=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize);let u=o.chunkLengthChars,d=o.chunkSegmentCount;const f=new Tr;if(f.addBlob(nn.header,aR(nn.header,o,this.logger,this.mergeTree.options,t,r)),o.chunkSegmentCount<o.totalSegmentCount){const m=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.header.segmentsTotalLength,o.chunkSegmentCount);u+=m.chunkLengthChars,d+=m.chunkSegmentCount,f.addBlob(nn.body,aR(nn.body,m,this.logger,this.mergeTree.options,t,r))}return Ge(u===this.header.segmentsTotalLength,93),Ge(d===o.totalSegmentCount,94),e!==void 0&&e.length>0&&f.addBlob((s=(i=this.mergeTree.options)===null||i===void 0?void 0:i.catchUpBlobName)!==null&&s!==void 0?s:nn.catchupOps,t?t.stringify(e,r):JSON.stringify(e)),f.getSummaryTree()}extractSync(){const e=this.mergeTree.getCollabWindow();this.seq=e.minSeq,this.header={segmentsTotalLength:this.mergeTree.getLength(this.mergeTree.collabWindow.minSeq,tu),seq:this.mergeTree.collabWindow.minSeq};const t=[];let r;const i=(o,u,d,f,m,g)=>(o.seq!==rt&&o.seq<=this.seq&&(o.removedSeq===void 0||o.removedSeq===rt||o.removedSeq>this.seq)&&(r!=null&&r.canAppend(o)&&Yh(r.properties,o.properties)?(r=r.clone(),r.append(o.clone())):(r&&t.push(r),r=o)),!0);this.mergeTree.map({leaf:i},this.seq,tu,void 0),r&&t.push(r),this.segments=[],this.segmentLengths=[];let s=0;return t.map(o=>{s+=o.cachedLength,this.segments.push(o.toJSONObject()),this.segmentLengths.push(o.cachedLength)}),this.header.segmentsTotalLength!==s&&(this.logger.sendErrorEvent({eventName:"SegmentsTotalLengthMismatch",totalLength:s,segmentsTotalLength:this.header.segmentsTotalLength}),this.header.segmentsTotalLength=s),this.segments}}nn.header="header";nn.body="body";nn.catchupOps="catchupOps";nn.sizeOfFirstChunk=1e4;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class bu{constructor(e,t,r,i,s){var o,u;this.mergeTree=e,this.getLongClientId=r,this.filename=i,this.onCompletion=s,this.logger=at.create(t,"Snapshot"),this.chunkSize=(u=(o=e==null?void 0:e.options)===null||o===void 0?void 0:o.mergeTreeSnapshotChunkSize)!==null&&u!==void 0?u:bu.chunkSize;const{currentSeq:d,minSeq:f}=e.getCollabWindow();this.header={minSequenceNumber:f,sequenceNumber:d,orderedChunkMetadata:[],totalLength:0,totalSegmentCount:0},this.segments=[],this.segmentLengths=[]}getSeqLengthSegs(e,t,r,i=0){const s=[];let o=0,u=0;for(;o<r&&i+u<e.length;){const d=e[i+u];s.push(d),o+=t[i+u],u++}return{version:"1",segmentCount:u,length:o,segments:s,startIndex:i,headerMetadata:void 0}}emit(e,t){const r=[];this.header.totalSegmentCount=0,this.header.totalLength=0;do{const u=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize,this.header.totalSegmentCount);r.push(u),this.header.totalSegmentCount+=u.segmentCount,this.header.totalLength+=u.length}while(this.header.totalSegmentCount<this.segments.length);const i=r.shift();i.headerMetadata=this.header,i.headerMetadata.orderedChunkMetadata=[{id:nn.header}];const s=[];r.forEach((u,d)=>{const f=`${nn.body}_${d}`;this.header.orderedChunkMetadata.push({id:f}),s.push([f,uR(f,u,this.logger,this.mergeTree.options,e,t)])});const o=new Tr;return o.addBlob(nn.header,uR(nn.header,i,this.logger,this.mergeTree.options,e,t)),s.forEach(u=>{o.addBlob(u[0],u[1])}),o.getSummaryTree()}extractSync(){const e=this.mergeTree,t=this.header.minSequenceNumber,r=(u,d)=>{this.segments.push(u),this.segmentLengths.push(d)},i=u=>{u&&r(u.toJSONObject(),u.cachedLength)};let s;const o=u=>{var d;if(u.seq===rt||u.removedSeq<=t)return!0;if(u.seq<=t&&(u.removedSeq===void 0||u.removedSeq===rt))s?s.canAppend(u)&&Yh(s.properties,u.properties)?(s=s.clone(),s.append(u.clone())):(i(s),s=u):s=u;else{i(s),s=void 0;const f={json:u.toJSONObject()};u.seq>t&&(f.seq=u.seq,f.client=this.getLongClientId(u.clientId)),u.removedSeq!==void 0&&(Ge(u.removedSeq!==rt&&u.removedSeq>t,101),f.removedSeq=u.removedSeq,f.removedClient=u.removedClientIds!==void 0?this.getLongClientId(u.removedClientIds[0]):void 0,f.removedClientIds=(d=u.removedClientIds)===null||d===void 0?void 0:d.map(m=>this.getLongClientId(m))),Ge(f.seq!==void 0&&f.client!==void 0||f.removedSeq!==void 0&&f.removedClient!==void 0,102),r(f,u.cachedLength)}return!0};return e.walkAllSegments(e.root,o,this),i(s),this.segments}static async loadChunk(e,t,r,i,s){const o=await e.readBlob(t),u=tw(o,"utf8");return bu.processChunk(t,u,r,i,s)}static processChunk(e,t,r,i,s){const o=s?s.parse(t):JSON.parse(t);return b3(e,o)}}bu.chunkSize=1e4;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class hJ{constructor(e,t,r,i,s){this.runtime=e,this.client=t,this.mergeTree=r,this.serializer=s,this.specToSegment=o=>{var u;let d;return dJ(o)?(d=this.client.specToSegment(o.json),d.clientId=o.client!==void 0?this.client.getOrAddShortClientId(o.client):tu,d.seq=o.seq!==void 0?o.seq:Or,o.removedSeq!==void 0&&(d.removedSeq=o.removedSeq),o.removedClient!==void 0&&(d.removedClientIds=[this.client.getOrAddShortClientId(o.removedClient)]),o.removedClientIds!==void 0&&(d.removedClientIds=(u=o.removedClientIds)===null||u===void 0?void 0:u.map(f=>this.client.getOrAddShortClientId(f)))):(d=this.client.specToSegment(o),d.seq=Or,d.clientId=tu),d},this.logger=at.create(i,"SnapshotLoader")}async initialize(e){const t=e.readBlob(nn.header).then(i=>(Ge(!!i,95),this.loadHeader(tw(i,"utf8")))),r=this.loadBodyAndCatchupOps(t,e);return r.catch(i=>this.logger.sendErrorEvent({eventName:"CatchupOpsLoadFailure"},i)),await t,{catchupOpsP:r}}async loadBodyAndCatchupOps(e,t){const r=t.list(""),i=await e;await this.loadBody(i,t);const s=await r;if(s.length===i.headerMetadata.orderedChunkMetadata.length+1)return i.headerMetadata.orderedChunkMetadata.forEach(o=>s.splice(s.indexOf(o.id),1)),Ge(s.length===1,96),this.loadCatchupOps(t.readBlob(s[0]));if(s.length!==i.headerMetadata.orderedChunkMetadata.length)throw new Error("Unexpected blobs in snapshot");return[]}loadHeader(e){var t;const r=bu.processChunk(nn.header,e,this.logger,this.mergeTree.options,this.serializer),i=r.segments.map(this.specToSegment);if(this.mergeTree.reloadFromSegments(i),r.headerMetadata===void 0)throw new Error("header metadata not available");return this.runtime.attachState!==Qe.Detached&&this.client.startOrUpdateCollaboration((t=this.runtime.clientId)!==null&&t!==void 0?t:"snapshot",r.headerMetadata.minSequenceNumber!==void 0?r.headerMetadata.minSequenceNumber:r.headerMetadata.sequenceNumber,r.headerMetadata.sequenceNumber),r}async loadBody(e,t){if(Ge(e.length<=e.headerMetadata.totalLength,97),Ge(e.segmentCount<=e.headerMetadata.totalSegmentCount,98),e.segmentCount===e.headerMetadata.totalSegmentCount)return;const r=[];let i=e.length;for(let f=1;f<e.headerMetadata.orderedChunkMetadata.length;f++){const m=await bu.loadChunk(t,e.headerMetadata.orderedChunkMetadata[f].id,this.logger,this.mergeTree.options,this.serializer);i+=m.length,r.push(...m.segments.map(this.specToSegment))}Ge(i===e.headerMetadata.totalLength,99),Ge(e.segmentCount+r.length===e.headerMetadata.totalSegmentCount,100);const s=this.mergeTree,o=(f,m,g)=>{s.insertSegments(s.root.cachedLength,f,Or,m,g,void 0)},u=[],d=()=>{u.length>0&&o(u,tu,Or)};for(const f of r){const m=f.clientId,g=f.seq;m===tu&&g===Or?u.push(f):(d(),o([f],m,g))}d()}async loadCatchupOps(e){return JSON.parse(tw(await e,"utf8"))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const lR=256;class An extends Yg{constructor(e){super(),this.text=e,this.type=An.type,this.cachedLength=e.length}static is(e){return e.type===An.type}static make(e,t){const r=new An(e);return t&&r.addProperties(t),r}static fromJSONObject(e){if(typeof e=="string")return new An(e);if(e&&typeof e=="object"&&"text"in e){const t=e;return An.make(t.text,t.props)}}toJSONObject(){return this.properties?{text:this.text,props:this.properties}:this.text}clone(e=0,t){const r=this.text.substring(e,t),i=An.make(r,this.properties);return this.cloneInto(i),i}canAppend(e){return!this.text.endsWith(`
`)&&An.is(e)&&(this.cachedLength<=lR||e.cachedLength<=lR)}toString(){return this.text}append(e){if(An.is(e))ao.append(this,e),this.text+=e.text,this.cachedLength=this.text.length;else throw new Error("can only append text segment")}removeRange(e,t){let r="";const i=this.text.length;return e>0&&(r+=this.text.substring(0,e)),t<i&&(r+=this.text.substring(t)),this.text=r,this.cachedLength=r.length,r.length===0}createSplitSegmentAt(e){if(e>0){const t=this.text.substring(e);return this.text=this.text.substring(0,e),this.cachedLength=this.text.length,new An(t)}}}An.type="TextSegment";function cR(n){return n.parallelArrays===!0}class fJ{constructor(e){this.mergeTree=e,this.gatherText=(t,r,i,s,o,u,d)=>{var f,m;let g=o;if(An.is(t)){let P="",D="";if(cR(d)){const M=[],U=[];!((f=t.properties)===null||f===void 0)&&f["font-weight"]&&M.push("b"),!((m=t.properties)===null||m===void 0)&&m["text-decoration"]&&M.push("u");const j=[];if(M.length>0){for(const E of M)d.tagsInProgress.includes(E)||(P+=`<${E}>`,U.push(E));for(const E of d.tagsInProgress)M.includes(E)||(D+=`</${E}>`,j.push(E));for(const E of U.reverse())d.tagsInProgress.push(E)}else for(const E of d.tagsInProgress)D+=`</${E}>`,j.push(E);for(const E of j){const k=d.tagsInProgress.indexOf(E);k>=0&&d.tagsInProgress.splice(k,1)}}d.textSegment.text+=D,d.textSegment.text+=P,g<=0&&u>=t.text.length?d.textSegment.text+=t.text:(g<0&&(g=0),u>=t.text.length?d.textSegment.text+=t.text.substring(g):d.textSegment.text+=t.text.substring(g,u))}else if(d.placeholder&&d.placeholder.length>0)if(d.placeholder==="*"){const P=t;d.textSegment.text+=`
${P.toString()}`}else for(let P=0;P<t.cachedLength;P++)d.textSegment.text+=d.placeholder;else if(cR(d)){const P=t;P.hasTileLabel(d.parallelMarkerLabel)&&(d.parallelMarkers.push(P),d.parallelText.push(d.textSegment.text),d.textSegment.text="")}return!0}}getTextAndMarkers(e,t,r,i,s){const o=this.getValidRange(i,s,e,t),u={parallelArrays:!0,parallelMarkerLabel:r,parallelMarkers:[],parallelText:[],tagsInProgress:[],textSegment:new An("")};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,u,o.start,o.end),{parallelText:u.parallelText,parallelMarkers:u.parallelMarkers}}getText(e,t,r="",i,s){const o=this.getValidRange(i,s,e,t),u={textSegment:new An(""),placeholder:r};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,u,o.start,o.end),u.textSegment.text}getValidRange(e,t,r,i){return{end:t??this.mergeTree.getLength(r,i),start:e??0}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Rp(n){return n.trace().duration*1e3}class Zx{constructor(e,t,r){this.specToSegment=e,this.logger=t,this.measureOps=!1,this.accumTime=0,this.localTime=0,this.localOps=0,this.accumWindowTime=0,this.accumWindow=0,this.accumOps=0,this.maxWindowTime=0,this.clientNameToIds=new Ah(iJ),this.shortClientIdMap=[],this.pendingConsensus=new Map,this.mergeTree=new hn(r)}get mergeTreeDeltaCallback(){return this.mergeTree.mergeTreeDeltaCallback}set mergeTreeDeltaCallback(e){this.mergeTree.mergeTreeDeltaCallback=e}get mergeTreeMaintenanceCallback(){return this.mergeTree.mergeTreeMaintenanceCallback}set mergeTreeMaintenanceCallback(e){this.mergeTree.mergeTreeMaintenanceCallback=e}peekPendingSegmentGroups(e=1){var t,r;if(e===1)return(t=this.mergeTree.pendingSegments)===null||t===void 0?void 0:t.last();let i=0;return(r=this.mergeTree.pendingSegments)===null||r===void 0?void 0:r.some(()=>i<e?(i++,!0):!1,!0)}annotateMarkerNotifyConsensus(e,t,r){const i={name:"consensus"},s=this.annotateMarker(e,t,i);if(s){const o={callback:r,marker:e};return this.pendingConsensus.set(e.getId(),o),s}else return}annotateMarker(e,t,r){const i=cJ(e,t,r);if(this.applyAnnotateRangeOp({op:i}))return i}annotateRangeLocal(e,t,r,i){const s=nw(e,t,r,i);if(this.applyAnnotateRangeOp({op:s}))return s}removeRangeLocal(e,t){const r=rw(e,t);if(this.applyRemoveRangeOp({op:r}))return r}insertSegmentLocal(e,t){if(t.cachedLength<=0)return;const r=uS(e,t);if(this.applyInsertOp({op:r}))return r}insertAtReferencePositionLocal(e,t){const r=this.mergeTree.referencePositionToLocalPosition(e,this.getCurrentSeq(),this.getClientId());if(r===Au.DetachedPosition)return;const i=uS(r,t),s={op:i};let o;return this.measureOps&&(o=Yu.start()),this.mergeTree.insertAtReferencePosition(e,t,s),this.completeAndLogOp(s,this.getClientSequenceArgs(s),{start:i.pos1},o),i}walkSegments(e,t,r,i,s=!1){this.mergeTree.mapRange({leaf:e},this.getCurrentSeq(),this.getClientId(),i,t,r,s)}serializeGCData(e,t){this.mergeTree.walkAllSegments(this.mergeTree.root,r=>(r.removedSeq===void 0&&t.stringify(r.clone().toJSONObject(),e),!0))}getCollabWindow(){return this.mergeTree.getCollabWindow()}getPosition(e){return(e==null?void 0:e.parent)===void 0?-1:this.mergeTree.getPosition(e,this.getCurrentSeq(),this.getClientId())}addLocalReference(e){return this.mergeTree.addLocalReference(e)}removeLocalReference(e){return this.removeLocalReferencePosition(e)}createLocalReferencePosition(e,t,r,i){return this.mergeTree.createLocalReferencePosition(e,t,r,i,this)}removeLocalReferencePosition(e){return this.mergeTree.removeLocalReferencePosition(e)}localReferencePositionToPosition(e){return this.mergeTree.referencePositionToLocalPosition(e)}posFromRelativePos(e){return this.mergeTree.posFromRelativePos(e)}getMarkerFromId(e){return this.mergeTree.getMarkerFromId(e)}applyRemoveRangeOp(e){Ge(e.op.type===ut.REMOVE,45);const t=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(t,r);if(!i)return!1;let s;return this.measureOps&&(s=Yu.start()),this.mergeTree.markRangeRemoved(i.start,i.end,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,!1,e),this.completeAndLogOp(e,r,i,s),!0}applyAnnotateRangeOp(e){Ge(e.op.type===ut.ANNOTATE,46);const t=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(t,r);if(!i)return!1;let s;return this.measureOps&&(s=Yu.start()),this.mergeTree.annotateRange(i.start,i.end,t.props,t.combiningOp,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,e),this.completeAndLogOp(e,r,i,s),!0}applyInsertOp(e){Ge(e.op.type===ut.INSERT,47);const t=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(t,r);if(!i)return!1;let s;if(t.seg&&(s=[this.specToSegment(t.seg)]),!s||s.length===0)return!1;let o;return this.measureOps&&(o=Yu.start()),this.mergeTree.insertSegments(i.start,s,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,e),this.completeAndLogOp(e,r,i,o),!0}completeAndLogOp(e,t,r,i){e.sequencedMessage?(Ge(this.mergeTree.getCollabWindow().currentSeq<t.sequenceNumber,48),Ge(this.mergeTree.getCollabWindow().minSeq<=e.sequencedMessage.minimumSequenceNumber,49),i&&(this.accumTime+=Rp(i),this.accumOps++,this.accumWindow+=this.getCurrentSeq()-this.getCollabWindow().minSeq)):i&&(this.localTime+=Rp(i),this.localOps++)}getValidOpRange(e,t){let r=e.pos1;r===void 0&&e.relativePos1&&(r=this.mergeTree.posFromRelativePos(e.relativePos1,t.referenceSequenceNumber,t.clientId));let i=e.pos2;if(i===void 0&&e.relativePos2&&(i=this.mergeTree.posFromRelativePos(e.relativePos2,t.referenceSequenceNumber,t.clientId)),t.clientId===this.getClientId()){const s=this.getLength(),o=[];if((r===void 0||r<0||r>s||r===s&&e.type!==ut.INSERT)&&o.push("start"),(e.type!==ut.INSERT||i!==void 0)&&(i===void 0||i<=r)&&o.push("end"),o.length>0)throw new st("RangeOutOfBounds",{usageError:!0,end:i,invalidPositions:o.toString(),length:s,opPos1:e.pos1,opPos1Relative:e.relativePos1!==void 0,opPos2:e.pos2,opPos2Relative:e.relativePos2!==void 0,opType:e.type,start:r})}return{start:r,end:i}}getClientSequenceArgsForMessage(e){if(e)return{clientId:this.getOrAddShortClientId(e.clientId),referenceSequenceNumber:e.referenceSequenceNumber,sequenceNumber:e.sequenceNumber};{const t=this.getCollabWindow();return{clientId:t.clientId,referenceSequenceNumber:t.currentSeq,sequenceNumber:this.getLocalSequenceNumber()}}}getClientSequenceArgs(e){return this.getClientSequenceArgsForMessage(e.sequencedMessage)}ackPendingSegment(e){const t=r=>{let i;this.measureOps&&(i=Yu.start()),this.mergeTree.ackPendingSegment(r),r.op.type===ut.ANNOTATE&&r.op.combiningOp&&r.op.combiningOp.name==="consensus"&&this.updateConsensusProperty(r.op,r.sequencedMessage),i&&(this.accumTime+=Rp(i),this.accumOps++,this.accumWindow+=this.getCurrentSeq()-this.getCollabWindow().minSeq)};if(e.op.type===ut.GROUP)for(const r of e.op.ops)t({groupOp:e.op,op:r,sequencedMessage:e.sequencedMessage});else t(e)}cloneFromSegments(){const e=new Zx(this.specToSegment,this.logger,this.mergeTree.options),t=[],r=this.mergeTree.blockClone(this.mergeTree.root,t);return e.mergeTree.root=r,e}getOrAddShortClientId(e){return this.clientNameToIds.get(e)||this.addLongClientId(e),this.getShortClientId(e)}getShortClientId(e){return this.clientNameToIds.get(e).data}getLongClientId(e){return e>=0?this.shortClientIdMap[e]:"original"}addLongClientId(e){this.clientNameToIds.put(e,this.shortClientIdMap.length),this.shortClientIdMap.push(e)}findReconnectionPosition(e,t){Ge(t<=this.mergeTree.collabWindow.localSeq,50);let r=0;return this.mergeTree.walkAllSegments(this.mergeTree.root,i=>i===e?!1:((i.localSeq===void 0||i.localSeq<=t)&&(i.removedSeq===void 0||i.localRemovedSeq>t)&&(r+=i.cachedLength),!0)),r}rebasePosition(e,t,r){Ge(r<=this.mergeTree.collabWindow.localSeq,768);let i,s=0,o=e;const u=m=>m.seq!==void 0&&m.seq!==rt&&m.seq<=t||m.localSeq!==void 0&&m.localSeq<=r,d=({removedSeq:m,localRemovedSeq:g})=>m!==void 0&&m!==rt&&m<=t||g!==void 0&&g<=r;this.mergeTree.walkAllSegments(this.mergeTree.root,m=>(Ge(m.seq!==void 0||m.localSeq!==void 0,769),i=m,u(m)&&!d(m)&&(s+=m.cachedLength,o>=m.cachedLength&&(o-=m.cachedLength)),s<=e)),Ge(i!==void 0,770);const f=this.getCollabWindow().currentSeq;return(i.removedSeq!==void 0&&i.removedSeq!==rt&&i.removedSeq<=f||i.localRemovedSeq!==void 0&&i.localRemovedSeq<=r)&&(o=0),Ge(0<=o&&o<i.cachedLength,771),this.findReconnectionPosition(i,r)+o}resetPendingDeltaToOps(e,t){var r,i;Ge(!!t,51);const s=(r=this.mergeTree.pendingSegments)===null||r===void 0?void 0:r.dequeue();Ge(t===s,52);const o=[];for(const u of t.segments.sort((d,f)=>d.ordinal<f.ordinal?-1:1)){const d=u.segmentGroups.dequeue();Ge(t===d,53);const f=this.findReconnectionPosition(u,t.localSeq);let m;switch(e.type){case ut.ANNOTATE:Ge(((i=u.propertyManager)===null||i===void 0?void 0:i.hasPendingProperties())===!0,54),(u.removedSeq===void 0||u.localRemovedSeq!==void 0)&&(m=nw(f,f+u.cachedLength,e.props,e.combiningOp));break;case ut.INSERT:Ge(u.seq===rt,55);let g=u;typeof e.seg=="object"&&e.seg.props!==void 0&&(g=u.clone(),g.properties=e.seg.props),m=uS(f,g);break;case ut.REMOVE:u.localRemovedSeq!==void 0&&(m=rw(f,f+u.cachedLength));break;default:throw new Error("Invalid op type")}if(m){const g={segments:[],localSeq:t.localSeq};u.segmentGroups.enqueue(g),this.mergeTree.pendingSegments.enqueue(g),o.push(m)}}return o}applyRemoteOp(e){const t=e.op,r=e.sequencedMessage;switch(this.getOrAddShortClientId(r.clientId),t.type){case ut.INSERT:this.applyInsertOp(e);break;case ut.REMOVE:this.applyRemoveRangeOp(e);break;case ut.ANNOTATE:this.applyAnnotateRangeOp(e);break;case ut.GROUP:{for(const i of t.ops)this.applyRemoteOp({op:i,groupOp:t,sequencedMessage:r});break}}}applyStashedOp(e){let t;switch(e.type){case ut.INSERT:this.applyInsertOp({op:e}),t=this.peekPendingSegmentGroups();break;case ut.REMOVE:this.applyRemoveRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case ut.ANNOTATE:this.applyAnnotateRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case ut.GROUP:return e.ops.map(r=>this.applyStashedOp(r));default:BK(e,"unrecognized op type")}return Ge(!!t,731),t}applyMsg(e,t=!1){var r;if(this.getOrAddShortClientId(e.clientId),e.type===ew.Operation){const i={op:e.contents,sequencedMessage:e};((r=i.sequencedMessage)===null||r===void 0?void 0:r.clientId)===this.longClientId||t?this.ackPendingSegment(i):this.applyRemoteOp(i)}this.updateSeqNumbers(e.minimumSequenceNumber,e.sequenceNumber)}updateSeqNumbers(e,t){const r=this.mergeTree.getCollabWindow();Ge(r.currentSeq<=t,56),r.currentSeq=t,Ge(e<=t,57),this.updateMinSeq(e)}resolveRemoteClientPosition(e,t,r){const i=this.getOrAddShortClientId(r);return this.mergeTree.resolveRemoteClientPosition(e,t,i)}regeneratePendingOp(e,t){const r=[];if(e.type===ut.GROUP)if(Array.isArray(t)){Ge(e.ops.length===t.length,58);for(let i=0;i<e.ops.length;i++)r.push(...this.resetPendingDeltaToOps(e.ops[i],t[i]))}else Ge(e.ops.length===1,59),r.push(...this.resetPendingDeltaToOps(e.ops[0],t));else Ge(e.type!==ut.GROUP,60),Ge(!Array.isArray(t),61),r.push(...this.resetPendingDeltaToOps(e,t));return r.length===1?r[0]:eg(...r)}createTextHelper(){return new fJ(this.mergeTree)}summarize(e,t,r,i){var s;const o=e.deltaManager,u=o.minimumSequenceNumber;if(this.updateSeqNumbers(u,o.lastSequenceNumber),Ge(this.getCollabWindow().minSeq===u,62),((s=this.mergeTree.options)===null||s===void 0?void 0:s.newMergeTreeSnapshotFormat)===!0){Ge(i===void 0||i.length===0,63);const d=new bu(this.mergeTree,this.logger,f=>this.getLongClientId(f));return d.extractSync(),d.emit(r,t)}else{const d=new nn(this.mergeTree,this.logger);return d.extractSync(),d.emit(i,r,t)}}async load(e,t,r){return new hJ(e,this,this.mergeTree,this.logger,r).initialize(t)}getStackContext(e,t){return this.mergeTree.getStackContext(e,this.getCollabWindow().clientId,t)}getLocalSequenceNumber(){return this.getCollabWindow().collaborating?rt:Or}localTransaction(e){for(const t of e.ops){const r={op:t,groupOp:e};switch(t.type){case ut.INSERT:this.applyInsertOp(r);break;case ut.ANNOTATE:this.applyAnnotateRangeOp(r);break;case ut.REMOVE:this.applyRemoveRangeOp(r);break}}}updateConsensusProperty(e,t){const r=e.relativePos1.id,i=this.pendingConsensus.get(r);i&&i.marker.addProperties(e.props,e.combiningOp,t.sequenceNumber),this.mergeTree.addMinSeqListener(t.sequenceNumber,()=>i.callback(i.marker))}updateMinSeq(e){let t;if(this.measureOps&&(t=Yu.start()),this.mergeTree.setMinSeq(e),t){const r=Rp(t);this.accumWindowTime+=r,r>this.maxWindowTime&&(this.maxWindowTime=r)}}getContainingSegment(e,t){const r=this.getClientSequenceArgsForMessage(t);return this.mergeTree.getContainingSegment(e,r.referenceSequenceNumber,r.clientId)}getSlideToSegment(e){return this.mergeTree._getSlideToSegment(e)}getPropertiesAtPosition(e){let t;const i=this.getContainingSegment(e).segment;return i&&(t=i.properties),t}getRangeExtentsOfPosition(e){let t,r;const s=this.getContainingSegment(e).segment;return s&&(t=this.getPosition(s),r=t+s.cachedLength),{posStart:t,posAfterEnd:r}}getCurrentSeq(){return this.getCollabWindow().currentSeq}getClientId(){return this.getCollabWindow().clientId}getLength(){return this.mergeTree.length}startOrUpdateCollaboration(e,t=0,r=0){if(e!==void 0)if(this.longClientId===void 0)this.longClientId=e,this.addLongClientId(this.longClientId),this.mergeTree.startCollaboration(this.getShortClientId(this.longClientId),t,r);else{const i=this.longClientId,s=this.clientNameToIds.get(i).data;this.longClientId=e,this.clientNameToIds.put(e,s),this.shortClientIdMap[s]=e}}findTile(e,t,r=!0){const i=this.getClientId();return this.mergeTree.findTile(e,i,t,r)}}var _p,pJ=new Uint8Array(16);function mJ(){if(!_p&&(_p=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!_p))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _p(pJ)}const gJ=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function vJ(n){return typeof n=="string"&&gJ.test(n)}var zn=[];for(var lS=0;lS<256;++lS)zn.push((lS+256).toString(16).substr(1));function yJ(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(zn[n[e+0]]+zn[n[e+1]]+zn[n[e+2]]+zn[n[e+3]]+"-"+zn[n[e+4]]+zn[n[e+5]]+"-"+zn[n[e+6]]+zn[n[e+7]]+"-"+zn[n[e+8]]+zn[n[e+9]]+"-"+zn[n[e+10]]+zn[n[e+11]]+zn[n[e+12]]+zn[n[e+13]]+zn[n[e+14]]+zn[n[e+15]]).toLowerCase();if(!vJ(t))throw TypeError("Stringified UUID is invalid");return t}function SJ(n,e,t){n=n||{};var r=n.random||(n.rng||mJ)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return yJ(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var bJ=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const Sr="intervalId";var Yi;(function(n){n[n.Simple=0]="Simple",n[n.Nest=1]="Nest",n[n.SlideOnRemove=2]="SlideOnRemove",n[n.Transient=4]="Transient"})(Yi||(Yi={}));function wJ(n,e){return{start:n[0],end:n[1],sequenceNumber:n[2],intervalType:n[3],properties:Object.assign(Object.assign({},n[4]),{[Zh]:e})}}function CJ(n){const{start:e,end:t,sequenceNumber:r,intervalType:i,properties:s}=n;return[e,t,r,i,Object.assign(Object.assign({},s),{[Zh]:void 0})]}class zl{constructor(e,t,r){this.start=e,this.end=t,this.propertyManager=new oc,this.properties={},r&&this.addProperties(r)}getIntervalId(){var e;const t=(e=this.properties)===null||e===void 0?void 0:e[Sr];if(t!==void 0)return`${t}`}getAdditionalPropertySets(){return this.auxProps}addPropertySet(e){this.auxProps===void 0&&(this.auxProps=[]),this.auxProps.push(e)}serialize(e){let t=0;e&&(t=e.getCurrentSeq());const r={end:this.end,intervalType:0,sequenceNumber:t,start:this.start};return this.properties&&(r.properties=this.properties),r}clone(){return new zl(this.start,this.end,this.properties)}compare(e){const t=this.compareStart(e);if(t===0){const r=this.compareEnd(e);if(r===0){const i=this.getIntervalId();if(i){const s=e.getIntervalId();return s?i>s?1:i<s?-1:0:0}return 0}else return r}else return t}compareStart(e){return this.start-e.start}compareEnd(e){return this.end-e.end}overlaps(e){return this.start<=e.end&&this.end>=e.start}union(e){return new zl(Math.min(this.start,e.start),Math.max(this.end,e.end),this.properties)}getProperties(){return this.properties}addProperties(e,t=!1,r,i){if(e)return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,i,r,t)}modify(e,t,r,i){const s=t??this.start,o=r??this.end;if(this.start===s&&this.end===o)return;const u=new zl(s,o);return this.properties&&(u.initializeProperties(),this.propertyManager.copyTo(this.properties,u.properties,u.propertyManager)),u}initializeProperties(){this.propertyManager||(this.propertyManager=new oc),this.properties||(this.properties=Dr())}}class uo{constructor(e,t,r,i){this.start=e,this.end=t,this.intervalType=r,this.propertyManager=new oc,this.properties={},i&&this.addProperties(i)}addPositionChangeListeners(e,t){var r,i,s,o;if(this.callbacks===void 0){this.callbacks={beforePositionChange:e,afterPositionChange:t};const u=(r=(s=this.start).callbacks)!==null&&r!==void 0?r:s.callbacks={},d=(i=(o=this.end).callbacks)!==null&&i!==void 0?i:o.callbacks={};u.beforeSlide=d.beforeSlide=e,u.afterSlide=d.afterSlide=t}}removePositionChangeListeners(){this.callbacks&&(this.callbacks=void 0,this.start.callbacks=void 0,this.end.callbacks=void 0)}serialize(e){const t=this.start.toPosition(),i={end:this.end.toPosition(),intervalType:this.intervalType,sequenceNumber:e.getCurrentSeq(),start:t};return this.properties&&(i.properties=this.properties),i}clone(){return new uo(this.start,this.end,this.intervalType,this.properties)}compare(e){const t=this.compareStart(e);if(t===0){const r=this.compareEnd(e);if(r===0){const i=this.getIntervalId();if(i){const s=e.getIntervalId();return s?i>s?1:i<s?-1:0:0}return 0}else return r}else return t}compareStart(e){return this.start.compare(e.start)}compareEnd(e){return this.end.compare(e.end)}overlaps(e){return this.start.compare(e.end)<=0&&this.end.compare(e.start)>=0}getIntervalId(){var e;const t=(e=this.properties)===null||e===void 0?void 0:e[Sr];if(t!==void 0)return`${t}`}union(e){return new uo(this.start.min(e.start),this.end.max(e.end),this.intervalType)}addProperties(e,t=!1,r,i){return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,i,r,t)}overlapsPos(e,t){const r=this.start.toPosition();return this.start.toPosition()>e&&r<t}modify(e,t,r,i){const s=f=>{let m=f;return i===void 0&&(m&=~et.SlideOnRemove,m|=et.StayOnRemove),m};let o=this.start;t!==void 0&&(o=tg(this.start.getClient(),t,s(this.start.refType),i),o.addProperties(this.start.properties));let u=this.end;r!==void 0&&(u=tg(this.end.getClient(),r,s(this.end.refType),i),u.addProperties(this.end.properties)),o.pairedRef=u,u.pairedRef=o;const d=new uo(o,u,this.intervalType);return this.properties&&(d.initializeProperties(),this.propertyManager.copyTo(this.properties,d.properties,d.propertyManager)),d}initializeProperties(){this.propertyManager||(this.propertyManager=new oc),this.properties||(this.properties=Dr())}}function iw(n,e,t,r){if(e.segment)return n.createLocalReferencePosition(e.segment,e.offset,t,void 0);if(!r&&!Xt(t,et.Transient))throw new Ct("Non-transient references need segment");return new Au(n,void 0,0,t)}function tg(n,e,t,r){let i;return r?(ci((t&et.SlideOnRemove)!==0,757),i=n.getContainingSegment(e,r),i=n.getSlideToSegment(i)):(ci((t&et.SlideOnRemove)===0,758),i=n.getContainingSegment(e)),iw(n,i,t,r)}function xJ(n,e,t,r,i,s){let o=et.RangeBegin,u=et.RangeEnd;i===Yi.Transient?(o=et.Transient,u=et.Transient):(i===Yi.Nest&&(o=et.NestBegin,u=et.NestEnd),s?(o|=et.SlideOnRemove,u|=et.SlideOnRemove):(o|=et.StayOnRemove,u|=et.StayOnRemove));const d=tg(r,e,o,s),f=tg(r,t,u,s);d.pairedRef=f,f.pairedRef=d;const m={[Zh]:[n]};return d.addProperties(m),f.addProperties(m),new uo(d,f,i,m)}class Zg{constructor(e,t,r,i){this.client=e,this.label=t,this.helpers=r,this.onPositionChange=i,this.intervalTree=new qK,this.intervalIdMap=new Map,this.endIntervalTree=new Ah(r.compareEnds)}addConflictResolver(e){this.conflictResolver=e,this.endConflictResolver=(t,r)=>{const i=e(t,r);return{data:i,key:i}}}map(e){this.intervalTree.map(e)}createLegacyId(e,t){return`${Zg.legacyIdPrefix}${e}-${t}`}ensureSerializedId(e){var t;let r=(t=e.properties)===null||t===void 0?void 0:t[Sr];if(r===void 0){r=this.createLegacyId(e.start,e.end);const i={[Sr]:r};e.properties=m3(e.properties,i)}return Object.defineProperty(e.properties,Sr,{configurable:!1,enumerable:!0,writable:!1}),r}mapUntil(e){this.intervalTree.mapUntil(e)}gatherIterationResults(e,t,r,i){if(!this.intervalTree.intervals.isEmpty())if(r===void 0&&i===void 0)t?this.intervalTree.map(s=>{e.push(s)}):this.intervalTree.mapBackward(s=>{e.push(s)});else{const s=this.helpers.create("transient",r,i,this.client,Yi.Transient);if(r===void 0)t?this.intervalTree.map(o=>{s.compareEnd(o)===0&&e.push(o)}):this.intervalTree.mapBackward(o=>{s.compareEnd(o)===0&&e.push(o)});else{const o=i===void 0?m=>s.compareStart(m.key):m=>s.compare(m.key),u=m=>m<=0,d=m=>m>=0,f=m=>{e.push(m.key)};t?this.intervalTree.intervals.walkExactMatchesForward(o,f,u,d):this.intervalTree.intervals.walkExactMatchesBackward(o,f,u,d)}}}findOverlappingIntervals(e,t){if(t<e||this.intervalTree.intervals.isEmpty())return[];const r=this.helpers.create("transient",e,t,this.client,Yi.Transient);return this.intervalTree.match(r).map(s=>s.key)}previousInterval(e){const t=this.helpers.create("transient",e,e,this.client,Yi.Transient),r=this.endIntervalTree.floor(t);if(r)return r.data}nextInterval(e){const t=this.helpers.create("transient",e,e,this.client,Yi.Transient),r=this.endIntervalTree.ceil(t);if(r)return r.data}removeInterval(e,t){const r=this.helpers.create("transient",e,t,this.client,Yi.Transient);return this.intervalTree.remove(r),this.endIntervalTree.remove(r),r}removeIntervalFromIndex(e){this.intervalTree.removeExisting(e),this.endIntervalTree.remove(e);const t=e.getIntervalId();ci(t!==void 0,785),this.intervalIdMap.delete(t)}removeExistingInterval(e){this.removeIntervalFromIndex(e),this.removeIntervalListeners(e)}createInterval(e,t,r,i){return this.helpers.create(this.label,e,t,this.client,r,i)}addInterval(e,t,r,i,s){const o=this.createInterval(e,t,r,s);return o&&(o.properties||(o.properties=Dr()),i&&o.addProperties(i),o.properties[Sr]===void 0&&(o.properties[Sr]=SJ()),this.add(o)),o}addIntervalToIndex(e){const t=e.getIntervalId();ci(t!==void 0,704),Object.defineProperty(e.properties,Sr,{configurable:!1,enumerable:!0,writable:!1}),this.intervalTree.put(e,this.conflictResolver),this.endIntervalTree.put(e,e,this.endConflictResolver),this.intervalIdMap.set(t,e)}add(e){this.addIntervalToIndex(e),this.addIntervalListeners(e)}getIntervalById(e){return this.intervalIdMap.get(e)}changeInterval(e,t,r,i){const s=e.modify(this.label,t,r,i);return s&&(this.removeExistingInterval(e),this.add(s)),s}serialize(){const e=this.client,t=this.intervalTree.intervals.keys();return{label:this.label,intervals:t.map(r=>CJ(r.serialize(e))),version:2}}addIntervalListeners(e){e instanceof uo&&e.addPositionChangeListeners(()=>this.removeIntervalFromIndex(e),()=>{var t;this.addIntervalToIndex(e),(t=this.onPositionChange)===null||t===void 0||t.call(this,e)})}removeIntervalListeners(e){e instanceof uo&&e.removePositionChangeListeners()}}Zg.legacyIdPrefix="legacy";const EJ=(n,e)=>n.end.compare(e.end);class TJ{load(e,t=[]){const r={compareEnds:EJ,create:xJ};return new eE(r,!0,e,t)}store(e){return e.serializeInternal()}}class ea{get name(){return ea.Name}get factory(){return ea._factory}get ops(){return ea._ops}}ea.Name="sharedStringIntervalCollection";ea._factory=new TJ;ea._ops=C3();const PJ=(n,e)=>n.end-e.end;function RJ(n,e,t,r){const i={};return n&&n.length>0&&(i[Zh]=[n]),new zl(e,t,i)}class _J{load(e,t=[]){const r={compareEnds:PJ,create:RJ},i=new eE(r,!1,e,t);return i.attachGraph(void 0,""),i}store(e){return e.serializeInternal()}}class ta{get name(){return ta.Name}get factory(){return ta._factory}get ops(){return ta._ops}}ta.Name="sharedIntervalCollection";ta._factory=new _J;ta._ops=C3();function C3(){const n=(e,t,r)=>{const{localSeq:i}=r,s=e.rebaseLocalInterval(t.opName,t.value,i);return{rebasedOp:Object.assign(Object.assign({},t),{value:s}),rebasedLocalOpMetadata:r}};return new Map([["add",{process:(e,t,r,i)=>{e.ackAdd(t,r,i)},rebase:n}],["delete",{process:(e,t,r,i)=>{e.ackDelete(t,r,i)},rebase:(e,t,r)=>({rebasedOp:t,rebasedLocalOpMetadata:r})}],["change",{process:(e,t,r,i)=>{e.ackChange(t,r,i)},rebase:n}]])}class ll{constructor(e,t=!0,r,i){this.results=[],this.index=0,e.gatherIterationResults(this.results,t,r,i)}next(){let e,t=!0;return this.index<this.results.length&&(e=this.results[this.index++],t=!1),{value:e,done:t}}}class eE extends l3{constructor(e,t,r,i){super(),this.helpers=e,this.requiresClient=t,this.emitter=r,this.pendingChangesStart=new Map,this.pendingChangesEnd=new Map,Array.isArray(i)?this.savedSerializedIntervals=i:this.savedSerializedIntervals=i.intervals.map(s=>wJ(s,i.label))}get attached(){return!!this.localCollection}attachGraph(e,t){if(this.attached)throw new st("Only supports one Sequence attach");if(e===void 0&&this.requiresClient)throw new st("Client required for this collection");if(this.client=e,this.localCollection=new Zg(e,t,this.helpers,r=>this.emit("changeInterval",r,!0,void 0)),this.savedSerializedIntervals)for(const r of this.savedSerializedIntervals)this.localCollection.ensureSerializedId(r),this.localCollection.addInterval(r.start,r.end,r.intervalType,r.properties);this.savedSerializedIntervals=void 0}getNextLocalSeq(){return++this.client.getCollabWindow().localSeq}getIntervalById(e){if(!this.attached)throw new st("attach must be called before accessing intervals");return this.localCollection.getIntervalById(e)}add(e,t,r,i){var s,o;if(!this.attached)throw new st("attach must be called prior to adding intervals");if(r&Yi.Transient)throw new st("Can not add transient intervals");const u=this.localCollection.addInterval(e,t,r,i);if(u){const d={end:t,intervalType:r,properties:u.properties,sequenceNumber:(o=(s=this.client)===null||s===void 0?void 0:s.getCurrentSeq())!==null&&o!==void 0?o:0,start:e};this.emitter.emit("add",void 0,d,{localSeq:this.getNextLocalSeq()})}return this.emit("addInterval",u,!0,void 0),u}deleteExistingInterval(e,t,r){this.localCollection.removeExistingInterval(e),e&&(t?this.emitter.emit("delete",void 0,e.serialize(this.client),{localSeq:this.getNextLocalSeq()}):this.onDeserialize&&this.onDeserialize(e)),this.emit("deleteInterval",e,t,r)}removeIntervalById(e){const t=this.localCollection.getIntervalById(e);return t&&this.deleteExistingInterval(t,!0,void 0),t}changeProperties(e,t){if(!this.attached)throw new st("Attach must be called before accessing intervals");if(typeof e!="string")throw new st("Change API requires an ID that is a string");if(!t)throw new st("changeProperties should be called with a property set");const r=this.getIntervalById(e);if(r){const i=r.addProperties(t,!0,rt),s=r.serialize(this.client);s.start=void 0,s.end=void 0,s.properties=t,s.properties[Sr]=r.getIntervalId(),this.emitter.emit("change",void 0,s,{localSeq:this.getNextLocalSeq()}),this.emit("propertyChanged",r,i)}this.emit("changeInterval",r,!0,void 0)}change(e,t,r){if(!this.attached)throw new st("Attach must be called before accessing intervals");if(typeof e!="string")throw new st("Change API requires an ID that is a string");const i=this.getIntervalById(e);if(i){const s=this.localCollection.changeInterval(i,t,r),o=i.serialize(this.client);return o.start=t,o.end=r,o.properties={[Sr]:i.getIntervalId()},this.emitter.emit("change",void 0,o,{localSeq:this.getNextLocalSeq()}),this.addPendingChange(e,o),this.emit("changeInterval",s,!0,void 0),s}}addPendingChange(e,t){t.start!==void 0&&this.addPendingChangeHelper(e,this.pendingChangesStart,t),t.end!==void 0&&this.addPendingChangeHelper(e,this.pendingChangesEnd,t)}addPendingChangeHelper(e,t,r){let i=t.get(e);i||(i=[],t.set(e,i)),i.push(r)}removePendingChange(e){var t;const r=(t=e.properties)===null||t===void 0?void 0:t[Sr];e.start!==void 0&&this.removePendingChangeHelper(r,this.pendingChangesStart,e),e.end!==void 0&&this.removePendingChangeHelper(r,this.pendingChangesEnd,e)}removePendingChangeHelper(e,t,r){const i=t.get(e);if(i){const s=i.shift();if(i.length===0&&t.delete(e),(s==null?void 0:s.start)!==r.start||(s==null?void 0:s.end)!==r.end)throw new st("Mismatch in pending changes")}}hasPendingChangeStart(e){const t=this.pendingChangesStart.get(e);return t&&t.length!==0}hasPendingChangeEnd(e){const t=this.pendingChangesEnd.get(e);return t&&t.length!==0}changeInterval(e,t,r){return this.ackChange(e,t,r)}ackChange(e,t,r){var i,s,o,u;if(!this.attached)throw new st("Attach must be called before accessing intervals");let d;if(t){this.removePendingChange(e);const f=(i=e.properties)===null||i===void 0?void 0:i[Sr];d=this.getIntervalById(f),d&&((s=d.propertyManager)===null||s===void 0||s.ackPendingProperties({type:ut.ANNOTATE,props:(o=e.properties)!==null&&o!==void 0?o:{}}),this.ackInterval(d,r))}else{const f=e.properties,m=Sr,g=f[m],P=bJ(f,[m+""]);if(d=this.getIntervalById(g),d){let D,M;this.hasPendingChangeStart(g)||(D=e.start),this.hasPendingChangeEnd(g)||(M=e.end),(D!==void 0||M!==void 0)&&(d=(u=this.localCollection.changeInterval(d,D,M,r))!==null&&u!==void 0?u:d);const U=d.addProperties(P,!0,r.sequenceNumber);this.onDeserialize&&this.onDeserialize(d),this.emit("propertyChanged",d,U)}}d&&this.emit("changeInterval",d,t,r)}addConflictResolver(e){if(!this.attached)throw new st("attachSequence must be called");this.localCollection.addConflictResolver(e)}attachDeserializer(e){e&&(this.onDeserialize=e,this.localCollection.map(t=>{e(t)}))}rebaseLocalInterval(e,t,r){var i,s;if(!this.attached)throw new st("attachSequence must be called");const{start:o,end:u,intervalType:d,properties:f,sequenceNumber:m}=t,g=o===void 0?void 0:this.client.rebasePosition(o,m,r),P=u===void 0?void 0:this.client.rebasePosition(u,m,r),D=f==null?void 0:f[Sr],M={start:g,end:P,intervalType:d,sequenceNumber:(s=(i=this.client)===null||i===void 0?void 0:i.getCurrentSeq())!==null&&s!==void 0?s:0,properties:f};return e==="change"&&(this.hasPendingChangeStart(D)||this.hasPendingChangeEnd(D))&&(this.removePendingChange(t),this.addPendingChange(D,M)),M}getSlideToSegment(e){const t={segment:e.segment,offset:e.offset},r=this.client.getSlideToSegment(t);return t.segment===r.segment&&t.offset===r.offset?void 0:r}setSlideOnRemove(e){let t=e.refType;t=t&~et.StayOnRemove,t=t|et.SlideOnRemove,e.refType=t}ackInterval(e,t){if(!(e instanceof uo)||!Xt(e.start,et.StayOnRemove)&&!Xt(e.end,et.StayOnRemove))return;const r=this.getSlideToSegment(e.start),i=this.getSlideToSegment(e.end),s=e.properties[Sr],o=this.hasPendingChangeStart(s),u=this.hasPendingChangeEnd(s);o||this.setSlideOnRemove(e.start),u||this.setSlideOnRemove(e.end);const d=r!==void 0&&!o,f=i!==void 0&&!u;if(d||f){if(this.localCollection.removeExistingInterval(e),d){const m=e.start.properties;this.client.removeLocalReferencePosition(e.start),e.start=iw(this.client,r,e.start.refType,t),m&&e.start.addProperties(m)}if(f){const m=e.end.properties;this.client.removeLocalReferencePosition(e.end),e.end=iw(this.client,i,e.end.refType,t),m&&e.end.addProperties(m)}this.localCollection.add(e)}}addInternal(e,t,r){return this.ackAdd(e,t,r)}ackAdd(e,t,r){var i;if(t){const o=(i=e.properties)===null||i===void 0?void 0:i[Sr],u=this.getIntervalById(o);u&&this.ackInterval(u,r);return}if(!this.attached)throw new st("attachSequence must be called");this.localCollection.ensureSerializedId(e);const s=this.localCollection.addInterval(e.start,e.end,e.intervalType,e.properties,r);return s&&this.onDeserialize&&this.onDeserialize(s),this.emit("addInterval",s,t,r),s}deleteInterval(e,t,r){return this.ackDelete(e,t,r)}ackDelete(e,t,r){if(t)return;if(!this.attached)throw new st("attach must be called prior to deleting intervals");const i=this.localCollection.ensureSerializedId(e),s=this.localCollection.getIntervalById(i);s&&this.deleteExistingInterval(s,t,r)}serializeInternal(){if(!this.attached)throw new st("attachSequence must be called");return this.localCollection.serialize()}[Symbol.iterator](){return new ll(this)}CreateForwardIteratorWithStartPosition(e){return new ll(this,!0,e)}CreateBackwardIteratorWithStartPosition(e){return new ll(this,!1,e)}CreateForwardIteratorWithEndPosition(e){return new ll(this,!0,void 0,e)}CreateBackwardIteratorWithEndPosition(e){return new ll(this,!1,void 0,e)}gatherIterationResults(e,t,r,i){this.attached&&this.localCollection.gatherIterationResults(e,t,r,i)}findOverlappingIntervals(e,t){if(!this.attached)throw new st("attachSequence must be called");return this.localCollection.findOverlappingIntervals(e,t)}map(e){if(!this.attached)throw new st("attachSequence must be called");this.localCollection.map(e)}previousInterval(e){if(!this.attached)throw new st("attachSequence must be called");return this.localCollection.previousInterval(e)}nextInterval(e){if(!this.attached)throw new st("attachSequence must be called");return this.localCollection.nextInterval(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var ng;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(ng||(ng={}));var dR;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(dR||(dR={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function IJ(n,e,t){const r=n.makeSerialized(e,t);return{type:r.type,value:r.value&&JSON.parse(r.value)}}class hR{constructor(e,t){this.value=e,this.valueType=t}get type(){return this.valueType.name}makeSerialized(e,t){const r=this.valueType.factory.store(this.value),i=GF(r,e,t);return{type:this.type,value:i}}getOpHandler(e){const t=this.valueType.ops.get(e);if(!t)throw new Error("Unknown type message");return t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class x3{constructor(e,t,r,i,s=new l3){this.serializer=e,this.handle=t,this.submitMessage=r,this.type=i,this.eventEmitter=s,this.messageHandlers=new Map,this.data=new Map,this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:[r.value[0],r.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:r.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach((t,r,i)=>{e(t.value,r,i)})}get(e){var t;return((t=this.data.get(e))!==null&&t!==void 0?t:this.createCore(e,!0)).value}has(e){return this.data.has(e)}getSerializedStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=r.makeSerialized(e,this.handle)}),t}getSerializableStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=IJ(r,e,this.handle)}),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,r]of Object.entries(e)){if(r.type===Vt[Vt.Plain]||r.type===Vt[Vt.Shared])continue;const s={key:t.startsWith("intervalCollections/")?t.substring(20):t,value:this.makeLocal(t,r)};this.data.set(s.key,s.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}tryResubmitMessage(e,t){const r=e.type,i=this.messageHandlers.get(r);return i!==void 0?(i.resubmit(e,t),!0):!1}tryGetStashedOpLocalMetadata(e){const t=e.type;if(this.messageHandlers.has(t))return this.messageHandlers.get(t).getStashedOpLocalMetadata(e);throw new Error("no apply stashed op handler")}tryProcessMessage(e,t,r,i){const s=this.messageHandlers.get(e.type);return s!==void 0?(s.process(e,t,r,i),!0):!1}createCore(e,t){const r=new hR(this.type.factory.load(this.makeMapValueOpEmitter(e),void 0),this.type),i=this.data.get(e);this.data.set(e,r);const s={key:e,previousValue:i};return this.eventEmitter.emit("create",s,t,this.eventEmitter),r}makeLocal(e,t){ci(t.type!==Vt[Vt.Plain]&&t.type!==Vt[Vt.Shared],737),t.value=Ym(t.value,this.serializer);const r=this.type.factory.load(this.makeMapValueOpEmitter(e),t.value);return new hR(r,this.type)}getMessageHandlers(){const e=new Map;return e.set("act",{process:(t,r,i,s)=>{var o;const u=(o=this.data.get(t.key))!==null&&o!==void 0?o:this.createCore(t.key,r),d=u.getOpHandler(t.value.opName),f=u.value,m=Ym(t.value.value,this.serializer);d.process(f,m,r,i,s);const g={key:t.key,previousValue:f};this.eventEmitter.emit("valueChanged",g,r,i,this.eventEmitter)},submit:(t,r)=>{this.submitMessage(t,r)},resubmit:(t,r)=>{const i=this.data.get(t.key),s=i.getOpHandler(t.value.opName),{rebasedOp:o,rebasedLocalOpMetadata:u}=s.rebase(i.value,t.value,r);this.submitMessage(Object.assign(Object.assign({},t),{value:o}),u)},getStashedOpLocalMetadata:t=>{ci(!1,22)}}),e}makeMapValueOpEmitter(e){return{emit:(r,i,s,o)=>{const u=KF(s,this.serializer,this.handle),d={key:e,type:"act",value:{opName:r,value:u}};this.submitMessage(d,o);const f={key:e,previousValue:i};this.eventEmitter.emit("valueChanged",f,!0,null,this.eventEmitter)}}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class tE{constructor(e,t){this.deltaArgs=e,this.mergeTreeClient=t,ci(e.deltaSegments.length>0,728),this.isEmpty=!1,this.deltaOperation=e.operation,this.sortedRanges=new cS(()=>{const r=new GK;return this.deltaArgs.deltaSegments.forEach(i=>{const s={operation:this.deltaArgs.operation,position:this.mergeTreeClient.getPosition(i.segment),propertyDeltas:i.propertyDeltas,segment:i.segment};r.addOrUpdate(s)}),r}),this.pFirst=new cS(()=>this.sortedRanges.value.items[0]),this.pLast=new cS(()=>this.sortedRanges.value.items[this.sortedRanges.value.size-1])}get ranges(){return this.sortedRanges.value.items}get clientId(){return this.mergeTreeClient.longClientId}get first(){return this.pFirst.value}get last(){return this.pLast.value}}class E3 extends tE{constructor(e,t,r){super(t,r),this.opArgs=e,this.isLocal=e.sequencedMessage===void 0}}class T3 extends tE{constructor(e,t,r){super(t,r),this.opArgs=e}}let cS=class{constructor(e){this.valueGenerator=e,this.pEvaluated=!1}get evaluated(){return this.pEvaluated}get value(){return this.pEvaluated||(this.pEvaluated=!0,this.pValue=this.valueGenerator()),this.pValue}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const dS="header",fR="content";class bc extends Gg{constructor(e,t,r,i){super(t,e,r,"fluid_sequence_"),this.dataStoreRuntime=e,this.id=t,this.segmentFromSpec=i,this.loadedDeferred=new DK,this.loadedDeferredOutgoingOps=[],this.deferIncomingOps=!0,this.loadedDeferredIncomingOps=[],this.messagesSinceMSNChange=[],this.loadedDeferred.promise.catch(s=>{this.logger.sendErrorEvent({eventName:"SequenceLoadFailed"},s)}),this.client=new Zx(i,at.create(this.logger,"SharedSegmentSequence.MergeTreeClient"),e.options),super.on("newListener",s=>{switch(s){case"sequenceDelta":this.client.mergeTreeDeltaCallback||(this.client.mergeTreeDeltaCallback=(o,u)=>{this.emit("sequenceDelta",new E3(o,u,this.client),this)});break;case"maintenance":this.client.mergeTreeMaintenanceCallback||(this.client.mergeTreeMaintenanceCallback=(o,u)=>{this.emit("maintenance",new T3(u,o,this.client),this)});break}}),super.on("removeListener",s=>{switch(s){case"sequenceDelta":super.listenerCount(s)===0&&(this.client.mergeTreeDeltaCallback=void 0);break;case"maintenance":super.listenerCount(s)===0&&(this.client.mergeTreeMaintenanceCallback=void 0);break}}),this.intervalCollections=new x3(this.serializer,this.handle,(s,o)=>this.submitLocalMessage(s,o),new ea)}get loaded(){return this.loadedDeferred.promise}static createOpsFromDelta(e){var t,r;const i=[];for(const s of e.ranges)switch(e.deltaOperation){case ut.ANNOTATE:{const o=i[i.length-1],u={};for(const d of Object.keys(s.propertyDeltas))u[d]=(r=(t=s.segment.properties)===null||t===void 0?void 0:t[d])!==null&&r!==void 0?r:null;o&&o.pos2===s.position&&Yh(o.props,u)?o.pos2+=s.segment.cachedLength:i.push(nw(s.position,s.position+s.segment.cachedLength,u,void 0));break}case ut.INSERT:i.push(S3(s.position,s.segment.clone().toJSONObject()));break;case ut.REMOVE:{const o=i[i.length-1];(o==null?void 0:o.pos1)===s.position?o.pos2+=s.segment.cachedLength:i.push(rw(s.position,s.position+s.segment.cachedLength));break}}return i}removeRange(e,t){const r=this.client.removeRangeLocal(e,t);return r&&this.submitSequenceMessage(r),r}groupOperation(e){this.client.localTransaction(e),this.submitSequenceMessage(e)}getContainingSegment(e){return this.client.getContainingSegment(e)}getLength(){return this.client.getLength()}getPosition(e){return this.client.getPosition(e)}annotateRange(e,t,r,i){const s=this.client.annotateRangeLocal(e,t,r,i);s&&this.submitSequenceMessage(s)}getPropertiesAtPosition(e){return this.client.getPropertiesAtPosition(e)}getRangeExtentsOfPosition(e){return this.client.getRangeExtentsOfPosition(e)}createPositionReference(e,t,r){const i=new Au(this.client,e,t,r);return r!==et.Transient&&this.addLocalReference(i),i}createLocalReferencePosition(e,t,r,i){return this.client.createLocalReferencePosition(e,t,r,i)}localRefToPos(e){return this.client.localReferencePositionToPosition(e)}localReferencePositionToPosition(e){return this.client.localReferencePositionToPosition(e)}resolveRemoteClientPosition(e,t,r){return this.client.resolveRemoteClientPosition(e,t,r)}submitSequenceMessage(e){if(!this.isAttached())return;const t=KF(e,this.serializer,this.handle),r=this.client.peekPendingSegmentGroups(e.type===ut.GROUP?e.ops.length:1);this.loadedDeferred.isCompleted?this.submitLocalMessage(t,r):this.loadedDeferredOutgoingOps.push([t,r])}addLocalReference(e){return this.client.addLocalReference(e)}removeLocalReference(e){return this.client.removeLocalReferencePosition(e)}removeLocalReferencePosition(e){return this.client.removeLocalReferencePosition(e)}posFromRelativePos(e){return this.client.posFromRelativePos(e)}walkSegments(e,t,r,i,s=!1){return this.client.walkSegments(e,t,r,i,s)}getStackContext(e,t){return this.client.getStackContext(e,t)}getCurrentSeq(){return this.client.getCurrentSeq()}insertAtReferencePosition(e,t){const r=this.client.insertAtReferencePositionLocal(e,t);r&&this.submitSequenceMessage(r)}async waitIntervalCollection(e){return this.intervalCollections.get(e)}getIntervalCollection(e){return this.intervalCollections.get(e)}getIntervalCollectionLabels(){return this.intervalCollections.keys()}summarizeCore(e,t){const r=new Tr;return this.intervalCollections.size>0&&r.addBlob(dS,this.intervalCollections.serialize(e)),r.addWithStats(fR,this.summarizeMergeTree(e)),r.getSummaryTree()}processGCDataCore(e){this.intervalCollections.size>0&&this.intervalCollections.serialize(e),this.client.serializeGCData(this.handle,e)}replaceRange(e,t,r){const i=Math.max(e,t),s=this.client.insertSegmentLocal(i,r);if(s)if(e<t){const o=this.client.removeRangeLocal(e,t);this.submitSequenceMessage(eg(s,o))}else this.submitSequenceMessage(s)}onConnect(){this.client.startOrUpdateCollaboration(this.runtime.clientId)}onDisconnect(){}reSubmitCore(e,t){this.intervalCollections.tryResubmitMessage(e,t)||this.submitSequenceMessage(this.client.regeneratePendingOp(e,t))}async loadCore(e){var t;if(await e.contains(dS)){const r=await e.readBlob(dS),i=u3(r,"utf8");this.intervalCollections.populate(i)}try{const{catchupOpsP:r}=await this.client.load(this.runtime,new vF(e,fR),this.serializer),i=r.then(s=>{s.forEach(o=>{const u=this.client.getCollabWindow();if(o.minimumSequenceNumber<u.minSeq||o.referenceSequenceNumber<u.minSeq||o.sequenceNumber<=u.minSeq||o.sequenceNumber<=u.currentSeq)throw new Error(`Invalid catchup operations in snapshot: ${JSON.stringify({op:{seq:o.sequenceNumber,minSeq:o.minimumSequenceNumber,refSeq:o.referenceSequenceNumber},collabWindow:{seq:u.currentSeq,minSeq:u.minSeq}})}`);this.processMergeTreeMsg(o)}),this.loadFinished()}).catch(s=>{this.loadFinished(s)});((t=this.dataStoreRuntime.options)===null||t===void 0?void 0:t.sequenceInitializeFromHeaderOnly)!==!0&&await i}catch(r){this.loadFinished(r)}}processCore(e,t,r){this.deferIncomingOps?(ci(!t,114),this.loadedDeferredIncomingOps.push(e)):(ci(e.type===ng.Operation,115),this.intervalCollections.tryProcessMessage(e.contents,t,e,r)||this.processMergeTreeMsg(e,t))}didAttach(){var e;this.isAttached()&&this.client.startOrUpdateCollaboration((e=this.runtime.clientId)!==null&&e!==void 0?e:"attached")}initializeLocalCore(){super.initializeLocalCore(),this.loadFinished()}applyStashedOp(e){return this.client.applyStashedOp(e)}summarizeMergeTree(e){ci(this.loadedDeferred.isCompleted,116);const t=this.runtime.deltaManager.minimumSequenceNumber;return this.processMinSequenceNumberChanged(t),this.messagesSinceMSNChange.forEach(r=>{r.minimumSequenceNumber=t}),this.client.summarize(this.runtime,this.handle,e,this.messagesSinceMSNChange)}processMergeTreeMsg(e,t){var r,i;const s=Ym(e,this.serializer),o=[];function u(m){o.push(...bc.createOpsFromDelta(m))}const d=s.referenceSequenceNumber!==s.sequenceNumber-1;let f=s;((r=this.runtime.options)===null||r===void 0?void 0:r.newMergeTreeSnapshotFormat)!==!0&&d&&this.on("sequenceDelta",u),this.client.applyMsg(s,t),((i=this.runtime.options)===null||i===void 0?void 0:i.newMergeTreeSnapshotFormat)!==!0&&(d&&(this.removeListener("sequenceDelta",u),f=Object.assign(Object.assign({},s),{referenceSequenceNumber:f.sequenceNumber-1,contents:o.length!==1?eg(...o):o[0]})),this.messagesSinceMSNChange.push(f),this.messagesSinceMSNChange.length>20&&this.messagesSinceMSNChange[20].sequenceNumber<s.minimumSequenceNumber&&this.processMinSequenceNumberChanged(s.minimumSequenceNumber))}processMinSequenceNumberChanged(e){let t=0;for(;t<this.messagesSinceMSNChange.length&&!(this.messagesSinceMSNChange[t].sequenceNumber>e);t++);t!==0&&(this.messagesSinceMSNChange=this.messagesSinceMSNChange.slice(t))}loadFinished(e){if(!this.loadedDeferred.isCompleted){if(this.initializeIntervalCollections(),e)throw this.loadedDeferred.reject(e),e;this.deferIncomingOps=!1;for(const t of this.loadedDeferredIncomingOps)this.processCore(t,!1,void 0);this.loadedDeferredIncomingOps.length=0,this.loadedDeferred.resolve();for(const[t,r]of this.loadedDeferredOutgoingOps)this.reSubmitCore(t,r);this.loadedDeferredOutgoingOps.length=0}}initializeIntervalCollections(){this.intervalCollections.eventEmitter.on("create",({key:e,previousValue:t},r)=>{const i=this.intervalCollections.get(e);i.attached||i.attachGraph(this.client,e),ci(t===void 0,705),this.emit("createIntervalCollection",e,r,this)});for(const e of this.intervalCollections.keys())this.intervalCollections.get(e).attachGraph(this.client,e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const ef="1.3.6";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const pR=128;class Fr extends Yg{constructor(e){super(),this.items=e,this.type=Fr.typeString,this.cachedLength=e.length}static is(e){return e.type===Fr.typeString}static fromJSONObject(e){if(e&&typeof e=="object"&&"items"in e){const t=new Fr(e.items);return e.props&&t.addProperties(e.props),t}}toJSONObject(){const e={items:this.items};return super.addSerializedProps(e),e}clone(e=0,t){const r=this.items.slice(e,t),i=new Fr(r);return this.cloneInto(i),i}canAppend(e){return Fr.is(e)&&(this.cachedLength<=pR||e.cachedLength<=pR)}toString(){return this.items.toString()}append(e){if(!Fr.is(e))throw new Error("can only append another run segment");ao.append(this,e),this.items=this.items.concat(e.items),this.cachedLength=this.items.length}removeRange(e,t){let r=[];const i=this.items.length;return e>0&&(r=r.concat(this.items.slice(0,e))),t<i&&(r=r.concat(this.items.slice(t))),this.items=r,this.cachedLength=this.items.length,this.items.length===0}createSplitSegmentAt(e){if(e>0){const t=this.items.slice(e);return this.items=this.items.slice(0,e),this.cachedLength=this.items.length,new Fr(t)}}}Fr.typeString="SubSequence";class nE extends bc{constructor(e,t,r,i){super(e,t,r,i),this.id=t}insert(e,t,r){const i=new Fr(t);r&&i.addProperties(r);const s=this.client.insertSegmentLocal(e,i);s&&this.submitSequenceMessage(s)}remove(e,t){this.removeRange(e,t)}getItemCount(){return this.getLength()}getItems(e,t){const r=[];let i;return t!==void 0&&t<=e||(this.walkSegments(s=>(Fr.is(s)&&(i===void 0&&(i=s),r.push(...s.items)),!0),e,t),i!==void 0&&r.splice(0,e-this.getPosition(i)),t!==void 0&&r.splice(t-e)),r}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class sw extends nE{constructor(e,t,r){super(e,t,r,As.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,As.Type)}static getFactory(){return new As}getRange(e,t){return this.getItems(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ow extends nE{constructor(e,t,r){super(e,t,r,Is.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,Is.Type)}static getFactory(){return new Is}getRange(e,t){return this.getItems(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class _s{static segmentFromSpec(e){const t=An.fromJSONObject(e);if(t)return t;const r=Xn.fromJSONObject(e);if(r)return r}get type(){return _s.Type}get attributes(){return _s.Attributes}async load(e,t,r,i){const s=new aw(e,t,i);return await s.load(r),s}create(e,t){const r=new aw(e,t,this.attributes);return r.initializeLocal(),r}}_s.Type="https://graph.microsoft.com/types/mergeTree";_s.Attributes={type:_s.Type,snapshotFormatVersion:"0.1",packageVersion:ef};class Is{static segmentFromSpec(e){const t=e;if(t.items){const r=new Fr(t.items);return t.props&&r.addProperties(t.props),r}}get type(){return Is.Type}get attributes(){return Is.Attributes}async load(e,t,r,i){const s=new ow(e,t,i);return await s.load(r),s}create(e,t){const r=new ow(e,t,this.attributes);return r.initializeLocal(),r}}Is.Type="https://graph.microsoft.com/types/mergeTree/object-sequence";Is.Attributes={type:Is.Type,snapshotFormatVersion:"0.1",packageVersion:ef};class As{static segmentFromSpec(e){const t=e;if(t.items){const r=new Fr(t.items);return t.props&&r.addProperties(t.props),r}}get type(){return As.Type}get attributes(){return As.Attributes}async load(e,t,r,i){const s=new sw(e,t,i);return await s.load(r),s}create(e,t){const r=new sw(e,t,this.attributes);return r.initializeLocal(),r}}As.Type="https://graph.microsoft.com/types/mergeTree/number-sequence";As.Attributes={type:As.Type,snapshotFormatVersion:"0.1",packageVersion:ef};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class aw extends bc{constructor(e,t,r){super(e,t,r,_s.segmentFromSpec),this.id=t,this.mergeTreeTextHelper=this.client.createTextHelper()}static create(e,t){return e.createChannel(t,_s.Type)}static getFactory(){return new _s}get ISharedString(){return this}insertMarkerRelative(e,t,r){const i=new Xn(t);r&&i.addProperties(r);const s=this.posFromRelativePos(e),o=this.client.insertSegmentLocal(s,i);o&&this.submitSequenceMessage(o)}insertMarker(e,t,r){const i=new Xn(t);r&&i.addProperties(r);const s=this.client.insertSegmentLocal(e,i);return s&&this.submitSequenceMessage(s),s}insertTextRelative(e,t,r){const i=new An(t);r&&i.addProperties(r);const s=this.posFromRelativePos(e),o=this.client.insertSegmentLocal(s,i);o&&this.submitSequenceMessage(o)}insertText(e,t,r){const i=new An(t);r&&i.addProperties(r);const s=this.client.insertSegmentLocal(e,i);s&&this.submitSequenceMessage(s)}replaceText(e,t,r,i){this.replaceRange(e,t,An.make(r,i))}removeText(e,t){return this.removeRange(e,t)}annotateMarkerNotifyConsensus(e,t,r){const i=this.client.annotateMarkerNotifyConsensus(e,t,r);i&&this.submitSequenceMessage(i)}annotateMarker(e,t,r){const i=this.client.annotateMarker(e,t,r);i&&this.submitSequenceMessage(i)}findTile(e,t,r=!0){return this.client.findTile(e,t,r)}getTextAndMarkers(e){const t=this.client.getCollabWindow();return this.mergeTreeTextHelper.getTextAndMarkers(t.currentSeq,t.clientId,e)}getText(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId,"",e,t)}getTextWithPlaceholders(){const e=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(e.currentSeq,e.clientId," ")}getTextRangeWithPlaceholders(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId," ",e,t)}getTextRangeWithMarkers(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId,"*",e,t)}getMarkerFromId(e){return this.client.getMarkerFromId(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class zr extends Yg{constructor(e){super(),this.type=zr.typeString,this.cachedLength=e}static is(e){return e.type===zr.typeString}static fromJSONObject(e){if(e&&typeof e=="object"&&"pad"in e){const t=new zr(e.pad);return e.props&&t.addProperties(e.props),t}}toJSONObject(){return{pad:this.cachedLength,props:this.properties}}clone(e=0,t){const r=new zr(this.cachedLength);return this.cloneInto(r),r}canAppend(e){return zr.is(e)}toString(){return`[padding: ${this.cachedLength}]`}append(e){if(!zr.is(e))throw new Error("can only append padding segment");ao.append(this,e),this.cachedLength+=e.cachedLength}removeRange(e,t){return this.cachedLength-=t-e,this.cachedLength===0}createSplitSegmentAt(e){const t=e,r=this.cachedLength-e;return this.cachedLength=t,new zr(r)}}zr.typeString="PaddingSegment";class ui extends Fr{constructor(e){super(e),this.items=e,this.type=ui.typeString,this.tags=new Array(e.length).fill(void 0)}static is(e){return e.type===ui.typeString}static fromJSONObject(e){if(e&&typeof e=="object"&&"items"in e){const t=new ui(e.items);return e.props&&t.addProperties(e.props),t}}clone(e=0,t){const r=new ui(this.items.slice(e,t));return this.tags&&(r.tags=this.tags.slice(e,t)),this.cloneInto(r),r}append(e){super.append(e);const t=e;return t.tags&&this.tags&&this.tags.splice(this.items.length,0,...t.tags),this}removeRange(e,t){return this.tags.splice(e,t-e),super.removeRange(e,t)}getTag(e){return this.tags[e]}setTag(e,t){this.tags[e]=t}createSplitSegmentAt(e){if(e>0){const t=this.items.slice(e);this.items=this.items.slice(0,e),this.cachedLength=this.items.length;const r=new ui(t);return r.tags=this.tags.slice(e),this.tags.length=e,r}}}ui.typeString="RunSegment";const kh=2097152,lu=kh+1,rE=4294967295,AJ=rE+1,kJ=kh*rE,To=(n,e)=>n*lu+e;function P3(n){const e=Math.floor(n/lu),t=n-e*lu;return{row:e,col:t}}class uw extends bc{constructor(e,t,r){super(e,t,r,ks.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,ks.Type)}static getFactory(){return new ks}get numRows(){return P3(this.getLength()).row}setItems(e,t,r,i){const s=To(e,t),o=s+r.length,u=new ui(r);i&&u.addProperties(i),this.replaceRange(s,o,u)}getItem(e,t){const r=To(e,t),{segment:i,offset:s}=this.getContainingSegment(r);if(i&&ui.is(i))return i.items[s];if(i&&zr.is(i))return;throw new Error("Unrecognized Segment type")}getTag(e,t){const{segment:r,offset:i}=this.getSegment(e,t);if(ui.is(r))return r.getTag(i)}setTag(e,t,r){const{segment:i,offset:s}=this.getSegment(e,t);if(ui.is(i))i.setTag(s,r);else if(r!==void 0)throw new Error(`Must not attempt to set tags on '${i.constructor.name}'.`)}insertRows(e,t){const r=To(e,0),i=lu*t,s=new zr(i),o=this.client.insertSegmentLocal(r,s);o&&this.submitSequenceMessage(o)}removeRows(e,t){const r=To(e,0),i=lu*t;this.removeRange(r,r+i)}insertCols(e,t){this.moveAsPadding(kh-t,e,t)}removeCols(e,t){this.moveAsPadding(e,kh-t,t)}annotatePosition(e,t,r){const i=To(e,t);this.annotateRange(i,i+1,r)}getPositionProperties(e,t){const r=To(e,t);return this.getPropertiesAtPosition(r)}moveAsPadding(e,t,r){const i=e,s=e+r,o=[];for(let u=0,d=0;u<this.numRows;u++,d+=lu){o.push(this.client.removeRangeLocal(d+i,d+s));const f=d+t,m=new zr(r);o.push(this.client.insertSegmentLocal(f,m))}this.submitSequenceMessage(eg(...o))}getSegment(e,t){const r=To(e,t);return this.getContainingSegment(r)}}class ks{static segmentFromSpec(e){const t=zr.fromJSONObject(e);if(t)return t;const r=ui.fromJSONObject(e);if(r)return r;throw new Error(`Unrecognized IJSONObject: '${JSON.stringify(e)}'`)}get type(){return ks.Type}get attributes(){return ks.Attributes}async load(e,t,r,i){const s=new uw(e,t,i);return await s.load(r),s}create(e,t){const r=new uw(e,t,this.attributes);return r.initializeLocal(),r}}ks.Type="https://graph.microsoft.com/types/mergeTree/sparse-matrix";ks.Attributes={type:ks.Type,snapshotFormatVersion:"0.1",packageVersion:ef};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var R3;const mR="header";class go{get type(){return go.Type}get attributes(){return go.Attributes}async load(e,t,r,i){const s=new lw(t,e,i);return await s.load(r),s}create(e,t){const r=new lw(t,e,this.attributes);return r.initializeLocal(),r}}go.Type="https://graph.microsoft.com/types/sharedIntervalCollection";go.Attributes={type:go.Type,snapshotFormatVersion:"0.1",packageVersion:ef};class lw extends Gg{constructor(e,t,r){super(e,t,r,"fluid_sharedIntervalCollection_"),this[R3]="SharedIntervalCollection",this.intervalCollections=new x3(this.serializer,this.handle,(i,s)=>this.submitLocalMessage(i,s),new ta)}static create(e,t){return e.createChannel(t,go.Type)}static getFactory(){return new go}async waitIntervalCollection(e){return this.intervalCollections.get(this.getIntervalCollectionPath(e))}getIntervalCollection(e){const t=this.getIntervalCollectionPath(e);return this.intervalCollections.get(t)}summarizeCore(e){return cK(mR,this.intervalCollections.serialize(e))}reSubmitCore(e,t){this.intervalCollections.tryResubmitMessage(e,t)}onDisconnect(){}async loadCore(e){const t=await e.readBlob(mR),r=u3(t,"utf8");this.intervalCollections.populate(r)}processCore(e,t,r){e.type===ng.Operation&&this.intervalCollections.tryProcessMessage(e.contents,t,e,r)}getIntervalCollectionPath(e){return e}applyStashedOp(){throw new Error("not implemented")}}R3=Symbol.toStringTag;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const OJ=Object.freeze(Object.defineProperty({__proto__:null,get AttachState(){return Qe},get ConnectionState(){return Tt},get ContainerErrorType(){return po},DOProviderContainerRuntimeFactory:o3,DirectoryFactory:Fi,get DriverErrorType(){return mi},FluidContainer:Wb,Interval:zl,IntervalCollection:eE,IntervalCollectionIterator:ll,get IntervalType(){return Yi},LocalValueMaker:Kg,MapFactory:hi,PaddingSegment:zr,RootDataObject:s3,RunSegment:ui,SequenceDeltaEvent:E3,SequenceEvent:tE,SequenceInterval:uo,SequenceMaintenanceEvent:T3,ServiceAudience:a3,SharedDirectory:sc,SharedIntervalCollection:lw,SharedIntervalCollectionFactory:go,SharedMap:Ih,SharedNumberSequence:sw,SharedNumberSequenceFactory:As,SharedObjectSequence:ow,SharedObjectSequenceFactory:Is,SharedSegmentSequence:bc,SharedSequence:nE,SharedString:aw,SharedStringFactory:_s,SparseMatrix:uw,SparseMatrixFactory:ks,SubSequence:Fr,maxCellPosition:kJ,maxCol:kh,maxCols:lu,maxRow:rE,maxRows:AJ,positionToRowCol:P3,rowColToPosition:To},Symbol.toStringTag,{value:"Module"})),FJ=Li(OJ);/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(la,"__esModule",{value:!0});la.DynamicObjectRegistry=void 0;const ac=FJ,gR="@microsoft/live-share:DYNAMIC-LOADABLE-OBJECTS";class tf{static get dynamicLoadableObjects(){return typeof window>"u"?this._dynamicLoadableObjects:window[gR]||this._dynamicLoadableObjects}static registerObjectClass(e,t){const r=this.dynamicLoadableObjects;r.has(t)||(r.set(t,e),typeof window<"u"&&(window[gR]=r))}}tf._dynamicLoadableObjects=new Map;la.DynamicObjectRegistry=tf;tf.registerObjectClass(ac.SharedMap,ac.SharedMap.getFactory().type);tf.registerObjectClass(ac.SharedString,ac.SharedString.getFactory().type);tf.registerObjectClass(ac.SharedDirectory,ac.SharedDirectory.getFactory().type);var nf={},rf={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var hS=Ne&&Ne.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(m){try{f(r.next(m))}catch(g){o(g)}}function d(m){try{f(r.throw(m))}catch(g){o(g)}}function f(m){m.done?s(m.value):i(m.value).then(u,d)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(rf,"__esModule",{value:!0});rf.TimestampProvider=void 0;const NJ=5*1e3,DJ=5;class LJ{constructor(){this._retries=0,this._lastTimeSent=0}get isRunning(){return!!this._serverTime}getTimestamp(){if(!this._serverTime)throw new Error("TimestampProvider: can't call getTimestamp() before calling start().");return this._lastTimeSent=Math.max(new Date().getTime()+this._serverTime.offset,this._lastTimeSent+1)}getMaxTimestampError(){if(!this._serverTime)throw new Error("DefaultTimestampProvider: can't call getMaxTimestampError() before calling initialize().");return Math.floor(this._serverTime.requestLatency/2)}start(){return hS(this,void 0,void 0,function*(){this.stop(),performance.mark("TeamsSync: starting clock");try{yield this.improveAccuracy()}finally{performance.measure("TeamsSync: clock startup","TeamsSync: starting clock")}})}stop(){this._syncTimer&&(clearTimeout(this._syncTimer),this._syncTimer=void 0),this._serverTime=void 0,this._retries=0}improveAccuracy(){return hS(this,void 0,void 0,function*(){const e=yield this.getSessionTimeOffset();!this._serverTime||e.requestLatency<this._serverTime.requestLatency?(this._serverTime=e,this._retries=0):this._retries++,this._retries<=DJ?this._syncTimer=setTimeout(this.improveAccuracy.bind(this),NJ):this._syncTimer=void 0})}getSessionTimeOffset(){return hS(this,void 0,void 0,function*(){const e=performance.now(),t=yield this.getNtpTime(),r=performance.now(),i=new Date().getTime(),s=r-e,o=t.ntpTimeInUTC+Math.floor(s/2);return{serverTimeInUtc:o,localTimeInUtc:i,requestLatency:s,offset:o-i}})}}rf.TimestampProvider=LJ;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(nf,"__esModule",{value:!0});nf.HostTimestampProvider=void 0;const MJ=rf;class BJ extends MJ.TimestampProvider{constructor(e){super(),this._host=e}getNtpTime(){return this._host.getNtpTime()}}nf.HostTimestampProvider=BJ;var wc={};(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.ContainerState=n.UserMeetingRole=void 0,function(e){e.guest="Guest",e.attendee="Attendee",e.presenter="Presenter",e.organizer="Organizer"}(n.UserMeetingRole||(n.UserMeetingRole={})),function(e){e.added="Added",e.alreadyExists="AlreadyExists",e.conflict="Conflict",e.notFound="NotFound"}(n.ContainerState||(n.ContainerState={}))})(wc);var fS={};const Cc=Li(kK);var fd={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Ki(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function _3(n,e){switch(e){case"base64":return yi(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const jJ=(n,e)=>ku.from(n,e).buffer,qJ=(n,e)=>ku.from(n).toString(e);function cw(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let ku=class za extends Uint8Array{toString(e){return _3(this,e)}static from(e,t,r){if(typeof e=="string")return za.fromString(e,t);if(e!==null&&typeof e=="object"&&cw(e.buffer))return za.fromArrayBuffer(e.buffer,e.byteOffset,e.byteLength);if(cw(e))return za.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new za(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=js(r);return new za(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new za(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};async function UJ(n,e){const t=await crypto.subtle.digest(e,n);return new Uint8Array(t)}function zJ(n,e){switch(e){case"hex":return Array.prototype.map.call(n,r=>r.toString(16).padStart(2,"0")).join("");case"base64":return yi(n)}}async function I3(n,e="SHA-1",t="hex"){if(crypto.subtle===void 0)return WC(()=>import("./hashFileNode-ccf10514.js"),["./hashFileNode-ccf10514.js","./sha256-738eea55.js"],import.meta.url).then(async i=>i.hashFile(n,e,t));const r=await UJ(n,e);return zJ(r,t)}async function $J(n){const t=`blob ${n.byteLength.toString()}${String.fromCharCode(0)}`,r=ku.from(t+n.toString());return I3(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const dw=globalThis.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const HJ=n=>ku.from(n,"base64").toString("utf-8"),VJ=n=>ku.from(n,"utf8").toString("base64"),WJ=(n,e)=>{switch(e){case"utf8":case"utf-8":return n;default:return ku.from(n,e).toString()}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function GJ(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const KJ=async n=>new Promise(e=>setTimeout(()=>e(),n));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function JJ(n,e){return(...t)=>{if(n.disposed)throw new Error("Already disposed");return e(...t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let A3=class extends Fn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let iE=class $a extends A3{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,e!==void 0){const t=i=>this.unforwardEvent(e,i),r=i=>this.forwardEvent(e,i);this.on($a.removeListenerEvent,t),this.on($a.newListenerEvent,r)}}static isEmitterEvent(e){return e===$a.newListenerEvent||e===$a.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(e!==void 0&&r!==void 0&&!$a.isEmitterEvent(r)){let i=this.forwardingEvents.get(r);if(i===void 0&&(i=new Map,this.forwardingEvents.set(r,i)),!i.has(e)){const s=(...o)=>this.emit(r,...o);i.set(e,()=>e.off(r,s)),e.on(r,s)}}}unforwardEvent(e,...t){for(const r of t)if(r!==void 0&&!$a.isEmitterEvent(r)){const i=this.forwardingEvents.get(r);if((i==null?void 0:i.has(e))===!0&&this.listenerCount(r)===0){const s=i.get(e);s!==void 0&&s(),i.delete(e),i.size===0&&this.forwardingEvents.delete(r)}}}};iE.newListenerEvent="newListener";iE.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const QJ={compare:(n,e)=>n-e,min:Number.MIN_VALUE};let XJ=class{constructor(e){this.comp=e,this.L=[{value:e.min,position:0}]}peek(){return this.L[1]}get(){this.swap(1,this.count());const e=this.L.pop();return this.fixdown(1),e.value}add(e){const t={value:e,position:this.L.length};return this.L.push(t),this.fixup(this.count()),t}update(e){const t=e.position;this.isGreaterThanParent(t)?this.fixup(t):this.fixdown(t)}remove(e){const t=e.position;this.swap(e.position,this.L.length-1),this.L.splice(this.L.length-1),t!==this.L.length&&this.update(this.L[t])}count(){return this.L.length-1}fixup(e){let t=e;for(;this.isGreaterThanParent(t);){const r=t>>1;this.swap(t,r),t=r}}isGreaterThanParent(e){return e>1&&this.comp.compare(this.L[e>>1].value,this.L[e].value)>0}fixdown(e){let t=e;for(;t<<1<=this.count();){let r=t<<1;if(r<this.count()&&this.comp.compare(this.L[r].value,this.L[r+1].value)>0&&r++,this.comp.compare(this.L[t].value,this.L[r].value)<=0)break;this.swap(t,r),t=r}}swap(e,t){const r=this.L[e];this.L[e]=this.L[t],this.L[e].position=e,this.L[t]=r,this.L[t].position=t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let YJ=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let ZJ=class{send(e){}},eQ=class{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let tQ=class{constructor(e,t){this.expiry=e,this.cleanup=t,this.gcTimeouts=new Map}schedule(e){this.expiry.policy!=="indefinite"&&this.gcTimeouts.set(e,setTimeout(()=>{this.cleanup(e),this.cancel(e)},this.expiry.durationMs))}cancel(e){const t=this.gcTimeouts.get(e);t!==void 0&&(clearTimeout(t),this.gcTimeouts.delete(e))}update(e){this.expiry.policy==="sliding"&&(this.cancel(e),this.schedule(e))}},nQ=class{constructor({expiry:e={policy:"indefinite"},removeOnError:t=()=>!0}={}){this.cache=new Map,this.removeOnError=t,this.gc=new tQ(e,r=>this.remove(r))}has(e){return this.cache.has(e)}get(e){return this.has(e)&&this.gc.update(e),this.cache.get(e)}remove(e){return this.gc.cancel(e),this.cache.delete(e)}async addOrGet(e,t){let r=this.get(e);return r===void 0&&(r=(async()=>t())(),this.cache.set(e,r),r.catch(s=>{this.removeOnError(s)&&this.remove(e)}),this.gc.schedule(e)),r}add(e,t){const r=this.has(e);return this.addOrGet(e,t).catch(()=>{}),!r}async addValueOrGet(e,t){return this.addOrGet(e,async()=>t)}addValue(e,t){return this.add(e,async()=>t)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let k3=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}},rQ=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let iQ=class{constructor(e,t){typeof e=="number"?(this.ranges=[{length:0,primary:e,secondary:t}],this.lastPrimary=e,this.lastSecondary=t):(this.ranges=ia(e.ranges),this.lastPrimary=e.lastPrimary,this.lastSecondary=e.lastSecondary)}get base(){return this.ranges[0].primary}get primaryHead(){return this.lastPrimary}get secondaryHead(){return this.lastSecondary}serialize(){return{lastPrimary:this.lastPrimary,lastSecondary:this.lastSecondary,ranges:ia(this.ranges)}}add(e,t){Ki(e>=this.lastPrimary,3),this.lastSecondary!==void 0&&Ki(t>=this.lastSecondary,4),this.lastPrimary=e,this.lastSecondary=t;const r=this.ranges[this.ranges.length-1],i=r.primary+r.length,s=r.secondary+r.length;t!==s&&(e===i?r.length===0?r.secondary=t:(r.length--,this.ranges.push({length:0,primary:e,secondary:t})):i+1===e&&s+1===t?r.length++:this.ranges.push({length:0,primary:e,secondary:t}))}get(e){Ki(e>=this.ranges[0].primary,5);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);Ki(e>=this.ranges[t-1].primary,6);const r=this.ranges[t-1];return Math.min(e-r.primary,r.length)+r.secondary}updateBase(e){Ki(e>=this.ranges[0].primary,7);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);Ki(e>=this.ranges[t-1].primary,8);const r=this.ranges[t-1],i=e-r.primary;r.secondary=r.secondary+Math.min(i,r.length),r.length=Math.max(r.length-i,0),r.primary=e,this.ranges=t-1>0?this.ranges.slice(t-1):this.ranges,Ki(e===this.ranges[0].primary,9)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let sQ=class{constructor(e){this.windowMSec=e,this.requestMap=new Map}filter(e,t){const r=[],i=Date.now();for(const s of t){const o=`${e}/${s}`;if(!this.requestMap.has(o))this.requestMap.set(o,i),r.push(s);else{if(this.requestMap.get(o)+this.windowMSec>i)continue;this.requestMap.set(o,i),r.push(s)}}return r}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function oQ(n){let e;try{e=JSON.parse(n)}catch{return}return e}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const pS=2147483647;function sE(n,e,t){let r;if(e>pS){const i=e-pS;r=setTimeout(()=>sE(n,i,t),pS)}else r=setTimeout(()=>n(),Math.max(e,0));return t==null||t(r),r}let O3=class{constructor(e,t,r=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,i;if(!this.runningState)this.start(e,t);else{const s=e??this.runningState.intendedDuration,o=(i=t??((r=this.runningState.restart)===null||r===void 0?void 0:r.handler))!==null&&i!==void 0?i:this.runningState.handler,u=this.calculateRemainingTime(this.runningState);s<u?this.start(s,o):s===u?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:sE(()=>this.handler(),e,i=>{this.runningState!==void 0&&(this.runningState.timeout=i)})}}handler(){Ki(!!this.runningState,10);const e=this.runningState.restart;if(e!==void 0){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}},aQ=class{constructor(e,t){this.timer=new O3(e,()=>this.wrapHandler(t))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new k3,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),Ki(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let uQ=class F3{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=dw.now();return new F3(e)}trace(){const e=dw.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function lQ(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const cQ=Object.freeze(Object.defineProperty({__proto__:null,BaseTelemetryNullLogger:ZJ,Deferred:k3,EventForwarder:iE,Heap:XJ,IsoBuffer:ku,Lazy:YJ,LazyPromise:rQ,NumberComparer:QJ,PromiseCache:nQ,PromiseTimer:aQ,RangeTracker:iQ,RateLimiter:sQ,TelemetryNullLogger:eQ,Timer:O3,Trace:uQ,TypedEventEmitter:A3,Uint8ArrayToArrayBuffer:GJ,Uint8ArrayToString:_3,assert:Ki,bufferToString:qJ,delay:KJ,doIfNotDisposed:JJ,fromBase64ToUtf8:HJ,fromUtf8ToBase64:VJ,gitHashFile:$J,hashFile:I3,isArrayBuffer:cw,performance:dw,safelyParseJSON:oQ,setLongTimeout:sE,stringToBuffer:jJ,toUtf8:WJ,unreachableCase:lQ},Symbol.toStringTag,{value:"Module"})),sf=Li(cQ);var mS={},wu={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(wu,"__esModule",{value:!0});wu.ObjectSynchronizerEvents=wu.TelemetryEvents=void 0;wu.TelemetryEvents={LivePresence:{LocalPresenceChanged:"LivePresence:LocalPresenceChange",RemotePresenceChanged:"LivePresence:RemotePresenceChange",GetClientInfoError:"LivePresence:GetClientInfoError",RoleVerificationError:"LivePresence:RoleVerificationError"},LiveState:{StateChanged:"LiveState:StateChanged",RoleVerificationError:"LiveState:RoleVerificationError"}};wu.ObjectSynchronizerEvents={update:"update",connect:"connect"};var ev={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var gS=Ne&&Ne.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(m){try{f(r.next(m))}catch(g){o(g)}}function d(m){try{f(r.throw(m))}catch(g){o(g)}}function f(m){m.done?s(m.value):i(m.value).then(u,d)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(ev,"__esModule",{value:!0});ev.LiveShareTokenProvider=void 0;class dQ{constructor(e){this._host=e}fetchOrdererToken(e,t,r){return gS(this,void 0,void 0,function*(){return yield this.fetchFluidToken(e,t,r)})}fetchStorageToken(e,t,r){return gS(this,void 0,void 0,function*(){return yield this.fetchFluidToken(e,t,r)})}fetchFluidToken(e,t,r){return gS(this,void 0,void 0,function*(){let i;return!this._frsToken||r||this._tenantId!==e||this._documentId!==t?(this._frsToken=yield this._host.getFluidToken(t),i=!1):i=!0,this._tenantId=e,t&&(this._documentId=t),{jwt:this._frsToken,fromCache:i}})}}ev.LiveShareTokenProvider=dQ;var xc={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(xc,"__esModule",{value:!0});xc.RequestCache=void 0;class hQ{constructor(e){this._cache=new Map,this._cacheLifetime=e}cacheRequest(e,t){const r=new Date().getTime();let i;if(this._cache.has(e)){i=this._cache.get(e);const o=i.startTime+this._cacheLifetime;if(r<o)return i.promise}const s=t();return this._cache.set(e,{startTime:r,promise:s}),s}has(e){return this._cache.has(e)}}xc.RequestCache=hQ;var tv={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var fQ=Ne&&Ne.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(m){try{f(r.next(m))}catch(g){o(g)}}function d(m){try{f(r.throw(m))}catch(g){o(g)}}function f(m){m.done?s(m.value):i(m.value).then(u,d)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(tv,"__esModule",{value:!0});tv.RoleVerifier=void 0;class pQ{constructor(e){this._host=e}verifyRolesAllowed(e,t){var r;return fQ(this,void 0,void 0,function*(){if(!e)throw new Error("RoleVerifier: called verifyRolesAllowed() without a clientId");if(Array.isArray(t)&&t.length>0){const i=yield this._host.getClientInfo(e),s=(r=i==null?void 0:i.roles)!==null&&r!==void 0?r:[];for(let o=0;o<t.length;o++){const u=t[o];if(s.indexOf(u)>=0)return!0}return!1}return!0})}}tv.RoleVerifier=pQ;var Jt={},nv={},rv={},iv={};Object.defineProperty(iv,"__esModule",{value:!0});iv.default=gQ;let Ip;const mQ=new Uint8Array(16);function gQ(){if(!Ip&&(Ip=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ip))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ip(mQ)}var ha={},Ou={},sv={};Object.defineProperty(sv,"__esModule",{value:!0});sv.default=void 0;var vQ=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;sv.default=vQ;Object.defineProperty(Ou,"__esModule",{value:!0});Ou.default=void 0;var yQ=SQ(sv);function SQ(n){return n&&n.__esModule?n:{default:n}}function bQ(n){return typeof n=="string"&&yQ.default.test(n)}var wQ=bQ;Ou.default=wQ;Object.defineProperty(ha,"__esModule",{value:!0});ha.default=void 0;ha.unsafeStringify=N3;var CQ=xQ(Ou);function xQ(n){return n&&n.__esModule?n:{default:n}}const $n=[];for(let n=0;n<256;++n)$n.push((n+256).toString(16).slice(1));function N3(n,e=0){return($n[n[e+0]]+$n[n[e+1]]+$n[n[e+2]]+$n[n[e+3]]+"-"+$n[n[e+4]]+$n[n[e+5]]+"-"+$n[n[e+6]]+$n[n[e+7]]+"-"+$n[n[e+8]]+$n[n[e+9]]+"-"+$n[n[e+10]]+$n[n[e+11]]+$n[n[e+12]]+$n[n[e+13]]+$n[n[e+14]]+$n[n[e+15]]).toLowerCase()}function EQ(n,e=0){const t=N3(n,e);if(!(0,CQ.default)(t))throw TypeError("Stringified UUID is invalid");return t}var TQ=EQ;ha.default=TQ;Object.defineProperty(rv,"__esModule",{value:!0});rv.default=void 0;var PQ=_Q(iv),RQ=ha;function _Q(n){return n&&n.__esModule?n:{default:n}}let vR,vS,yS=0,SS=0;function IQ(n,e,t){let r=e&&t||0;const i=e||new Array(16);n=n||{};let s=n.node||vR,o=n.clockseq!==void 0?n.clockseq:vS;if(s==null||o==null){const P=n.random||(n.rng||PQ.default)();s==null&&(s=vR=[P[0]|1,P[1],P[2],P[3],P[4],P[5]]),o==null&&(o=vS=(P[6]<<8|P[7])&16383)}let u=n.msecs!==void 0?n.msecs:Date.now(),d=n.nsecs!==void 0?n.nsecs:SS+1;const f=u-yS+(d-SS)/1e4;if(f<0&&n.clockseq===void 0&&(o=o+1&16383),(f<0||u>yS)&&n.nsecs===void 0&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");yS=u,SS=d,vS=o,u+=122192928e5;const m=((u&268435455)*1e4+d)%4294967296;i[r++]=m>>>24&255,i[r++]=m>>>16&255,i[r++]=m>>>8&255,i[r++]=m&255;const g=u/4294967296*1e4&268435455;i[r++]=g>>>8&255,i[r++]=g&255,i[r++]=g>>>24&15|16,i[r++]=g>>>16&255,i[r++]=o>>>8|128,i[r++]=o&255;for(let P=0;P<6;++P)i[r+P]=s[P];return e||(0,RQ.unsafeStringify)(i)}var AQ=IQ;rv.default=AQ;var ov={},sa={},of={};Object.defineProperty(of,"__esModule",{value:!0});of.default=void 0;var kQ=OQ(Ou);function OQ(n){return n&&n.__esModule?n:{default:n}}function FQ(n){if(!(0,kQ.default)(n))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var NQ=FQ;of.default=NQ;Object.defineProperty(sa,"__esModule",{value:!0});sa.URL=sa.DNS=void 0;sa.default=jQ;var DQ=ha,LQ=MQ(of);function MQ(n){return n&&n.__esModule?n:{default:n}}function BQ(n){n=unescape(encodeURIComponent(n));const e=[];for(let t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}const D3="6ba7b810-9dad-11d1-80b4-00c04fd430c8";sa.DNS=D3;const L3="6ba7b811-9dad-11d1-80b4-00c04fd430c8";sa.URL=L3;function jQ(n,e,t){function r(i,s,o,u){var d;if(typeof i=="string"&&(i=BQ(i)),typeof s=="string"&&(s=(0,LQ.default)(s)),((d=s)===null||d===void 0?void 0:d.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let f=new Uint8Array(16+i.length);if(f.set(s),f.set(i,s.length),f=t(f),f[6]=f[6]&15|e,f[8]=f[8]&63|128,o){u=u||0;for(let m=0;m<16;++m)o[u+m]=f[m];return o}return(0,DQ.unsafeStringify)(f)}try{r.name=n}catch{}return r.DNS=D3,r.URL=L3,r}var av={};Object.defineProperty(av,"__esModule",{value:!0});av.default=void 0;function qQ(n){if(typeof n=="string"){const e=unescape(encodeURIComponent(n));n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n[t]=e.charCodeAt(t)}return UQ(zQ($Q(n),n.length*8))}function UQ(n){const e=[],t=n.length*32,r="0123456789abcdef";for(let i=0;i<t;i+=8){const s=n[i>>5]>>>i%32&255,o=parseInt(r.charAt(s>>>4&15)+r.charAt(s&15),16);e.push(o)}return e}function M3(n){return(n+64>>>9<<4)+14+1}function zQ(n,e){n[e>>5]|=128<<e%32,n[M3(e)-1]=e;let t=1732584193,r=-271733879,i=-1732584194,s=271733878;for(let o=0;o<n.length;o+=16){const u=t,d=r,f=i,m=s;t=ar(t,r,i,s,n[o],7,-680876936),s=ar(s,t,r,i,n[o+1],12,-389564586),i=ar(i,s,t,r,n[o+2],17,606105819),r=ar(r,i,s,t,n[o+3],22,-1044525330),t=ar(t,r,i,s,n[o+4],7,-176418897),s=ar(s,t,r,i,n[o+5],12,1200080426),i=ar(i,s,t,r,n[o+6],17,-1473231341),r=ar(r,i,s,t,n[o+7],22,-45705983),t=ar(t,r,i,s,n[o+8],7,1770035416),s=ar(s,t,r,i,n[o+9],12,-1958414417),i=ar(i,s,t,r,n[o+10],17,-42063),r=ar(r,i,s,t,n[o+11],22,-1990404162),t=ar(t,r,i,s,n[o+12],7,1804603682),s=ar(s,t,r,i,n[o+13],12,-40341101),i=ar(i,s,t,r,n[o+14],17,-1502002290),r=ar(r,i,s,t,n[o+15],22,1236535329),t=ur(t,r,i,s,n[o+1],5,-165796510),s=ur(s,t,r,i,n[o+6],9,-1069501632),i=ur(i,s,t,r,n[o+11],14,643717713),r=ur(r,i,s,t,n[o],20,-373897302),t=ur(t,r,i,s,n[o+5],5,-701558691),s=ur(s,t,r,i,n[o+10],9,38016083),i=ur(i,s,t,r,n[o+15],14,-660478335),r=ur(r,i,s,t,n[o+4],20,-405537848),t=ur(t,r,i,s,n[o+9],5,568446438),s=ur(s,t,r,i,n[o+14],9,-1019803690),i=ur(i,s,t,r,n[o+3],14,-187363961),r=ur(r,i,s,t,n[o+8],20,1163531501),t=ur(t,r,i,s,n[o+13],5,-1444681467),s=ur(s,t,r,i,n[o+2],9,-51403784),i=ur(i,s,t,r,n[o+7],14,1735328473),r=ur(r,i,s,t,n[o+12],20,-1926607734),t=lr(t,r,i,s,n[o+5],4,-378558),s=lr(s,t,r,i,n[o+8],11,-2022574463),i=lr(i,s,t,r,n[o+11],16,1839030562),r=lr(r,i,s,t,n[o+14],23,-35309556),t=lr(t,r,i,s,n[o+1],4,-1530992060),s=lr(s,t,r,i,n[o+4],11,1272893353),i=lr(i,s,t,r,n[o+7],16,-155497632),r=lr(r,i,s,t,n[o+10],23,-1094730640),t=lr(t,r,i,s,n[o+13],4,681279174),s=lr(s,t,r,i,n[o],11,-358537222),i=lr(i,s,t,r,n[o+3],16,-722521979),r=lr(r,i,s,t,n[o+6],23,76029189),t=lr(t,r,i,s,n[o+9],4,-640364487),s=lr(s,t,r,i,n[o+12],11,-421815835),i=lr(i,s,t,r,n[o+15],16,530742520),r=lr(r,i,s,t,n[o+2],23,-995338651),t=cr(t,r,i,s,n[o],6,-198630844),s=cr(s,t,r,i,n[o+7],10,1126891415),i=cr(i,s,t,r,n[o+14],15,-1416354905),r=cr(r,i,s,t,n[o+5],21,-57434055),t=cr(t,r,i,s,n[o+12],6,1700485571),s=cr(s,t,r,i,n[o+3],10,-1894986606),i=cr(i,s,t,r,n[o+10],15,-1051523),r=cr(r,i,s,t,n[o+1],21,-2054922799),t=cr(t,r,i,s,n[o+8],6,1873313359),s=cr(s,t,r,i,n[o+15],10,-30611744),i=cr(i,s,t,r,n[o+6],15,-1560198380),r=cr(r,i,s,t,n[o+13],21,1309151649),t=cr(t,r,i,s,n[o+4],6,-145523070),s=cr(s,t,r,i,n[o+11],10,-1120210379),i=cr(i,s,t,r,n[o+2],15,718787259),r=cr(r,i,s,t,n[o+9],21,-343485551),t=Bo(t,u),r=Bo(r,d),i=Bo(i,f),s=Bo(s,m)}return[t,r,i,s]}function $Q(n){if(n.length===0)return[];const e=n.length*8,t=new Uint32Array(M3(e));for(let r=0;r<e;r+=8)t[r>>5]|=(n[r/8]&255)<<r%32;return t}function Bo(n,e){const t=(n&65535)+(e&65535);return(n>>16)+(e>>16)+(t>>16)<<16|t&65535}function HQ(n,e){return n<<e|n>>>32-e}function uv(n,e,t,r,i,s){return Bo(HQ(Bo(Bo(e,n),Bo(r,s)),i),t)}function ar(n,e,t,r,i,s,o){return uv(e&t|~e&r,n,e,i,s,o)}function ur(n,e,t,r,i,s,o){return uv(e&r|t&~r,n,e,i,s,o)}function lr(n,e,t,r,i,s,o){return uv(e^t^r,n,e,i,s,o)}function cr(n,e,t,r,i,s,o){return uv(t^(e|~r),n,e,i,s,o)}var VQ=qQ;av.default=VQ;Object.defineProperty(ov,"__esModule",{value:!0});ov.default=void 0;var WQ=B3(sa),GQ=B3(av);function B3(n){return n&&n.__esModule?n:{default:n}}const KQ=(0,WQ.default)("v3",48,GQ.default);var JQ=KQ;ov.default=JQ;var lv={},cv={};Object.defineProperty(cv,"__esModule",{value:!0});cv.default=void 0;const QQ=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var XQ={randomUUID:QQ};cv.default=XQ;Object.defineProperty(lv,"__esModule",{value:!0});lv.default=void 0;var yR=j3(cv),YQ=j3(iv),ZQ=ha;function j3(n){return n&&n.__esModule?n:{default:n}}function eX(n,e,t){if(yR.default.randomUUID&&!e&&!n)return yR.default.randomUUID();n=n||{};const r=n.random||(n.rng||YQ.default)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return(0,ZQ.unsafeStringify)(r)}var tX=eX;lv.default=tX;var dv={},hv={};Object.defineProperty(hv,"__esModule",{value:!0});hv.default=void 0;function nX(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function bS(n,e){return n<<e|n>>>32-e}function rX(n){const e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){const o=unescape(encodeURIComponent(n));n=[];for(let u=0;u<o.length;++u)n.push(o.charCodeAt(u))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);const r=n.length/4+2,i=Math.ceil(r/16),s=new Array(i);for(let o=0;o<i;++o){const u=new Uint32Array(16);for(let d=0;d<16;++d)u[d]=n[o*64+d*4]<<24|n[o*64+d*4+1]<<16|n[o*64+d*4+2]<<8|n[o*64+d*4+3];s[o]=u}s[i-1][14]=(n.length-1)*8/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=(n.length-1)*8&4294967295;for(let o=0;o<i;++o){const u=new Uint32Array(80);for(let D=0;D<16;++D)u[D]=s[o][D];for(let D=16;D<80;++D)u[D]=bS(u[D-3]^u[D-8]^u[D-14]^u[D-16],1);let d=t[0],f=t[1],m=t[2],g=t[3],P=t[4];for(let D=0;D<80;++D){const M=Math.floor(D/20),U=bS(d,5)+nX(M,f,m,g)+P+e[M]+u[D]>>>0;P=g,g=m,m=bS(f,30)>>>0,f=d,d=U}t[0]=t[0]+d>>>0,t[1]=t[1]+f>>>0,t[2]=t[2]+m>>>0,t[3]=t[3]+g>>>0,t[4]=t[4]+P>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var iX=rX;hv.default=iX;Object.defineProperty(dv,"__esModule",{value:!0});dv.default=void 0;var sX=q3(sa),oX=q3(hv);function q3(n){return n&&n.__esModule?n:{default:n}}const aX=(0,sX.default)("v5",80,oX.default);var uX=aX;dv.default=uX;var fv={};Object.defineProperty(fv,"__esModule",{value:!0});fv.default=void 0;var lX="00000000-0000-0000-0000-000000000000";fv.default=lX;var pv={};Object.defineProperty(pv,"__esModule",{value:!0});pv.default=void 0;var cX=dX(Ou);function dX(n){return n&&n.__esModule?n:{default:n}}function hX(n){if(!(0,cX.default)(n))throw TypeError("Invalid UUID");return parseInt(n.slice(14,15),16)}var fX=hX;pv.default=fX;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"NIL",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(n,"parse",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(n,"stringify",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(n,"v1",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(n,"v3",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(n,"v4",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(n,"v5",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(n,"validate",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(n,"version",{enumerable:!0,get:function(){return o.default}});var e=m(rv),t=m(ov),r=m(lv),i=m(dv),s=m(fv),o=m(pv),u=m(Ou),d=m(ha),f=m(of);function m(g){return g&&g.__esModule?g:{default:g}}})(nv);var wS={},CS={},pd={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var hw;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(hw||(hw={}));var fw;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(fw||(fw={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var pw;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(pw||(pw={}));var mw;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(mw||(mw={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var gw;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(gw||(gw={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var vw;(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(vw||(vw={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const pX=Object.freeze(Object.defineProperty({__proto__:null,get FileMode(){return pw},get MessageType(){return hw},get NackErrorType(){return fw},get ScopeType(){return vw},get SummaryType(){return gw},get TreeEntry(){return mw}},Symbol.toStringTag,{value:"Module"})),U3=Li(pX);var Pa={},Be={},SR;function mX(){if(SR)return Be;SR=1;var n={};n.userAgent=!1;var e={},t="10.8.6",r="jsrsasign(all) 10.8.6 (2023-04-26) (c) 2010-2023 Kenji Urushima | kjur.github.io/jsrsasign/license";/*! CryptoJS v3.1.2 core-fix.js
 * code.google.com/p/crypto-js
 * (c) 2009-2013 by Jeff Mott. All rights reserved.
 * code.google.com/p/crypto-js/wiki/License
 * THIS IS FIX of 'core.js' to fix Hmac issue.
 * https://code.google.com/p/crypto-js/issues/detail?id=84
 * https://crypto-js.googlecode.com/svn-history/r667/branches/3.x/src/core.js
 */var i=i||function(a,l){var c={},p=c.lib={},y=p.Base=function(){function w(){}return{extend:function(I){w.prototype=this;var R=new w;return I&&R.mixIn(I),R.hasOwnProperty("init")||(R.init=function(){R.$super.init.apply(this,arguments)}),R.init.prototype=R,R.$super=this,R},create:function(){var I=this.extend();return I.init.apply(I,arguments),I},init:function(){},mixIn:function(I){for(var R in I)I.hasOwnProperty(R)&&(this[R]=I[R]);I.hasOwnProperty("toString")&&(this.toString=I.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),v=p.WordArray=y.extend({init:function(w,I){w=this.words=w||[],I!=l?this.sigBytes=I:this.sigBytes=w.length*4},toString:function(w){return(w||C).stringify(this)},concat:function(w){var I=this.words,R=w.words,F=this.sigBytes,L=w.sigBytes;if(this.clamp(),F%4)for(var V=0;V<L;V++){var te=R[V>>>2]>>>24-V%4*8&255;I[F+V>>>2]|=te<<24-(F+V)%4*8}else for(var V=0;V<L;V+=4)I[F+V>>>2]=R[V>>>2];return this.sigBytes+=L,this},clamp:function(){var w=this.words,I=this.sigBytes;w[I>>>2]&=4294967295<<32-I%4*8,w.length=a.ceil(I/4)},clone:function(){var w=y.clone.call(this);return w.words=this.words.slice(0),w},random:function(w){for(var I=[],R=0;R<w;R+=4)I.push(a.random()*4294967296|0);return new v.init(I,w)}}),x=c.enc={},C=x.Hex={stringify:function(w){for(var I=w.words,R=w.sigBytes,F=[],L=0;L<R;L++){var V=I[L>>>2]>>>24-L%4*8&255;F.push((V>>>4).toString(16)),F.push((V&15).toString(16))}return F.join("")},parse:function(w){for(var I=w.length,R=[],F=0;F<I;F+=2)R[F>>>3]|=parseInt(w.substr(F,2),16)<<24-F%8*4;return new v.init(R,I/2)}},O=x.Latin1={stringify:function(w){for(var I=w.words,R=w.sigBytes,F=[],L=0;L<R;L++){var V=I[L>>>2]>>>24-L%4*8&255;F.push(String.fromCharCode(V))}return F.join("")},parse:function(w){for(var I=w.length,R=[],F=0;F<I;F++)R[F>>>2]|=(w.charCodeAt(F)&255)<<24-F%4*8;return new v.init(R,I)}},_=x.Utf8={stringify:function(w){try{return decodeURIComponent(escape(O.stringify(w)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(w){return O.parse(unescape(encodeURIComponent(w)))}},B=p.BufferedBlockAlgorithm=y.extend({reset:function(){this._data=new v.init,this._nDataBytes=0},_append:function(w){typeof w=="string"&&(w=_.parse(w)),this._data.concat(w),this._nDataBytes+=w.sigBytes},_process:function(w){var I=this._data,R=I.words,F=I.sigBytes,L=this.blockSize,V=L*4,te=F/V;w?te=a.ceil(te):te=a.max((te|0)-this._minBufferSize,0);var ue=te*L,ae=a.min(ue*4,F);if(ue){for(var le=0;le<ue;le+=L)this._doProcessBlock(R,le);var H=R.splice(0,ue);I.sigBytes-=ae}return new v.init(H,ae)},clone:function(){var w=y.clone.call(this);return w._data=this._data.clone(),w},_minBufferSize:0});p.Hasher=B.extend({cfg:y.extend(),init:function(w){this.cfg=this.cfg.extend(w),this.reset()},reset:function(){B.reset.call(this),this._doReset()},update:function(w){return this._append(w),this._process(),this},finalize:function(w){w&&this._append(w);var I=this._doFinalize();return I},blockSize:512/32,_createHelper:function(w){return function(I,R){return new w.init(R).finalize(I)}},_createHmacHelper:function(w){return function(I,R){return new N.HMAC.init(w,R).finalize(I)}}});var N=c.algo={};return c}(Math);(function(a){var y=i,l=y.lib,c=l.Base,p=l.WordArray,y=y.x64={};y.Word=c.extend({init:function(v,x){this.high=v,this.low=x}}),y.WordArray=c.extend({init:function(v,x){v=this.words=v||[],this.sigBytes=x!=a?x:8*v.length},toX32:function(){for(var v=this.words,x=v.length,C=[],O=0;O<x;O++){var _=v[O];C.push(_.high),C.push(_.low)}return p.create(C,this.sigBytes)},clone:function(){for(var v=c.clone.call(this),x=v.words=this.words.slice(0),C=x.length,O=0;O<C;O++)x[O]=x[O].clone();return v}})})(),i.lib.Cipher||function(a){var I=i,l=I.lib,c=l.Base,p=l.WordArray,y=l.BufferedBlockAlgorithm,v=I.enc.Base64,x=I.algo.EvpKDF,C=l.Cipher=y.extend({cfg:c.extend(),createEncryptor:function(F,L){return this.create(this._ENC_XFORM_MODE,F,L)},createDecryptor:function(F,L){return this.create(this._DEC_XFORM_MODE,F,L)},init:function(F,L,V){this.cfg=this.cfg.extend(V),this._xformMode=F,this._key=L,this.reset()},reset:function(){y.reset.call(this),this._doReset()},process:function(F){return this._append(F),this._process()},finalize:function(F){return F&&this._append(F),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(F){return{encrypt:function(L,V,te){return(typeof V=="string"?R:w).encrypt(F,L,V,te)},decrypt:function(L,V,te){return(typeof V=="string"?R:w).decrypt(F,L,V,te)}}}});l.StreamCipher=C.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var N=I.mode={},O=function(F,L,V){var te=this._iv;te?this._iv=a:te=this._prevBlock;for(var ue=0;ue<V;ue++)F[L+ue]^=te[ue]},_=(l.BlockCipherMode=c.extend({createEncryptor:function(F,L){return this.Encryptor.create(F,L)},createDecryptor:function(F,L){return this.Decryptor.create(F,L)},init:function(F,L){this._cipher=F,this._iv=L}})).extend();_.Encryptor=_.extend({processBlock:function(F,L){var V=this._cipher,te=V.blockSize;O.call(this,F,L,te),V.encryptBlock(F,L),this._prevBlock=F.slice(L,L+te)}}),_.Decryptor=_.extend({processBlock:function(F,L){var V=this._cipher,te=V.blockSize,ue=F.slice(L,L+te);V.decryptBlock(F,L),O.call(this,F,L,te),this._prevBlock=ue}}),N=N.CBC=_,_=(I.pad={}).Pkcs7={pad:function(F,L){for(var V=4*L,V=V-F.sigBytes%V,te=V<<24|V<<16|V<<8|V,ue=[],ae=0;ae<V;ae+=4)ue.push(te);V=p.create(ue,V),F.concat(V)},unpad:function(F){F.sigBytes-=F.words[F.sigBytes-1>>>2]&255}},l.BlockCipher=C.extend({cfg:C.cfg.extend({mode:N,padding:_}),reset:function(){C.reset.call(this);var L=this.cfg,F=L.iv,L=L.mode;if(this._xformMode==this._ENC_XFORM_MODE)var V=L.createEncryptor;else V=L.createDecryptor,this._minBufferSize=1;this._mode=V.call(L,this,F&&F.words)},_doProcessBlock:function(F,L){this._mode.processBlock(F,L)},_doFinalize:function(){var F=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){F.pad(this._data,this.blockSize);var L=this._process(!0)}else L=this._process(!0),F.unpad(L);return L},blockSize:4});var B=l.CipherParams=c.extend({init:function(F){this.mixIn(F)},toString:function(F){return(F||this.formatter).stringify(this)}}),N=(I.format={}).OpenSSL={stringify:function(F){var L=F.ciphertext;return F=F.salt,(F?p.create([1398893684,1701076831]).concat(F).concat(L):L).toString(v)},parse:function(F){F=v.parse(F);var L=F.words;if(L[0]==1398893684&&L[1]==1701076831){var V=p.create(L.slice(2,4));L.splice(0,4),F.sigBytes-=16}return B.create({ciphertext:F,salt:V})}},w=l.SerializableCipher=c.extend({cfg:c.extend({format:N}),encrypt:function(F,L,V,te){te=this.cfg.extend(te);var ue=F.createEncryptor(V,te);return L=ue.finalize(L),ue=ue.cfg,B.create({ciphertext:L,key:V,iv:ue.iv,algorithm:F,mode:ue.mode,padding:ue.padding,blockSize:F.blockSize,formatter:te.format})},decrypt:function(F,L,V,te){return te=this.cfg.extend(te),L=this._parse(L,te.format),F.createDecryptor(V,te).finalize(L.ciphertext)},_parse:function(F,L){return typeof F=="string"?L.parse(F,this):F}}),I=(I.kdf={}).OpenSSL={execute:function(F,L,V,te){return te||(te=p.random(8)),F=x.create({keySize:L+V}).compute(F,te),V=p.create(F.words.slice(L),4*V),F.sigBytes=4*L,B.create({key:F,iv:V,salt:te})}},R=l.PasswordBasedCipher=w.extend({cfg:w.cfg.extend({kdf:I}),encrypt:function(F,L,V,te){return te=this.cfg.extend(te),V=te.kdf.execute(V,F.keySize,F.ivSize),te.iv=V.iv,F=w.encrypt.call(this,F,L,V.key,te),F.mixIn(V),F},decrypt:function(F,L,V,te){return te=this.cfg.extend(te),L=this._parse(L,te.format),V=te.kdf.execute(V,F.keySize,F.ivSize,L.salt),te.iv=V.iv,w.decrypt.call(this,F,L,V.key,te)}})}(),function(){for(var a=i,l=a.lib.BlockCipher,H=a.algo,c=[],p=[],y=[],v=[],x=[],C=[],O=[],_=[],B=[],N=[],w=[],I=0;256>I;I++)w[I]=128>I?I<<1:I<<1^283;for(var R=0,F=0,I=0;256>I;I++){var L=F^F<<1^F<<2^F<<3^F<<4,L=L>>>8^L&255^99;c[R]=L,p[L]=R;var V=w[R],te=w[V],ue=w[te],ae=257*w[L]^16843008*L;y[R]=ae<<24|ae>>>8,v[R]=ae<<16|ae>>>16,x[R]=ae<<8|ae>>>24,C[R]=ae,ae=16843009*ue^65537*te^257*V^16843008*R,O[L]=ae<<24|ae>>>8,_[L]=ae<<16|ae>>>16,B[L]=ae<<8|ae>>>24,N[L]=ae,R?(R=V^w[w[w[ue^V]]],F^=w[w[F]]):R=F=1}var le=[0,1,2,4,8,16,32,64,128,27,54],H=H.AES=l.extend({_doReset:function(){for(var $=this._key,W=$.words,J=$.sigBytes/4,$=4*((this._nRounds=J+6)+1),Z=this._keySchedule=[],oe=0;oe<$;oe++)if(oe<J)Z[oe]=W[oe];else{var de=Z[oe-1];oe%J?6<J&&oe%J==4&&(de=c[de>>>24]<<24|c[de>>>16&255]<<16|c[de>>>8&255]<<8|c[de&255]):(de=de<<8|de>>>24,de=c[de>>>24]<<24|c[de>>>16&255]<<16|c[de>>>8&255]<<8|c[de&255],de^=le[oe/J|0]<<24),Z[oe]=Z[oe-J]^de}for(W=this._invKeySchedule=[],J=0;J<$;J++)oe=$-J,de=J%4?Z[oe]:Z[oe-4],W[J]=4>J||4>=oe?de:O[c[de>>>24]]^_[c[de>>>16&255]]^B[c[de>>>8&255]]^N[c[de&255]]},encryptBlock:function(W,J){this._doCryptBlock(W,J,this._keySchedule,y,v,x,C,c)},decryptBlock:function(W,J){var $=W[J+1];W[J+1]=W[J+3],W[J+3]=$,this._doCryptBlock(W,J,this._invKeySchedule,O,_,B,N,p),$=W[J+1],W[J+1]=W[J+3],W[J+3]=$},_doCryptBlock:function(W,J,$,Z,oe,de,Te,h){for(var T=this._nRounds,me=W[J]^$[0],re=W[J+1]^$[1],Se=W[J+2]^$[2],ne=W[J+3]^$[3],b=4,A=1;A<T;A++)var q=Z[me>>>24]^oe[re>>>16&255]^de[Se>>>8&255]^Te[ne&255]^$[b++],G=Z[re>>>24]^oe[Se>>>16&255]^de[ne>>>8&255]^Te[me&255]^$[b++],Q=Z[Se>>>24]^oe[ne>>>16&255]^de[me>>>8&255]^Te[re&255]^$[b++],ne=Z[ne>>>24]^oe[me>>>16&255]^de[re>>>8&255]^Te[Se&255]^$[b++],me=q,re=G,Se=Q;q=(h[me>>>24]<<24|h[re>>>16&255]<<16|h[Se>>>8&255]<<8|h[ne&255])^$[b++],G=(h[re>>>24]<<24|h[Se>>>16&255]<<16|h[ne>>>8&255]<<8|h[me&255])^$[b++],Q=(h[Se>>>24]<<24|h[ne>>>16&255]<<16|h[me>>>8&255]<<8|h[re&255])^$[b++],ne=(h[ne>>>24]<<24|h[me>>>16&255]<<16|h[re>>>8&255]<<8|h[Se&255])^$[b++],W[J]=q,W[J+1]=G,W[J+2]=Q,W[J+3]=ne},keySize:8});a.AES=l._createHelper(H)}(),function(){function a(w,I){var R=(this._lBlock>>>w^this._rBlock)&I;this._rBlock^=R,this._lBlock^=R<<w}function l(w,I){var R=(this._rBlock>>>w^this._lBlock)&I;this._lBlock^=R,this._rBlock^=R<<w}var c=i,y=c.lib,p=y.WordArray,y=y.BlockCipher,v=c.algo,x=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],C=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],O=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],_=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],B=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],N=v.DES=y.extend({_doReset:function(){for(var w=this._key.words,I=[],R=0;56>R;R++){var F=x[R]-1;I[R]=w[F>>>5]>>>31-F%32&1}for(w=this._subKeys=[],F=0;16>F;F++){for(var L=w[F]=[],V=O[F],R=0;24>R;R++)L[R/6|0]|=I[(C[R]-1+V)%28]<<31-R%6,L[4+(R/6|0)]|=I[28+(C[R+24]-1+V)%28]<<31-R%6;for(L[0]=L[0]<<1|L[0]>>>31,R=1;7>R;R++)L[R]>>>=4*(R-1)+3;L[7]=L[7]<<5|L[7]>>>27}for(I=this._invSubKeys=[],R=0;16>R;R++)I[R]=w[15-R]},encryptBlock:function(w,I){this._doCryptBlock(w,I,this._subKeys)},decryptBlock:function(w,I){this._doCryptBlock(w,I,this._invSubKeys)},_doCryptBlock:function(w,I,R){this._lBlock=w[I],this._rBlock=w[I+1],a.call(this,4,252645135),a.call(this,16,65535),l.call(this,2,858993459),l.call(this,8,16711935),a.call(this,1,1431655765);for(var F=0;16>F;F++){for(var L=R[F],V=this._lBlock,te=this._rBlock,ue=0,ae=0;8>ae;ae++)ue|=_[ae][((te^L[ae])&B[ae])>>>0];this._lBlock=te,this._rBlock=V^ue}R=this._lBlock,this._lBlock=this._rBlock,this._rBlock=R,a.call(this,1,1431655765),l.call(this,8,16711935),l.call(this,2,858993459),a.call(this,16,65535),a.call(this,4,252645135),w[I]=this._lBlock,w[I+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});c.DES=y._createHelper(N),v=v.TripleDES=y.extend({_doReset:function(){var w=this._key.words;this._des1=N.createEncryptor(p.create(w.slice(0,2))),this._des2=N.createEncryptor(p.create(w.slice(2,4))),this._des3=N.createEncryptor(p.create(w.slice(4,6)))},encryptBlock:function(w,I){this._des1.encryptBlock(w,I),this._des2.decryptBlock(w,I),this._des3.encryptBlock(w,I)},decryptBlock:function(w,I){this._des3.decryptBlock(w,I),this._des2.encryptBlock(w,I),this._des1.decryptBlock(w,I)},keySize:6,ivSize:2,blockSize:2}),c.TripleDES=y._createHelper(v)}(),function(){var a=i,l=a.lib.WordArray;a.enc.Base64={stringify:function(c){var p=c.words,y=c.sigBytes,v=this._map;c.clamp(),c=[];for(var x=0;x<y;x+=3)for(var C=(p[x>>>2]>>>24-8*(x%4)&255)<<16|(p[x+1>>>2]>>>24-8*((x+1)%4)&255)<<8|p[x+2>>>2]>>>24-8*((x+2)%4)&255,O=0;4>O&&x+.75*O<y;O++)c.push(v.charAt(C>>>6*(3-O)&63));if(p=v.charAt(64))for(;c.length%4;)c.push(p);return c.join("")},parse:function(c){var p=c.length,y=this._map,v=y.charAt(64);v&&(v=c.indexOf(v),v!=-1&&(p=v));for(var v=[],x=0,C=0;C<p;C++)if(C%4){var O=y.indexOf(c.charAt(C-1))<<2*(C%4),_=y.indexOf(c.charAt(C))>>>6-2*(C%4);v[x>>>2]|=(O|_)<<24-8*(x%4),x++}return l.create(v,x)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(a){function l(N,w,I,R,F,L,V){return N=N+(w&I|~w&R)+F+V,(N<<L|N>>>32-L)+w}function c(N,w,I,R,F,L,V){return N=N+(w&R|I&~R)+F+V,(N<<L|N>>>32-L)+w}function p(N,w,I,R,F,L,V){return N=N+(w^I^R)+F+V,(N<<L|N>>>32-L)+w}function y(N,w,I,R,F,L,V){return N=N+(I^(w|~R))+F+V,(N<<L|N>>>32-L)+w}for(var v=i,O=v.lib,x=O.WordArray,C=O.Hasher,O=v.algo,_=[],B=0;64>B;B++)_[B]=4294967296*a.abs(a.sin(B+1))|0;O=O.MD5=C.extend({_doReset:function(){this._hash=new x.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(N,w){for(var I=0;16>I;I++){var R=w+I,F=N[R];N[R]=(F<<8|F>>>24)&16711935|(F<<24|F>>>8)&4278255360}var I=this._hash.words,R=N[w+0],F=N[w+1],L=N[w+2],V=N[w+3],te=N[w+4],ue=N[w+5],ae=N[w+6],le=N[w+7],H=N[w+8],W=N[w+9],J=N[w+10],$=N[w+11],Z=N[w+12],oe=N[w+13],de=N[w+14],Te=N[w+15],h=I[0],A=I[1],b=I[2],T=I[3],h=l(h,A,b,T,R,7,_[0]),T=l(T,h,A,b,F,12,_[1]),b=l(b,T,h,A,L,17,_[2]),A=l(A,b,T,h,V,22,_[3]),h=l(h,A,b,T,te,7,_[4]),T=l(T,h,A,b,ue,12,_[5]),b=l(b,T,h,A,ae,17,_[6]),A=l(A,b,T,h,le,22,_[7]),h=l(h,A,b,T,H,7,_[8]),T=l(T,h,A,b,W,12,_[9]),b=l(b,T,h,A,J,17,_[10]),A=l(A,b,T,h,$,22,_[11]),h=l(h,A,b,T,Z,7,_[12]),T=l(T,h,A,b,oe,12,_[13]),b=l(b,T,h,A,de,17,_[14]),A=l(A,b,T,h,Te,22,_[15]),h=c(h,A,b,T,F,5,_[16]),T=c(T,h,A,b,ae,9,_[17]),b=c(b,T,h,A,$,14,_[18]),A=c(A,b,T,h,R,20,_[19]),h=c(h,A,b,T,ue,5,_[20]),T=c(T,h,A,b,J,9,_[21]),b=c(b,T,h,A,Te,14,_[22]),A=c(A,b,T,h,te,20,_[23]),h=c(h,A,b,T,W,5,_[24]),T=c(T,h,A,b,de,9,_[25]),b=c(b,T,h,A,V,14,_[26]),A=c(A,b,T,h,H,20,_[27]),h=c(h,A,b,T,oe,5,_[28]),T=c(T,h,A,b,L,9,_[29]),b=c(b,T,h,A,le,14,_[30]),A=c(A,b,T,h,Z,20,_[31]),h=p(h,A,b,T,ue,4,_[32]),T=p(T,h,A,b,H,11,_[33]),b=p(b,T,h,A,$,16,_[34]),A=p(A,b,T,h,de,23,_[35]),h=p(h,A,b,T,F,4,_[36]),T=p(T,h,A,b,te,11,_[37]),b=p(b,T,h,A,le,16,_[38]),A=p(A,b,T,h,J,23,_[39]),h=p(h,A,b,T,oe,4,_[40]),T=p(T,h,A,b,R,11,_[41]),b=p(b,T,h,A,V,16,_[42]),A=p(A,b,T,h,ae,23,_[43]),h=p(h,A,b,T,W,4,_[44]),T=p(T,h,A,b,Z,11,_[45]),b=p(b,T,h,A,Te,16,_[46]),A=p(A,b,T,h,L,23,_[47]),h=y(h,A,b,T,R,6,_[48]),T=y(T,h,A,b,le,10,_[49]),b=y(b,T,h,A,de,15,_[50]),A=y(A,b,T,h,ue,21,_[51]),h=y(h,A,b,T,Z,6,_[52]),T=y(T,h,A,b,V,10,_[53]),b=y(b,T,h,A,J,15,_[54]),A=y(A,b,T,h,F,21,_[55]),h=y(h,A,b,T,H,6,_[56]),T=y(T,h,A,b,Te,10,_[57]),b=y(b,T,h,A,ae,15,_[58]),A=y(A,b,T,h,oe,21,_[59]),h=y(h,A,b,T,te,6,_[60]),T=y(T,h,A,b,$,10,_[61]),b=y(b,T,h,A,L,15,_[62]),A=y(A,b,T,h,W,21,_[63]);I[0]=I[0]+h|0,I[1]=I[1]+A|0,I[2]=I[2]+b|0,I[3]=I[3]+T|0},_doFinalize:function(){var N=this._data,w=N.words,I=8*this._nDataBytes,R=8*N.sigBytes;w[R>>>5]|=128<<24-R%32;var F=a.floor(I/4294967296);for(w[(R+64>>>9<<4)+15]=(F<<8|F>>>24)&16711935|(F<<24|F>>>8)&4278255360,w[(R+64>>>9<<4)+14]=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360,N.sigBytes=4*(w.length+1),this._process(),N=this._hash,w=N.words,I=0;4>I;I++)R=w[I],w[I]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360;return N},clone:function(){var N=C.clone.call(this);return N._hash=this._hash.clone(),N}}),v.MD5=C._createHelper(O),v.HmacMD5=C._createHmacHelper(O)}(Math),function(){var a=i,y=a.lib,l=y.WordArray,c=y.Hasher,p=[],y=a.algo.SHA1=c.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(v,x){for(var C=this._hash.words,O=C[0],_=C[1],B=C[2],N=C[3],w=C[4],I=0;80>I;I++){if(16>I)p[I]=v[x+I]|0;else{var R=p[I-3]^p[I-8]^p[I-14]^p[I-16];p[I]=R<<1|R>>>31}R=(O<<5|O>>>27)+w+p[I],R=20>I?R+((_&B|~_&N)+1518500249):40>I?R+((_^B^N)+1859775393):60>I?R+((_&B|_&N|B&N)-1894007588):R+((_^B^N)-899497514),w=N,N=B,B=_<<30|_>>>2,_=O,O=R}C[0]=C[0]+O|0,C[1]=C[1]+_|0,C[2]=C[2]+B|0,C[3]=C[3]+N|0,C[4]=C[4]+w|0},_doFinalize:function(){var v=this._data,x=v.words,C=8*this._nDataBytes,O=8*v.sigBytes;return x[O>>>5]|=128<<24-O%32,x[(O+64>>>9<<4)+14]=Math.floor(C/4294967296),x[(O+64>>>9<<4)+15]=C,v.sigBytes=4*x.length,this._process(),this._hash},clone:function(){var v=c.clone.call(this);return v._hash=this._hash.clone(),v}});a.SHA1=c._createHelper(y),a.HmacSHA1=c._createHmacHelper(y)}(),function(a){for(var l=i,I=l.lib,c=I.WordArray,p=I.Hasher,I=l.algo,y=[],v=[],x=function(F){return 4294967296*(F-(F|0))|0},C=2,O=0;64>O;){var _;e:{_=C;for(var B=a.sqrt(_),N=2;N<=B;N++)if(!(_%N)){_=!1;break e}_=!0}_&&(8>O&&(y[O]=x(a.pow(C,.5))),v[O]=x(a.pow(C,1/3)),O++),C++}var w=[],I=I.SHA256=p.extend({_doReset:function(){this._hash=new c.init(y.slice(0))},_doProcessBlock:function(R,F){for(var L=this._hash.words,V=L[0],te=L[1],ue=L[2],ae=L[3],le=L[4],H=L[5],W=L[6],J=L[7],$=0;64>$;$++){if(16>$)w[$]=R[F+$]|0;else{var Z=w[$-15],oe=w[$-2];w[$]=((Z<<25|Z>>>7)^(Z<<14|Z>>>18)^Z>>>3)+w[$-7]+((oe<<15|oe>>>17)^(oe<<13|oe>>>19)^oe>>>10)+w[$-16]}Z=J+((le<<26|le>>>6)^(le<<21|le>>>11)^(le<<7|le>>>25))+(le&H^~le&W)+v[$]+w[$],oe=((V<<30|V>>>2)^(V<<19|V>>>13)^(V<<10|V>>>22))+(V&te^V&ue^te&ue),J=W,W=H,H=le,le=ae+Z|0,ae=ue,ue=te,te=V,V=Z+oe|0}L[0]=L[0]+V|0,L[1]=L[1]+te|0,L[2]=L[2]+ue|0,L[3]=L[3]+ae|0,L[4]=L[4]+le|0,L[5]=L[5]+H|0,L[6]=L[6]+W|0,L[7]=L[7]+J|0},_doFinalize:function(){var R=this._data,F=R.words,L=8*this._nDataBytes,V=8*R.sigBytes;return F[V>>>5]|=128<<24-V%32,F[(V+64>>>9<<4)+14]=a.floor(L/4294967296),F[(V+64>>>9<<4)+15]=L,R.sigBytes=4*F.length,this._process(),this._hash},clone:function(){var R=p.clone.call(this);return R._hash=this._hash.clone(),R}});l.SHA256=p._createHelper(I),l.HmacSHA256=p._createHmacHelper(I)}(Math),function(){var a=i,l=a.lib.WordArray,p=a.algo,c=p.SHA256,p=p.SHA224=c.extend({_doReset:function(){this._hash=new l.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var y=c._doFinalize.call(this);return y.sigBytes-=4,y}});a.SHA224=c._createHelper(p),a.HmacSHA224=c._createHmacHelper(p)}(),function(){function a(){return p.create.apply(p,arguments)}for(var l=i,c=l.lib.Hasher,v=l.x64,p=v.Word,y=v.WordArray,v=l.algo,x=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],C=[],O=0;80>O;O++)C[O]=a();v=v.SHA512=c.extend({_doReset:function(){this._hash=new y.init([new p.init(1779033703,4089235720),new p.init(3144134277,2227873595),new p.init(1013904242,4271175723),new p.init(2773480762,1595750129),new p.init(1359893119,2917565137),new p.init(2600822924,725511199),new p.init(528734635,4215389547),new p.init(1541459225,327033209)])},_doProcessBlock:function(_,B){for(var te=this._hash.words,N=te[0],w=te[1],I=te[2],R=te[3],F=te[4],L=te[5],V=te[6],te=te[7],ue=N.high,ae=N.low,le=w.high,H=w.low,W=I.high,J=I.low,$=R.high,Z=R.low,oe=F.high,de=F.low,Te=L.high,h=L.low,T=V.high,b=V.low,A=te.high,q=te.low,G=ue,Q=ae,ne=le,me=H,re=W,Se=J,Ue=$,Oe=Z,Pe=oe,Me=de,Ie=Te,ze=h,Ye=T,Ke=b,bn=A,ir=q,Dn=0;80>Dn;Dn++){var xo=C[Dn];if(16>Dn)var wi=xo.high=_[B+2*Dn]|0,wt=xo.low=_[B+2*Dn+1]|0;else{var wi=C[Dn-15],wt=wi.high,ds=wi.low,wi=(wt>>>1|ds<<31)^(wt>>>8|ds<<24)^wt>>>7,ds=(ds>>>1|wt<<31)^(ds>>>8|wt<<24)^(ds>>>7|wt<<25),Ea=C[Dn-2],wt=Ea.high,Lt=Ea.low,Ea=(wt>>>19|Lt<<13)^(wt<<3|Lt>>>29)^wt>>>6,Lt=(Lt>>>19|wt<<13)^(Lt<<3|wt>>>29)^(Lt>>>6|wt<<26),wt=C[Dn-7],Y0=wt.high,Co=C[Dn-16],hs=Co.high,Co=Co.low,wt=ds+wt.low,wi=wi+Y0+(wt>>>0<ds>>>0?1:0),wt=wt+Lt,wi=wi+Ea+(wt>>>0<Lt>>>0?1:0),wt=wt+Co,wi=wi+hs+(wt>>>0<Co>>>0?1:0);xo.high=wi,xo.low=wt}var Y0=Pe&Ie^~Pe&Ye,Co=Me&ze^~Me&Ke,xo=G&ne^G&re^ne&re,SD=Q&me^Q&Se^me&Se,ds=(G>>>28|Q<<4)^(G<<30|Q>>>2)^(G<<25|Q>>>7),Ea=(Q>>>28|G<<4)^(Q<<30|G>>>2)^(Q<<25|G>>>7),Lt=x[Dn],bD=Lt.high,jE=Lt.low,Lt=ir+((Me>>>14|Pe<<18)^(Me>>>18|Pe<<14)^(Me<<23|Pe>>>9)),hs=bn+((Pe>>>14|Me<<18)^(Pe>>>18|Me<<14)^(Pe<<23|Me>>>9))+(Lt>>>0<ir>>>0?1:0),Lt=Lt+Co,hs=hs+Y0+(Lt>>>0<Co>>>0?1:0),Lt=Lt+jE,hs=hs+bD+(Lt>>>0<jE>>>0?1:0),Lt=Lt+wt,hs=hs+wi+(Lt>>>0<wt>>>0?1:0),wt=Ea+SD,xo=ds+xo+(wt>>>0<Ea>>>0?1:0),bn=Ye,ir=Ke,Ye=Ie,Ke=ze,Ie=Pe,ze=Me,Me=Oe+Lt|0,Pe=Ue+hs+(Me>>>0<Oe>>>0?1:0)|0,Ue=re,Oe=Se,re=ne,Se=me,ne=G,me=Q,Q=Lt+wt|0,G=hs+xo+(Q>>>0<Lt>>>0?1:0)|0}ae=N.low=ae+Q,N.high=ue+G+(ae>>>0<Q>>>0?1:0),H=w.low=H+me,w.high=le+ne+(H>>>0<me>>>0?1:0),J=I.low=J+Se,I.high=W+re+(J>>>0<Se>>>0?1:0),Z=R.low=Z+Oe,R.high=$+Ue+(Z>>>0<Oe>>>0?1:0),de=F.low=de+Me,F.high=oe+Pe+(de>>>0<Me>>>0?1:0),h=L.low=h+ze,L.high=Te+Ie+(h>>>0<ze>>>0?1:0),b=V.low=b+Ke,V.high=T+Ye+(b>>>0<Ke>>>0?1:0),q=te.low=q+ir,te.high=A+bn+(q>>>0<ir>>>0?1:0)},_doFinalize:function(){var _=this._data,B=_.words,N=8*this._nDataBytes,w=8*_.sigBytes;return B[w>>>5]|=128<<24-w%32,B[(w+128>>>10<<5)+30]=Math.floor(N/4294967296),B[(w+128>>>10<<5)+31]=N,_.sigBytes=4*B.length,this._process(),this._hash.toX32()},clone:function(){var _=c.clone.call(this);return _._hash=this._hash.clone(),_},blockSize:32}),l.SHA512=c._createHelper(v),l.HmacSHA512=c._createHmacHelper(v)}(),function(){var a=i,y=a.x64,l=y.Word,c=y.WordArray,y=a.algo,p=y.SHA512,y=y.SHA384=p.extend({_doReset:function(){this._hash=new c.init([new l.init(3418070365,3238371032),new l.init(1654270250,914150663),new l.init(2438529370,812702999),new l.init(355462360,4144912697),new l.init(1731405415,4290775857),new l.init(2394180231,1750603025),new l.init(3675008525,1694076839),new l.init(1203062813,3204075428)])},_doFinalize:function(){var v=p._doFinalize.call(this);return v.sigBytes-=16,v}});a.SHA384=p._createHelper(y),a.HmacSHA384=p._createHmacHelper(y)}(),function(){var a=i,_=a.lib,l=_.WordArray,c=_.Hasher,_=a.algo,p=l.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),y=l.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),v=l.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),x=l.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),C=l.create([0,1518500249,1859775393,2400959708,2840853838]),O=l.create([1352829926,1548603684,1836072691,2053994217,0]),_=_.RIPEMD160=c.extend({_doReset:function(){this._hash=l.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(B,N){for(var w=0;16>w;w++){var I=N+w,R=B[I];B[I]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360}var I=this._hash.words,R=C.words,F=O.words,L=p.words,V=y.words,te=v.words,ue=x.words,ae,le,H,W,J,$,Z,oe,de,Te;$=ae=I[0],Z=le=I[1],oe=H=I[2],de=W=I[3],Te=J=I[4];for(var h,w=0;80>w;w+=1)h=ae+B[N+L[w]]|0,h=16>w?h+((le^H^W)+R[0]):32>w?h+((le&H|~le&W)+R[1]):48>w?h+(((le|~H)^W)+R[2]):64>w?h+((le&W|H&~W)+R[3]):h+((le^(H|~W))+R[4]),h|=0,h=h<<te[w]|h>>>32-te[w],h=h+J|0,ae=J,J=W,W=H<<10|H>>>22,H=le,le=h,h=$+B[N+V[w]]|0,h=16>w?h+((Z^(oe|~de))+F[0]):32>w?h+((Z&de|oe&~de)+F[1]):48>w?h+(((Z|~oe)^de)+F[2]):64>w?h+((Z&oe|~Z&de)+F[3]):h+((Z^oe^de)+F[4]),h|=0,h=h<<ue[w]|h>>>32-ue[w],h=h+Te|0,$=Te,Te=de,de=oe<<10|oe>>>22,oe=Z,Z=h;h=I[1]+H+de|0,I[1]=I[2]+W+Te|0,I[2]=I[3]+J+$|0,I[3]=I[4]+ae+Z|0,I[4]=I[0]+le+oe|0,I[0]=h},_doFinalize:function(){var B=this._data,N=B.words,w=8*this._nDataBytes,I=8*B.sigBytes;for(N[I>>>5]|=128<<24-I%32,N[(I+64>>>9<<4)+14]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,B.sigBytes=4*(N.length+1),this._process(),B=this._hash,N=B.words,w=0;5>w;w++)I=N[w],N[w]=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360;return B},clone:function(){var B=c.clone.call(this);return B._hash=this._hash.clone(),B}});a.RIPEMD160=c._createHelper(_),a.HmacRIPEMD160=c._createHmacHelper(_)}(),function(){var a=i,l=a.enc.Utf8;a.algo.HMAC=a.lib.Base.extend({init:function(c,p){c=this._hasher=new c.init,typeof p=="string"&&(p=l.parse(p));var y=c.blockSize,v=4*y;p.sigBytes>v&&(p=c.finalize(p)),p.clamp();for(var x=this._oKey=p.clone(),C=this._iKey=p.clone(),O=x.words,_=C.words,B=0;B<y;B++)O[B]^=1549556828,_[B]^=909522486;x.sigBytes=C.sigBytes=v,this.reset()},reset:function(){var c=this._hasher;c.reset(),c.update(this._iKey)},update:function(c){return this._hasher.update(c),this},finalize:function(c){var p=this._hasher;return c=p.finalize(c),p.reset(),p.finalize(this._oKey.clone().concat(c))}})}(),function(){var a=i,p=a.lib,l=p.Base,c=p.WordArray,p=a.algo,y=p.HMAC,v=p.PBKDF2=l.extend({cfg:l.extend({keySize:4,hasher:p.SHA1,iterations:1}),init:function(x){this.cfg=this.cfg.extend(x)},compute:function(x,C){for(var R=this.cfg,O=y.create(R.hasher,x),_=c.create(),B=c.create([1]),N=_.words,w=B.words,I=R.keySize,R=R.iterations;N.length<I;){var F=O.update(C).finalize(B);O.reset();for(var L=F.words,V=L.length,te=F,ue=1;ue<R;ue++){te=O.finalize(te),O.reset();for(var ae=te.words,le=0;le<V;le++)L[le]^=ae[le]}_.concat(F),w[0]++}return _.sigBytes=4*I,_}});a.PBKDF2=function(x,C,O){return v.create(O).compute(x,C)}}();/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="=";function u(a){var l,c,p="";for(l=0;l+3<=a.length;l+=3)c=parseInt(a.substring(l,l+3),16),p+=s.charAt(c>>6)+s.charAt(c&63);for(l+1==a.length?(c=parseInt(a.substring(l,l+1),16),p+=s.charAt(c<<2)):l+2==a.length&&(c=parseInt(a.substring(l,l+2),16),p+=s.charAt(c>>2)+s.charAt((c&3)<<4));(p.length&3)>0;)p+=o;return p}function d(a){var l="",c,p=0,y,v;for(c=0;c<a.length&&a.charAt(c)!=o;++c)v=s.indexOf(a.charAt(c)),!(v<0)&&(p==0?(l+=ie(v>>2),y=v&3,p=1):p==1?(l+=ie(y<<2|v>>4),y=v&15,p=2):p==2?(l+=ie(y),l+=ie(v>>2),y=v&3,p=3):(l+=ie(y<<2|v>>4),l+=ie(v&15),p=0));return p==1&&(l+=ie(y<<2)),l}function f(a){var l=d(a),c,p=new Array;for(c=0;2*c<l.length;++c)p[c]=parseInt(l.substring(2*c,2*c+2),16);return p}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
*/var m;function g(a,l,c){a!=null&&(typeof a=="number"?this.fromNumber(a,l,c):l==null&&typeof a!="string"?this.fromString(a,256):this.fromString(a,l))}function P(){return new g(null)}function D(a,l,c,p,y,v){for(;--v>=0;){var x=l*this[a++]+c[p]+y;y=Math.floor(x/67108864),c[p++]=x&67108863}return y}function M(a,l,c,p,y,v){for(var x=l&32767,C=l>>15;--v>=0;){var O=this[a]&32767,_=this[a++]>>15,B=C*O+_*x;O=x*O+((B&32767)<<15)+c[p]+(y&1073741823),y=(O>>>30)+(B>>>15)+C*_+(y>>>30),c[p++]=O&1073741823}return y}function U(a,l,c,p,y,v){for(var x=l&16383,C=l>>14;--v>=0;){var O=this[a]&16383,_=this[a++]>>14,B=C*O+_*x;O=x*O+((B&16383)<<14)+c[p]+y,y=(O>>28)+(B>>14)+C*_,c[p++]=O&268435455}return y}n.appName=="Microsoft Internet Explorer"?(g.prototype.am=M,m=30):n.appName!="Netscape"?(g.prototype.am=D,m=26):(g.prototype.am=U,m=28),g.prototype.DB=m,g.prototype.DM=(1<<m)-1,g.prototype.DV=1<<m;var j=52;g.prototype.FV=Math.pow(2,j),g.prototype.F1=j-m,g.prototype.F2=2*m-j;var E="0123456789abcdefghijklmnopqrstuvwxyz",k=new Array,z,K;for(z="0".charCodeAt(0),K=0;K<=9;++K)k[z++]=K;for(z="a".charCodeAt(0),K=10;K<36;++K)k[z++]=K;for(z="A".charCodeAt(0),K=10;K<36;++K)k[z++]=K;function ie(a){return E.charAt(a)}function he(a,l){var c=k[a.charCodeAt(l)];return c??-1}function pe(a){for(var l=this.t-1;l>=0;--l)a[l]=this[l];a.t=this.t,a.s=this.s}function X(a){this.t=1,this.s=a<0?-1:0,a>0?this[0]=a:a<-1?this[0]=a+this.DV:this.t=0}function fe(a){var l=P();return l.fromInt(a),l}function ge(a,l){var c;if(l==16)c=4;else if(l==8)c=3;else if(l==256)c=8;else if(l==2)c=1;else if(l==32)c=5;else if(l==4)c=2;else{this.fromRadix(a,l);return}this.t=0,this.s=0;for(var p=a.length,y=!1,v=0;--p>=0;){var x=c==8?a[p]&255:he(a,p);if(x<0){a.charAt(p)=="-"&&(y=!0);continue}y=!1,v==0?this[this.t++]=x:v+c>this.DB?(this[this.t-1]|=(x&(1<<this.DB-v)-1)<<v,this[this.t++]=x>>this.DB-v):this[this.t-1]|=x<<v,v+=c,v>=this.DB&&(v-=this.DB)}c==8&&a[0]&128&&(this.s=-1,v>0&&(this[this.t-1]|=(1<<this.DB-v)-1<<v)),this.clamp(),y&&g.ZERO.subTo(this,this)}function we(){for(var a=this.s&this.DM;this.t>0&&this[this.t-1]==a;)--this.t}function be(a){if(this.s<0)return"-"+this.negate().toString(a);var l;if(a==16)l=4;else if(a==8)l=3;else if(a==2)l=1;else if(a==32)l=5;else if(a==4)l=2;else return this.toRadix(a);var c=(1<<l)-1,p,y=!1,v="",x=this.t,C=this.DB-x*this.DB%l;if(x-- >0)for(C<this.DB&&(p=this[x]>>C)>0&&(y=!0,v=ie(p));x>=0;)C<l?(p=(this[x]&(1<<C)-1)<<l-C,p|=this[--x]>>(C+=this.DB-l)):(p=this[x]>>(C-=l)&c,C<=0&&(C+=this.DB,--x)),p>0&&(y=!0),y&&(v+=ie(p));return y?v:"0"}function He(){var a=P();return g.ZERO.subTo(this,a),a}function ce(){return this.s<0?this.negate():this}function ve(a){var l=this.s-a.s;if(l!=0)return l;var c=this.t;if(l=c-a.t,l!=0)return this.s<0?-l:l;for(;--c>=0;)if((l=this[c]-a[c])!=0)return l;return 0}function De(a){var l=1,c;return(c=a>>>16)!=0&&(a=c,l+=16),(c=a>>8)!=0&&(a=c,l+=8),(c=a>>4)!=0&&(a=c,l+=4),(c=a>>2)!=0&&(a=c,l+=2),(c=a>>1)!=0&&(a=c,l+=1),l}function Xe(){return this.t<=0?0:this.DB*(this.t-1)+De(this[this.t-1]^this.s&this.DM)}function Re(a,l){var c;for(c=this.t-1;c>=0;--c)l[c+a]=this[c];for(c=a-1;c>=0;--c)l[c]=0;l.t=this.t+a,l.s=this.s}function je(a,l){for(var c=a;c<this.t;++c)l[c-a]=this[c];l.t=Math.max(this.t-a,0),l.s=this.s}function Ae(a,l){var c=a%this.DB,p=this.DB-c,y=(1<<p)-1,v=Math.floor(a/this.DB),x=this.s<<c&this.DM,C;for(C=this.t-1;C>=0;--C)l[C+v+1]=this[C]>>p|x,x=(this[C]&y)<<c;for(C=v-1;C>=0;--C)l[C]=0;l[v]=x,l.t=this.t+v+1,l.s=this.s,l.clamp()}function Ce(a,l){l.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t){l.t=0;return}var p=a%this.DB,y=this.DB-p,v=(1<<p)-1;l[0]=this[c]>>p;for(var x=c+1;x<this.t;++x)l[x-c-1]|=(this[x]&v)<<y,l[x-c]=this[x]>>p;p>0&&(l[this.t-c-1]|=(this.s&v)<<y),l.t=this.t-c,l.clamp()}function Ve(a,l){for(var c=0,p=0,y=Math.min(a.t,this.t);c<y;)p+=this[c]-a[c],l[c++]=p&this.DM,p>>=this.DB;if(a.t<this.t){for(p-=a.s;c<this.t;)p+=this[c],l[c++]=p&this.DM,p>>=this.DB;p+=this.s}else{for(p+=this.s;c<a.t;)p-=a[c],l[c++]=p&this.DM,p>>=this.DB;p-=a.s}l.s=p<0?-1:0,p<-1?l[c++]=this.DV+p:p>0&&(l[c++]=p),l.t=c,l.clamp()}function qe(a,l){var c=this.abs(),p=a.abs(),y=c.t;for(l.t=y+p.t;--y>=0;)l[y]=0;for(y=0;y<p.t;++y)l[y+c.t]=c.am(0,p[y],l,y,0,c.t);l.s=0,l.clamp(),this.s!=a.s&&g.ZERO.subTo(l,l)}function lt(a){for(var l=this.abs(),c=a.t=2*l.t;--c>=0;)a[c]=0;for(c=0;c<l.t-1;++c){var p=l.am(c,l[c],a,2*c,0,1);(a[c+l.t]+=l.am(c+1,2*l[c],a,2*c+1,p,l.t-c-1))>=l.DV&&(a[c+l.t]-=l.DV,a[c+l.t+1]=1)}a.t>0&&(a[a.t-1]+=l.am(c,l[c],a,2*c,0,1)),a.s=0,a.clamp()}function ee(a,l,c){var p=a.abs();if(!(p.t<=0)){var y=this.abs();if(y.t<p.t){l!=null&&l.fromInt(0),c!=null&&this.copyTo(c);return}c==null&&(c=P());var v=P(),x=this.s,C=a.s,O=this.DB-De(p[p.t-1]);O>0?(p.lShiftTo(O,v),y.lShiftTo(O,c)):(p.copyTo(v),y.copyTo(c));var _=v.t,B=v[_-1];if(B!=0){var N=B*(1<<this.F1)+(_>1?v[_-2]>>this.F2:0),w=this.FV/N,I=(1<<this.F1)/N,R=1<<this.F2,F=c.t,L=F-_,V=l??P();for(v.dlShiftTo(L,V),c.compareTo(V)>=0&&(c[c.t++]=1,c.subTo(V,c)),g.ONE.dlShiftTo(_,V),V.subTo(v,v);v.t<_;)v[v.t++]=0;for(;--L>=0;){var te=c[--F]==B?this.DM:Math.floor(c[F]*w+(c[F-1]+R)*I);if((c[F]+=v.am(0,te,c,L,0,_))<te)for(v.dlShiftTo(L,V),c.subTo(V,c);c[F]<--te;)c.subTo(V,c)}l!=null&&(c.drShiftTo(_,l),x!=C&&g.ZERO.subTo(l,l)),c.t=_,c.clamp(),O>0&&c.rShiftTo(O,c),x<0&&g.ZERO.subTo(c,c)}}}function bt(a){var l=P();return this.abs().divRemTo(a,null,l),this.s<0&&l.compareTo(g.ZERO)>0&&a.subTo(l,l),l}function Et(a){this.m=a}function en(a){return a.s<0||a.compareTo(this.m)>=0?a.mod(this.m):a}function er(a){return a}function mn(a){a.divRemTo(this.m,null,a)}function Ee(a,l,c){a.multiplyTo(l,c),this.reduce(c)}function Nn(a,l){a.squareTo(l),this.reduce(l)}Et.prototype.convert=en,Et.prototype.revert=er,Et.prototype.reduce=mn,Et.prototype.mulTo=Ee,Et.prototype.sqrTo=Nn;function tr(){if(this.t<1)return 0;var a=this[0];if(!(a&1))return 0;var l=a&3;return l=l*(2-(a&15)*l)&15,l=l*(2-(a&255)*l)&255,l=l*(2-((a&65535)*l&65535))&65535,l=l*(2-a*l%this.DV)%this.DV,l>0?this.DV-l:-l}function gn(a){this.m=a,this.mp=a.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function Mi(a){var l=P();return a.abs().dlShiftTo(this.m.t,l),l.divRemTo(this.m,null,l),a.s<0&&l.compareTo(g.ZERO)>0&&this.m.subTo(l,l),l}function Br(a){var l=P();return a.copyTo(l),this.reduce(l),l}function Lu(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var l=0;l<this.m.t;++l){var c=a[l]&32767,p=c*this.mpl+((c*this.mph+(a[l]>>15)*this.mpl&this.um)<<15)&a.DM;for(c=l+this.m.t,a[c]+=this.m.am(0,p,a,l,0,this.m.t);a[c]>=a.DV;)a[c]-=a.DV,a[++c]++}a.clamp(),a.drShiftTo(this.m.t,a),a.compareTo(this.m)>=0&&a.subTo(this.m,a)}function mf(a,l){a.squareTo(l),this.reduce(l)}function gf(a,l,c){a.multiplyTo(l,c),this.reduce(c)}gn.prototype.convert=Mi,gn.prototype.revert=Br,gn.prototype.reduce=Lu,gn.prototype.mulTo=gf,gn.prototype.sqrTo=mf;function zv(){return(this.t>0?this[0]&1:this.s)==0}function vf(a,l){if(a>4294967295||a<1)return g.ONE;var c=P(),p=P(),y=l.convert(this),v=De(a)-1;for(y.copyTo(c);--v>=0;)if(l.sqrTo(c,p),(a&1<<v)>0)l.mulTo(p,y,c);else{var x=c;c=p,p=x}return l.revert(c)}function $v(a,l){var c;return a<256||l.isEven()?c=new Et(l):c=new gn(l),this.exp(a,c)}g.prototype.copyTo=pe,g.prototype.fromInt=X,g.prototype.fromString=ge,g.prototype.clamp=we,g.prototype.dlShiftTo=Re,g.prototype.drShiftTo=je,g.prototype.lShiftTo=Ae,g.prototype.rShiftTo=Ce,g.prototype.subTo=Ve,g.prototype.multiplyTo=qe,g.prototype.squareTo=lt,g.prototype.divRemTo=ee,g.prototype.invDigit=tr,g.prototype.isEven=zv,g.prototype.exp=vf,g.prototype.toString=be,g.prototype.negate=He,g.prototype.abs=ce,g.prototype.compareTo=ve,g.prototype.bitLength=Xe,g.prototype.mod=bt,g.prototype.modPowInt=$v,g.ZERO=fe(0),g.ONE=fe(1);/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Hv(){var a=P();return this.copyTo(a),a}function Vv(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function yf(){return this.t==0?this.s:this[0]<<24>>24}function Sf(){return this.t==0?this.s:this[0]<<16>>16}function Bi(a){return Math.floor(Math.LN2*this.DB/Math.log(a))}function bf(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function Ic(a){if(a==null&&(a=10),this.signum()==0||a<2||a>36)return"0";var l=this.chunkSize(a),c=Math.pow(a,l),p=fe(c),y=P(),v=P(),x="";for(this.divRemTo(p,y,v);y.signum()>0;)x=(c+v.intValue()).toString(a).substr(1)+x,y.divRemTo(p,y,v);return v.intValue().toString(a)+x}function wf(a,l){this.fromInt(0),l==null&&(l=10);for(var c=this.chunkSize(l),p=Math.pow(l,c),y=!1,v=0,x=0,C=0;C<a.length;++C){var O=he(a,C);if(O<0){a.charAt(C)=="-"&&this.signum()==0&&(y=!0);continue}x=l*x+O,++v>=c&&(this.dMultiply(p),this.dAddOffset(x,0),v=0,x=0)}v>0&&(this.dMultiply(Math.pow(l,v)),this.dAddOffset(x,0)),y&&g.ZERO.subTo(this,this)}function Wv(a,l,c){if(typeof l=="number")if(a<2)this.fromInt(1);else for(this.fromNumber(a,c),this.testBit(a-1)||this.bitwiseTo(g.ONE.shiftLeft(a-1),pa,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(l);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(g.ONE.shiftLeft(a-1),this);else{var p=new Array,y=a&7;p.length=(a>>3)+1,l.nextBytes(p),y>0?p[0]&=(1<<y)-1:p[0]=0,this.fromString(p,256)}}function Gv(){var a=this.t,l=new Array;l[0]=this.s;var c=this.DB-a*this.DB%8,p,y=0;if(a-- >0)for(c<this.DB&&(p=this[a]>>c)!=(this.s&this.DM)>>c&&(l[y++]=p|this.s<<this.DB-c);a>=0;)c<8?(p=(this[a]&(1<<c)-1)<<8-c,p|=this[--a]>>(c+=this.DB-8)):(p=this[a]>>(c-=8)&255,c<=0&&(c+=this.DB,--a)),p&128&&(p|=-256),y==0&&(this.s&128)!=(p&128)&&++y,(y>0||p!=this.s)&&(l[y++]=p);return l}function Y(a){return this.compareTo(a)==0}function Kv(a){return this.compareTo(a)<0?this:a}function Cf(a){return this.compareTo(a)>0?this:a}function Jv(a,l,c){var p,y,v=Math.min(a.t,this.t);for(p=0;p<v;++p)c[p]=l(this[p],a[p]);if(a.t<this.t){for(y=a.s&this.DM,p=v;p<this.t;++p)c[p]=l(this[p],y);c.t=this.t}else{for(y=this.s&this.DM,p=v;p<a.t;++p)c[p]=l(y,a[p]);c.t=a.t}c.s=l(this.s,a.s),c.clamp()}function Qv(a,l){return a&l}function xf(a){var l=P();return this.bitwiseTo(a,Qv,l),l}function pa(a,l){return a|l}function Xv(a){var l=P();return this.bitwiseTo(a,pa,l),l}function Mu(a,l){return a^l}function Ac(a){var l=P();return this.bitwiseTo(a,Mu,l),l}function ma(a,l){return a&~l}function os(a){var l=P();return this.bitwiseTo(a,ma,l),l}function Bu(){for(var a=P(),l=0;l<this.t;++l)a[l]=this.DM&~this[l];return a.t=this.t,a.s=~this.s,a}function ji(a){var l=P();return a<0?this.rShiftTo(-a,l):this.lShiftTo(a,l),l}function nr(a){var l=P();return a<0?this.lShiftTo(-a,l):this.rShiftTo(a,l),l}function Ft(a){if(a==0)return-1;var l=0;return a&65535||(a>>=16,l+=16),a&255||(a>>=8,l+=8),a&15||(a>>=4,l+=4),a&3||(a>>=2,l+=2),a&1||++l,l}function ju(){for(var a=0;a<this.t;++a)if(this[a]!=0)return a*this.DB+Ft(this[a]);return this.s<0?this.t*this.DB:-1}function Ef(a){for(var l=0;a!=0;)a&=a-1,++l;return l}function Yv(){for(var a=0,l=this.s&this.DM,c=0;c<this.t;++c)a+=Ef(this[c]^l);return a}function Zv(a){var l=Math.floor(a/this.DB);return l>=this.t?this.s!=0:(this[l]&1<<a%this.DB)!=0}function qi(a,l){var c=g.ONE.shiftLeft(a);return this.bitwiseTo(c,l,c),c}function se(a){return this.changeBit(a,pa)}function Qr(a){return this.changeBit(a,ma)}function e0(a){return this.changeBit(a,Mu)}function qu(a,l){for(var c=0,p=0,y=Math.min(a.t,this.t);c<y;)p+=this[c]+a[c],l[c++]=p&this.DM,p>>=this.DB;if(a.t<this.t){for(p+=a.s;c<this.t;)p+=this[c],l[c++]=p&this.DM,p>>=this.DB;p+=this.s}else{for(p+=this.s;c<a.t;)p+=a[c],l[c++]=p&this.DM,p>>=this.DB;p+=a.s}l.s=p<0?-1:0,p>0?l[c++]=p:p<-1&&(l[c++]=this.DV+p),l.t=c,l.clamp()}function t0(a){var l=P();return this.addTo(a,l),l}function Ui(a){var l=P();return this.subTo(a,l),l}function n0(a){var l=P();return this.multiplyTo(a,l),l}function Tf(){var a=P();return this.squareTo(a),a}function r0(a){var l=P();return this.divRemTo(a,l,null),l}function vn(a){var l=P();return this.divRemTo(a,null,l),l}function i0(a){var l=P(),c=P();return this.divRemTo(a,l,c),new Array(l,c)}function Pf(a){this[this.t]=this.am(0,a-1,this,0,0,this.t),++this.t,this.clamp()}function Rf(a,l){if(a!=0){for(;this.t<=l;)this[this.t++]=0;for(this[l]+=a;this[l]>=this.DV;)this[l]-=this.DV,++l>=this.t&&(this[this.t++]=0),++this[l]}}function Ze(){}function yn(a){return a}function s0(a,l,c){a.multiplyTo(l,c)}function jr(a,l){a.squareTo(l)}Ze.prototype.convert=yn,Ze.prototype.revert=yn,Ze.prototype.mulTo=s0,Ze.prototype.sqrTo=jr;function o0(a){return this.exp(a,new Ze)}function a0(a,l,c){var p=Math.min(this.t+a.t,l);for(c.s=0,c.t=p;p>0;)c[--p]=0;var y;for(y=c.t-this.t;p<y;++p)c[p+this.t]=this.am(0,a[p],c,p,0,this.t);for(y=Math.min(a.t,l);p<y;++p)this.am(0,a[p],c,p,0,l-p);c.clamp()}function u0(a,l,c){--l;var p=c.t=this.t+a.t-l;for(c.s=0;--p>=0;)c[p]=0;for(p=Math.max(l-this.t,0);p<a.t;++p)c[this.t+p-l]=this.am(l-p,a[p],c,0,0,this.t+p-l);c.clamp(),c.drShiftTo(1,c)}function yo(a){this.r2=P(),this.q3=P(),g.ONE.dlShiftTo(2*a.t,this.r2),this.mu=this.r2.divide(a),this.m=a}function l0(a){if(a.s<0||a.t>2*this.m.t)return a.mod(this.m);if(a.compareTo(this.m)<0)return a;var l=P();return a.copyTo(l),this.reduce(l),l}function c0(a){return a}function _f(a){for(a.drShiftTo(this.m.t-1,this.r2),a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);a.compareTo(this.r2)<0;)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);a.compareTo(this.m)>=0;)a.subTo(this.m,a)}function kc(a,l){a.squareTo(l),this.reduce(l)}function ke(a,l,c){a.multiplyTo(l,c),this.reduce(c)}yo.prototype.convert=l0,yo.prototype.revert=c0,yo.prototype.reduce=_f,yo.prototype.mulTo=ke,yo.prototype.sqrTo=kc;function Sn(a,l){var c=a.bitLength(),p,y=fe(1),v;if(c<=0)return y;c<18?p=1:c<48?p=3:c<144?p=4:c<768?p=5:p=6,c<8?v=new Et(l):l.isEven()?v=new yo(l):v=new gn(l);var x=new Array,C=3,O=p-1,_=(1<<p)-1;if(x[1]=v.convert(this),p>1){var B=P();for(v.sqrTo(x[1],B);C<=_;)x[C]=P(),v.mulTo(B,x[C-2],x[C]),C+=2}var N=a.t-1,w,I=!0,R=P(),F;for(c=De(a[N])-1;N>=0;){for(c>=O?w=a[N]>>c-O&_:(w=(a[N]&(1<<c+1)-1)<<O-c,N>0&&(w|=a[N-1]>>this.DB+c-O)),C=p;!(w&1);)w>>=1,--C;if((c-=C)<0&&(c+=this.DB,--N),I)x[w].copyTo(y),I=!1;else{for(;C>1;)v.sqrTo(y,R),v.sqrTo(R,y),C-=2;C>0?v.sqrTo(y,R):(F=y,y=R,R=F),v.mulTo(R,x[w],y)}for(;N>=0&&!(a[N]&1<<c);)v.sqrTo(y,R),F=y,y=R,R=F,--c<0&&(c=this.DB-1,--N)}return v.revert(y)}function d0(a){var l=this.s<0?this.negate():this.clone(),c=a.s<0?a.negate():a.clone();if(l.compareTo(c)<0){var p=l;l=c,c=p}var y=l.getLowestSetBit(),v=c.getLowestSetBit();if(v<0)return l;for(y<v&&(v=y),v>0&&(l.rShiftTo(v,l),c.rShiftTo(v,c));l.signum()>0;)(y=l.getLowestSetBit())>0&&l.rShiftTo(y,l),(y=c.getLowestSetBit())>0&&c.rShiftTo(y,c),l.compareTo(c)>=0?(l.subTo(c,l),l.rShiftTo(1,l)):(c.subTo(l,c),c.rShiftTo(1,c));return v>0&&c.lShiftTo(v,c),c}function h0(a){if(a<=0)return 0;var l=this.DV%a,c=this.s<0?a-1:0;if(this.t>0)if(l==0)c=this[0]%a;else for(var p=this.t-1;p>=0;--p)c=(l*c+this[p])%a;return c}function as(a){var l=a.isEven();if(this.isEven()&&l||a.signum()==0)return g.ZERO;for(var c=a.clone(),p=this.clone(),y=fe(1),v=fe(0),x=fe(0),C=fe(1);c.signum()!=0;){for(;c.isEven();)c.rShiftTo(1,c),l?((!y.isEven()||!v.isEven())&&(y.addTo(this,y),v.subTo(a,v)),y.rShiftTo(1,y)):v.isEven()||v.subTo(a,v),v.rShiftTo(1,v);for(;p.isEven();)p.rShiftTo(1,p),l?((!x.isEven()||!C.isEven())&&(x.addTo(this,x),C.subTo(a,C)),x.rShiftTo(1,x)):C.isEven()||C.subTo(a,C),C.rShiftTo(1,C);c.compareTo(p)>=0?(c.subTo(p,c),l&&y.subTo(x,y),v.subTo(C,v)):(p.subTo(c,p),l&&x.subTo(y,x),C.subTo(v,C))}if(p.compareTo(g.ONE)!=0)return g.ZERO;if(C.compareTo(a)>=0)return C.subtract(a);if(C.signum()<0)C.addTo(a,C);else return C;return C.signum()<0?C.add(a):C}var yt=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Oc=(1<<26)/yt[yt.length-1];function ft(a){var l,c=this.abs();if(c.t==1&&c[0]<=yt[yt.length-1]){for(l=0;l<yt.length;++l)if(c[0]==yt[l])return!0;return!1}if(c.isEven())return!1;for(l=1;l<yt.length;){for(var p=yt[l],y=l+1;y<yt.length&&p<Oc;)p*=yt[y++];for(p=c.modInt(p);l<y;)if(p%yt[l++]==0)return!1}return c.millerRabin(a)}function us(a){var l=this.subtract(g.ONE),c=l.getLowestSetBit();if(c<=0)return!1;var p=l.shiftRight(c);a=a+1>>1,a>yt.length&&(a=yt.length);for(var y=P(),v=0;v<a;++v){y.fromInt(yt[Math.floor(Math.random()*yt.length)]);var x=y.modPow(p,this);if(x.compareTo(g.ONE)!=0&&x.compareTo(l)!=0){for(var C=1;C++<c&&x.compareTo(l)!=0;)if(x=x.modPowInt(2,this),x.compareTo(g.ONE)==0)return!1;if(x.compareTo(l)!=0)return!1}}return!0}g.prototype.chunkSize=Bi,g.prototype.toRadix=Ic,g.prototype.fromRadix=wf,g.prototype.fromNumber=Wv,g.prototype.bitwiseTo=Jv,g.prototype.changeBit=qi,g.prototype.addTo=qu,g.prototype.dMultiply=Pf,g.prototype.dAddOffset=Rf,g.prototype.multiplyLowerTo=a0,g.prototype.multiplyUpperTo=u0,g.prototype.modInt=h0,g.prototype.millerRabin=us,g.prototype.clone=Hv,g.prototype.intValue=Vv,g.prototype.byteValue=yf,g.prototype.shortValue=Sf,g.prototype.signum=bf,g.prototype.toByteArray=Gv,g.prototype.equals=Y,g.prototype.min=Kv,g.prototype.max=Cf,g.prototype.and=xf,g.prototype.or=Xv,g.prototype.xor=Ac,g.prototype.andNot=os,g.prototype.not=Bu,g.prototype.shiftLeft=ji,g.prototype.shiftRight=nr,g.prototype.getLowestSetBit=ju,g.prototype.bitCount=Yv,g.prototype.testBit=Zv,g.prototype.setBit=se,g.prototype.clearBit=Qr,g.prototype.flipBit=e0,g.prototype.add=t0,g.prototype.subtract=Ui,g.prototype.multiply=n0,g.prototype.divide=r0,g.prototype.remainder=vn,g.prototype.divideAndRemainder=i0,g.prototype.modPow=Sn,g.prototype.modInverse=as,g.prototype.pow=o0,g.prototype.gcd=d0,g.prototype.isProbablePrime=ft,g.prototype.square=Tf;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Fc(){this.i=0,this.j=0,this.S=new Array}function _e(a){var l,c,p;for(l=0;l<256;++l)this.S[l]=l;for(c=0,l=0;l<256;++l)c=c+this.S[l]+a[l%a.length]&255,p=this.S[l],this.S[l]=this.S[c],this.S[c]=p;this.i=0,this.j=0}function f0(){var a;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,a=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=a,this.S[a+this.S[this.i]&255]}Fc.prototype.init=_e,Fc.prototype.next=f0;function If(){return new Fc}var Nc=256;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var Uu,Pr,ln;function Af(a){Pr[ln++]^=a&255,Pr[ln++]^=a>>8&255,Pr[ln++]^=a>>16&255,Pr[ln++]^=a>>24&255,ln>=Nc&&(ln-=Nc)}function Dc(){Af(new Date().getTime())}if(Pr==null){Pr=new Array,ln=0;var Xr;if(e!==void 0&&(e.crypto!==void 0||e.msCrypto!==void 0)){var ga=e.crypto||e.msCrypto;if(ga.getRandomValues){var va=new Uint8Array(32);for(ga.getRandomValues(va),Xr=0;Xr<32;++Xr)Pr[ln++]=va[Xr]}else if(n.appName=="Netscape"&&n.appVersion<"5"){var ya=e.crypto.random(32);for(Xr=0;Xr<ya.length;++Xr)Pr[ln++]=ya.charCodeAt(Xr)&255}}for(;ln<Nc;)Xr=Math.floor(65536*Math.random()),Pr[ln++]=Xr>>>8,Pr[ln++]=Xr&255;ln=0,Dc()}function Lc(){if(Uu==null){for(Dc(),Uu=If(),Uu.init(Pr),ln=0;ln<Pr.length;++ln)Pr[ln]=0;ln=0}return Uu.next()}function Mc(a){var l;for(l=0;l<a.length;++l)a[l]=Lc()}function bi(){}bi.prototype.nextBytes=Mc;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function cn(a,l){return new g(a,l)}function p0(a,l){if(l<a.length+11)throw"Message too long for RSA";for(var c=new Array,p=a.length-1;p>=0&&l>0;){var y=a.charCodeAt(p--);y<128?c[--l]=y:y>127&&y<2048?(c[--l]=y&63|128,c[--l]=y>>6|192):(c[--l]=y&63|128,c[--l]=y>>6&63|128,c[--l]=y>>12|224)}c[--l]=0;for(var v=new bi,x=new Array;l>2;){for(x[0]=0;x[0]==0;)v.nextBytes(x);c[--l]=x[0]}return c[--l]=2,c[--l]=0,new g(c)}function Bc(a,l,c){for(var p="",y=0;p.length<l;)p+=c(String.fromCharCode.apply(String,a.concat([(y&4278190080)>>24,(y&16711680)>>16,(y&65280)>>8,y&255]))),y+=1;return p}function kf(a,l,c,p){var y=S.crypto.MessageDigest,v=S.crypto.Util,x=null;if(c||(c="sha1"),typeof c=="string"&&(x=y.getCanonicalAlgName(c),p=y.getHashLength(x),c=function(F){return Kt(v.hashHex(Pn(F),x))}),a.length+2*p+2>l)throw"Message too long for RSA";var C="",O;for(O=0;O<l-a.length-2*p-2;O+=1)C+="\0";var _=c("")+C+""+a,B=new Array(p);new bi().nextBytes(B);var N=Bc(B,_.length,c),w=[];for(O=0;O<_.length;O+=1)w[O]=_.charCodeAt(O)^N.charCodeAt(O);var I=Bc(w,B.length,c),R=[0];for(O=0;O<B.length;O+=1)R[O+1]=B[O]^I.charCodeAt(O);return new g(R.concat(w))}function Je(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function zi(a,l){if(this.isPublic=!0,this.isPrivate=!1,typeof a!="string")this.n=a,this.e=l;else if(a!=null&&l!=null&&a.length>0&&l.length>0)this.n=cn(a,16),this.e=parseInt(l,16);else throw"Invalid RSA public key"}function m0(a){return a.modPowInt(this.e,this.n)}function g0(a){var l=p0(a,this.n.bitLength()+7>>3);if(l==null)return null;var c=this.doPublic(l);if(c==null)return null;var p=c.toString(16);return p.length&1?"0"+p:p}function v0(a,l,c){var p=this.n.bitLength()+7>>3,y=kf(a,p,l,c);if(y==null)return null;var v=this.doPublic(y);if(v==null)return null;for(var x=v.toString(16);x.length<p*2;)x="0"+x;return x}Je.prototype.doPublic=m0,Je.prototype.setPublic=zi,Je.prototype.encrypt=g0,Je.prototype.encryptOAEP=v0,Je.prototype.type="RSA";/*! (c) Tom Wu, Kenji Urushima | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function y0(a,l){for(var c=a.toByteArray(),p=0;p<c.length&&c[p]==0;)++p;if(c.length-p!=l-1||c[p]!=2)return null;for(++p;c[p]!=0;)if(++p>=c.length)return null;for(var y="";++p<c.length;){var v=c[p]&255;v<128?y+=String.fromCharCode(v):v>191&&v<224?(y+=String.fromCharCode((v&31)<<6|c[p+1]&63),++p):(y+=String.fromCharCode((v&15)<<12|(c[p+1]&63)<<6|c[p+2]&63),p+=2)}return y}function Of(a,l,c){for(var p="",y=0;p.length<l;)p+=c(a+String.fromCharCode.apply(String,[(y&4278190080)>>24,(y&16711680)>>16,(y&65280)>>8,y&255])),y+=1;return p}function S0(a,l,c,p){var y=S.crypto.MessageDigest,v=S.crypto.Util,x=null;c||(c="sha1"),typeof c=="string"&&(x=y.getCanonicalAlgName(c),p=y.getHashLength(x),c=function(L){return Kt(v.hashHex(Pn(L),x))}),a=a.toByteArray();var N;for(N=0;N<a.length;N+=1)a[N]&=255;for(;a.length<l;)a.unshift(0);if(a=String.fromCharCode.apply(String,a),a.length<2*p+2)throw"Cipher too short";var C=a.substr(1,p),O=a.substr(p+1),_=Of(O,p,c),B=[],N;for(N=0;N<C.length;N+=1)B[N]=C.charCodeAt(N)^_.charCodeAt(N);var w=Of(String.fromCharCode.apply(String,B),a.length-p,c),I=[];for(N=0;N<O.length;N+=1)I[N]=O.charCodeAt(N)^w.charCodeAt(N);if(I=String.fromCharCode.apply(String,I),I.substr(0,p)!==c(""))throw"Hash mismatch";I=I.substr(p);var R=I.indexOf(""),F=R!=-1?I.substr(0,R).lastIndexOf("\0"):-1;if(F+1!=R)throw"Malformed data";return I.substr(R+1)}function b0(a,l,c){if(this.isPrivate=!0,typeof a!="string")this.n=a,this.e=l,this.d=c;else if(a!=null&&l!=null&&a.length>0&&l.length>0)this.n=cn(a,16),this.e=parseInt(l,16),this.d=cn(c,16);else throw"Invalid RSA private key"}function w0(a,l,c,p,y,v,x,C){if(this.isPrivate=!0,this.isPublic=!1,a==null)throw"RSASetPrivateEx N == null";if(l==null)throw"RSASetPrivateEx E == null";if(a.length==0)throw"RSASetPrivateEx N.length == 0";if(l.length==0)throw"RSASetPrivateEx E.length == 0";if(a!=null&&l!=null&&a.length>0&&l.length>0)this.n=cn(a,16),this.e=parseInt(l,16),this.d=cn(c,16),this.p=cn(p,16),this.q=cn(y,16),this.dmp1=cn(v,16),this.dmq1=cn(x,16),this.coeff=cn(C,16);else throw"Invalid RSA private key in RSASetPrivateEx"}function C0(a,l){var c=new bi,p=a>>1;this.e=parseInt(l,16);for(var y=new g(l,16),v=a/2-100,x=g.ONE.shiftLeft(v);;){for(;this.p=new g(a-p,1,c),!(this.p.subtract(g.ONE).gcd(y).compareTo(g.ONE)==0&&this.p.isProbablePrime(10)););for(;this.q=new g(p,1,c),!(this.q.subtract(g.ONE).gcd(y).compareTo(g.ONE)==0&&this.q.isProbablePrime(10)););if(this.p.compareTo(this.q)<=0){var C=this.p;this.p=this.q,this.q=C}var O=this.q.subtract(this.p).abs();if(!(O.bitLength()<v||O.compareTo(x)<=0)){var _=this.p.subtract(g.ONE),B=this.q.subtract(g.ONE),N=_.multiply(B);if(N.gcd(y).compareTo(g.ONE)==0&&(this.n=this.p.multiply(this.q),this.n.bitLength()==a)){this.d=y.modInverse(N),this.dmp1=this.d.mod(_),this.dmq1=this.d.mod(B),this.coeff=this.q.modInverse(this.p);break}}}this.isPrivate=!0}function jc(a){if(this.p==null||this.q==null)return a.modPow(this.d,this.n);for(var l=a.mod(this.p).modPow(this.dmp1,this.p),c=a.mod(this.q).modPow(this.dmq1,this.q);l.compareTo(c)<0;)l=l.add(this.p);return l.subtract(c).multiply(this.coeff).mod(this.p).multiply(this.q).add(c)}function qc(a){if(a.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var l=cn(a,16),c=this.doPrivate(l);return c==null?null:y0(c,this.n.bitLength()+7>>3)}function x0(a,l,c){if(a.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var p=cn(a,16),y=this.doPrivate(p);return y==null?null:S0(y,this.n.bitLength()+7>>3,l,c)}Je.prototype.doPrivate=jc,Je.prototype.setPrivate=b0,Je.prototype.setPrivateEx=w0,Je.prototype.generate=C0,Je.prototype.decrypt=qc,Je.prototype.decryptOAEP=x0;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function rn(a,l){this.x=l,this.q=a}function E0(a){return a==this?!0:this.q.equals(a.q)&&this.x.equals(a.x)}function T0(){return this.x}function P0(){return new rn(this.q,this.x.negate().mod(this.q))}function R0(a){return new rn(this.q,this.x.add(a.toBigInteger()).mod(this.q))}function _0(a){return new rn(this.q,this.x.subtract(a.toBigInteger()).mod(this.q))}function I0(a){return new rn(this.q,this.x.multiply(a.toBigInteger()).mod(this.q))}function A0(){return new rn(this.q,this.x.square().mod(this.q))}function k0(a){return new rn(this.q,this.x.multiply(a.toBigInteger().modInverse(this.q)).mod(this.q))}rn.prototype.equals=E0,rn.prototype.toBigInteger=T0,rn.prototype.negate=P0,rn.prototype.add=R0,rn.prototype.subtract=_0,rn.prototype.multiply=I0,rn.prototype.square=A0,rn.prototype.divide=k0,rn.prototype.sqrt=function(){return new rn(this.q,this.x.sqrt().mod(this.q))};function mt(a,l,c,p){this.curve=a,this.x=l,this.y=c,p==null?this.z=g.ONE:this.z=p,this.zinv=null}function Ff(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function O0(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function F0(a){if(a==this)return!0;if(this.isInfinity())return a.isInfinity();if(a.isInfinity())return this.isInfinity();var l,c;return l=a.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(a.z)).mod(this.curve.q),l.equals(g.ZERO)?(c=a.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(a.z)).mod(this.curve.q),c.equals(g.ZERO)):!1}function Nf(){return this.x==null&&this.y==null?!0:this.z.equals(g.ZERO)&&!this.y.toBigInteger().equals(g.ZERO)}function N0(){return new mt(this.curve,this.x,this.y.negate(),this.z)}function D0(a){if(this.isInfinity())return a;if(a.isInfinity())return this;var l=a.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(a.z)).mod(this.curve.q),c=a.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(a.z)).mod(this.curve.q);if(g.ZERO.equals(c))return g.ZERO.equals(l)?this.twice():this.curve.getInfinity();var p=new g("3"),y=this.x.toBigInteger(),v=this.y.toBigInteger();a.x.toBigInteger(),a.y.toBigInteger();var x=c.square(),C=x.multiply(c),O=y.multiply(x),_=l.square().multiply(this.z),B=_.subtract(O.shiftLeft(1)).multiply(a.z).subtract(C).multiply(c).mod(this.curve.q),N=O.multiply(p).multiply(l).subtract(v.multiply(C)).subtract(_.multiply(l)).multiply(a.z).add(l.multiply(C)).mod(this.curve.q),w=C.multiply(this.z).multiply(a.z).mod(this.curve.q);return new mt(this.curve,this.curve.fromBigInteger(B),this.curve.fromBigInteger(N),w)}function L0(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var a=new g("3"),l=this.x.toBigInteger(),c=this.y.toBigInteger(),p=c.multiply(this.z),y=p.multiply(c).mod(this.curve.q),v=this.curve.a.toBigInteger(),x=l.square().multiply(a);g.ZERO.equals(v)||(x=x.add(this.z.square().multiply(v))),x=x.mod(this.curve.q);var C=x.square().subtract(l.shiftLeft(3).multiply(y)).shiftLeft(1).multiply(p).mod(this.curve.q),O=x.multiply(a).multiply(l).subtract(y.shiftLeft(1)).shiftLeft(2).multiply(y).subtract(x.square().multiply(x)).mod(this.curve.q),_=p.square().multiply(p).shiftLeft(3).mod(this.curve.q);return new mt(this.curve,this.curve.fromBigInteger(C),this.curve.fromBigInteger(O),_)}function ls(a){if(this.isInfinity())return this;if(a.signum()==0)return this.curve.getInfinity();var l=a,c=l.multiply(new g("3")),p=this.negate(),y=this,v=this.curve.q.subtract(a),x=v.multiply(new g("3")),C=new mt(this.curve,this.x,this.y),O=C.negate(),_;for(_=c.bitLength()-2;_>0;--_){y=y.twice();var B=c.testBit(_),N=l.testBit(_);B!=N&&(y=y.add(B?this:p))}for(_=x.bitLength()-2;_>0;--_){C=C.twice();var w=x.testBit(_),I=v.testBit(_);w!=I&&(C=C.add(w?C:O))}return y}function Uc(a,l,c){var p;a.bitLength()>c.bitLength()?p=a.bitLength()-1:p=c.bitLength()-1;for(var y=this.curve.getInfinity(),v=this.add(l);p>=0;)y=y.twice(),a.testBit(p)?c.testBit(p)?y=y.add(v):y=y.add(this):c.testBit(p)&&(y=y.add(l)),--p;return y}mt.prototype.getX=Ff,mt.prototype.getY=O0,mt.prototype.equals=F0,mt.prototype.isInfinity=Nf,mt.prototype.negate=N0,mt.prototype.add=D0,mt.prototype.twice=L0,mt.prototype.multiply=ls,mt.prototype.multiplyTwo=Uc;function Yr(a,l,c){this.q=a,this.a=this.fromBigInteger(l),this.b=this.fromBigInteger(c),this.infinity=new mt(this,null,null)}function zc(){return this.q}function Df(){return this.a}function Lf(){return this.b}function Mf(a){return a==this?!0:this.q.equals(a.q)&&this.a.equals(a.a)&&this.b.equals(a.b)}function M0(){return this.infinity}function B0(a){return new rn(this.q,a)}function j0(a){switch(parseInt(a.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var l=a.substr(0,2);a.substr(2);var c=this.fromBigInteger(new g(O,16)),p=this.getA(),y=this.getB(),v=c.square().add(p).multiply(c).add(y),x=v.sqrt();return l=="03"&&(x=x.negate()),new mt(this,c,x);case 4:case 6:case 7:var C=(a.length-2)/2,O=a.substr(2,C),_=a.substr(C+2,C);return new mt(this,this.fromBigInteger(new g(O,16)),this.fromBigInteger(new g(_,16)));default:return null}}Yr.prototype.getQ=zc,Yr.prototype.getA=Df,Yr.prototype.getB=Lf,Yr.prototype.equals=Mf,Yr.prototype.getInfinity=M0,Yr.prototype.fromBigInteger=B0,Yr.prototype.decodePointHex=j0;/*! (c) Stefan Thomas | https://github.com/bitcoinjs/bitcoinjs-lib
 */rn.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},mt.prototype.getEncoded=function(a){var l=function(v,x){var C=v.toByteArrayUnsigned();if(x<C.length)C=C.slice(C.length-x);else for(;x>C.length;)C.unshift(0);return C},c=this.getX().toBigInteger(),p=this.getY().toBigInteger(),y=l(c,32);return a?p.isEven()?y.unshift(2):y.unshift(3):(y.unshift(4),y=y.concat(l(p,32))),y},mt.decodeFrom=function(a,l){l[0];var c=l.length-1,p=l.slice(1,1+c/2),y=l.slice(1+c/2,1+c);p.unshift(0),y.unshift(0);var v=new g(p),x=new g(y);return new mt(a,a.fromBigInteger(v),a.fromBigInteger(x))},mt.decodeFromHex=function(a,l){l.substr(0,2);var c=l.length-2,p=l.substr(2,c/2),y=l.substr(2+c/2,c/2),v=new g(p,16),x=new g(y,16);return new mt(a,a.fromBigInteger(v),a.fromBigInteger(x))},mt.prototype.add2D=function(a){if(this.isInfinity())return a;if(a.isInfinity())return this;if(this.x.equals(a.x))return this.y.equals(a.y)?this.twice():this.curve.getInfinity();var l=a.x.subtract(this.x),c=a.y.subtract(this.y),p=c.divide(l),y=p.square().subtract(this.x).subtract(a.x),v=p.multiply(this.x.subtract(y)).subtract(this.y);return new mt(this.curve,y,v)},mt.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var a=this.curve.fromBigInteger(g.valueOf(2)),l=this.curve.fromBigInteger(g.valueOf(3)),c=this.x.square().multiply(l).add(this.curve.a).divide(this.y.multiply(a)),p=c.square().subtract(this.x.multiply(a)),y=c.multiply(this.x.subtract(p)).subtract(this.y);return new mt(this.curve,p,y)},mt.prototype.multiply2D=function(a){if(this.isInfinity())return this;if(a.signum()==0)return this.curve.getInfinity();var l=a,c=l.multiply(new g("3")),p=this.negate(),y=this,v;for(v=c.bitLength()-2;v>0;--v){y=y.twice();var x=c.testBit(v),C=l.testBit(v);x!=C&&(y=y.add2D(x?this:p))}return y},mt.prototype.isOnCurve=function(){var a=this.getX().toBigInteger(),l=this.getY().toBigInteger(),c=this.curve.getA().toBigInteger(),p=this.curve.getB().toBigInteger(),y=this.curve.getQ(),v=l.multiply(l).mod(y),x=a.multiply(a).multiply(a).add(c.multiply(a)).add(p).mod(y);return v.equals(x)},mt.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},mt.prototype.validate=function(){var a=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var l=this.getX().toBigInteger(),c=this.getY().toBigInteger();if(l.compareTo(g.ONE)<0||l.compareTo(a.subtract(g.ONE))>0)throw new Error("x coordinate out of bounds");if(c.compareTo(g.ONE)<0||c.compareTo(a.subtract(g.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(a).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */var Bf=function(){var a="(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)",l='(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))',c='(?:"'+l+'*")',p=new RegExp("(?:false|true|null|[\\{\\}\\[\\]]|"+a+"|"+c+")","g"),y=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),v={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function x(B,N,w){return N?v[N]:String.fromCharCode(parseInt(w,16))}var C=new String(""),O="\\",_=Object.hasOwnProperty;return function(B,N){var w=B.match(p),I,R=w[0],F=!1;R==="{"?I={}:R==="["?I=[]:(I=[],F=!0);for(var L,V=[I],te=1-F,ue=w.length;te<ue;++te){R=w[te];var ae;switch(R.charCodeAt(0)){default:ae=V[0],ae[L||ae.length]=+R,L=void 0;break;case 34:if(R=R.substring(1,R.length-1),R.indexOf(O)!==-1&&(R=R.replace(y,x)),ae=V[0],!L)if(ae instanceof Array)L=ae.length;else{L=R||C;break}ae[L]=R,L=void 0;break;case 91:ae=V[0],V.unshift(ae[L||ae.length]=[]),L=void 0;break;case 93:V.shift();break;case 102:ae=V[0],ae[L||ae.length]=!1,L=void 0;break;case 110:ae=V[0],ae[L||ae.length]=null,L=void 0;break;case 116:ae=V[0],ae[L||ae.length]=!0,L=void 0;break;case 123:ae=V[0],V.unshift(ae[L||ae.length]={}),L=void 0;break;case 125:V.shift();break}}if(F){if(V.length!==1)throw new Error;I=I[0]}else if(V.length)throw new Error;if(N){var le=function(H,W){var J=H[W];if(J&&typeof J=="object"){var $=null;for(var Z in J)if(_.call(J,Z)&&J!==H){var oe=le(J,Z);oe!==void 0?J[Z]=oe:($||($=[]),$.push(Z))}if($)for(var de=$.length;--de>=0;)delete J[$[de]]}return N.call(H,W,J)};I=le({"":I},"")}return I}}();(typeof S>"u"||!S)&&(S={}),(typeof S.asn1>"u"||!S.asn1)&&(S.asn1={}),S.asn1.ASN1Util=new function(){this.integerToByteHex=function(a){var l=a.toString(16);return l.length%2==1&&(l="0"+l),l},this.bigIntToMinTwosComplementsHex=function(a){var l=a.toString(16);if(l.substr(0,1)!="-")l.length%2==1?l="0"+l:l.match(/^[0-7]/)||(l="00"+l);else{var c=l.substr(1),p=c.length;p%2==1?p+=1:l.match(/^[0-7]/)||(p+=2);for(var y="",v=0;v<p;v++)y+="f";var x=new g(y,16),C=x.xor(a).add(g.ONE);l=C.toString(16).replace(/^-/,"")}return l},this.getPEMStringFromHex=function(a,l){return dn(a,l)},this.newObject=function(a){var l=S,c=l.asn1,p=c.ASN1Object,y=c.DERBoolean,v=c.DERInteger,x=c.DERBitString,C=c.DEROctetString,O=c.DERNull,_=c.DERObjectIdentifier,B=c.DEREnumerated,N=c.DERUTF8String,w=c.DERNumericString,I=c.DERPrintableString,R=c.DERTeletexString,F=c.DERIA5String,L=c.DERUTCTime,V=c.DERGeneralizedTime,te=c.DERVisibleString,ue=c.DERBMPString,ae=c.DERSequence,le=c.DERSet,H=c.DERTaggedObject,W=c.ASN1Util.newObject;if(a instanceof c.ASN1Object)return a;var J=Object.keys(a);if(J.length!=1)throw new Error("key of param shall be only one.");var $=J[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+$+":")==-1)throw new Error("undefined key: "+$);if($=="bool")return new y(a[$]);if($=="int")return new v(a[$]);if($=="bitstr")return new x(a[$]);if($=="octstr")return new C(a[$]);if($=="null")return new O(a[$]);if($=="oid")return new _(a[$]);if($=="enum")return new B(a[$]);if($=="utf8str")return new N(a[$]);if($=="numstr")return new w(a[$]);if($=="prnstr")return new I(a[$]);if($=="telstr")return new R(a[$]);if($=="ia5str")return new F(a[$]);if($=="utctime")return new L(a[$]);if($=="gentime")return new V(a[$]);if($=="visstr")return new te(a[$]);if($=="bmpstr")return new ue(a[$]);if($=="asn1")return new p(a[$]);if($=="seq"){for(var Z=a[$],oe=[],de=0;de<Z.length;de++){var Te=W(Z[de]);oe.push(Te)}return new ae({array:oe})}if($=="set"){for(var Z=a[$],oe=[],de=0;de<Z.length;de++){var Te=W(Z[de]);oe.push(Te)}return new le({array:oe})}if($=="tag"){var h=a[$];if(Object.prototype.toString.call(h)==="[object Array]"&&h.length==3){var T=W(h[2]);return new H({tag:h[0],explicit:h[1],obj:T})}else return new H(h)}},this.jsonToASN1HEX=function(a){var l=this.newObject(a);return l.tohex()}},S.asn1.ASN1Util.oidHexToInt=function(a){for(var y="",l=parseInt(a.substr(0,2),16),c=Math.floor(l/40),p=l%40,y=c+"."+p,v="",x=2;x<a.length;x+=2){var C=parseInt(a.substr(x,2),16),O=("00000000"+C.toString(2)).slice(-8);if(v=v+O.substr(1,7),O.substr(0,1)=="0"){var _=new g(v,2);y=y+"."+_.toString(10),v=""}}return y},S.asn1.ASN1Util.oidIntToHex=function(a){var l=function(C){var O=C.toString(16);return O.length==1&&(O="0"+O),O},c=function(C){var O="",_=new g(C,10),B=_.toString(2),N=7-B.length%7;N==7&&(N=0);for(var w="",I=0;I<N;I++)w+="0";B=w+B;for(var I=0;I<B.length-1;I+=7){var R=B.substr(I,7);I!=B.length-7&&(R="1"+R),O+=l(parseInt(R,2))}return O};if(!a.match(/^[0-9.]+$/))throw"malformed oid string: "+a;var p="",y=a.split("."),v=parseInt(y[0])*40+parseInt(y[1]);p+=l(v),y.splice(0,2);for(var x=0;x<y.length;x++)p+=c(y[x]);return p},S.asn1.ASN1Object=function(a){var l="";this.params=null,this.getLengthHexFromValue=function(){if(typeof this.hV>"u"||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n="+l.length+",v="+this.hV);var c=this.hV.length/2,p=c.toString(16);if(p.length%2==1&&(p="0"+p),c<128)return p;var y=p.length/2;if(y>15)throw new Error("ASN.1 length too long to represent by 8x: n = "+c.toString(16));var v=128+y;return v.toString(16)+p},this.tohex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.getValueHex=function(){return this.tohex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(c){this.params=c},a!=null&&a.tlv!=null&&(this.hTLV=a.tlv,this.isModified=!1)},S.asn1.DERAbstractString=function(a){S.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(l){this.hTLV=null,this.isModified=!0,this.s=l,this.hV=zu(this.s).toLowerCase()},this.setStringHex=function(l){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=l},this.getFreshValueHex=function(){return this.hV},typeof a<"u"&&(typeof a=="string"?this.setString(a):typeof a.str<"u"?this.setString(a.str):typeof a.hex<"u"&&this.setStringHex(a.hex))},xe(S.asn1.DERAbstractString,S.asn1.ASN1Object),S.asn1.DERAbstractTime=function(a){S.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(l){var c=l.getTime()+l.getTimezoneOffset()*6e4,p=new Date(c);return p},this.formatDate=function(l,c,p){var y=this.zeroPadding,v=this.localDateToUTC(l),x=String(v.getFullYear());c=="utc"&&(x=x.substr(2,2));var C=y(String(v.getMonth()+1),2),O=y(String(v.getDate()),2),_=y(String(v.getHours()),2),B=y(String(v.getMinutes()),2),N=y(String(v.getSeconds()),2),w=x+C+O+_+B+N;if(p===!0){var I=v.getMilliseconds();if(I!=0){var R=y(String(I),3);R=R.replace(/[0]+$/,""),w=w+"."+R}}return w+"Z"},this.zeroPadding=function(l,c){return l.length>=c?l:new Array(c-l.length+1).join("0")+l},this.setByParam=function(l){this.hV=null,this.hTLV=null,this.params=l},this.getString=function(){},this.setString=function(l){this.hTLV=null,this.isModified=!0,this.params==null&&(this.params={}),this.params.str=l},this.setByDate=function(l){this.hTLV=null,this.isModified=!0,this.params==null&&(this.params={}),this.params.date=l},this.setByDateValue=function(l,c,p,y,v,x){var C=new Date(Date.UTC(l,c-1,p,y,v,x,0));this.setByDate(C)},this.getFreshValueHex=function(){return this.hV}},xe(S.asn1.DERAbstractTime,S.asn1.ASN1Object),S.asn1.DERAbstractStructured=function(a){S.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(l){this.hTLV=null,this.isModified=!0,this.asn1Array=l},this.appendASN1Object=function(l){this.hTLV=null,this.isModified=!0,this.asn1Array.push(l)},this.asn1Array=new Array,typeof a<"u"&&typeof a.array<"u"&&(this.asn1Array=a.array)},xe(S.asn1.DERAbstractStructured,S.asn1.ASN1Object),S.asn1.DERBoolean=function(a){S.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",a==!1?this.hTLV="010100":this.hTLV="0101ff"},xe(S.asn1.DERBoolean,S.asn1.ASN1Object),S.asn1.DERInteger=function(a){S.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.params=null;var l=S.asn1.ASN1Util.bigIntToMinTwosComplementsHex;this.setByBigInteger=function(c){this.isModified=!0,this.params={bigint:c}},this.setByInteger=function(c){this.isModified=!0,this.params=c},this.setValueHex=function(c){this.isModified=!0,this.params={hex:c}},this.getFreshValueHex=function(){var c=this.params,p=null;if(c==null)throw new Error("value not set");if(typeof c=="object"&&c.hex!=null)return this.hV=c.hex,this.hV;if(typeof c=="number")p=new g(String(c),10);else if(c.int!=null)p=new g(String(c.int),10);else if(c.bigint!=null)p=c.bigint;else throw new Error("wrong parameter");return this.hV=l(p),this.hV},a!=null&&(this.params=a)},xe(S.asn1.DERInteger,S.asn1.ASN1Object),S.asn1.DERBitString=function(a){if(a!==void 0&&typeof a.obj<"u"){var l=S.asn1.ASN1Util.newObject(a.obj);a.hex="00"+l.tohex()}S.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(c){this.hTLV=null,this.isModified=!0,this.hV=c},this.setUnusedBitsAndHexValue=function(c,p){if(c<0||7<c)throw"unused bits shall be from 0 to 7: u = "+c;var y="0"+c;this.hTLV=null,this.isModified=!0,this.hV=y+p},this.setByBinaryString=function(c){c=c.replace(/0+$/,"");var p=8-c.length%8;p==8&&(p=0),c+="0000000".substr(0,p);for(var y="",v=0;v<c.length-1;v+=8){var x=c.substr(v,8),C=parseInt(x,2).toString(16);C.length==1&&(C="0"+C),y+=C}this.hTLV=null,this.isModified=!0,this.hV="0"+p+y},this.setByBooleanArray=function(c){for(var p="",y=0;y<c.length;y++)c[y]==!0?p+="1":p+="0";this.setByBinaryString(p)},this.newFalseArray=function(c){for(var p=new Array(c),y=0;y<c;y++)p[y]=!1;return p},this.getFreshValueHex=function(){return this.hV},typeof a<"u"&&(typeof a=="string"&&a.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(a):typeof a.hex<"u"?this.setHexValueIncludingUnusedBits(a.hex):typeof a.bin<"u"?this.setByBinaryString(a.bin):typeof a.array<"u"&&this.setByBooleanArray(a.array))},xe(S.asn1.DERBitString,S.asn1.ASN1Object),S.asn1.DEROctetString=function(a){if(a!==void 0&&typeof a.obj<"u"){var l=S.asn1.ASN1Util.newObject(a.obj);a.hex=l.tohex()}S.asn1.DEROctetString.superclass.constructor.call(this,a),this.hT="04"},xe(S.asn1.DEROctetString,S.asn1.DERAbstractString),S.asn1.DERNull=function(){S.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},xe(S.asn1.DERNull,S.asn1.ASN1Object),S.asn1.DERObjectIdentifier=function(a){S.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(l){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=l},this.setValueOidString=function(l){var c=Vf(l);if(c==null)throw new Error("malformed oid string: "+l);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=c},this.setValueName=function(l){var c=S.asn1.x509.OID.name2oid(l);if(c!=="")this.setValueOidString(c);else throw new Error("DERObjectIdentifier oidName undefined: "+l)},this.setValueNameOrOid=function(l){l.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(l):this.setValueName(l)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(l){typeof l=="string"?this.setValueNameOrOid(l):l.oid!==void 0?this.setValueNameOrOid(l.oid):l.name!==void 0?this.setValueNameOrOid(l.name):l.hex!==void 0&&this.setValueHex(l.hex)},a!==void 0&&this.setByParam(a)},xe(S.asn1.DERObjectIdentifier,S.asn1.ASN1Object),S.asn1.DEREnumerated=function(a){S.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(l){this.hTLV=null,this.isModified=!0,this.hV=S.asn1.ASN1Util.bigIntToMinTwosComplementsHex(l)},this.setByInteger=function(l){var c=new g(String(l),10);this.setByBigInteger(c)},this.setValueHex=function(l){this.hV=l},this.getFreshValueHex=function(){return this.hV},typeof a<"u"&&(typeof a.int<"u"?this.setByInteger(a.int):typeof a=="number"?this.setByInteger(a):typeof a.hex<"u"&&this.setValueHex(a.hex))},xe(S.asn1.DEREnumerated,S.asn1.ASN1Object),S.asn1.DERUTF8String=function(a){S.asn1.DERUTF8String.superclass.constructor.call(this,a),this.hT="0c"},xe(S.asn1.DERUTF8String,S.asn1.DERAbstractString),S.asn1.DERNumericString=function(a){S.asn1.DERNumericString.superclass.constructor.call(this,a),this.hT="12"},xe(S.asn1.DERNumericString,S.asn1.DERAbstractString),S.asn1.DERPrintableString=function(a){S.asn1.DERPrintableString.superclass.constructor.call(this,a),this.hT="13"},xe(S.asn1.DERPrintableString,S.asn1.DERAbstractString),S.asn1.DERTeletexString=function(a){S.asn1.DERTeletexString.superclass.constructor.call(this,a),this.hT="14"},xe(S.asn1.DERTeletexString,S.asn1.DERAbstractString),S.asn1.DERIA5String=function(a){S.asn1.DERIA5String.superclass.constructor.call(this,a),this.hT="16"},xe(S.asn1.DERIA5String,S.asn1.DERAbstractString),S.asn1.DERVisibleString=function(a){S.asn1.DERIA5String.superclass.constructor.call(this,a),this.hT="1a"},xe(S.asn1.DERVisibleString,S.asn1.DERAbstractString),S.asn1.DERBMPString=function(a){S.asn1.DERBMPString.superclass.constructor.call(this,a),this.hT="1e"},xe(S.asn1.DERBMPString,S.asn1.DERAbstractString),S.asn1.DERUTCTime=function(a){S.asn1.DERUTCTime.superclass.constructor.call(this,a),this.hT="17",this.params=void 0,this.getFreshValueHex=function(){var l=this.params;if(this.params==null&&(l={date:new Date}),typeof l=="string")if(l.match(/^[0-9]{12}Z$/)||l.match(/^[0-9]{12}\.[0-9]+Z$/))this.hV=rr(l);else throw new Error("malformed string for UTCTime: "+l);else if(l.str!=null)this.hV=rr(l.str);else if(l.date==null&&l.millis==!0){var c=new Date;this.hV=rr(this.formatDate(c,"utc",!0))}else if(l.date!=null&&l.date instanceof Date){var p=l.millis===!0;this.hV=rr(this.formatDate(l.date,"utc",p))}else l instanceof Date&&(this.hV=rr(this.formatDate(l,"utc")));if(this.hV==null)throw new Error("parameter not specified properly for UTCTime");return this.hV},a!=null&&this.setByParam(a)},xe(S.asn1.DERUTCTime,S.asn1.DERAbstractTime),S.asn1.DERGeneralizedTime=function(a){S.asn1.DERGeneralizedTime.superclass.constructor.call(this,a),this.hT="18",this.params=a,this.getFreshValueHex=function(){var l=this.params;if(this.params==null&&(l={date:new Date}),typeof l=="string")if(l.match(/^[0-9]{14}Z$/)||l.match(/^[0-9]{14}\.[0-9]+Z$/))this.hV=rr(l);else throw new Error("malformed string for GeneralizedTime: "+l);else if(l.str!=null)this.hV=rr(l.str);else if(l.date==null&&l.millis==!0){var c=new Date;this.hV=rr(this.formatDate(c,"gen",!0))}else if(l.date!=null&&l.date instanceof Date){var p=l.millis===!0;this.hV=rr(this.formatDate(l.date,"gen",p))}else l instanceof Date&&(this.hV=rr(this.formatDate(l,"gen")));if(this.hV==null)throw new Error("parameter not specified properly for GeneralizedTime");return this.hV},a!=null&&this.setByParam(a)},xe(S.asn1.DERGeneralizedTime,S.asn1.DERAbstractTime),S.asn1.DERSequence=function(a){S.asn1.DERSequence.superclass.constructor.call(this,a),this.hT="30",this.getFreshValueHex=function(){for(var l="",c=0;c<this.asn1Array.length;c++){var p=this.asn1Array[c];l+=p.tohex()}return this.hV=l,this.hV}},xe(S.asn1.DERSequence,S.asn1.DERAbstractStructured),S.asn1.DERSet=function(a){S.asn1.DERSet.superclass.constructor.call(this,a),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var l=new Array,c=0;c<this.asn1Array.length;c++){var p=this.asn1Array[c];l.push(p.tohex())}return this.sortFlag==!0&&l.sort(),this.hV=l.join(""),this.hV},typeof a<"u"&&typeof a.sortflag<"u"&&a.sortflag==!1&&(this.sortFlag=!1)},xe(S.asn1.DERSet,S.asn1.DERAbstractStructured),S.asn1.DERTaggedObject=function(a){S.asn1.DERTaggedObject.superclass.constructor.call(this);var l=S.asn1,c=Fe,p=c.getV;c.isASN1HEX;var y=l.ASN1Util.newObject;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.params={tag:"a0",explicit:!0},this.setASN1Object=function(v,x,C){this.params={tag:x,explicit:v,obj:C}},this.getFreshValueHex=function(){var v=this.params;if(v.explicit==null&&(v.explicit=!0),v.tage!=null&&(v.tag=v.tage,v.explicit=!0),v.tagi!=null&&(v.tag=v.tagi,v.explicit=!1),v.str!=null)this.hV=zu(v.str);else if(v.hex!=null)this.hV=v.hex;else if(v.obj!=null){var x;v.obj instanceof l.ASN1Object?x=v.obj.tohex():typeof v.obj=="object"&&(x=y(v.obj).tohex()),v.explicit?this.hV=x:this.hV=p(x,0)}else throw new Error("str, hex nor obj not specified");return v.tag==null&&(v.tag="a0"),this.hT=v.tag,this.hTLV=null,this.isModified=!0,this.hV},this.setByParam=function(v){this.params=v},a!==void 0&&this.setByParam(a)},xe(S.asn1.DERTaggedObject,S.asn1.ASN1Object);var Fe=new function(){};Fe.getLblen=function(a,l){if(a.substr(l+2,1)!="8")return 1;var c=parseInt(a.substr(l+3,1));return c==0?-1:0<c&&c<10?c+1:-2},Fe.getL=function(a,l){var c=Fe.getLblen(a,l);return c<1?"":a.substr(l+2,c*2)},Fe.getVblen=function(a,l){var c,p;return c=Fe.getL(a,l),c==""?-1:(c.substr(0,1)==="8"?p=new g(c.substr(2),16):p=new g(c,16),p.intValue())},Fe.getVidx=function(a,l){var c=Fe.getLblen(a,l);return c<0?c:l+(c+1)*2},Fe.getV=function(a,l){var c=Fe.getVidx(a,l),p=Fe.getVblen(a,l);return a.substr(c,p*2)},Fe.getTLV=function(a,l){return a.substr(l,2)+Fe.getL(a,l)+Fe.getV(a,l)},Fe.getTLVblen=function(a,l){return 2+Fe.getLblen(a,l)*2+Fe.getVblen(a,l)*2},Fe.getNextSiblingIdx=function(a,l){var c=Fe.getVidx(a,l),p=Fe.getVblen(a,l);return c+p*2},Fe.getChildIdx=function(a,l){var c=Fe,p=[],y,v,x;y=c.getVidx(a,l),v=c.getVblen(a,l)*2,a.substr(l,2)=="03"&&(y+=2,v-=2),x=0;for(var C=y;x<=v;){var O=c.getTLVblen(a,C);if(x+=O,x<=v&&p.push(C),C+=O,x>=v)break}return p},Fe.getNthChildIdx=function(a,l,c){var p=Fe.getChildIdx(a,l);return p[c]},Fe.getIdxbyList=function(a,l,c,p){var y=Fe,v,x;return c.length==0?p!==void 0&&a.substr(l,2)!==p?-1:l:(v=c.shift(),x=y.getChildIdx(a,l),v>=x.length?-1:y.getIdxbyList(a,x[v],c,p))},Fe.getIdxbyListEx=function(a,l,c,p){var y=Fe,v,x;if(c.length==0)return p!==void 0&&a.substr(l,2)!==p?-1:l;v=c.shift(),x=y.getChildIdx(a,l);for(var C=0,O=0;O<x.length;O++){var _=a.substr(x[O],2);if(typeof v=="number"&&!y.isContextTag(_)&&C==v||typeof v=="string"&&y.isContextTag(_,v))return y.getIdxbyListEx(a,x[O],c,p);y.isContextTag(_)||C++}return-1},Fe.getTLVbyList=function(a,l,c,p){var y=Fe,v=y.getIdxbyList(a,l,c,p);return v==-1||v>=a.length?null:y.getTLV(a,v)},Fe.getTLVbyListEx=function(a,l,c,p){var y=Fe,v=y.getIdxbyListEx(a,l,c,p);return v==-1?null:y.getTLV(a,v)},Fe.getVbyList=function(a,l,c,p,y){var v=Fe,x,C;return x=v.getIdxbyList(a,l,c,p),x==-1||x>=a.length?null:(C=v.getV(a,x),y===!0&&(C=C.substr(2)),C)},Fe.getVbyListEx=function(a,l,c,p,y){var v=Fe,x,C;return x=v.getIdxbyListEx(a,l,c,p),x==-1?null:(C=v.getV(a,x),a.substr(x,2)=="03"&&y!==!1&&(C=C.substr(2)),C)},Fe.getInt=function(a,l,c){c==null&&(c=-1);try{var p=a.substr(l,2);if(p!="02"&&p!="03")return c;var y=Fe.getV(a,l);return p=="02"?parseInt(y,16):Wf(y)}catch{return c}},Fe.getOID=function(a,l,c){c==null&&(c=null);try{if(a.substr(l,2)!="06")return c;var p=Fe.getV(a,l);return Wu(p)}catch{return c}},Fe.getOIDName=function(a,l,c){c==null&&(c=null);try{var p=Fe.getOID(a,l,c);if(p==c)return c;var y=S.asn1.x509.OID.oid2name(p);return y==""?p:y}catch{return c}},Fe.getString=function(a,l,c){c==null&&(c=null);try{var p=Fe.getV(a,l);return Kt(p)}catch{return c}},Fe.hextooidstr=function(a){var l=function(N,w){return N.length>=w?N:new Array(w-N.length+1).join("0")+N},c=[],p=a.substr(0,2),y=parseInt(p,16);c[0]=new String(Math.floor(y/40)),c[1]=new String(y%40);for(var v=a.substr(2),x=[],C=0;C<v.length/2;C++)x.push(parseInt(v.substr(C*2,2),16));for(var O=[],_="",C=0;C<x.length;C++)x[C]&128?_=_+l((x[C]&127).toString(2),7):(_=_+l((x[C]&127).toString(2),7),O.push(new String(parseInt(_,2))),_="");var B=c.join(".");return O.length>0&&(B=B+"."+O.join(".")),B},Fe.dump=function(a,l,c,p){var y=Fe,v=y.getV,x=y.dump,C=y.getChildIdx,O=a;a instanceof S.asn1.ASN1Object&&(O=a.tohex());var _=function(W,J){if(W.length<=J*2)return W;var $=W.substr(0,J)+"..(total "+W.length/2+"bytes).."+W.substr(W.length-J,J);return $};l===void 0&&(l={ommit_long_octet:32}),c===void 0&&(c=0),p===void 0&&(p="");var B=l.ommit_long_octet,le=O.substr(c,2);if(le=="01"){var N=v(O,c);return N=="00"?p+`BOOLEAN FALSE
`:p+`BOOLEAN TRUE
`}if(le=="02"){var N=v(O,c);return p+"INTEGER "+_(N,B)+`
`}if(le=="03"){var N=v(O,c);if(y.isASN1HEX(N.substr(2))){var w=p+`BITSTRING, encapsulates
`;return w=w+x(N.substr(2),l,0,p+"  "),w}else return p+"BITSTRING "+_(N,B)+`
`}if(le=="04"){var N=v(O,c);if(y.isASN1HEX(N)){var w=p+`OCTETSTRING, encapsulates
`;return w=w+x(N,l,0,p+"  "),w}else return p+"OCTETSTRING "+_(N,B)+`
`}if(le=="05")return p+`NULL
`;if(le=="06"){var I=v(O,c),R=S.asn1.ASN1Util.oidHexToInt(I),F=S.asn1.x509.OID.oid2name(R),L=R.replace(/\./g," ");return F!=""?p+"ObjectIdentifier "+F+" ("+L+`)
`:p+"ObjectIdentifier ("+L+`)
`}if(le=="0a")return p+"ENUMERATED "+parseInt(v(O,c))+`
`;if(le=="0c")return p+"UTF8String '"+St(v(O,c))+`'
`;if(le=="13")return p+"PrintableString '"+St(v(O,c))+`'
`;if(le=="14")return p+"TeletexString '"+St(v(O,c))+`'
`;if(le=="16")return p+"IA5String '"+St(v(O,c))+`'
`;if(le=="17")return p+"UTCTime "+St(v(O,c))+`
`;if(le=="18")return p+"GeneralizedTime "+St(v(O,c))+`
`;if(le=="1a")return p+"VisualString '"+St(v(O,c))+`'
`;if(le=="1e")return p+"BMPString '"+Yc(v(O,c))+`'
`;if(le=="30"){if(O.substr(c,4)=="3000")return p+`SEQUENCE {}
`;var w=p+`SEQUENCE
`,V=C(O,c),te=l;if((V.length==2||V.length==3)&&O.substr(V[0],2)=="06"&&O.substr(V[V.length-1],2)=="04"){var F=y.oidname(v(O,V[0])),ue=JSON.parse(JSON.stringify(l));ue.x509ExtName=F,te=ue}for(var ae=0;ae<V.length;ae++)w=w+x(O,te,V[ae],p+"  ");return w}if(le=="31"){for(var w=p+`SET
`,V=C(O,c),ae=0;ae<V.length;ae++)w=w+x(O,l,V[ae],p+"  ");return w}var le=parseInt(le,16);if(le&128){var H=le&31;if(le&32){for(var w=p+"["+H+`]
`,V=C(O,c),ae=0;ae<V.length;ae++)w=w+x(O,l,V[ae],p+"  ");return w}else{var N=v(O,c);if(Fe.isASN1HEX(N)){var w=p+"["+H+`]
`;return w=w+x(N,l,0,p+"  "),w}else(N.substr(0,8)=="68747470"||l.x509ExtName==="subjectAltName"&&H==2)&&(N=St(N));var w=p+"["+H+"] "+N+`
`;return w}}return p+"UNKNOWN("+le+") "+v(O,c)+`
`},Fe.parse=function(a){var l=Fe,c=l.parse,p=l.isASN1HEX,y=l.getV,v=l.getTLV,x=l.getChildIdx,C=S.asn1,O=C.ASN1Util.oidHexToInt,_=C.x509.OID.oid2name,B=St,N=Yc,w=U0,I={"0c":"utf8str",12:"numstr",13:"prnstr",14:"telstr",16:"ia5str",17:"utctime",18:"gentime","1a":"visstr","1e":"bmpstr",30:"seq",31:"set"},R=function($){for(var Z=[],oe=x($,0),de=0;de<oe.length;de++){var Te=oe[de],h=v($,Te),T=c(h);Z.push(T)}return Z},F=a.substr(0,2),L={},V=y(a,0);if(F=="01")return a=="0101ff"?{bool:!0}:{bool:!1};if(F=="02")return{int:{hex:V}};if(F=="03")try{if(V.substr(0,2)!="00")throw"not encap";var te=V.substr(2);if(!p(te))throw"not encap";return{bitstr:{obj:c(te)}}}catch{var ue=null;return V.length<=10&&(ue=Kf(V)),ue==null?{bitstr:{hex:V}}:{bitstr:{bin:ue}}}else if(F=="04")try{if(!p(V))throw"not encap";return{octstr:{obj:c(V)}}}catch{return{octstr:{hex:V}}}else{if(F=="05")return{null:""};if(F=="06"){var ae=O(V),le=_(ae);return le==""?{oid:ae}:{oid:le}}else{if(F=="0a")return V.length>4?{enum:{hex:V}}:{enum:parseInt(V,16)};if(F=="30"||F=="31")return L[I[F]]=R(a),L;if(F=="14"){var H=w(V);return L[I[F]]={str:H},L}else if(F=="1e"){var H=N(V);return L[I[F]]={str:H},L}else if(":0c:12:13:16:17:18:1a:".indexOf(F)!=-1){var H=B(V);return L[I[F]]={str:H},L}else if(F.match(/^8[0-9]$/)){var H=B(V);return H==null|H==""?{tag:{tag:F,explicit:!1,hex:V}}:H.match(/[\x00-\x1F\x7F-\x9F]/)!=null||H.match(/[\u0000-\u001F\u0080\u009F]/)!=null?{tag:{tag:F,explicit:!1,hex:V}}:{tag:{tag:F,explicit:!1,str:H}}}else if(F.match(/^a[0-9]$/))try{if(!p(V))throw new Error("not encap");return{tag:{tag:F,explicit:!0,obj:c(V)}}}catch{return{tag:{tag:F,explicit:!0,hex:V}}}else{var W=new S.asn1.ASN1Object;W.hV=V;var J=W.getLengthHexFromValue();return{asn1:{tlv:F+J+V}}}}}},Fe.isContextTag=function(a,l){a=a.toLowerCase();var c,p;try{c=parseInt(a,16)}catch{return-1}if(l===void 0)return(c&192)==128;try{var y=l.match(/^\[[0-9]+\]$/);return y==null||(p=parseInt(l.substr(1,l.length-1),10),p>31)?!1:(c&192)==128&&(c&31)==p}catch{return!1}},Fe.isASN1HEX=function(a){var l=Fe;if(a.length%2==1)return!1;var c=l.getVblen(a,0),p=a.substr(0,2),y=l.getL(a,0),v=a.length-p.length-y.length;return v==c*2},Fe.checkStrictDER=function(a,l,c,p,y){var v=Fe;if(c===void 0){if(typeof a!="string")throw new Error("not hex string");if(a=a.toLowerCase(),!S.lang.String.isHex(a))throw new Error("not hex string");c=a.length,p=a.length/2,p<128?y=1:y=Math.ceil(p.toString(16))+1}var x=v.getL(a,l);if(x.length>y*2)throw new Error("L of TLV too long: idx="+l);var C=v.getVblen(a,l);if(C>p)throw new Error("value of L too long than hex: idx="+l);var O=v.getTLV(a,l),_=O.length-2-v.getL(a,l).length;if(_!==C*2)throw new Error("V string length and L's value not the same:"+_+"/"+C*2);if(l===0&&a.length!=O.length)throw new Error("total length and TLV length unmatch:"+a.length+"!="+O.length);var B=a.substr(l,2);if(B==="02"){var N=v.getVidx(a,l);if(a.substr(N,2)=="00"&&a.charCodeAt(N+2)<56)throw new Error("not least zeros for DER INTEGER")}if(parseInt(B,16)&32){for(var w=v.getVblen(a,l),I=0,R=v.getChildIdx(a,l),F=0;F<R.length;F++){var L=v.getTLV(a,R[F]);I+=L.length,v.checkStrictDER(a,R[F],c,p,y)}if(w*2!=I)throw new Error("sum of children's TLV length and L unmatch: "+w*2+"!="+I)}},Fe.oidname=function(a){var l=S.asn1;S.lang.String.isHex(a)&&(a=l.ASN1Util.oidHexToInt(a));var c=l.x509.OID.oid2name(a);return c===""&&(c=a),c},(typeof S>"u"||!S)&&(S={}),(typeof S.asn1>"u"||!S.asn1)&&(S.asn1={}),(typeof S.asn1.x509>"u"||!S.asn1.x509)&&(S.asn1.x509={}),S.asn1.x509.Certificate=function(a){S.asn1.x509.Certificate.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.DERBitString,y=c.DERSequence,v=c.x509,x=v.TBSCertificate,C=v.AlgorithmIdentifier;this.params=void 0,this.setByParam=function(O){this.params=O},this.sign=function(){var O=this.params,_=O.sigalg;O.sigalg.name!=null&&(_=O.sigalg.name);var B=O.tbsobj.tohex(),N=new S.crypto.Signature({alg:_});N.init(O.cakey),N.updateHex(B),O.sighex=N.sign()},this.getPEM=function(){return dn(this.tohex(),"CERTIFICATE")},this.tohex=function(){var O=this.params;if((O.tbsobj==null||O.tbsobj==null)&&(O.tbsobj=new x(O)),O.sighex==null&&O.cakey!=null&&this.sign(),O.sighex==null)throw new Error("sighex or cakey parameter not defined");var _=[];_.push(O.tbsobj),_.push(new C({name:O.sigalg})),_.push(new p({hex:"00"+O.sighex}));var B=new y({array:_});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&(this.params=a)},xe(S.asn1.x509.Certificate,S.asn1.ASN1Object),S.asn1.x509.TBSCertificate=function(a){S.asn1.x509.TBSCertificate.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.x509,y=c.DERTaggedObject,v=c.DERInteger,x=c.DERSequence,C=p.AlgorithmIdentifier,O=p.Time,_=p.X500Name,B=p.Extensions,N=p.SubjectPublicKeyInfo;this.params=null,this.setByParam=function(w){this.params=w},this.tohex=function(){var w=[],I=this.params;if(I.version!=null||I.version!=1){var R=2;I.version!=null&&(R=I.version-1);var F=new y({obj:new v({int:R})});w.push(F)}w.push(new v(I.serial)),w.push(new C({name:I.sigalg})),w.push(new _(I.issuer)),w.push(new x({array:[new O(I.notbefore),new O(I.notafter)]})),w.push(new _(I.subject)),w.push(new N(gt.getKey(I.sbjpubkey))),I.ext!==void 0&&I.ext.length>0&&w.push(new y({tag:"a3",obj:new B(I.ext)}));var L=new S.asn1.DERSequence({array:w});return L.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.x509.TBSCertificate,S.asn1.ASN1Object),S.asn1.x509.Extensions=function(a){S.asn1.x509.Extensions.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.DERSequence,y=c.x509;this.aParam=[],this.setByParam=function(v){this.aParam=v},this.tohex=function(){for(var v=[],x=0;x<this.aParam.length;x++){var C=this.aParam[x],O=C.extname,_=null;if(C.extn!=null)_=new y.PrivateExtension(C);else if(O=="subjectKeyIdentifier")_=new y.SubjectKeyIdentifier(C);else if(O=="keyUsage")_=new y.KeyUsage(C);else if(O=="subjectAltName")_=new y.SubjectAltName(C);else if(O=="issuerAltName")_=new y.IssuerAltName(C);else if(O=="basicConstraints")_=new y.BasicConstraints(C);else if(O=="nameConstraints")_=new y.NameConstraints(C);else if(O=="cRLDistributionPoints")_=new y.CRLDistributionPoints(C);else if(O=="certificatePolicies")_=new y.CertificatePolicies(C);else if(O=="policyMappings")_=new y.PolicyMappings(C);else if(O=="policyConstraints")_=new y.PolicyConstraints(C);else if(O=="inhibitAnyPolicy")_=new y.InhibitAnyPolicy(C);else if(O=="authorityKeyIdentifier")_=new y.AuthorityKeyIdentifier(C);else if(O=="extKeyUsage")_=new y.ExtKeyUsage(C);else if(O=="authorityInfoAccess")_=new y.AuthorityInfoAccess(C);else if(O=="cRLNumber")_=new y.CRLNumber(C);else if(O=="cRLReason")_=new y.CRLReason(C);else if(O=="ocspNonce")_=new y.OCSPNonce(C);else if(O=="ocspNoCheck")_=new y.OCSPNoCheck(C);else if(O=="adobeTimeStamp")_=new y.AdobeTimeStamp(C);else if(O=="subjectDirectoryAttributes")_=new y.SubjectDirectoryAttributes(C);else throw new Error("extension not supported:"+JSON.stringify(C));_!=null&&v.push(_)}var B=new p({array:v});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.x509.Extensions,S.asn1.ASN1Object),S.asn1.x509.Extension=function(a){S.asn1.x509.Extension.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.DERObjectIdentifier,y=c.DEROctetString;c.DERBitString;var v=c.DERBoolean,x=c.DERSequence;this.tohex=function(){var C=new p({oid:this.oid}),O=new y({hex:this.getExtnValueHex()}),_=new Array;_.push(C),this.critical&&_.push(new v),_.push(O);var B=new x({array:_});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},this.critical=!1,a!==void 0&&a.critical!==void 0&&(this.critical=a.critical)},xe(S.asn1.x509.Extension,S.asn1.ASN1Object),S.asn1.x509.KeyUsage=function(a){S.asn1.x509.KeyUsage.superclass.constructor.call(this,a);var l=Error,c={digitalSignature:0,nonRepudiation:1,keyEncipherment:2,dataEncipherment:3,keyAgreement:4,keyCertSign:5,cRLSign:6,encipherOnly:7,decipherOnly:8};this.getExtnValueHex=function(){var p=this.getBinValue();return this.asn1ExtnValue=new S.asn1.DERBitString({bin:p}),this.asn1ExtnValue.tohex()},this.getBinValue=function(){var p=this.params;if(typeof p!="object"||typeof p.names!="object"&&typeof p.bin!="string")throw new l("parameter not yet set");if(p.names!=null)return Ku(p.names,c);if(p.bin!=null)return p.bin;throw new l("parameter not set properly")},this.oid="2.5.29.15",a!==void 0&&(this.params=a)},xe(S.asn1.x509.KeyUsage,S.asn1.x509.Extension),S.asn1.x509.BasicConstraints=function(a){S.asn1.x509.BasicConstraints.superclass.constructor.call(this,a);var l=S.asn1,c=l.DERBoolean,p=l.DERInteger,y=l.DERSequence;this.getExtnValueHex=function(){var v=new Array;this.cA&&v.push(new c),this.pathLen>-1&&v.push(new p({int:this.pathLen}));var x=new y({array:v});return this.asn1ExtnValue=x,this.asn1ExtnValue.tohex()},this.oid="2.5.29.19",this.cA=!1,this.pathLen=-1,a!==void 0&&(a.cA!==void 0&&(this.cA=a.cA),a.pathLen!==void 0&&(this.pathLen=a.pathLen))},xe(S.asn1.x509.BasicConstraints,S.asn1.x509.Extension),S.asn1.x509.CRLDistributionPoints=function(a){S.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,a);var l=S,c=l.asn1,p=c.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.setByDPArray=function(y){for(var v=[],x=0;x<y.length;x++)if(y[x]instanceof S.asn1.ASN1Object)v.push(y[x]);else{var C=new p.DistributionPoint(y[x]);v.push(C)}this.asn1ExtnValue=new c.DERSequence({array:v})},this.setByOneURI=function(y){var v=new p.DistributionPoint({fulluri:y});this.setByDPArray([v])},this.oid="2.5.29.31",a!==void 0&&(a.array!==void 0?this.setByDPArray(a.array):a.uri!==void 0&&this.setByOneURI(a.uri))},xe(S.asn1.x509.CRLDistributionPoints,S.asn1.x509.Extension),S.asn1.x509.DistributionPoint=function(a){S.asn1.x509.DistributionPoint.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.x509.DistributionPointName;this.tohex=function(){var y=new c.DERSequence;if(this.asn1DP!=null){var v=new c.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});y.appendASN1Object(v)}return this.hTLV=y.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(a.dpobj!==void 0?this.asn1DP=a.dpobj:a.dpname!==void 0?this.asn1DP=new p(a.dpname):a.fulluri!==void 0&&(this.asn1DP=new p({full:[{uri:a.fulluri}]})))},xe(S.asn1.x509.DistributionPoint,S.asn1.ASN1Object),S.asn1.x509.DistributionPointName=function(a){S.asn1.x509.DistributionPointName.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.DERTaggedObject;if(this.tohex=function(){if(this.type!="full")throw new Error("currently type shall be 'full': "+this.type);return this.asn1Obj=new p({explicit:!1,tag:this.tag,obj:this.asn1V}),this.hTLV=this.asn1Obj.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0)if(c.x509.GeneralNames.prototype.isPrototypeOf(a))this.type="full",this.tag="a0",this.asn1V=a;else if(a.full!==void 0)this.type="full",this.tag="a0",this.asn1V=new c.x509.GeneralNames(a.full);else throw new Error("This class supports GeneralNames only as argument")},xe(S.asn1.x509.DistributionPointName,S.asn1.ASN1Object),S.asn1.x509.CertificatePolicies=function(a){S.asn1.x509.CertificatePolicies.superclass.constructor.call(this,a);var l=S,c=l.asn1,p=c.x509,y=c.DERSequence,v=p.PolicyInformation;this.params=null,this.getExtnValueHex=function(){for(var x=[],C=0;C<this.params.array.length;C++)x.push(new v(this.params.array[C]));var O=new y({array:x});return this.asn1ExtnValue=O,this.asn1ExtnValue.tohex()},this.oid="2.5.29.32",a!==void 0&&(this.params=a)},xe(S.asn1.x509.CertificatePolicies,S.asn1.x509.Extension),S.asn1.x509.PolicyInformation=function(a){S.asn1.x509.PolicyInformation.superclass.constructor.call(this,a);var l=S.asn1,c=l.DERSequence,p=l.DERObjectIdentifier,y=l.x509.PolicyQualifierInfo;this.params=null,this.tohex=function(){if(this.params.policyoid===void 0&&this.params.array===void 0)throw new Error("parameter oid and array missing");var v=[new p(this.params.policyoid)];if(this.params.array!==void 0){for(var x=[],C=0;C<this.params.array.length;C++)x.push(new y(this.params.array[C]));x.length>0&&v.push(new c({array:x}))}var O=new c({array:v});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(this.params=a)},xe(S.asn1.x509.PolicyInformation,S.asn1.ASN1Object),S.asn1.x509.PolicyQualifierInfo=function(a){S.asn1.x509.PolicyQualifierInfo.superclass.constructor.call(this,a);var l=S.asn1,c=l.DERSequence,p=l.DERIA5String,y=l.DERObjectIdentifier,v=l.x509.UserNotice;this.params=null,this.tohex=function(){if(this.params.cps!==void 0){var x=new c({array:[new y({oid:"1.3.6.1.5.5.7.2.1"}),new p({str:this.params.cps})]});return x.tohex()}if(this.params.unotice!=null){var x=new c({array:[new y({oid:"1.3.6.1.5.5.7.2.2"}),new v(this.params.unotice)]});return x.tohex()}},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(this.params=a)},xe(S.asn1.x509.PolicyQualifierInfo,S.asn1.ASN1Object),S.asn1.x509.UserNotice=function(a){S.asn1.x509.UserNotice.superclass.constructor.call(this,a);var l=S.asn1.DERSequence;S.asn1.DERInteger;var c=S.asn1.x509.DisplayText,p=S.asn1.x509.NoticeReference;this.params=null,this.tohex=function(){var y=[];this.params.noticeref!==void 0&&y.push(new p(this.params.noticeref)),this.params.exptext!==void 0&&y.push(new c(this.params.exptext));var v=new l({array:y});return v.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(this.params=a)},xe(S.asn1.x509.UserNotice,S.asn1.ASN1Object),S.asn1.x509.NoticeReference=function(a){S.asn1.x509.NoticeReference.superclass.constructor.call(this,a);var l=S.asn1.DERSequence,c=S.asn1.DERInteger,p=S.asn1.x509.DisplayText;this.params=null,this.tohex=function(){var y=[];if(this.params.org!==void 0&&y.push(new p(this.params.org)),this.params.noticenum!==void 0){for(var v=[],x=this.params.noticenum,C=0;C<x.length;C++)v.push(new c(x[C]));y.push(new l({array:v}))}if(y.length==0)throw new Error("parameter is empty");var O=new l({array:y});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(this.params=a)},xe(S.asn1.x509.NoticeReference,S.asn1.ASN1Object),S.asn1.x509.DisplayText=function(a){S.asn1.x509.DisplayText.superclass.constructor.call(this,a),this.hT="0c",a!==void 0&&(a.type==="ia5"?this.hT="16":a.type==="vis"?this.hT="1a":a.type==="bmp"&&(this.hT="1e"))},xe(S.asn1.x509.DisplayText,S.asn1.DERAbstractString),S.asn1.x509.PolicyMappings=function(a){S.asn1.x509.PolicyMappings.superclass.constructor.call(this,a);var l=S,c=l.asn1;c.x509;var p=c.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){for(var y=this.params,v=[],x=0;x<y.array.length;x++){var C=y.array[x];v.push({seq:[{oid:C[0]},{oid:C[1]}]})}return this.asn1ExtnValue=p({seq:v}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.33",a!==void 0&&(this.params=a)},xe(S.asn1.x509.PolicyMappings,S.asn1.x509.Extension),S.asn1.x509.PolicyConstraints=function(a){S.asn1.x509.PolicyConstraints.superclass.constructor.call(this,a);var l=S,c=l.asn1;c.x509;var p=c.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){var y=this.params,v=[];return y.reqexp!=null&&v.push({tag:{tagi:"80",obj:{int:y.reqexp}}}),y.inhibit!=null&&v.push({tag:{tagi:"81",obj:{int:y.inhibit}}}),this.asn1ExtnValue=p({seq:v}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.36",a!==void 0&&(this.params=a)},xe(S.asn1.x509.PolicyConstraints,S.asn1.x509.Extension),S.asn1.x509.InhibitAnyPolicy=function(a){S.asn1.x509.InhibitAnyPolicy.superclass.constructor.call(this,a);var l=S,c=l.asn1;c.x509;var p=c.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=p({int:this.params.skip}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.54",a!==void 0&&(this.params=a)},xe(S.asn1.x509.InhibitAnyPolicy,S.asn1.x509.Extension),S.asn1.x509.NameConstraints=function(a){S.asn1.x509.NameConstraints.superclass.constructor.call(this,a);var l=S,c=l.asn1,p=c.x509,y=c.ASN1Util.newObject,v=p.GeneralSubtree;this.params=null,this.getExtnValueHex=function(){var x=this.params,C=[];if(x.permit!=null&&x.permit.length!=null){for(var O=[],_=0;_<x.permit.length;_++)O.push(new v(x.permit[_]));C.push({tag:{tagi:"a0",obj:{seq:O}}})}if(x.exclude!=null&&x.exclude.length!=null){for(var B=[],_=0;_<x.exclude.length;_++)B.push(new v(x.exclude[_]));C.push({tag:{tagi:"a1",obj:{seq:B}}})}return this.asn1ExtnValue=y({seq:C}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.30",a!==void 0&&(this.params=a)},xe(S.asn1.x509.NameConstraints,S.asn1.x509.Extension),S.asn1.x509.GeneralSubtree=function(a){S.asn1.x509.GeneralSubtree.superclass.constructor.call(this);var l=S.asn1,c=l.x509,p=c.GeneralName,y=l.ASN1Util.newObject;this.params=null,this.setByParam=function(v){this.params=v},this.tohex=function(){var v=this.params,x=[new p(v)];v.min!=null&&x.push({tag:{tagi:"80",obj:{int:v.min}}}),v.max!=null&&x.push({tag:{tagi:"81",obj:{int:v.max}}});var C=y({seq:x});return C.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.x509.GeneralSubtree,S.asn1.ASN1Object),S.asn1.x509.ExtKeyUsage=function(a){S.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,a);var l=S,c=l.asn1;this.setPurposeArray=function(p){this.asn1ExtnValue=new c.DERSequence;for(var y=0;y<p.length;y++){var v=new c.DERObjectIdentifier(p[y]);this.asn1ExtnValue.appendASN1Object(v)}},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.37",a!==void 0&&a.array!==void 0&&this.setPurposeArray(a.array)},xe(S.asn1.x509.ExtKeyUsage,S.asn1.x509.Extension),S.asn1.x509.AuthorityKeyIdentifier=function(a){S.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,a);var l=S,c=l.asn1,p=c.DERTaggedObject,y=c.x509.GeneralNames;l.crypto.Util.isKey,this.asn1KID=null,this.asn1CertIssuer=null,this.asn1CertSN=null,this.getExtnValueHex=function(){var v=new Array;this.asn1KID&&v.push(new p({explicit:!1,tag:"80",obj:this.asn1KID})),this.asn1CertIssuer&&v.push(new p({explicit:!1,tag:"a1",obj:new y([{dn:this.asn1CertIssuer}])})),this.asn1CertSN&&v.push(new p({explicit:!1,tag:"82",obj:this.asn1CertSN}));var x=new c.DERSequence({array:v});return this.asn1ExtnValue=x,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(v){if(v.str!==void 0||v.hex!==void 0)this.asn1KID=new S.asn1.DEROctetString(v);else if(typeof v=="object"&&S.crypto.Util.isKey(v)||typeof v=="string"&&v.indexOf("BEGIN ")!=-1){var x=v;typeof v=="string"&&(x=gt.getKey(v));var C=gt.getKeyID(x);this.asn1KID=new S.asn1.DEROctetString({hex:C})}},this.setCertIssuerByParam=function(v){v.str!==void 0||v.ldapstr!==void 0||v.hex!==void 0||v.certsubject!==void 0||v.certissuer!==void 0?this.asn1CertIssuer=new S.asn1.x509.X500Name(v):typeof v=="string"&&v.indexOf("BEGIN ")!=-1&&v.indexOf("CERTIFICATE")!=-1&&(this.asn1CertIssuer=new S.asn1.x509.X500Name({certissuer:v}))},this.setCertSNByParam=function(v){if(v.str!==void 0||v.bigint!==void 0||v.hex!==void 0)this.asn1CertSN=new S.asn1.DERInteger(v);else if(typeof v=="string"&&v.indexOf("BEGIN ")!=-1&&v.indexOf("CERTIFICATE")){var x=new tt;x.readCertPEM(v);var C=x.getSerialNumberHex();this.asn1CertSN=new S.asn1.DERInteger({hex:C})}},this.oid="2.5.29.35",a!==void 0&&(a.kid!==void 0&&this.setKIDByParam(a.kid),a.issuer!==void 0&&this.setCertIssuerByParam(a.issuer),a.sn!==void 0&&this.setCertSNByParam(a.sn),a.issuersn!==void 0&&typeof a.issuersn=="string"&&a.issuersn.indexOf("BEGIN ")!=-1&&a.issuersn.indexOf("CERTIFICATE")&&(this.setCertSNByParam(a.issuersn),this.setCertIssuerByParam(a.issuersn)))},xe(S.asn1.x509.AuthorityKeyIdentifier,S.asn1.x509.Extension),S.asn1.x509.SubjectKeyIdentifier=function(a){S.asn1.x509.SubjectKeyIdentifier.superclass.constructor.call(this,a);var l=S,c=l.asn1,p=c.DEROctetString;this.asn1KID=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=this.asn1KID,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(y){if(y.str!==void 0||y.hex!==void 0)this.asn1KID=new p(y);else if(typeof y=="object"&&S.crypto.Util.isKey(y)||typeof y=="string"&&y.indexOf("BEGIN")!=-1){var v=y;typeof y=="string"&&(v=gt.getKey(y));var x=gt.getKeyID(v);this.asn1KID=new S.asn1.DEROctetString({hex:x})}},this.oid="2.5.29.14",a!==void 0&&a.kid!==void 0&&this.setKIDByParam(a.kid)},xe(S.asn1.x509.SubjectKeyIdentifier,S.asn1.x509.Extension),S.asn1.x509.AuthorityInfoAccess=function(a){S.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,a),this.setAccessDescriptionArray=function(l){for(var c=new Array,p=S,y=p.asn1,v=y.DERSequence,x=y.DERObjectIdentifier,C=y.x509.GeneralName,O=0;O<l.length;O++){var _,B=l[O];if(B.ocsp!==void 0)_=new v({array:[new x({oid:"1.3.6.1.5.5.7.48.1"}),new C({uri:B.ocsp})]});else if(B.caissuer!==void 0)_=new v({array:[new x({oid:"1.3.6.1.5.5.7.48.2"}),new C({uri:B.caissuer})]});else throw new Error("unknown AccessMethod parameter: "+JSON.stringify(B));c.push(_)}this.asn1ExtnValue=new v({array:c})},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.1.1",a!==void 0&&a.array!==void 0&&this.setAccessDescriptionArray(a.array)},xe(S.asn1.x509.AuthorityInfoAccess,S.asn1.x509.Extension),S.asn1.x509.SubjectAltName=function(a){S.asn1.x509.SubjectAltName.superclass.constructor.call(this,a),this.setNameArray=function(l){this.asn1ExtnValue=new S.asn1.x509.GeneralNames(l)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.17",a!==void 0&&a.array!==void 0&&this.setNameArray(a.array)},xe(S.asn1.x509.SubjectAltName,S.asn1.x509.Extension),S.asn1.x509.IssuerAltName=function(a){S.asn1.x509.IssuerAltName.superclass.constructor.call(this,a),this.setNameArray=function(l){this.asn1ExtnValue=new S.asn1.x509.GeneralNames(l)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.18",a!==void 0&&a.array!==void 0&&this.setNameArray(a.array)},xe(S.asn1.x509.IssuerAltName,S.asn1.x509.Extension),S.asn1.x509.SubjectDirectoryAttributes=function(a){S.asn1.x509.SubjectDirectoryAttributes.superclass.constructor.call(this,a);var l=S.asn1,c=l.DERSequence,p=l.ASN1Util.newObject,y=l.x509.OID.name2oid;this.params=null,this.getExtnValueHex=function(){for(var v=[],x=0;x<this.params.array.length;x++){var C=this.params.array[x];if(C.attr!=null&&C.array!=null){var O={seq:[{oid:C.attr},{set:C.array}]};v.push(p(O));continue}var _={seq:[{oid:"1.2.3.4"},{set:[{utf8str:"DE"}]}]};if(C.attr=="dateOfBirth")_.seq[0].oid=y(C.attr),_.seq[1].set[0]={gentime:C.str};else if(C.attr=="placeOfBirth")_.seq[0].oid=y(C.attr),_.seq[1].set[0]={utf8str:C.str};else if(C.attr=="gender")_.seq[0].oid=y(C.attr),_.seq[1].set[0]={prnstr:C.str};else if(C.attr=="countryOfCitizenship")_.seq[0].oid=y(C.attr),_.seq[1].set[0]={prnstr:C.str};else if(C.attr=="countryOfResidence")_.seq[0].oid=y(C.attr),_.seq[1].set[0]={prnstr:C.str};else throw new Error("unsupported attribute: "+C.attr);v.push(new p(_))}var B=new c({array:v});return this.asn1ExtnValue=B,this.asn1ExtnValue.tohex()},this.oid="2.5.29.9",a!==void 0&&(this.params=a)},xe(S.asn1.x509.SubjectDirectoryAttributes,S.asn1.x509.Extension),S.asn1.x509.PrivateExtension=function(a){S.asn1.x509.PrivateExtension.superclass.constructor.call(this,a);var l=S,c=l.lang.String.isHex,p=l.asn1,y=p.x509.OID.name2oid,v=p.ASN1Util.newObject;this.params=null,this.setByParam=function(x){this.oid=y(x.extname),this.params=x},this.getExtnValueHex=function(){if(this.params.extname==null||this.params.extn==null)throw new Error("extname or extnhex not specified");var x=this.params.extn;if(typeof x=="string"&&c(x))return x;if(typeof x=="object")try{return v(x).tohex()}catch{}throw new Error("unsupported extn value")},a!=null&&this.setByParam(a)},xe(S.asn1.x509.PrivateExtension,S.asn1.x509.Extension),S.asn1.x509.CRL=function(a){S.asn1.x509.CRL.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.DERSequence,y=c.DERBitString,v=c.x509,x=v.AlgorithmIdentifier,C=v.TBSCertList;this.params=void 0,this.setByParam=function(O){this.params=O},this.sign=function(){var O=new C(this.params).tohex(),_=new S.crypto.Signature({alg:this.params.sigalg});_.init(this.params.cakey),_.updateHex(O);var B=_.sign();this.params.sighex=B},this.getPEM=function(){return dn(this.tohex(),"X509 CRL")},this.tohex=function(){var O=this.params;if(O.tbsobj==null&&(O.tbsobj=new C(O)),O.sighex==null&&O.cakey!=null&&this.sign(),O.sighex==null)throw new Error("sighex or cakey parameter not defined");var _=[];_.push(O.tbsobj),_.push(new x({name:O.sigalg})),_.push(new y({hex:"00"+O.sighex}));var B=new p({array:_});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&(this.params=a)},xe(S.asn1.x509.CRL,S.asn1.ASN1Object),S.asn1.x509.TBSCertList=function(a){S.asn1.x509.TBSCertList.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.DERInteger,y=c.DERSequence,v=c.DERTaggedObject;c.DERObjectIdentifier;var x=c.x509,C=x.AlgorithmIdentifier,O=x.Time,_=x.Extensions,B=x.X500Name;this.params=null,this.setByParam=function(N){this.params=N},this.getRevCertSequence=function(){for(var N=[],w=this.params.revcert,I=0;I<w.length;I++){var R=[new p(w[I].sn),new O(w[I].date)];w[I].ext!=null&&R.push(new _(w[I].ext)),N.push(new y({array:R}))}return new y({array:N})},this.tohex=function(){var N=[],w=this.params;if(w.version!=null){var I=w.version-1,R=new p({int:I});N.push(R)}if(N.push(new C({name:w.sigalg})),N.push(new B(w.issuer)),N.push(new O(w.thisupdate)),w.nextupdate!=null&&N.push(new O(w.nextupdate)),w.revcert!=null&&N.push(this.getRevCertSequence()),w.ext!=null){var F=new _(w.ext);N.push(new v({tag:"a0",explicit:!0,obj:F}))}var L=new y({array:N});return L.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.x509.TBSCertList,S.asn1.ASN1Object),S.asn1.x509.CRLEntry=function(a){S.asn1.x509.CRLEntry.superclass.constructor.call(this);var l=S,c=l.asn1;this.setCertSerial=function(p){this.sn=new c.DERInteger(p)},this.setRevocationDate=function(p){this.time=new c.x509.Time(p)},this.tohex=function(){var p=new c.DERSequence({array:[this.sn,this.time]});return this.TLV=p.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(a.time!==void 0&&this.setRevocationDate(a.time),a.sn!==void 0&&this.setCertSerial(a.sn))},xe(S.asn1.x509.CRLEntry,S.asn1.ASN1Object),S.asn1.x509.CRLNumber=function(a){S.asn1.x509.CRLNumber.superclass.constructor.call(this,a),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new S.asn1.DERInteger(this.params.num),this.asn1ExtnValue.tohex()},this.oid="2.5.29.20",a!=null&&(this.params=a)},xe(S.asn1.x509.CRLNumber,S.asn1.x509.Extension),S.asn1.x509.CRLReason=function(a){S.asn1.x509.CRLReason.superclass.constructor.call(this,a),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new S.asn1.DEREnumerated(this.params.code),this.asn1ExtnValue.tohex()},this.oid="2.5.29.21",a!=null&&(this.params=a)},xe(S.asn1.x509.CRLReason,S.asn1.x509.Extension),S.asn1.x509.OCSPNonce=function(a){S.asn1.x509.OCSPNonce.superclass.constructor.call(this,a),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new S.asn1.DEROctetString(this.params),this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.2",a!=null&&(this.params=a)},xe(S.asn1.x509.OCSPNonce,S.asn1.x509.Extension),S.asn1.x509.OCSPNoCheck=function(a){S.asn1.x509.OCSPNoCheck.superclass.constructor.call(this,a),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new S.asn1.DERNull,this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.5",a!=null&&(this.params=a)},xe(S.asn1.x509.OCSPNoCheck,S.asn1.x509.Extension),S.asn1.x509.AdobeTimeStamp=function(a){S.asn1.x509.AdobeTimeStamp.superclass.constructor.call(this,a);var l=S,c=l.asn1,p=c.DERInteger,y=c.DERBoolean,v=c.DERSequence,x=c.x509.GeneralName;this.params=null,this.getExtnValueHex=function(){var C=this.params,O=[new p(1)];return O.push(new x({uri:C.uri})),C.reqauth!=null&&O.push(new y(C.reqauth)),this.asn1ExtnValue=new v({array:O}),this.asn1ExtnValue.tohex()},this.oid="1.2.840.113583.1.1.9.1",a!==void 0&&this.setByParam(a)},xe(S.asn1.x509.AdobeTimeStamp,S.asn1.x509.Extension),S.asn1.x509.X500Name=function(a){S.asn1.x509.X500Name.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var l=S,c=l.asn1,p=c.x509,y=p.RDN;this.setByString=function(v,x){x!==void 0&&(this.sRule=x);var C=v.split("/");C.shift();for(var O=[],_=0;_<C.length;_++)if(C[_].match(/^[^=]+=.+$/))O.push(C[_]);else{var B=O.length-1;O[B]=O[B]+"/"+C[_]}for(var _=0;_<O.length;_++)this.asn1Array.push(new y({str:O[_],rule:this.sRule}))},this.setByLdapString=function(v,x){x!==void 0&&(this.sRule=x);var C=p.X500Name.ldapToCompat(v);this.setByString(C,x)},this.setByObject=function(v,x){x!==void 0&&(this.sRule=x);for(var C in v)if(v.hasOwnProperty(C)){var O=new y({str:C+"="+v[C],rule:this.sRule});this.asn1Array?this.asn1Array.push(O):this.asn1Array=[O]}},this.setByParam=function(v){if(v.rule!==void 0&&(this.sRule=v.rule),v.array!==void 0)this.paramArray=v.array;else if(v.str!==void 0)this.setByString(v.str);else if(v.ldapstr!==void 0)this.setByLdapString(v.ldapstr);else if(v.hex!==void 0)this.hTLV=v.hex;else if(v.certissuer!==void 0){var x=new tt;x.readCertPEM(v.certissuer),this.hTLV=x.getIssuerHex()}else if(v.certsubject!==void 0){var x=new tt;x.readCertPEM(v.certsubject),this.hTLV=x.getSubjectHex()}else typeof v=="object"&&v.certsubject===void 0&&v.certissuer===void 0&&this.setByObject(v)},this.tohex=function(){if(typeof this.hTLV=="string")return this.hTLV;if(this.asn1Array.length==0&&this.paramArray.length>0)for(var v=0;v<this.paramArray.length;v++){var x={array:this.paramArray[v]};this.sRule!="utf8"&&(x.rule=this.sRule);var C=new y(x);this.asn1Array.push(C)}var O=new c.DERSequence({array:this.asn1Array});return this.hTLV=O.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.x509.X500Name,S.asn1.ASN1Object),S.asn1.x509.X500Name.compatToLDAP=function(a){if(a.substr(0,1)!=="/")throw"malformed input";a=a.substr(1);var l=a.split("/");return l.reverse(),l=l.map(function(c){return c.replace(/,/,"\\,")}),l.join(",")},S.asn1.x509.X500Name.onelineToLDAP=function(a){return S.asn1.x509.X500Name.compatToLDAP(a)},S.asn1.x509.X500Name.ldapToCompat=function(a){for(var l=a.split(","),c=!1,p=[],y=0;l.length>0;y++){var v=l.shift();if(c===!0){var x=p.pop(),C=(x+","+v).replace(/\\,/g,",");p.push(C),c=!1}else p.push(v);v.substr(-1,1)==="\\"&&(c=!0)}return p=p.map(function(O){return O.replace("/","\\/")}),p.reverse(),"/"+p.join("/")},S.asn1.x509.X500Name.ldapToOneline=function(a){return S.asn1.x509.X500Name.ldapToCompat(a)},S.asn1.x509.RDN=function(a){S.asn1.x509.RDN.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var l=S.asn1.x509.AttributeTypeAndValue;this.setByParam=function(c){c.rule!==void 0&&(this.sRule=c.rule),c.str!==void 0&&this.addByMultiValuedString(c.str),c.array!==void 0&&(this.paramArray=c.array)},this.addByString=function(c){this.asn1Array.push(new S.asn1.x509.AttributeTypeAndValue({str:c,rule:this.sRule}))},this.addByMultiValuedString=function(c){for(var p=S.asn1.x509.RDN.parseString(c),y=0;y<p.length;y++)this.addByString(p[y])},this.tohex=function(){if(this.asn1Array.length==0&&this.paramArray.length>0)for(var c=0;c<this.paramArray.length;c++){var p=this.paramArray[c];p.rule!==void 0&&this.sRule!="utf8"&&(p.rule=this.sRule);var y=new l(p);this.asn1Array.push(y)}var v=new S.asn1.DERSet({array:this.asn1Array});return this.TLV=v.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.x509.RDN,S.asn1.ASN1Object),S.asn1.x509.RDN.parseString=function(a){for(var l=a.split(/\+/),c=!1,p=[],y=0;l.length>0;y++){var v=l.shift();if(c===!0){var x=p.pop(),C=(x+"+"+v).replace(/\\\+/g,"+");p.push(C),c=!1}else p.push(v);v.substr(-1,1)==="\\"&&(c=!0)}for(var O=!1,_=[],y=0;p.length>0;y++){var v=p.shift();if(O===!0){var B=_.pop();if(v.match(/"$/)){var C=(B+"+"+v).replace(/^([^=]+)="(.*)"$/,"$1=$2");_.push(C),O=!1}else _.push(B+"+"+v)}else _.push(v);v.match(/^[^=]+="/)&&(O=!0)}return _},S.asn1.x509.AttributeTypeAndValue=function(a){S.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this),this.sRule="utf8",this.sType=null,this.sValue=null,this.dsType=null;var l=S,c=l.asn1,p=c.DERSequence,y=c.DERUTF8String,v=c.DERPrintableString,x=c.DERTeletexString,C=c.DERIA5String,O=c.DERVisibleString,_=c.DERBMPString,B=l.lang.String.isMail,N=l.lang.String.isPrintable;this.setByParam=function(w){if(w.rule!==void 0&&(this.sRule=w.rule),w.ds!==void 0&&(this.dsType=w.ds),w.value===void 0&&w.str!==void 0){var I=w.str,R=I.match(/^([^=]+)=(.+)$/);if(R)this.sType=R[1],this.sValue=R[2];else throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr)}else this.sType=w.type,this.sValue=w.value},this.setByString=function(w,I){I!==void 0&&(this.sRule=I);var R=w.match(/^([^=]+)=(.+)$/);if(R)this.setByAttrTypeAndValueStr(R[1],R[2]);else throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr)},this._getDsType=function(){var w=this.sType,I=this.sValue,R=this.sRule;return R==="prn"?w=="CN"&&B(I)?"ia5":N(I)?"prn":"utf8":R==="utf8"?w=="CN"&&B(I)?"ia5":w=="C"?"prn":"utf8":"utf8"},this.setByAttrTypeAndValueStr=function(w,I,R){R!==void 0&&(this.sRule=R),this.sType=w,this.sValue=I},this.getValueObj=function(w,I){if(w=="utf8")return new y({str:I});if(w=="prn")return new v({str:I});if(w=="tel")return new x({str:I});if(w=="ia5")return new C({str:I});if(w=="vis")return new O({str:I});if(w=="bmp")return new _({str:I});throw new Error("unsupported directory string type: type="+w+" value="+I)},this.tohex=function(){this.dsType==null&&(this.dsType=this._getDsType());var w=S.asn1.x509.OID.atype2obj(this.sType),I=this.getValueObj(this.dsType,this.sValue),R=new p({array:[w,I]});return this.TLV=R.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.x509.AttributeTypeAndValue,S.asn1.ASN1Object),S.asn1.x509.SubjectPublicKeyInfo=function(a){S.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.DERInteger,y=c.DERBitString,v=c.DERObjectIdentifier,x=c.DERSequence,C=c.ASN1Util.newObject,O=c.x509,_=O.AlgorithmIdentifier,B=l.crypto;B.ECDSA,B.DSA,this.getASN1Object=function(){if(this.asn1AlgId==null||this.asn1SubjPKey==null)throw"algId and/or subjPubKey not set";var N=new x({array:[this.asn1AlgId,this.asn1SubjPKey]});return N},this.tohex=function(){var N=this.getASN1Object();return this.hTLV=N.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.setPubKey=function(N){try{if(N instanceof Je){var w=C({seq:[{int:{bigint:N.n}},{int:{int:N.e}}]}),I=w.tohex();this.asn1AlgId=new _({name:"rsaEncryption"}),this.asn1SubjPKey=new y({hex:"00"+I})}}catch{}try{if(N instanceof S.crypto.ECDSA){var R=new v({name:N.curveName});this.asn1AlgId=new _({name:"ecPublicKey",asn1params:R}),this.asn1SubjPKey=new y({hex:"00"+N.pubKeyHex})}}catch{}try{if(N instanceof S.crypto.DSA){var R=new C({seq:[{int:{bigint:N.p}},{int:{bigint:N.q}},{int:{bigint:N.g}}]});this.asn1AlgId=new _({name:"dsa",asn1params:R});var F=new p({bigint:N.y});this.asn1SubjPKey=new y({hex:"00"+F.tohex()})}}catch{}},a!==void 0&&this.setPubKey(a)},xe(S.asn1.x509.SubjectPublicKeyInfo,S.asn1.ASN1Object),S.asn1.x509.Time=function(a){S.asn1.x509.Time.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.DERUTCTime,y=c.DERGeneralizedTime;this.params=null,this.type=null,this.setTimeParams=function(v){this.timeParams=v},this.setByParam=function(v){this.params=v},this.getType=function(v){return v.match(/^[0-9]{12}Z$/)?"utc":v.match(/^[0-9]{14}Z$/)?"gen":v.match(/^[0-9]{12}\.[0-9]+Z$/)?"utc":v.match(/^[0-9]{14}\.[0-9]+Z$/)?"gen":null},this.tohex=function(){var v=this.params,x=null;if(typeof v=="string"&&(v={str:v}),v!=null&&v.str&&(v.type==null||v.type==null)&&(v.type=this.getType(v.str)),v!=null&&v.str?(v.type=="utc"&&(x=new p(v.str)),v.type=="gen"&&(x=new y(v.str))):this.type=="gen"?x=new y:x=new p,x==null)throw new Error("wrong setting for Time");return this.TLV=x.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},S.asn1.x509.Time_bak=function(a){S.asn1.x509.Time_bak.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.DERUTCTime,y=c.DERGeneralizedTime;this.setTimeParams=function(v){this.timeParams=v},this.tohex=function(){var v=null;return this.timeParams!=null?this.type=="utc"?v=new p(this.timeParams):v=new y(this.timeParams):this.type=="utc"?v=new p:v=new y,this.TLV=v.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},this.type="utc",a!==void 0&&(a.type!==void 0?this.type=a.type:a.str!==void 0&&(a.str.match(/^[0-9]{12}Z$/)&&(this.type="utc"),a.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=a)},xe(S.asn1.x509.Time,S.asn1.ASN1Object),S.asn1.x509.AlgorithmIdentifier=function(a){S.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this),this.nameAlg=null,this.asn1Alg=null,this.asn1Params=null,this.paramEmpty=!1;var l=S,c=l.asn1,p=c.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;if(this.tohex=function(){if(this.nameAlg===null&&this.asn1Alg===null)throw new Error("algorithm not specified");if(this.nameAlg!==null){var v=null;for(var x in p)x===this.nameAlg&&(v=p[x]);if(v!==null)return this.hTLV=v,this.hTLV}this.nameAlg!==null&&this.asn1Alg===null&&(this.asn1Alg=c.x509.OID.name2obj(this.nameAlg));var C=[this.asn1Alg];this.asn1Params!==null&&C.push(this.asn1Params);var O=new c.DERSequence({array:C});return this.hTLV=O.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(a.name!==void 0&&(this.nameAlg=a.name),a.asn1params!==void 0&&(this.asn1Params=a.asn1params),a.paramempty!==void 0&&(this.paramEmpty=a.paramempty)),this.asn1Params===null&&this.paramEmpty===!1&&this.nameAlg!==null){this.nameAlg.name!==void 0&&(this.nameAlg=this.nameAlg.name);var y=this.nameAlg.toLowerCase();y.substr(-7,7)!=="withdsa"&&y.substr(-9,9)!=="withecdsa"&&(this.asn1Params=new c.DERNull)}},xe(S.asn1.x509.AlgorithmIdentifier,S.asn1.ASN1Object),S.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"},S.asn1.x509.GeneralName=function(a){S.asn1.x509.GeneralName.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.x509,y=p.X500Name,v=p.OtherName,x=c.DERIA5String;c.DERPrintableString;var C=c.DEROctetString,O=c.DERTaggedObject,_=c.ASN1Object,B=Error;this.params=null,this.setByParam=function(N){this.params=N},this.tohex=function(){var N=this.params,w,R,I,R=!1;if(N.other!==void 0)w="a0",I=new v(N.other);else if(N.rfc822!==void 0)w="81",I=new x({str:N.rfc822});else if(N.dns!==void 0)w="82",I=new x({str:N.dns});else if(N.dn!==void 0)w="a4",R=!0,typeof N.dn=="string"?I=new y({str:N.dn}):N.dn instanceof S.asn1.x509.X500Name?I=N.dn:I=new y(N.dn);else if(N.ldapdn!==void 0)w="a4",R=!0,I=new y({ldapstr:N.ldapdn});else if(N.certissuer!==void 0||N.certsubj!==void 0){w="a4",R=!0;var F,L,V=null;if(N.certsubj!==void 0?(F=!1,L=N.certsubj):(F=!0,L=N.certissuer),L.match(/^[0-9A-Fa-f]+$/),L.indexOf("-----BEGIN ")!=-1&&(V=zt(L)),V==null)throw new Error("certsubj/certissuer not cert");var te=new tt;te.hex=V;var ue;F?ue=te.getIssuerHex():ue=te.getSubjectHex(),I=new _,I.hTLV=ue}else if(N.uri!==void 0)w="86",I=new x({str:N.uri});else if(N.ip!==void 0){w="87";var ae,le=N.ip;try{if(le.match(/^[0-9a-f]+$/)){var H=le.length;if(H==8||H==16||H==32||H==64)ae=le;else throw"err"}else ae=Hu(le)}catch(J){throw new B("malformed IP address: "+N.ip+":"+J.message)}I=new C({hex:ae})}else throw new B("improper params");var W=new O({tag:w,explicit:R,obj:I});return W.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.x509.GeneralName,S.asn1.ASN1Object),S.asn1.x509.GeneralNames=function(a){S.asn1.x509.GeneralNames.superclass.constructor.call(this);var l=S,c=l.asn1;this.setByParamArray=function(p){for(var y=0;y<p.length;y++){var v=new c.x509.GeneralName(p[y]);this.asn1Array.push(v)}},this.tohex=function(){var p=new c.DERSequence({array:this.asn1Array});return p.tohex()},this.getEncodedHex=function(){return this.tohex()},this.asn1Array=new Array,typeof a<"u"&&this.setByParamArray(a)},xe(S.asn1.x509.GeneralNames,S.asn1.ASN1Object),S.asn1.x509.OtherName=function(a){S.asn1.x509.OtherName.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.DERObjectIdentifier,y=c.DERSequence,v=c.ASN1Util.newObject;this.params=null,this.setByParam=function(x){this.params=x},this.tohex=function(){var x=this.params;if(x.oid==null||x.value==null)throw new Error("oid or value not specified");var C=new p({oid:x.oid}),O=v({tag:{tag:"a0",explicit:!0,obj:x.value}}),_=new y({array:[C,O]});return _.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.x509.OtherName,S.asn1.ASN1Object),S.asn1.x509.OID=new function(){var a=S.asn1.DERObjectIdentifier;this.name2oidList={sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",policyMappings:"2.5.29.33",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",inhibitAnyPolicy:"2.5.29.54",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",smtpUTF8Mailbox:"1.3.6.1.5.5.7.8.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1",smimeMailboxLegacy:"2.23.140.1.5.1.1",smimeMailboxMulti:"2.23.140.1.5.1.2",smimeMailboxStrict:"2.23.140.1.5.1.3",smimeOrganizationLegacy:"2.23.140.1.5.2.1",smimeOrganizationMulti:"2.23.140.1.5.2.2",smimeOrganizationStrict:"2.23.140.1.5.2.3",smimeSponsorLegacy:"2.23.140.1.5.3.1",smimeSponsorMulti:"2.23.140.1.5.3.2",smimeSponsorStrict:"2.23.140.1.5.3.3",smimeIndividualLegacy:"2.23.140.1.5.4.1",smimeIndividualMulti:"2.23.140.1.5.4.2",smimeIndividualStrict:"2.23.140.1.5.4.3"},this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",GN:"2.5.4.42",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.objCache={},this.name2obj=function(l){if(typeof this.objCache[l]<"u")return this.objCache[l];if(typeof this.name2oidList[l]>"u")throw"Name of ObjectIdentifier not defined: "+l;var c=this.name2oidList[l],p=new a({oid:c});return this.objCache[l]=p,p},this.atype2obj=function(l){if(this.objCache[l]!==void 0)return this.objCache[l];var c;if(l.match(/^\d+\.\d+\.[0-9.]+$/))c=l;else if(this.atype2oidList[l]!==void 0)c=this.atype2oidList[l];else if(this.name2oidList[l]!==void 0)c=this.name2oidList[l];else throw new Error("AttributeType name undefined: "+l);var p=new a({oid:c});return this.objCache[l]=p,p},this.registerOIDs=function(l){if(this.checkOIDs(l))for(var c in l)this.name2oidList[c]=l[c]},this.checkOIDs=function(l){try{var c=Object.keys(l);return c.length==0?!1:(c.map(function(p,y,v){var x=this[p];if(!x.match(/^[0-2]\.[0-9.]+$/))throw new Error("value is not OID")},l),!0)}catch{return!1}}},S.asn1.x509.OID.oid2name=function(a){var l=S.asn1.x509.OID.name2oidList;for(var c in l)if(l[c]==a)return c;return""},S.asn1.x509.OID.oid2atype=function(a){var l=S.asn1.x509.OID.atype2oidList;for(var c in l)if(l[c]==a)return c;return a},S.asn1.x509.OID.name2oid=function(a){if(a.match(/^[0-9.]+$/))return a;var l=S.asn1.x509.OID.name2oidList;return l[a]===void 0?"":l[a]},S.asn1.x509.X509Util={},S.asn1.x509.X509Util.newCertPEM=function(a){var l=S.asn1.x509;l.TBSCertificate;var c=l.Certificate,p=new c(a);return p.getPEM()},(typeof S>"u"||!S)&&(S={}),(typeof S.asn1>"u"||!S.asn1)&&(S.asn1={}),(typeof S.asn1.cms>"u"||!S.asn1.cms)&&(S.asn1.cms={}),S.asn1.cms.Attribute=function(a){var l=Error,c=S,p=c.asn1,y=p.DERSequence,v=p.DERSet,x=p.DERObjectIdentifier;this.params=null,this.typeOid=null,this.setByParam=function(C){this.params=C},this.getValueArray=function(){throw new l("not yet implemented abstract")},this.tohex=function(){var C=new x({oid:this.typeOid}),O=new v({array:this.getValueArray()}),_=new y({array:[C,O]});return _.tohex()},this.getEncodedHex=function(){return this.tohex()}},xe(S.asn1.cms.Attribute,S.asn1.ASN1Object),S.asn1.cms.ContentType=function(a){var l=S,c=l.asn1;c.cms.ContentType.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.3",this.getValueArray=function(){var p=new c.DERObjectIdentifier(this.params.type);return[p]},a!=null&&this.setByParam(a)},xe(S.asn1.cms.ContentType,S.asn1.cms.Attribute),S.asn1.cms.MessageDigest=function(a){var l=S,c=l.asn1,p=c.DEROctetString,y=c.cms;y.MessageDigest.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.4",this.getValueArray=function(){var v=new p(this.params);return[v]},a!=null&&this.setByParam(a)},xe(S.asn1.cms.MessageDigest,S.asn1.cms.Attribute),S.asn1.cms.SigningTime=function(a){var l=S,c=l.asn1;c.cms.SigningTime.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.5",this.getValueArray=function(){var p=new c.x509.Time(this.params);return[p]},a!=null&&this.setByParam(a)},xe(S.asn1.cms.SigningTime,S.asn1.cms.Attribute),S.asn1.cms.SigningCertificate=function(a){var l=Error,c=S,p=c.asn1,y=p.DERSequence,v=p.cms,x=v.ESSCertID;c.crypto,v.SigningCertificate.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.12",this.getValueArray=function(){if(this.params==null||this.params==null||this.params.array==null)throw new l("parameter 'array' not specified");for(var C=this.params.array,O=[],_=0;_<C.length;_++){var B=C[_];a.hasis==!1&&typeof B=="string"&&(B.indexOf("-----BEGIN")!=-1||Fe.isASN1HEX(B))&&(B={cert:B}),B.hasis!=!1&&a.hasis==!1&&(B.hasis=!1),O.push(new x(B))}var N=new y({array:O}),w=new y({array:[N]});return[w]},a!=null&&this.setByParam(a)},xe(S.asn1.cms.SigningCertificate,S.asn1.cms.Attribute),S.asn1.cms.ESSCertID=function(a){S.asn1.cms.ESSCertID.superclass.constructor.call(this);var l=Error,c=S,p=c.asn1,y=p.DEROctetString,v=p.DERSequence,x=p.cms.IssuerSerial;this.params=null,this.getCertHash=function(C,O){if(C.hash!=null)return C.hash;if(typeof C=="string"&&C.indexOf("-----BEGIN")==-1&&!Fe.isASN1HEX(C))return C;var _;if(typeof C=="string")_=C;else if(C.cert!=null)_=C.cert;else throw new l("hash nor cert unspecified");var B;_.indexOf("-----BEGIN")!=-1?B=zt(_):B=_,typeof C=="string"&&(C.indexOf("-----BEGIN")!=-1?B=zt(C):Fe.isASN1HEX(C)&&(B=C));var N;if(C.alg!=null)N=C.alg;else if(O!=null)N=O;else throw new l("hash alg unspecified");return c.crypto.Util.hashHex(B,N)},this.tohex=function(){var C=this.params,O=this.getCertHash(C,"sha1"),_=[];_.push(new y({hex:O})),(typeof C=="string"&&C.indexOf("-----BEGIN")!=-1||C.cert!=null&&C.hasis!=!1||C.issuer!=null&&C.serial!=null)&&_.push(new x(C));var B=new v({array:_});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cms.ESSCertID,S.asn1.ASN1Object),S.asn1.cms.SigningCertificateV2=function(a){var l=Error,c=S,p=c.asn1,y=p.DERSequence;p.x509;var v=p.cms,x=v.ESSCertIDv2;c.crypto,v.SigningCertificateV2.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.47",this.getValueArray=function(){if(this.params==null||this.params==null||this.params.array==null)throw new l("parameter 'array' not specified");for(var C=this.params.array,O=[],_=0;_<C.length;_++){var B=C[_];(a.alg!=null||a.hasis==!1)&&typeof B=="string"&&(B.indexOf("-----BEGIN")!=-1||Fe.isASN1HEX(B))&&(B={cert:B}),B.alg==null&&a.alg!=null&&(B.alg=a.alg),B.hasis!=!1&&a.hasis==!1&&(B.hasis=!1),O.push(new x(B))}var N=new y({array:O}),w=new y({array:[N]});return[w]},a!=null&&this.setByParam(a)},xe(S.asn1.cms.SigningCertificateV2,S.asn1.cms.Attribute),S.asn1.cms.ESSCertIDv2=function(a){S.asn1.cms.ESSCertIDv2.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.DEROctetString,y=c.DERSequence,v=c.cms.IssuerSerial,x=c.x509.AlgorithmIdentifier;this.params=null,this.tohex=function(){var C=this.params,O=this.getCertHash(C,"sha256"),_=[];C.alg!=null&&C.alg!="sha256"&&_.push(new x({name:C.alg})),_.push(new p({hex:O})),(typeof C=="string"&&C.indexOf("-----BEGIN")!=-1||C.cert!=null&&C.hasis!=!1||C.issuer!=null&&C.serial!=null)&&_.push(new v(C));var B=new y({array:_});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cms.ESSCertIDv2,S.asn1.cms.ESSCertID),S.asn1.cms.IssuerSerial=function(a){var l=Error,c=S,p=c.asn1,y=p.DERInteger,v=p.DERSequence,x=p.cms,C=p.x509,O=C.GeneralNames,_=tt;x.IssuerSerial.superclass.constructor.call(this),this.setByParam=function(B){this.params=B},this.tohex=function(){var B=this.params,N,w;if(typeof B=="string"&&B.indexOf("-----BEGIN")!=-1||B.cert!=null){var I;B.cert!=null?I=B.cert:I=B;var R=new _;R.readCertPEM(I),N=R.getIssuer(),w={hex:R.getSerialNumberHex()}}else if(B.issuer!=null&&B.serial)N=B.issuer,w=B.serial;else throw new l("cert or issuer and serial parameter not specified");var F=new O([{dn:N}]),L=new y(w),V=new v({array:[F,L]});return V.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cms.IssuerSerial,S.asn1.ASN1Object),S.asn1.cms.SignerIdentifier=function(a){var l=S,c=l.asn1;c.DERInteger,c.DERSequence;var p=c.cms,y=p.IssuerAndSerialNumber,v=p.SubjectKeyIdentifier,x=c.x509;x.X500Name,p.SignerIdentifier.superclass.constructor.call(this),this.params=null,this.tohex=function(){var C=this.params;if(C.type=="isssn"){var O=new y(C);return O.tohex()}else if(C.type=="skid"){var _=new v(C);return _.tohex()}else throw new Error("wrong property for isssn or skid")},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cms.SignerIdentifier,S.asn1.ASN1Object),S.asn1.cms.IssuerAndSerialNumber=function(a){var l=S,c=l.asn1,p=c.DERInteger,y=c.DERSequence,v=c.cms,x=c.x509,C=x.X500Name,O=tt,_=Error;v.IssuerAndSerialNumber.superclass.constructor.call(this),this.params=null,this.tohex=function(){var B=this.params,N,w;if(typeof B=="string"&&B.indexOf("-----BEGIN")!=-1||B.cert!=null){var I;B.cert!=null?I=B.cert:I=B;var R=new O;R.readCertPEM(I),N=R.getIssuer(),w={hex:R.getSerialNumberHex()}}else if(B.issuer!=null&&B.serial)N=B.issuer,w=B.serial;else throw new _("cert or issuer and serial parameter not specified");var F=new C(N),L=new p(w),V=new y({array:[F,L]});return V.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(B){this.params=B},a!=null&&this.setByParam(a)},xe(S.asn1.cms.IssuerAndSerialNumber,S.asn1.ASN1Object),S.asn1.cms.SubjectKeyIdentifier=function(a){var l=S,c=l.asn1;c.DERInteger,c.DERSequence;var p=c.ASN1Util.newObject,y=c.cms;y.IssuerAndSerialName,y.SubjectKeyIdentifier;var v=c.x509;v.X500Name;var x=tt,C=Error;y.SubjectKeyIdentifier.superclass.constructor.call(this),this.tohex=function(){var O=this.params;if(O.cert==null&&O.skid==null)throw new C("property cert nor skid undefined");var _;if(O.cert!=null){var B=new x(O.cert),N=B.getExtSubjectKeyIdentifier();_=N.kid.hex}else O.skid!=null&&(_=O.skid);var w=p({tag:{tage:"a0",obj:{octstr:{hex:_}}}});return w.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cms.SubjectKeyIdentifier,S.asn1.ASN1Object),S.asn1.cms.AttributeList=function(a){var l=Error,c=S,p=c.asn1,y=p.DERSet,v=p.cms;v.AttributeList.superclass.constructor.call(this),this.params=null,this.hTLV=null,this.setByParam=function(x){this.params=x},this.tohex=function(){var x=this.params;if(this.hTLV!=null)return this.hTLV;var C=!0;x.sortflag!=null&&(C=x.sortflag);for(var O=x.array,_=[],B=0;B<O.length;B++){var N=O[B],w=N.attr;if(w=="contentType")_.push(new v.ContentType(N));else if(w=="messageDigest")_.push(new v.MessageDigest(N));else if(w=="signingTime")_.push(new v.SigningTime(N));else if(w=="signingCertificate")_.push(new v.SigningCertificate(N));else if(w=="signingCertificateV2")_.push(new v.SigningCertificateV2(N));else if(w=="signaturePolicyIdentifier")_.push(new S.asn1.cades.SignaturePolicyIdentifier(N));else if(w=="signatureTimeStamp"||w=="timeStampToken")_.push(new S.asn1.cades.SignatureTimeStamp(N));else throw new l("unknown attr: "+w)}var I=new y({array:_,sortflag:C});return this.hTLV=I.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cms.AttributeList,S.asn1.ASN1Object),S.asn1.cms.SignerInfo=function(a){var l=Error,c=S,p=c.asn1,y=p.DERInteger,v=p.DEROctetString,x=p.DERSequence,C=p.DERTaggedObject,O=p.cms,_=O.SignerIdentifier,B=O.AttributeList;O.ContentType,O.EncapsulatedContentInfo,O.MessageDigest,O.SignedData;var N=p.x509,w=N.AlgorithmIdentifier,I=c.crypto,R=gt;O.SignerInfo.superclass.constructor.call(this),this.params=null,this.sign=function(){var F=this.params,L=F.sigalg,V=new B(F.sattrs).tohex(),te=R.getKey(F.signkey),ue=new I.Signature({alg:L});ue.init(te),ue.updateHex(V);var ae=ue.sign();F.sighex=ae},this.tohex=function(){var F=this.params,L=[];if(L.push(new y({int:F.version})),L.push(new _(F.id)),L.push(new w({name:F.hashalg})),F.sattrs!=null){var V=new B(F.sattrs);try{L.push(new C({tag:"a0",explicit:!1,obj:V}))}catch(ue){throw new l("si sattr error: "+ue)}}if(F.sigalgfield!=null?L.push(new w({name:F.sigalgfield})):L.push(new w({name:F.sigalg})),F.sighex==null&&F.signkey!=null&&this.sign(),L.push(new v({hex:F.sighex})),F.uattrs!=null){var V=new B(F.uattrs);try{L.push(new C({tag:"a1",explicit:!1,obj:V}))}catch(ae){throw new l("si uattr error: "+ae)}}var te=new x({array:L});return te.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cms.SignerInfo,S.asn1.ASN1Object),S.asn1.cms.EncapsulatedContentInfo=function(a){var l=S,c=l.asn1,p=c.DERTaggedObject,y=c.DERSequence,v=c.DERObjectIdentifier,x=c.DEROctetString,C=c.cms;C.EncapsulatedContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var O=this.params,_=[];if(_.push(new v(O.type)),O.content!=null&&(O.content.hex!=null||O.content.str!=null)&&O.isDetached!=!0){var B=new x(O.content),N=new p({tag:"a0",explicit:!0,obj:B});_.push(N)}var w=new y({array:_});return w.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(O){this.params=O},a!=null&&this.setByParam(a)},xe(S.asn1.cms.EncapsulatedContentInfo,S.asn1.ASN1Object),S.asn1.cms.ContentInfo=function(a){var l=S,c=l.asn1,p=c.DERTaggedObject,y=c.DERSequence,v=c.DERObjectIdentifier,x=c.x509;x.OID.name2obj,S.asn1.cms.ContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var C=this.params,O=[];O.push(new v(C.type));var _=new p({tag:"a0",explicit:!0,obj:C.obj});O.push(_);var B=new y({array:O});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(C){this.params=C},a!=null&&this.setByParam(a)},xe(S.asn1.cms.ContentInfo,S.asn1.ASN1Object),S.asn1.cms.SignedData=function(a){var l=S,c=l.asn1;c.ASN1Object;var p=c.DERInteger,y=c.DERSet,v=c.DERSequence;c.DERTaggedObject;var x=c.cms,C=x.EncapsulatedContentInfo,O=x.SignerInfo,_=x.ContentInfo,B=x.CertificateSet,N=x.RevocationInfoChoices,w=c.x509,I=w.AlgorithmIdentifier;S.asn1.cms.SignedData.superclass.constructor.call(this),this.params=null,this.checkAndFixParam=function(){var R=this.params;this._setDigestAlgs(R),this._setContentTypeByEContent(R),this._setMessageDigestByEContent(R),this._setSignerInfoVersion(R),this._setSignedDataVersion(R)},this._setDigestAlgs=function(R){for(var F={},L=R.sinfos,V=0;V<L.length;V++){var te=L[V];F[te.hashalg]=1}R.hashalgs=Object.keys(F).sort()},this._setContentTypeByEContent=function(R){for(var F=R.econtent.type,L=R.sinfos,V=0;V<L.length;V++){var te=L[V],ue=this._getAttrParamByName(te,"contentType");ue.type=F}},this._setMessageDigestByEContent=function(R){var F=R.econtent;R.econtent.type;var L=F.content.hex;L==null&&F.type=="data"&&F.content.str!=null&&(L=Pn(F.content.str));for(var V=R.sinfos,te=0;te<V.length;te++){var ue=V[te],ae=ue.hashalg,le=this._getAttrParamByName(ue,"messageDigest"),H=S.crypto.Util.hashHex(L,ae);le.hex=H}},this._getAttrParamByName=function(R,F){for(var L=R.sattrs.array,V=0;V<L.length;V++)if(L[V].attr==F)return L[V]},this._setSignerInfoVersion=function(R){for(var F=R.sinfos,L=0;L<F.length;L++){var V=F[L],te=1;V.id.type=="skid"&&(te=3),V.version=te}},this._setSignedDataVersion=function(R){var F=this._getSignedDataVersion(R);R.version=F},this._getSignedDataVersion=function(R){if(R.revinfos!=null)for(var F=R.revinfos,L=0;L<F.length;L++){var V=F[L];if(V.ocsp!=null)return 5}for(var te=R.sinfos,L=0;L<te.length;L++){var ue=R.sinfos[L];if(ue.version==3)return 3}return R.econtent.type!="data"?3:1},this.tohex=function(){var R=this.params;this.getEncodedHexPrepare!=null&&this.getEncodedHexPrepare(),R.fixed!=!0&&this.checkAndFixParam();var F=[];F.push(new p({int:R.version}));for(var L=[],V=0;V<R.hashalgs.length;V++){var te=R.hashalgs[V];L.push(new I({name:te}))}F.push(new y({array:L})),F.push(new C(R.econtent)),R.certs!=null&&F.push(new B(R.certs)),R.revinfos!=null&&F.push(new N(R.revinfos));for(var ue=[],V=0;V<R.sinfos.length;V++){var ae=R.sinfos[V];ue.push(new O(ae))}F.push(new y({array:ue}));var le=new v({array:F});return le.tohex()},this.getEncodedHex=function(){return this.tohex()},this.getContentInfo=function(){var R=new _({type:"signed-data",obj:this});return R},this.getContentInfoEncodedHex=function(){return this.getContentInfo().tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cms.SignedData,S.asn1.ASN1Object),S.asn1.cms.CertificateSet=function(a){S.asn1.cms.CertificateSet.superclass.constructor.call(this);var l=Error,c=S.asn1,p=c.DERTaggedObject,y=c.DERSet,v=c.ASN1Object;this.params=null,this.tohex=function(){var x=this.params,C=[],O;if(x instanceof Array)O=x;else if(x.array!=null)O=x.array;else throw new l("cert array not specified");for(var _=0;_<O.length;_++){var B=O[_],N=zt(B),w=new v;w.hTLV=N,C.push(w)}var I={array:C};x.sortflag==!1&&(I.sortflag=!1);var R=new y(I),F=new p({tag:"a0",explicit:!1,obj:R});return F.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cms.CertificateSet,S.asn1.ASN1Object),S.asn1.cms.RevocationInfoChoices=function(a){S.asn1.cms.RevocationInfoChoices.superclass.constructor.call(this),this.params=null,this.tohex=function(){var l=this.params;if(!l instanceof Array)throw new Error("params is not array");for(var c=[],p=0;p<l.length;p++)c.push(new S.asn1.cms.RevocationInfoChoice(l[p]));var y=S.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:{set:c}}});return y.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cms.RevocationInfoChoices,S.asn1.ASN1Object),S.asn1.cms.RevocationInfoChoice=function(a){S.asn1.cms.RevocationInfoChoice.superclass.constructor.call(this),this.params=null,this.tohex=function(){var l=this.params;if(l.crl!=null&&typeof l.crl=="string"){var c=l.crl;return l.crl.indexOf("-----BEGIN")!=-1&&(c=zt(l.crl)),c}else if(l.ocsp!=null){var p=S.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:new S.asn1.cms.OtherRevocationFormat(l)}});return p.tohex()}else throw new Error("property crl or ocsp undefined")},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cms.RevocationInfoChoice,S.asn1.ASN1Object),S.asn1.cms.OtherRevocationFormat=function(a){S.asn1.cms.OtherRevocationFormat.superclass.constructor.call(this);var l=Error,c=S,p=c.asn1,y=p.ASN1Util.newObject,v=c.lang.String.isHex;this.params=null,this.tohex=function(){var x=this.params;if(x.ocsp==null)throw new l("property ocsp not specified");if(!v(x.ocsp)||!Fe.isASN1HEX(x.ocsp))throw new l("ocsp value not ASN.1 hex string");var C=y({seq:[{oid:"1.3.6.1.5.5.7.16.2"},{asn1:{tlv:x.ocsp}}]});return C.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cms.OtherRevocationFormat,S.asn1.ASN1Object),S.asn1.cms.CMSUtil=new function(){},S.asn1.cms.CMSUtil.newSignedData=function(a){return new S.asn1.cms.SignedData(a)},S.asn1.cms.CMSUtil.verifySignedData=function(a){var l=S,c=l.asn1,p=c.cms;p.SignerInfo,p.SignedData,p.SigningTime,p.SigningCertificate,p.SigningCertificateV2;var y=c.cades;y.SignaturePolicyIdentifier;var v=l.lang.String.isHex,x=Fe,C=x.getVbyList,O=x.getTLVbyList,_=x.getIdxbyList,B=x.getChildIdx,N=x.getTLV,w=x.oidname,I=l.crypto.Util.hashHex;a.cms===void 0&&v(a.cms);var R=a.cms,F=function(J,$){for(var Z,oe=3;oe<6;oe++)if(Z=_(J,0,[1,0,oe]),Z!==void 0){var de=J.substr(Z,2);de==="a0"&&($.certsIdx=Z),de==="a1"&&($.revinfosIdx=Z),de==="31"&&($.signerinfosIdx=Z)}},L=function(J,$){var Z=$.signerinfosIdx;if(Z!==void 0){var oe=B(J,Z);$.signerInfoIdxList=oe;for(var de=0;de<oe.length;de++){var Te=oe[de],h={idx:Te};V(J,h),$.signerInfos.push(h)}}},V=function(J,$){var Z=$.idx;$.signerid_issuer1=O(J,Z,[1,0],"30"),$.signerid_serial1=C(J,Z,[1,1],"02"),$.hashalg=w(C(J,Z,[2,0],"06"));var oe=_(J,Z,[3],"a0");$.idxSignedAttrs=oe,te(J,$,oe);var de=B(J,Z),Te=de.length;if(Te<6)throw"malformed SignerInfo";$.sigalg=w(C(J,Z,[Te-2,0],"06")),$.sigval=C(J,Z,[Te-1],"04")},te=function(J,$,Z){var oe=B(J,Z);$.signedAttrIdxList=oe;for(var de=0;de<oe.length;de++){var Te=oe[de],h=C(J,Te,[0],"06"),T;h==="2a864886f70d010905"?(T=St(C(J,Te,[1,0])),$.saSigningTime=T):h==="2a864886f70d010904"&&(T=C(J,Te,[1,0],"04"),$.saMessageDigest=T)}},ue=function(J,$){if(C(J,0,[0],"06")!=="2a864886f70d010702")return $;$.cmsType="signedData",$.econtent=C(J,0,[1,0,2,1,0]),F(J,$),$.signerInfos=[],L(J,$)},ae=function(J,$){for(var Z=$.parse.signerInfos,oe=Z.length,de=!0,Te=0;Te<oe;Te++){var h=Z[Te];H(J,$,h),h.isValid||(de=!1)}$.isValid=de},le=function(J,$,Z,oe){var de=$.parse.certsIdx,Te;if($.certs===void 0){Te=[],$.certkeys=[];for(var h=B(J,de),T=0;T<h.length;T++){var b=N(J,h[T]),A=new tt;A.readCertHex(b),Te[T]=A,$.certkeys[T]=A.getPublicKey()}$.certs=Te}else Te=$.certs;$.cccc=Te.length,$.cccci=h.length;for(var T=0;T<Te.length;T++){var q=A.getIssuerHex(),G=A.getSerialNumberHex();Z.signerid_issuer1===q&&Z.signerid_serial1===G&&(Z.certkey_idx=T)}},H=function(J,$,Z,oe){Z.verifyDetail={};var de=Z.verifyDetail,Te=$.parse.econtent,h=Z.hashalg,T=Z.saMessageDigest;de.validMessageDigest=!1,I(Te,h)===T&&(de.validMessageDigest=!0),le(J,$,Z),de.validSignatureValue=!1;var b=Z.sigalg,A="31"+N(J,Z.idxSignedAttrs).substr(2);Z.signedattrshex=A;var q=$.certs[Z.certkey_idx].getPublicKey(),G=new S.crypto.Signature({alg:b});G.init(q),G.updateHex(A);var Q=G.verify(Z.sigval);de.validSignatureValue_isValid=Q,Q===!0&&(de.validSignatureValue=!0),Z.isValid=!1,de.validMessageDigest&&de.validSignatureValue&&(Z.isValid=!0)},W={isValid:!1,parse:{}};return ue(R,W.parse),ae(R,W),W},S.asn1.cms.CMSParser=function(){var a=Error,l=tt,c=new l,p=Fe,y=p.getV,v=p.getTLV;p.getIdxbyList;var x=p.getTLVbyList,C=p.getTLVbyListEx,O=p.getVbyList,_=p.getVbyListEx,B=p.getChildIdx;this.getCMSSignedData=function(N){var w=x(N,0,[1,0]),I=this.getSignedData(w);return I},this.getSignedData=function(N){var w=B(N,0),I={},R=y(N,w[0]),F=parseInt(R,16);I.version=F;var L=v(N,w[1]);I.hashalgs=this.getHashAlgArray(L);var V=v(N,w[2]);I.econtent=this.getEContent(V);var te=C(N,0,["[0]"]);te!=null&&(I.certs=this.getCertificateSet(te)),C(N,0,["[1]"]);var ue=C(N,0,[3]);return I.sinfos=this.getSignerInfos(ue),I},this.getHashAlgArray=function(N){for(var w=B(N,0),I=new l,R=[],F=0;F<w.length;F++){var L=v(N,w[F]),V=I.getAlgorithmIdentifierName(L);R.push(V)}return R},this.getEContent=function(N){var w={},I=O(N,0,[0]),R=O(N,0,[1,0]);return w.type=S.asn1.x509.OID.oid2name(Fe.hextooidstr(I)),w.content={hex:R},w},this.getSignerInfos=function(N){for(var w=[],I=B(N,0),R=0;R<I.length;R++){var F=v(N,I[R]),L=this.getSignerInfo(F);w.push(L)}return w},this.getSignerInfo=function(N){var w={},I=B(N,0),R=p.getInt(N,I[0],-1);R!=-1&&(w.version=R);var F=v(N,I[1]),L=this.getIssuerAndSerialNumber(F);w.id=L;var V=v(N,I[2]),te=c.getAlgorithmIdentifierName(V);w.hashalg=te;var ue=C(N,0,["[0]"]);if(ue!=null){var ae=this.getAttributeList(ue);w.sattrs=ae}var le=C(N,0,[3]),H=c.getAlgorithmIdentifierName(le);w.sigalg=H;var W=_(N,0,[4]);w.sighex=W;var J=C(N,0,["[1]"]);if(J!=null){var $=this.getAttributeList(J);w.uattrs=$}return w},this.getSignerIdentifier=function(N){if(N.substr(0,2)=="30")return this.getIssuerAndSerialNumber(N);throw new Error("SKID of signerIdentifier not supported")},this.getIssuerAndSerialNumber=function(N){var w={type:"isssn"},I=B(N,0),R=v(N,I[0]);w.issuer=c.getX500Name(R);var F=y(N,I[1]);return w.serial={hex:F},w},this.getAttributeList=function(N){for(var w=[],I=B(N,0),R=0;R<I.length;R++){var F=v(N,I[R]),L=this.getAttribute(F);w.push(L)}return{array:w}},this.getAttribute=function(N){var w={},I=B(N,0),R=p.getOID(N,I[0]),F=S.asn1.x509.OID.oid2name(R);w.attr=F;var L=v(N,I[1]),V=B(L,0);if(V.length==1)w.valhex=v(L,V[0]);else{for(var te=[],ue=0;ue<V.length;ue++)te.push(v(L,V[ue]));w.valhex=te}return F=="contentType"?this.setContentType(w):F=="messageDigest"?this.setMessageDigest(w):F=="signingTime"?this.setSigningTime(w):F=="signingCertificate"?this.setSigningCertificate(w):F=="signingCertificateV2"?this.setSigningCertificateV2(w):F=="signaturePolicyIdentifier"&&this.setSignaturePolicyIdentifier(w),w},this.setContentType=function(N){var w=p.getOIDName(N.valhex,0,null);w!=null&&(N.type=w,delete N.valhex)},this.setSigningTime=function(N){var w=y(N.valhex,0),I=St(w);N.str=I,delete N.valhex},this.setMessageDigest=function(N){var w=y(N.valhex,0);N.hex=w,delete N.valhex},this.setSigningCertificate=function(N){var w=B(N.valhex,0);if(w.length>0){for(var I=v(N.valhex,w[0]),R=B(I,0),F=[],L=0;L<R.length;L++){var V=v(I,R[L]),te=this.getESSCertID(V);F.push(te)}N.array=F}if(w.length>1){var ue=v(N.valhex,w[1]);N.polhex=ue}delete N.valhex},this.setSignaturePolicyIdentifier=function(N){var w=B(N.valhex,0);if(w.length>0){var I=p.getOID(N.valhex,w[0]);N.oid=I}if(w.length>1){var R=new l,F=B(N.valhex,w[1]),L=v(N.valhex,F[0]),V=R.getAlgorithmIdentifierName(L);N.alg=V;var te=y(N.valhex,F[1]);N.hash=te}delete N.valhex},this.setSigningCertificateV2=function(N){var w=B(N.valhex,0);if(w.length>0){for(var I=v(N.valhex,w[0]),R=B(I,0),F=[],L=0;L<R.length;L++){var V=v(I,R[L]),te=this.getESSCertIDv2(V);F.push(te)}N.array=F}if(w.length>1){var ue=v(N.valhex,w[1]);N.polhex=ue}delete N.valhex},this.getESSCertID=function(N){var w={},I=B(N,0);if(I.length>0){var R=y(N,I[0]);w.hash=R}if(I.length>1){var F=v(N,I[1]),L=this.getIssuerSerial(F);L.serial!=null&&(w.serial=L.serial),L.issuer!=null&&(w.issuer=L.issuer)}return w},this.getESSCertIDv2=function(N){var w={},I=B(N,0);if(I.length<1||3<I.length)throw new a("wrong number of elements");var R=0;if(N.substr(I[0],2)=="30"){var F=v(N,I[0]);w.alg=c.getAlgorithmIdentifierName(F),R++}else w.alg="sha256";var L=y(N,I[R]);if(w.hash=L,I.length>R+1){var V=v(N,I[R+1]),te=this.getIssuerSerial(V);w.issuer=te.issuer,w.serial=te.serial}return w},this.getIssuerSerial=function(N){var w={},I=B(N,0),R=v(N,I[0]),F=c.getGeneralNames(R),L=F[0].dn;w.issuer=L;var V=y(N,I[1]);return w.serial={hex:V},w},this.getCertificateSet=function(N){for(var w=B(N,0),I=[],R=0;R<w.length;R++){var F=v(N,w[R]);if(F.substr(0,2)=="30"){var L=dn(F,"CERTIFICATE");I.push(L)}}return{array:I,sortflag:!1}}},(typeof S>"u"||!S)&&(S={}),(typeof S.asn1>"u"||!S.asn1)&&(S.asn1={}),(typeof S.asn1.tsp>"u"||!S.asn1.tsp)&&(S.asn1.tsp={}),S.asn1.tsp.TimeStampToken=function(a){var l=S,c=l.asn1,p=c.tsp;p.TimeStampToken.superclass.constructor.call(this),this.params=null,this.getEncodedHexPrepare=function(){var y=new p.TSTInfo(this.params.econtent.content);this.params.econtent.content.hex=y.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.tsp.TimeStampToken,S.asn1.cms.SignedData),S.asn1.tsp.TSTInfo=function(a){var l=S,c=l.asn1,p=c.DERSequence,y=c.DERInteger,v=c.DERBoolean,x=c.DERGeneralizedTime,C=c.DERObjectIdentifier,O=c.DERTaggedObject,_=c.tsp,B=_.MessageImprint,N=_.Accuracy;c.x509.X500Name;var w=c.x509.GeneralName;if(_.TSTInfo.superclass.constructor.call(this),this.dVersion=new y({int:1}),this.dPolicy=null,this.dMessageImprint=null,this.dSerial=null,this.dGenTime=null,this.dAccuracy=null,this.dOrdering=null,this.dNonce=null,this.dTsa=null,this.tohex=function(){var I=[this.dVersion];if(this.dPolicy==null)throw new Error("policy shall be specified.");if(I.push(this.dPolicy),this.dMessageImprint==null)throw new Error("messageImprint shall be specified.");if(I.push(this.dMessageImprint),this.dSerial==null)throw new Error("serialNumber shall be specified.");if(I.push(this.dSerial),this.dGenTime==null)throw new Error("genTime shall be specified.");I.push(this.dGenTime),this.dAccuracy!=null&&I.push(this.dAccuracy),this.dOrdering!=null&&I.push(this.dOrdering),this.dNonce!=null&&I.push(this.dNonce),this.dTsa!=null&&I.push(this.dTsa);var R=new p({array:I});return this.hTLV=R.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0){if(typeof a.policy=="string"){if(!a.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new C({oid:a.policy})}a.messageImprint!==void 0&&(this.dMessageImprint=new B(a.messageImprint)),a.serial!==void 0&&(this.dSerial=new y(a.serial)),a.genTime!==void 0&&(this.dGenTime=new x(a.genTime)),a.accuracy!==void 0&&(this.dAccuracy=new N(a.accuracy)),a.ordering!==void 0&&a.ordering==!0&&(this.dOrdering=new v),a.nonce!==void 0&&(this.dNonce=new y(a.nonce)),a.tsa!==void 0&&(this.dTsa=new O({tag:"a0",explicit:!0,obj:new w({dn:a.tsa})}))}},xe(S.asn1.tsp.TSTInfo,S.asn1.ASN1Object),S.asn1.tsp.Accuracy=function(a){var l=S,c=l.asn1,p=c.ASN1Util.newObject;c.tsp.Accuracy.superclass.constructor.call(this),this.params=null,this.tohex=function(){var y=this.params,v=[];return y.seconds!=null&&typeof y.seconds=="number"&&v.push({int:y.seconds}),y.millis!=null&&typeof y.millis=="number"&&v.push({tag:{tagi:"80",obj:{int:y.millis}}}),y.micros!=null&&typeof y.micros=="number"&&v.push({tag:{tagi:"81",obj:{int:y.micros}}}),p({seq:v}).tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.tsp.Accuracy,S.asn1.ASN1Object),S.asn1.tsp.MessageImprint=function(a){var l=S,c=l.asn1,p=c.DERSequence,y=c.DEROctetString,v=c.x509,x=v.AlgorithmIdentifier;c.tsp.MessageImprint.superclass.constructor.call(this),this.params=null,this.tohex=function(){var C=this.params,O=new x({name:C.alg}),_=new y({hex:C.hash}),B=new p({array:[O,_]});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.tsp.MessageImprint,S.asn1.ASN1Object),S.asn1.tsp.TimeStampReq=function(a){var l=S,c=l.asn1,p=c.DERSequence,y=c.DERInteger,v=c.DERBoolean;c.ASN1Object;var x=c.DERObjectIdentifier,C=c.tsp,O=C.MessageImprint;C.TimeStampReq.superclass.constructor.call(this),this.params=null,this.tohex=function(){var _=this.params,B=[];B.push(new y({int:1})),_.messageImprint instanceof S.asn1.ASN1Object?B.push(_.messageImprint):B.push(new O(_.messageImprint)),_.policy!=null&&B.push(new x(_.policy)),_.nonce!=null&&B.push(new y(_.nonce)),_.certreq==!0&&B.push(new v);var N=new p({array:B});return N.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.tsp.TimeStampReq,S.asn1.ASN1Object),S.asn1.tsp.TimeStampResp=function(a){var l=S,c=l.asn1,p=c.DERSequence;c.ASN1Object;var y=c.tsp,v=y.PKIStatusInfo;y.TimeStampResp.superclass.constructor.call(this),this.params=null,this.tohex=function(){var x=this.params,C=[];if(x.econtent!=null||x.tst!=null)if(x.statusinfo!=null?C.push(new v(x.statusinfo)):C.push(new v("granted")),x.econtent!=null)C.push(new y.TimeStampToken(x).getContentInfo());else if(x.tst instanceof c.ASN1Object)C.push(x.tst);else throw new Error("improper member tst value");else if(x.statusinfo!=null)C.push(new v(x.statusinfo));else throw new Error("parameter for token nor statusinfo not specified");var O=new p({array:C});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.tsp.TimeStampResp,S.asn1.ASN1Object),S.asn1.tsp.PKIStatusInfo=function(a){var l=Error,c=S,p=c.asn1,y=p.DERSequence,v=p.tsp,x=v.PKIStatus,C=v.PKIFreeText,O=v.PKIFailureInfo;v.PKIStatusInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var _=this.params,B=[];if(typeof _=="string")B.push(new x(_));else{if(_.status==null)throw new l("property 'status' unspecified");B.push(new x(_.status)),_.statusstr!=null&&B.push(new C(_.statusstr)),_.failinfo!=null&&B.push(new O(_.failinfo))}var N=new y({array:B});return N.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.tsp.PKIStatusInfo,S.asn1.ASN1Object),S.asn1.tsp.PKIStatus=function(a){var l=Error,c=S,p=c.asn1,y=p.DERInteger,v=p.tsp;v.PKIStatus.superclass.constructor.call(this);var x={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};this.params=null,this.tohex=function(){var C=this.params,O;if(typeof C=="string")try{O=x[C]}catch{throw new l("undefined name: "+C)}else if(typeof C=="number")O=C;else throw new l("unsupported params");return new y({int:O}).tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.tsp.PKIStatus,S.asn1.ASN1Object),S.asn1.tsp.PKIFreeText=function(a){var l=Error,c=S,p=c.asn1,y=p.DERSequence,v=p.DERUTF8String,x=p.tsp;x.PKIFreeText.superclass.constructor.call(this),this.params=null,this.tohex=function(){var C=this.params;if(!C instanceof Array)throw new l("wrong params: not array");for(var O=[],_=0;_<C.length;_++)O.push(new v({str:C[_]}));var B=new y({array:O});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.tsp.PKIFreeText,S.asn1.ASN1Object),S.asn1.tsp.PKIFailureInfo=function(a){var l=Error,c=S,p=c.asn1,y=p.DERBitString,v=p.tsp,x=v.PKIFailureInfo,C={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};x.superclass.constructor.call(this),this.params=null,this.getBinValue=function(){var O=this.params,_=0;if(typeof O=="number"&&0<=O&&O<=25){_|=1<<O;for(var B=_.toString(2),N="",w=B.length-1;w>=0;w--)N+=B[w];return N}else{if(typeof O=="string"&&C[O]!=null)return Ku([O],C);if(typeof O=="object"&&O.length!=null)return Ku(O,C);throw new l("wrong params")}},this.tohex=function(){this.params;var O=this.getBinValue();return new y({bin:O}).tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.tsp.PKIFailureInfo,S.asn1.ASN1Object),S.asn1.tsp.AbstractTSAAdapter=function(a){this.getTSTHex=function(l,c){throw"not implemented yet"}},S.asn1.tsp.SimpleTSAAdapter=function(a){var l=S,c=l.asn1,p=c.tsp,y=l.crypto.Util.hashHex;p.SimpleTSAAdapter.superclass.constructor.call(this),this.params=null,this.serial=0,this.getTSTHex=function(v,x){var C=y(v,x);this.params.econtent.content.messageImprint={alg:x,hash:C},this.params.econtent.content.serial={int:this.serial++};var O=Math.floor(Math.random()*1e9);this.params.econtent.content.nonce={int:O};var _=new p.TimeStampToken(this.params);return _.getContentInfoEncodedHex()},a!==void 0&&(this.params=a)},xe(S.asn1.tsp.SimpleTSAAdapter,S.asn1.tsp.AbstractTSAAdapter),S.asn1.tsp.FixedTSAAdapter=function(a){var l=S,c=l.asn1,p=c.tsp,y=l.crypto.Util.hashHex;p.FixedTSAAdapter.superclass.constructor.call(this),this.params=null,this.getTSTHex=function(v,x){var C=y(v,x);this.params.econtent.content.messageImprint={alg:x,hash:C};var O=new p.TimeStampToken(this.params);return O.getContentInfoEncodedHex()},a!==void 0&&(this.params=a)},xe(S.asn1.tsp.FixedTSAAdapter,S.asn1.tsp.AbstractTSAAdapter),S.asn1.tsp.TSPUtil=new function(){},S.asn1.tsp.TSPUtil.newTimeStampToken=function(a){return new S.asn1.tsp.TimeStampToken(a)},S.asn1.tsp.TSPUtil.parseTimeStampReq=function(a){var l=new S.asn1.tsp.TSPParser;return l.getTimeStampReq(a)},S.asn1.tsp.TSPUtil.parseMessageImprint=function(a){var l=new S.asn1.tsp.TSPParser;return l.getMessageImprint(a)},S.asn1.tsp.TSPParser=function(){var a=tt,l=new a,c=Fe,p=c.getV,y=c.getTLV,v=c.getIdxbyList;c.getTLVbyListEx;var x=c.getChildIdx,C=["granted","grantedWithMods","rejection","waiting","revocationWarning","revocationNotification"],O={0:"badAlg",2:"badRequest",5:"badDataFormat",14:"timeNotAvailable",15:"unacceptedPolicy",16:"unacceptedExtension",17:"addInfoNotAvailable",25:"systemFailure"};this.getResponse=function(_){var B=x(_,0);if(B.length==1)return this.getPKIStatusInfo(y(_,B[0]));if(B.length>1){var N=this.getPKIStatusInfo(y(_,B[0])),w=y(_,B[1]),I=this.getToken(w);return I.statusinfo=N,I}},this.getToken=function(_){var B=new S.asn1.cms.CMSParser,N=B.getCMSSignedData(_);return this.setTSTInfo(N),N},this.setTSTInfo=function(_){var B=_.econtent;if(B.type=="tstinfo"){var N=B.content.hex,w=this.getTSTInfo(N);B.content=w}},this.getTSTInfo=function(_){var B={},N=x(_,0),w=p(_,N[1]);B.policy=Wu(w);var I=y(_,N[2]);B.messageImprint=this.getMessageImprint(I);var R=p(_,N[3]);B.serial={hex:R};var F=p(_,N[4]);B.genTime={str:St(F)};var L=0;if(N.length>5&&_.substr(N[5],2)=="30"){var V=y(_,N[5]);B.accuracy=this.getAccuracy(V),L++}if(N.length>5+L&&_.substr(N[5+L],2)=="01"){var te=p(_,N[5+L]);te=="ff"&&(B.ordering=!0),L++}if(N.length>5+L&&_.substr(N[5+L],2)=="02"){var ue=p(_,N[5+L]);B.nonce={hex:ue},L++}if(N.length>5+L&&_.substr(N[5+L],2)=="a0"){var ae=y(_,N[5+L]);ae="30"+ae.substr(2),pGeneralNames=l.getGeneralNames(ae);var le=pGeneralNames[0].dn;B.tsa=le,L++}if(N.length>5+L&&_.substr(N[5+L],2)=="a1"){var H=y(_,N[5+L]);H="30"+H.substr(2);var W=l.getExtParamArray(H);B.ext=W,L++}return B},this.getAccuracy=function(_){for(var B={},N=x(_,0),w=0;w<N.length;w++){var I=_.substr(N[w],2),R=p(_,N[w]),F=parseInt(R,16);I=="02"?B.seconds=F:I=="80"?B.millis=F:I=="81"&&(B.micros=F)}return B},this.getMessageImprint=function(_){if(_.substr(0,2)!="30")throw new Error("head of messageImprint hex shall be x30");var B={};x(_,0);var N=v(_,0,[0,0]),w=p(_,N),I=c.hextooidstr(w),R=S.asn1.x509.OID.oid2name(I);if(R=="")throw new Error("hashAlg name undefined: "+I);var F=R,L=v(_,0,[1]);return B.alg=F,B.hash=p(_,L),B},this.getPKIStatusInfo=function(_){var B={},N=x(_,0),w=0;try{var I=p(_,N[0]),R=parseInt(I,16);B.status=C[R]}catch{}if(N.length>1&&_.substr(N[1],2)=="30"){var F=y(_,N[1]);B.statusstr=this.getPKIFreeText(F),w++}if(N.length>w&&_.substr(N[1+w],2)=="03"){var L=y(_,N[1+w]);B.failinfo=this.getPKIFailureInfo(L)}return B},this.getPKIFreeText=function(_){for(var B=[],N=x(_,0),w=0;w<N.length;w++)B.push(c.getString(_,N[w]));return B},this.getPKIFailureInfo=function(_){var B=c.getInt(_,0);return O[B]!=null?O[B]:B},this.getTimeStampReq=function(_){var B={};B.certreq=!1;var N=x(_,0);if(N.length<2)throw new Error("TimeStampReq must have at least 2 items");var w=y(_,N[1]);B.messageImprint=S.asn1.tsp.TSPUtil.parseMessageImprint(w);for(var I=2;I<N.length;I++){var R=N[I],F=_.substr(R,2);if(F=="06"){var L=p(_,R);B.policy=c.hextooidstr(L)}F=="02"&&(B.nonce=p(_,R)),F=="01"&&(B.certreq=!0)}return B}},(typeof S>"u"||!S)&&(S={}),(typeof S.asn1>"u"||!S.asn1)&&(S.asn1={}),(typeof S.asn1.cades>"u"||!S.asn1.cades)&&(S.asn1.cades={}),S.asn1.cades.SignaturePolicyIdentifier=function(a){var l=S,c=l.asn1,p=c.cades,y=p.SignaturePolicyId;p.SignaturePolicyIdentifier.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.15",this.params=null,this.getValueArray=function(){return[new y(this.params)]},this.setByParam=function(v){this.params=v},a!=null&&this.setByParam(a)},xe(S.asn1.cades.SignaturePolicyIdentifier,S.asn1.cms.Attribute),S.asn1.cades.SignaturePolicyId=function(a){var l=S,c=l.asn1,p=c.DERSequence,y=c.DERObjectIdentifier,v=c.x509;v.AlgorithmIdentifier;var x=c.cades,C=x.SignaturePolicyId,O=x.OtherHashAlgAndValue;C.superclass.constructor.call(this),this.params=null,this.tohex=function(){var _=this.params,B=[];B.push(new y(_.oid)),B.push(new O(_));var N=new p({array:B});return N.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(_){this.params=_},a!=null&&this.setByParam(a)},xe(S.asn1.cades.SignaturePolicyId,S.asn1.ASN1Object),S.asn1.cades.OtherHashAlgAndValue=function(a){var l=Error,c=S,p=c.asn1,y=p.DERSequence,v=p.DEROctetString,x=p.x509,C=x.AlgorithmIdentifier,O=p.cades,_=O.OtherHashAlgAndValue;_.superclass.constructor.call(this),this.params=null,this.tohex=function(){var B=this.params;if(B.alg==null)throw new l("property 'alg' not specified");if(B.hash==null&&B.cert==null)throw new l("property 'hash' nor 'cert' not specified");var N=null;if(B.hash!=null)N=B.hash;else if(B.cert!=null){if(typeof B.cert!="string")throw new l("cert not string");var w=B.cert;B.cert.indexOf("-----BEGIN")!=-1&&(w=zt(B.cert)),N=S.crypto.Util.hashHex(w,B.alg)}var I=[];I.push(new C({name:B.alg})),I.push(new v({hex:N}));var R=new y({array:I});return R.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cades.OtherHashAlgAndValue,S.asn1.ASN1Object),S.asn1.cades.OtherHashValue=function(a){S.asn1.cades.OtherHashValue.superclass.constructor.call(this);var l=Error,c=S;c.lang.String.isHex;var p=c.asn1,y=p.DEROctetString;c.crypto.Util.hashHex,this.params=null,this.tohex=function(){var v=this.params;if(v.hash==null&&v.cert==null)throw new l("hash or cert not specified");var x=null;if(v.hash!=null)x=v.hash;else if(v.cert!=null){if(typeof v.cert!="string")throw new l("cert not string");var C=v.cert;v.cert.indexOf("-----BEGIN")!=-1&&(C=zt(v.cert)),x=S.crypto.Util.hashHex(C,"sha1")}return new y({hex:x}).tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cades.OtherHashValue,S.asn1.ASN1Object),S.asn1.cades.SignatureTimeStamp=function(a){var l=Error,c=S,p=c.lang.String.isHex,y=c.asn1,v=y.ASN1Object;y.x509;var x=y.cades;x.SignatureTimeStamp.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.14",this.params=null,this.getValueArray=function(){var C=this.params;if(C.tst!=null)if(p(C.tst)){var O=new v;return O.hTLV=C.tst,[O]}else{if(C.tst instanceof v)return[C.tst];throw new l("params.tst has wrong value")}else if(C.res!=null){var _=C.res;if(_ instanceof v&&(_=_.tohex()),typeof _!="string"||!p(_))throw new l("params.res has wrong value");Fe.getTLVbyList(_,0,[1]);var O=new v;return O.hTLV=C.tst,[O]}},a!=null&&this.setByParam(a)},xe(S.asn1.cades.SignatureTimeStamp,S.asn1.cms.Attribute),S.asn1.cades.CompleteCertificateRefs=function(a){var l=Error,c=S,p=c.asn1,y=p.DERSequence,v=p.cades,x=v.OtherCertID,C=c.lang.String.isHex;v.CompleteCertificateRefs.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.21",this.params=null,this.getValueArray=function(){for(var O=this.params,_=[],B=0;B<O.array.length;B++){var N=O.array[B];if(typeof N=="string")if(N.indexOf("-----BEGIN")!=-1)N={cert:N};else if(C(N))N={hash:N};else throw new l("unsupported value: "+N);O.alg!=null&&N.alg==null&&(N.alg=O.alg),O.hasis!=null&&N.hasis==null&&(N.hasis=O.hasis);var w=new x(N);_.push(w)}var I=new y({array:_});return[I]},a!=null&&this.setByParam(a)},xe(S.asn1.cades.CompleteCertificateRefs,S.asn1.cms.Attribute),S.asn1.cades.OtherCertID=function(a){var l=S,c=l.asn1,p=c.DERSequence,y=c.cms,v=y.IssuerSerial,x=c.cades,C=x.OtherHashValue,O=x.OtherHashAlgAndValue;x.OtherCertID.superclass.constructor.call(this),this.params=a,this.tohex=function(){var _=this.params;typeof _=="string"&&(_.indexOf("-----BEGIN")!=-1?_={cert:_}:_isHex(_)&&(_={hash:_}));var B=[],N=null;if(_.alg!=null?N=new O(_):N=new C(_),B.push(N),_.cert!=null&&_.hasis==!0||_.issuer!=null&&_.serial!=null){var w=new v(_);B.push(w)}var I=new p({array:B});return I.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cades.OtherCertID,S.asn1.ASN1Object),S.asn1.cades.OtherHash=function(a){var l=S,c=l.asn1;c.cms;var p=c.cades,y=p.OtherHashAlgAndValue,v=p.OtherHashValue;l.crypto.Util.hashHex;var x=l.lang.String.isHex;p.OtherHash.superclass.constructor.call(this),this.params=null,this.tohex=function(){var C=this.params;typeof C=="string"&&(C.indexOf("-----BEGIN")!=-1?C={cert:C}:x(C)&&(C={hash:C}));var O=null;return C.alg!=null?O=new y(C):O=new v(C),O.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},xe(S.asn1.cades.OtherHash,S.asn1.ASN1Object),S.asn1.cades.CAdESUtil=new function(){},S.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(a){var l=new S.asn1.cms.CMSParser,c=l.getCMSSignedData(a);return c},S.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(a,l,c){var p=Fe,y=p.getChildIdx,v=p.getTLV,x=p.getV,C=S,O=C.asn1,_=O.ASN1Object,B=O.cms,N=B.AttributeList,w=B.SignerInfo,I={},R=y(a,l);if(R.length!=6)throw"not supported items for SignerInfo (!=6)";var F=R.shift();I.version=v(a,F);var L=R.shift();I.si=v(a,L);var V=R.shift();I.digalg=v(a,V);var te=R.shift();I.sattrs=v(a,te);var ue=R.shift();I.sigalg=v(a,ue);var ae=R.shift();I.sig=v(a,ae),I.sigval=x(a,ae);var le=null;return I.obj=new w,le=new _,le.hTLV=I.version,I.obj.dCMSVersion=le,le=new _,le.hTLV=I.si,I.obj.dSignerIdentifier=le,le=new _,le.hTLV=I.digalg,I.obj.dDigestAlgorithm=le,le=new _,le.hTLV=I.sattrs,I.obj.dSignedAttrs=le,le=new _,le.hTLV=I.sigalg,I.obj.dSigAlg=le,le=new _,le.hTLV=I.sig,I.obj.dSig=le,I.obj.dUnsignedAttrs=new N,I},(typeof S.asn1.csr>"u"||!S.asn1.csr)&&(S.asn1.csr={}),S.asn1.csr.CertificationRequest=function(a){var l=S,c=l.asn1,p=c.DERBitString,y=c.DERSequence,v=c.csr;c.x509;var x=v.CertificationRequestInfo;v.CertificationRequest.superclass.constructor.call(this),this.setByParam=function(C){this.params=C},this.sign=function(){var C=new x(this.params).tohex(),O=new S.crypto.Signature({alg:this.params.sigalg});O.init(this.params.sbjprvkey),O.updateHex(C);var _=O.sign();this.params.sighex=_},this.getPEM=function(){return dn(this.tohex(),"CERTIFICATE REQUEST")},this.tohex=function(){var C=this.params,O=new S.asn1.csr.CertificationRequestInfo(this.params),_=new S.asn1.x509.AlgorithmIdentifier({name:C.sigalg});if(C.sighex==null&&C.sbjprvkey!=null&&this.sign(),C.sighex==null)throw new Error("sighex or sbjprvkey parameter not defined");var B=new p({hex:"00"+C.sighex}),N=new y({array:[O,_,B]});return N.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.csr.CertificationRequest,S.asn1.ASN1Object),S.asn1.csr.CertificationRequestInfo=function(a){var l=S,c=l.asn1;c.DERBitString;var p=c.DERSequence,y=c.DERInteger,v=c.DERUTF8String,x=c.DERTaggedObject,C=c.ASN1Util.newObject,O=c.csr,_=c.x509,B=_.X500Name,N=_.Extensions,w=_.SubjectPublicKeyInfo;O.AttributeList,O.CertificationRequestInfo.superclass.constructor.call(this),this.params=null,this.setByParam=function(R){R!=null&&(this.params=R)},this.tohex=function(){var R=this.params,F=[];if(F.push(new y({int:0})),F.push(new B(R.subject)),F.push(new w(gt.getKey(R.sbjpubkey))),R.attrs!=null){var L=I(R.attrs),V=C({tag:{tage:"a0",obj:L}});F.push(V)}else if(R.extreq!=null){var te=new N(R.extreq),V=C({tag:{tage:"a0",obj:{seq:[{oid:"1.2.840.113549.1.9.14"},{set:[te]}]}}});F.push(V)}else F.push(new x({tag:"a0",explicit:!1,obj:new v({str:""})}));var ue=new p({array:F});return ue.tohex()},this.getEncodedHex=function(){return this.tohex()};function I(R){for(var F=Error,L=S.asn1.x509.Extensions,V=[],te=0;te<R.length;te++){var ue=R[te],ae=ue.attr;if(ae=="extensionRequest"){var le=new L(ue.ext),H={seq:[{oid:"1.2.840.113549.1.9.14"},{set:[le]}]};V.push(H)}else if(ae=="unstructuredName"){var H={seq:[{oid:"1.2.840.113549.1.9.2"},{set:ue.names}]};V.push(H)}else if(ae=="challengePassword"){var H={seq:[{oid:"1.2.840.113549.1.9.7"},{set:[{utf8str:ue.password}]}]};V.push(H)}else throw new F("unknown CSR attribute")}return{set:V}}a!=null&&this.setByParam(a)},xe(S.asn1.csr.CertificationRequestInfo,S.asn1.ASN1Object),S.asn1.csr.AttributeList=function(a){},xe(S.asn1.csr.AttributeList,S.asn1.ASN1Object),S.asn1.csr.CSRUtil=new function(){},S.asn1.csr.CSRUtil.newCSRPEM=function(a){var l=S.asn1.csr,c=new l.CertificationRequest(a),p=c.getPEM();return p},S.asn1.csr.CSRUtil.getParam=function(a,l){var c=Fe,p=c.getV,y=c.getIdxbyList,v=c.getTLVbyList,x=c.getTLVbyListEx,C=c.getVbyListEx,O=function(te){var ue=y(te,0,[0,3,0,0],"06");return p(te,ue)!="2a864886f70d01090e"?null:v(te,0,[0,3,0,1,0],"30")},_={};if(a.indexOf("-----BEGIN CERTIFICATE REQUEST")==-1)throw new Error("argument is not PEM file");var B=zt(a,"CERTIFICATE REQUEST");l&&(_.tbs=v(B,0,[0]));try{var N=x(B,0,[0,1]);if(N=="3000")_.subject={};else{var F=new tt;_.subject=F.getX500Name(N)}}catch{}var w=x(B,0,[0,2]),I=gt.getKey(w,null,"pkcs8pub");_.sbjpubkey=gt.getPEM(I,"PKCS8PUB");var R=O(B),F=new tt;R!=null&&(_.extreq=F.getExtParamArray(R));try{var L=x(B,0,[1],"30"),F=new tt;_.sigalg=F.getAlgorithmIdentifierName(L)}catch{}try{var V=C(B,0,[2]);_.sighex=V}catch{}return _},S.asn1.csr.CSRUtil.verifySignature=function(a){try{var l=null;if(typeof a=="string"&&a.indexOf("-----BEGIN CERTIFICATE REQUEST")!=-1?l=S.asn1.csr.CSRUtil.getParam(a,!0):typeof a=="object"&&a.sbjpubkey!=null&&a.sigalg!=null&&a.sighex!=null&&a.tbs!=null&&(l=a),l==null)return!1;var c=new S.crypto.Signature({alg:l.sigalg});return c.init(l.sbjpubkey),c.updateHex(l.tbs),c.verify(l.sighex)}catch(p){return alert(p),!1}},(typeof S>"u"||!S)&&(S={}),(typeof S.asn1>"u"||!S.asn1)&&(S.asn1={}),(typeof S.asn1.ocsp>"u"||!S.asn1.ocsp)&&(S.asn1.ocsp={}),S.asn1.ocsp.DEFAULT_HASH="sha1",S.asn1.ocsp.OCSPResponse=function(a){S.asn1.ocsp.OCSPResponse.superclass.constructor.call(this),S.asn1.DEREnumerated;var l=S.asn1.ASN1Util.newObject,c=S.asn1.ocsp.ResponseBytes,p=["successful","malformedRequest","internalError","tryLater","_not_used_","sigRequired","unauthorized"];this.params=null,this._getStatusCode=function(){var y=this.params.resstatus;return typeof y=="number"?y:typeof y!="string"?-1:p.indexOf(y)},this.setByParam=function(y){this.params=y},this.tohex=function(){var y=this.params,v=this._getStatusCode();if(v==-1)throw new Error("responseStatus not supported: "+y.resstatus);if(v!=0)return l({seq:[{enum:{int:v}}]}).tohex();var x=new c(y);return l({seq:[{enum:{int:0}},{tag:{tag:"a0",explicit:!0,obj:x}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.ocsp.OCSPResponse,S.asn1.ASN1Object),S.asn1.ocsp.ResponseBytes=function(a){S.asn1.ocsp.ResponseBytes.superclass.constructor.call(this);var l=S.asn1,c=l.DERSequence,p=l.DERObjectIdentifier,y=l.DEROctetString,v=l.ocsp.BasicOCSPResponse;this.params=null,this.setByParam=function(x){this.params=x},this.tohex=function(){var x=this.params;if(x.restype!="ocspBasic")throw new Error("not supported responseType: "+x.restype);var C=new v(x),O=[];O.push(new p({name:"ocspBasic"})),O.push(new y({hex:C.tohex()}));var _=new c({array:O});return _.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.ocsp.ResponseBytes,S.asn1.ASN1Object),S.asn1.ocsp.BasicOCSPResponse=function(a){S.asn1.ocsp.BasicOCSPResponse.superclass.constructor.call(this);var l=Error,c=S.asn1,p=c.ASN1Object,y=c.DERSequence;c.DERGeneralizedTime;var v=c.DERTaggedObject,x=c.DERBitString;c.x509.Extensions;var C=c.x509.AlgorithmIdentifier,O=c.ocsp;O.ResponderID,_SingleResponseList=O.SingleResponseList,_ResponseData=O.ResponseData,this.params=null,this.setByParam=function(_){this.params=_},this.sign=function(){var _=this.params,B=_.tbsresp.tohex(),N=new S.crypto.Signature({alg:_.sigalg});N.init(_.reskey),N.updateHex(B),_.sighex=N.sign()},this.tohex=function(){var _=this.params;_.tbsresp==null&&(_.tbsresp=new _ResponseData(_)),_.sighex==null&&_.reskey!=null&&this.sign();var B=[];if(B.push(_.tbsresp),B.push(new C({name:_.sigalg})),B.push(new x({hex:"00"+_.sighex})),_.certs!=null&&_.certs.length!=null){for(var N=[],w=0;w<_.certs.length;w++){var I=_.certs[w],R=null;if(Fe.isASN1HEX(I))R=I;else if(I.match(/-----BEGIN/))R=zt(I);else throw new l("certs["+w+"] not hex or PEM");N.push(new p({tlv:R}))}var F=new y({array:N});B.push(new v({tag:"a0",explicit:!0,obj:F}))}var L=new y({array:B});return L.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.ocsp.BasicOCSPResponse,S.asn1.ASN1Object),S.asn1.ocsp.ResponseData=function(a){S.asn1.ocsp.ResponseData.superclass.constructor.call(this);var l=S.asn1,c=l.DERSequence,p=l.DERGeneralizedTime,y=l.DERTaggedObject,v=l.x509.Extensions,x=l.ocsp,C=x.ResponderID;_SingleResponseList=x.SingleResponseList,this.params=null,this.tohex=function(){var O=this.params;O.respid!=null,O.prodat!=null,O.array!=null;var _=[];if(_.push(new C(O.respid)),_.push(new p(O.prodat)),_.push(new _SingleResponseList(O.array)),O.ext!=null){var B=new v(O.ext);_.push(new y({tag:"a1",explicit:!0,obj:B}))}var N=new c({array:_});return N.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(O){this.params=O},a!==void 0&&this.setByParam(a)},xe(S.asn1.ocsp.ResponseData,S.asn1.ASN1Object),S.asn1.ocsp.ResponderID=function(a){S.asn1.ocsp.ResponderID.superclass.constructor.call(this);var l=S,c=l.asn1,p=c.ASN1Util.newObject,y=c.x509.X500Name,v=l.lang.String.isHex,x=Error;this.params=null,this.tohex=function(){var C=this.params;if(C.key!=null){var O=null;if(typeof C.key=="string"){if(v(C.key)&&(O=C.key),C.key.match(/-----BEGIN CERTIFICATE/)){var _=new tt(C.key),B=_.getExtSubjectKeyIdentifier();B!=null&&(O=B.kid.hex)}}else if(C.key instanceof tt){var B=C.key.getExtSubjectKeyIdentifier();B!=null&&(O=B.kid.hex)}if(O==null)throw new x("wrong key member value");var N=p({tag:{tag:"a2",explicit:!0,obj:{octstr:{hex:O}}}});return N.tohex()}else if(C.name!=null){var w=null;if(typeof C.name=="string"&&C.name.match(/-----BEGIN CERTIFICATE/)){var _=new tt(C.name);w=_.getSubject()}else C.name instanceof tt?w=C.name.getSubject():typeof C.name=="object"&&(C.name.array!=null||C.name.str!=null)&&(w=C.name);if(w==null)throw new x("wrong name member value");var N=p({tag:{tag:"a1",explicit:!0,obj:new y(w)}});return N.tohex()}throw new x("key or name not specified")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(C){this.params=C},a!==void 0&&this.setByParam(a)},xe(S.asn1.ocsp.ResponderID,S.asn1.ASN1Object),S.asn1.ocsp.SingleResponseList=function(a){S.asn1.ocsp.SingleResponseList.superclass.constructor.call(this);var l=S.asn1,c=l.DERSequence,p=l.ocsp.SingleResponse;this.params=null,this.tohex=function(){var y=this.params;if(typeof y!="object"||y.length==null)throw new Error("params not specified properly");for(var v=[],x=0;x<y.length;x++)v.push(new p(y[x]));var C=new c({array:v});return C.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(y){this.params=y},a!==void 0&&this.setByParam(a)},xe(S.asn1.ocsp.SingleResponseList,S.asn1.ASN1Object),S.asn1.ocsp.SingleResponse=function(a){var l=Error,c=S,p=c.asn1,y=p.DERSequence,v=p.DERGeneralizedTime,x=p.DERTaggedObject,C=p.ocsp,O=C.CertID,_=C.CertStatus,B=p.x509,N=B.Extensions;C.SingleResponse.superclass.constructor.call(this),this.params=null,this.tohex=function(){var w=this.params,I=[];if(w.certid==null)throw new l("certid unspecified");if(w.status==null)throw new l("status unspecified");if(w.thisupdate==null)throw new l("thisupdate unspecified");if(I.push(new O(w.certid)),I.push(new _(w.status)),I.push(new v(w.thisupdate)),w.nextupdate!=null){var R=new v(w.nextupdate);I.push(new x({tag:"a0",explicit:!0,obj:R}))}if(w.ext!=null){var F=new N(w.ext);I.push(new x({tag:"a1",explicit:!0,obj:F}))}var L=new y({array:I});return L.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(w){this.params=w},a!==void 0&&this.setByParam(a)},xe(S.asn1.ocsp.SingleResponse,S.asn1.ASN1Object),S.asn1.ocsp.CertID=function(a){var l=S,c=l.asn1,p=c.DEROctetString,y=c.DERInteger,v=c.DERSequence,x=c.x509,C=x.AlgorithmIdentifier,O=c.ocsp;O.DEFAULT_HASH;var _=l.crypto,B=_.Util.hashHex,N=tt,w=Fe,I=w.getVbyList;O.CertID.superclass.constructor.call(this),this.DEFAULT_HASH="sha1",this.params=null,this.setByValue=function(R,F,L,V){V==null&&(V=this.DEFAULT_HASH),this.params={alg:V,issname:R,isskey:F,sbjsn:L}},this.setByCert=function(R,F,L){L==null&&(L=this.DEFAULT_HASH),this.params={alg:L,issuerCert:R,subjectCert:F}},this.getParamByCerts=function(R,F,L){L==null&&(L=this.DEFAULT_HASH);var V=new N(R),te=new N(F),ue=B(V.getSubjectHex(),L),ae=V.getPublicKeyHex(),le=B(I(ae,0,[1],"03",!0),L),H=te.getSerialNumberHex(),W={alg:L,issname:ue,isskey:le,sbjsn:H};return W},this.tohex=function(){if(typeof this.params!="object")throw new Error("params not set");var R=this.params,F,L,V,te;if(R.alg==null?te=this.DEFAULT_HASH:te=R.alg,R.issuerCert!=null&&R.subjectCert!=null){var ue=this.getParamByCerts(R.issuerCert,R.subjectCert,te);F=ue.issname,L=ue.isskey,V=ue.sbjsn}else if(R.issname!=null&&R.isskey!=null&&R.sbjsn!=null)F=R.issname,L=R.isskey,V=R.sbjsn;else throw new Error("required param members not defined");var ae=new C({name:te}),le=new p({hex:F}),H=new p({hex:L}),W=new y({hex:V}),J=new v({array:[ae,le,H,W]});return this.hTLV=J.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},xe(S.asn1.ocsp.CertID,S.asn1.ASN1Object),S.asn1.ocsp.CertStatus=function(a){S.asn1.ocsp.CertStatus.superclass.constructor.call(this),this.params=null,this.tohex=function(){var l=this.params;if(l.status=="good")return"8000";if(l.status=="unknown")return"8200";if(l.status=="revoked"){var c=[{gentime:{str:l.time}}];l.reason!=null&&c.push({tag:{tag:"a0",explicit:!0,obj:{enum:{int:l.reason}}}});var p={tag:"a1",explicit:!1,obj:{seq:c}};return S.asn1.ASN1Util.newObject({tag:p}).tohex()}throw new Error("bad status")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(l){this.params=l},a!==void 0&&this.setByParam(a)},xe(S.asn1.ocsp.CertStatus,S.asn1.ASN1Object),S.asn1.ocsp.Request=function(a){var l=S,c=l.asn1,p=c.DERSequence,y=c.ocsp;if(y.Request.superclass.constructor.call(this),this.dReqCert=null,this.dExt=null,this.tohex=function(){var x=[];if(this.dReqCert===null)throw"reqCert not set";x.push(this.dReqCert);var C=new p({array:x});return this.hTLV=C.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},typeof a<"u"){var v=new y.CertID(a);this.dReqCert=v}},xe(S.asn1.ocsp.Request,S.asn1.ASN1Object),S.asn1.ocsp.TBSRequest=function(a){var l=S,c=l.asn1,p=c.DERSequence,y=c.ocsp;y.TBSRequest.superclass.constructor.call(this),this.version=0,this.dRequestorName=null,this.dRequestList=[],this.dRequestExt=null,this.setRequestListByParam=function(v){for(var x=[],C=0;C<v.length;C++){var O=new y.Request(v[0]);x.push(O)}this.dRequestList=x},this.tohex=function(){var v=[];if(this.version!==0)throw"not supported version: "+this.version;if(this.dRequestorName!==null)throw"requestorName not supported";var x=new p({array:this.dRequestList});if(v.push(x),this.dRequestExt!==null)throw"requestExtensions not supported";var C=new p({array:v});return this.hTLV=C.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&a.reqList!==void 0&&this.setRequestListByParam(a.reqList)},xe(S.asn1.ocsp.TBSRequest,S.asn1.ASN1Object),S.asn1.ocsp.OCSPRequest=function(a){var l=S,c=l.asn1,p=c.DERSequence,y=c.ocsp;if(y.OCSPRequest.superclass.constructor.call(this),this.dTbsRequest=null,this.dOptionalSignature=null,this.tohex=function(){var x=[];if(this.dTbsRequest!==null)x.push(this.dTbsRequest);else throw"tbsRequest not set";if(this.dOptionalSignature!==null)throw"optionalSignature not supported";var C=new p({array:x});return this.hTLV=C.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&a.reqList!==void 0){var v=new y.TBSRequest(a);this.dTbsRequest=v}},xe(S.asn1.ocsp.OCSPRequest,S.asn1.ASN1Object),S.asn1.ocsp.OCSPUtil={},S.asn1.ocsp.OCSPUtil.getRequestHex=function(a,l,c){var p=S,y=p.asn1,v=y.ocsp;c===void 0&&(c=v.DEFAULT_HASH);var x={alg:c,issuerCert:a,subjectCert:l},C=new v.OCSPRequest({reqList:[x]});return C.tohex()},S.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(a){var l=Fe,c=l.getVbyList,p=l.getVbyListEx,y=l.getIdxbyList;l.getIdxbyListEx;var v=l.getV,x={};try{var C=p(a,0,[0],"0a");x.responseStatus=parseInt(C,16)}catch{}if(x.responseStatus!==0)return x;try{var O=y(a,0,[1,0,1,0,0,2,0,1]);a.substr(O,2)==="80"?x.certStatus="good":a.substr(O,2)==="a1"?(x.certStatus="revoked",x.revocationTime=St(c(a,O,[0]))):a.substr(O,2)==="82"&&(x.certStatus="unknown")}catch{}try{var _=y(a,0,[1,0,1,0,0,2,0,2]);x.thisUpdate=St(v(a,_))}catch{}try{var B=y(a,0,[1,0,1,0,0,2,0,3]);a.substr(B,2)==="a0"&&(x.nextUpdate=St(c(a,B,[0])))}catch{}return x},S.asn1.ocsp.OCSPParser=function(){var a=Error,l=tt,c=new l,p=Fe,y=p.getV,v=p.getTLV,x=p.getIdxbyList,C=p.getVbyList,O=p.getTLVbyList,_=p.getVbyListEx,B=p.getTLVbyListEx,N=p.getChildIdx;this.getOCSPRequest=function(w){var I=N(w,0);if(I.length!=1&&I.length!=2)throw new a("wrong number elements: "+I.length);var R=this.getTBSRequest(v(w,I[0]));return R},this.getTBSRequest=function(w){var I={},R=B(w,0,[0],"30");I.array=this.getRequestList(R);var F=B(w,0,["[2]",0],"30");return F!=null&&(I.ext=c.getExtParamArray(F)),I},this.getRequestList=function(w){for(var I=[],R=N(w,0),F=0;F<R.length;F++){var w=v(w,R[F]);I.push(this.getRequest(w))}return I},this.getRequest=function(w){var I=N(w,0);if(I.length!=1&&I.length!=2)throw new a("wrong number elements: "+I.length);var R=this.getCertID(v(w,I[0]));if(I.length==2){var F=x(w,0,[1,0]);R.ext=c.getExtParamArray(v(w,F))}return R},this.getCertID=function(w){var I=N(w,0);if(I.length!=4)throw new a("wrong number elements: "+I.length);var R=new l,F={};return F.alg=R.getAlgorithmIdentifierName(v(w,I[0])),F.issname=y(w,I[1]),F.isskey=y(w,I[2]),F.sbjsn=y(w,I[3]),F},this.getOCSPResponse=function(w){var I=N(w,0),R,F=y(w,I[0]),L=parseInt(F);if(I.length==1)return{resstatus:L};var V=O(w,0,[1,0]);return R=this.getResponseBytes(V),R.resstatus=L,R},this.getResponseBytes=function(w){var I=N(w,0),R,F=O(w,0,[1,0]);R=this.getBasicOCSPResponse(F);var L=y(w,I[0]);return R.restype=S.asn1.x509.OID.oid2name(Wu(L)),R},this.getBasicOCSPResponse=function(w){var I=N(w,0),R;R=this.getResponseData(v(w,I[0]));var F=new tt;R.alg=F.getAlgorithmIdentifierName(v(w,I[1]));var L=y(w,I[2]);R.sighex=L.substr(2);var V=_(w,0,["[0]"]);if(V!=null){for(var te=N(V,0),ue=[],ae=0;ae<te.length;ae++){var le=v(V,te[ae]);ue.push(le)}R.certs=ue}return R},this.getResponseData=function(w){var I=N(w,0),R=I.length,F={},L=0;w.substr(I[0],2)=="a0"&&L++,F.respid=this.getResponderID(v(w,I[L++]));var V=y(w,I[L++]);if(F.prodat=St(V),F.array=this.getSingleResponseList(v(w,I[L++])),w.substr(I[R-1],2)=="a1"){var te=O(w,I[R-1],[0]),ue=new tt;F.ext=ue.getExtParamArray(te)}return F},this.getResponderID=function(w){var I={};if(w.substr(0,2)=="a2"){var R=C(w,0,[0]);I.key=R}if(w.substr(0,2)=="a1"){var F=O(w,0,[0]),L=new tt;I.name=L.getX500Name(F)}return I},this.getSingleResponseList=function(w){for(var I=N(w,0),R=[],F=0;F<I.length;F++){var L=this.getSingleResponse(v(w,I[F]));R.push(L)}return R},this.getSingleResponse=function(w){var I=N(w,0),R={},F=this.getCertID(v(w,I[0]));R.certid=F;var L=this.getCertStatus(v(w,I[1]));if(R.status=L,w.substr(I[2],2)=="18"){var V=y(w,I[2]);R.thisupdate=St(V)}for(var te=3;te<I.length;te++){if(w.substr(I[te],2)=="a0"){var ue=C(w,I[te],[0],"18");R.nextupdate=St(ue)}if(w.substr(I[te],2)=="a1"){var ae=new tt,le=O(w,0,[te,0]);R.ext=ae.getExtParamArray(le)}}return R},this.getCertStatus=function(w){var I={};if(w=="8000")return{status:"good"};if(w=="8200")return{status:"unknown"};if(w.substr(0,2)=="a1"){I.status="revoked";var R=C(w,0,[0]),F=St(R);I.time=F}return I}};var S;(typeof S>"u"||!S)&&(S={}),(typeof S.lang>"u"||!S.lang)&&(S.lang={}),S.lang.String=function(){};function jf(a){for(var l=new Array,c=0;c<a.length;c++)l[c]=a.charCodeAt(c);return l}function qf(a){for(var l="",c=0;c<a.length;c++)l=l+String.fromCharCode(a[c]);return l}function Sa(a){for(var l="",c=0;c<a.length;c++){var p=a[c].toString(16);p.length==1&&(p="0"+p),l=l+p}return l}function rr(a){return Sa(jf(a))}function q0(a){return u(rr(a))}function $c(a){return Us(u(rr(a)))}function Hc(a){return qf(f(ba(a)))}function Us(a){return a=a.replace(/\=/g,""),a=a.replace(/\+/g,"-"),a=a.replace(/\//g,"_"),a}function ba(a){return a.length%4==2?a=a+"==":a.length%4==3&&(a=a+"="),a=a.replace(/-/g,"+"),a=a.replace(/_/g,"/"),a}function Gt(a){return a.length%2==1&&(a="0"+a),Us(u(a))}function Pt(a){return d(ba(a))}var zs,Rr;typeof Buffer=="function"?(zs=function(a){return Us(Buffer.from(a,"utf8").toString("base64"))},Rr=function(a){return Buffer.from(ba(a),"base64").toString("utf8")}):(zs=function(a){return Gt(So(Vu(a)))},Rr=function(a){return decodeURIComponent(bo(Pt(a)))});function Vc(a){return u(So(Vu(a)))}function Wc(a){return decodeURIComponent(bo(d(a)))}function zu(a){return So(Vu(a)).toLowerCase()}function St(a){try{return decodeURIComponent(bo(a))}catch{return null}}function U0(a){return St(z0(a))}function z0(a){for(var l=a.match(/.{1,2}/g),c=[],p=0;p<l.length;p++){var y=parseInt(l[p],16);161<=y&&y<=191?(c.push("c2"),c.push(l[p])):192<=y&&y<=255?(c.push("c3"),c.push((y-64).toString(16))):c.push(l[p])}return c.join("")}function Kt(a){for(var l="",c=0;c<a.length-1;c+=2)l+=String.fromCharCode(parseInt(a.substr(c,2),16));return l}function Pn(a){for(var l="",c=0;c<a.length;c++)l+=("0"+a.charCodeAt(c).toString(16)).slice(-2);return l}function Gc(a){return u(a)}function Uf(a){return $i(Gc(a),64)}function $i(a,l){return a=a.replace(new RegExp("(.{"+l+"})","g"),`$1\r
`),a=a.replace(/\s+$/,""),a}function $s(a){var l=a.replace(/[^0-9A-Za-z\/+=]*/g,""),c=d(l);return c}function zf(a,l){return"-----BEGIN "+l+`-----\r
`+$i(a,64)+`\r
-----END `+l+`-----\r
`}function dn(a,l){return"-----BEGIN "+l+`-----\r
`+$i(Gc(a),64)+`\r
-----END `+l+`-----\r
`}function zt(a,l){if(a.indexOf("-----BEGIN ")==-1)throw new Error("can't find PEM header");return l!==void 0?(a=a.replace(new RegExp("^[^]*-----BEGIN "+l+"-----"),""),a=a.replace(new RegExp("-----END "+l+"-----[^]*$"),"")):(a=a.replace(/^[^]*-----BEGIN [^-]+-----/,""),a=a.replace(/-----END [^-]+-----[^]*$/,"")),$s(a)}function $f(a){return a.indexOf("-----BEGIN ")==-1||a.indexOf("-----END ")==-1?null:(a=a.replace(/^[\s\S]*?-----BEGIN [^-]+-----/m,""),a=a.replace(/-----END [\s\S]+$/m,""),a=a.replace(/\s+/g,""),a.match(/^[0-9a-zA-Z+/=]+$/)?a:null)}function $0(a){if(a.length%2!=0)throw"input is not even length";if(a.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var l=new ArrayBuffer(a.length/2),c=new DataView(l),p=0;p<a.length/2;p++)c.setUint8(p,parseInt(a.substr(p*2,2),16));return l}function H0(a){for(var l="",c=new DataView(a),p=0;p<a.byteLength;p++)l+=("00"+c.getUint8(p).toString(16)).slice(-2);return l}function Kc(a){var l,c,p,y,v,x,C,O,_,B;if(a=$u(a),B=a.match(/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/),B)return l=parseInt(B[1]),c=parseInt(B[2])-1,p=parseInt(B[3]),y=parseInt(B[4]),v=parseInt(B[5]),x=parseInt(B[6]),C=0,O=B[7],O!==""&&(_=(O.substr(1)+"00").substr(0,3),C=parseInt(_)),Date.UTC(l,c,p,y,v,x,C);throw new Error("unsupported zulu format: "+a)}function V0(a){var l=new Date(a),c=("0000"+l.getUTCFullYear()).slice(-4),p=("00"+(l.getUTCMonth()+1)).slice(-2),y=("00"+l.getUTCDate()).slice(-2),v=("00"+l.getUTCHours()).slice(-2),x=("00"+l.getUTCMinutes()).slice(-2),C=("00"+l.getUTCSeconds()).slice(-2),O=("000"+l.getUTCMilliseconds()).slice(-3);return O=O.replace(/0+$/,""),O=O!=""?"."+O:O,c+p+y+v+x+C+O+"Z"}function Jc(a){return Math.round(Kc(a)/1e3)}function cs(a){return new Date(Kc(a))}function Qc(a,l,c){var p,y=a.getUTCFullYear();if(l){if(y<1950||2049<y)throw"not proper year for UTCTime: "+y;p=(""+y).slice(-2)}else p=("000"+y).slice(-4);if(p+=("0"+(a.getUTCMonth()+1)).slice(-2),p+=("0"+a.getUTCDate()).slice(-2),p+=("0"+a.getUTCHours()).slice(-2),p+=("0"+a.getUTCMinutes()).slice(-2),p+=("0"+a.getUTCSeconds()).slice(-2),c){var v=a.getUTCMilliseconds();v!==0&&(v=("00"+v).slice(-3),v=v.replace(/0+$/g,""),p+="."+v)}return p+="Z",p}function $u(a){return a.match(/^[0-9]{12}Z$/)||a.match(/^[0-9]{12}[.][0-9]*Z$/)?a.match(/^[0-4]/)?"20"+a:"19"+a:a}function So(a){return a.replace(/%/g,"")}function bo(a){return a.replace(/(..)/g,"%$1")}function wa(a){var l="malformed IPv6 address";if(!a.match(/^[0-9A-Fa-f:]+$/))throw l;a=a.toLowerCase();var c=a.split(":").length-1;if(c<2)throw l;var p=":".repeat(7-c+2);a=a.replace("::",p);var y=a.split(":");if(y.length!=8)throw l;for(var v=0;v<8;v++)y[v]=("0000"+y[v]).slice(-4);return y.join("")}function Ca(a){if(!a.match(/^[0-9A-Fa-f]{32}$/))throw new Error("malformed IPv6 address: "+a);a=a.toLowerCase();var l=a.match(/.{1,4}/g);l=l.map(function(y){return y.replace(/^0+/,"")}),l=l.map(function(y){return y==""?"0":y}),a=":"+l.join(":")+":";var c=a.match(/:(0:){2,}/g);if(c==null)return a.slice(1,-1);var p=c.sort().slice(-1)[0];return a=a.replace(p.substr(0,p.length-1),":"),a.substr(0,2)!="::"&&(a=a.substr(1)),a.substr(-2,2)!="::"&&(a=a.substr(0,a.length-1)),a}function wo(a){var l=new Error("malformed hex value");if(!a.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw l;if(a.length==8){var c;try{return c=parseInt(a.substr(0,2),16)+"."+parseInt(a.substr(2,2),16)+"."+parseInt(a.substr(4,2),16)+"."+parseInt(a.substr(6,2),16),c}catch{throw l}}else if(a.length==16)try{return wo(a.substr(0,8))+"/"+xa(a.substr(8))}catch{throw l}else{if(a.length==32)return Ca(a);if(a.length==64){try{return Ca(a.substr(0,32))+"/"+xa(a.substr(32))}catch{throw l}return}else return a}}function xa(a){var l=new Error("malformed mask"),c;try{c=new g(a,16).toString(2)}catch{throw l}if(!c.match(/^1*0*$/))throw l;return c.replace(/0+$/,"").length}function Hu(a){var l=new Error("malformed IP address");if(a=a.toLowerCase(a),!a.match(/^[0-9a-f.:/]+$/))throw l;if(a.match(/^[0-9.]+$/)){var c=a.split(".");if(c.length!==4)throw l;var p="";try{for(var y=0;y<4;y++){var v=parseInt(c[y]);p+=("0"+v.toString(16)).slice(-2)}return p}catch{throw l}}else if(a.match(/^[0-9.]+\/[0-9]+$/)){var x=a.split("/");return Hu(x[0])+Xc(parseInt(x[1]),32)}else{if(a.match(/^[0-9a-f:]+$/)&&a.indexOf(":")!==-1)return wa(a);if(a.match(/^[0-9a-f:]+\/[0-9]+$/)&&a.indexOf(":")!==-1){var x=a.split("/");return wa(x[0])+Xc(parseInt(x[1]),128)}else throw l}}function Xc(a,l){if(l==32&&a==0)return"00000000";if(l==128&&a==0)return"00000000000000000000000000000000";var c=Array(a+1).join("1")+Array(l-a+1).join("0");return new g(c,2).toString(16)}function Yc(a){function l(y){var v=parseInt(y.substr(0,2),16),x=parseInt(y.substr(2),16);if(v==0&x<128)return String.fromCharCode(x);if(v<8){var C=192|(v&7)<<3|(x&192)>>6,O=128|x&63;return St(C.toString(16)+O.toString(16))}var C=224|(v&240)>>4,O=128|(v&15)<<2|(x&192)>>6,_=128|x&63;return St(C.toString(16)+O.toString(16)+_.toString(16))}var c=a.match(/.{4}/g),p=c.map(l);return p.join("")}function Vu(a){for(var l=encodeURIComponent(a),c="",p=0;p<l.length;p++)l[p]=="%"?(c=c+l.substr(p,3),p=p+2):c=c+"%"+rr(l[p]);return c}function W0(a){return a=a.replace(/\r\n/mg,`
`),a}function G0(a){return a=a.replace(/\r\n/mg,`
`),a=a.replace(/\n/mg,`\r
`),a}S.lang.String.isInteger=function(a){return a.match(/^[0-9]+$/)?!0:!!a.match(/^-[0-9]+$/)},S.lang.String.isHex=function(a){return Hf(a)};function Hf(a){return!!(a.length%2==0&&(a.match(/^[0-9a-f]+$/)||a.match(/^[0-9A-F]+$/)))}S.lang.String.isBase64=function(a){return a=a.replace(/\s+/g,""),!!(a.match(/^[0-9A-Za-z+\/]+={0,3}$/)&&a.length%4==0)},S.lang.String.isBase64URL=function(a){return a.match(/[+/=]/)?!1:(a=ba(a),S.lang.String.isBase64(a))};function Zc(a){return!!a.match(/^[0-9A-Za-z-_.]+$/)}S.lang.String.isIntegerArray=function(a){return a=a.replace(/\s+/g,""),!!a.match(/^\[[0-9,]+\]$/)},S.lang.String.isPrintable=function(a){return a.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},S.lang.String.isIA5=function(a){return a.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},S.lang.String.isMail=function(a){return a.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};function ed(a){return a.length%2==1?"0"+a:a.substr(0,1)>"7"?"00"+a:a}function K0(a){a=a.replace(/^\s*\[\s*/,""),a=a.replace(/\s*\]\s*$/,""),a=a.replace(/\s*/g,"");try{var l=a.split(/,/).map(function(c,p,y){var v=parseInt(c);if(v<0||255<v)throw"integer not in range 0-255";var x=("00"+v.toString(16)).slice(-2);return x}).join("");return l}catch(c){throw"malformed integer array string: "+c}}var J0=function(a,l){var c=a.length;a.length>l.length&&(c=l.length);for(var p=0;p<c;p++)if(a.charCodeAt(p)!=l.charCodeAt(p))return p;return a.length!=l.length?c:-1};function Vf(a){var l=function(C){var O=C.toString(16);return O.length==1&&(O="0"+O),O},c=function(C){var O="",_=parseInt(C,10),B=_.toString(2),N=7-B.length%7;N==7&&(N=0);for(var w="",I=0;I<N;I++)w+="0";B=w+B;for(var I=0;I<B.length-1;I+=7){var R=B.substr(I,7);I!=B.length-7&&(R="1"+R),O+=l(parseInt(R,2))}return O};try{if(!a.match(/^[0-9.]+$/))return null;var p="",y=a.split("."),v=parseInt(y[0],10)*40+parseInt(y[1],10);p+=l(v),y.splice(0,2);for(var x=0;x<y.length;x++)p+=c(y[x]);return p}catch{return null}}function Wu(a){if(!Hf(a))return null;try{var l=[],c=a.substr(0,2),p=parseInt(c,16);l[0]=new String(Math.floor(p/40)),l[1]=new String(p%40);for(var y=a.substr(2),v=[],x=0;x<y.length/2;x++)v.push(parseInt(y.substr(x*2,2),16));for(var C=[],O="",x=0;x<v.length;x++)v[x]&128?O=O+Gu((v[x]&127).toString(2),7):(O=O+Gu((v[x]&127).toString(2),7),C.push(new String(parseInt(O,2))),O="");var _=l.join(".");return C.length>0&&(_=_+"."+C.join(".")),_}catch{return null}}var Gu=function(a,l,c){return c==null&&(c="0"),a.length>=l?a:new Array(l-a.length+1).join(c)+a};function Wf(a){if(a.length%2!=0||(a=a.toLowerCase(),a.match(/^[0-9a-f]+$/)==null))return-1;try{var l=a.substr(0,2);if(l=="00")return parseInt(a.substr(2),16);var c=parseInt(l,16);if(c>7)return-1;var p=a.substr(2),y=parseInt(p,16).toString(2);y=="0"&&(y="00000000"),y=y.slice(0,0-c);var v=parseInt(y,2);return v==NaN?-1:v}catch{return-1}}function Gf(a){if(typeof a!="number"||a<0)return null;var l=Number(a).toString(2),c=8-l.length%8;c==8&&(c=0),l=l+Gu("",c,"0");var p=parseInt(l,2).toString(16);p.length%2==1&&(p="0"+p);var y="0"+c;return y+p}function Kf(a){if(typeof a!="string"||a.length%2!=0||!a.match(/^[0-9a-f]+$/))return null;try{var l=parseInt(a.substr(0,2),16);if(l<0||7<l)return null;for(var c=a.substr(2),p="",y=0;y<c.length;y+=2){var v=c.substr(y,2),x=parseInt(v,16).toString(2);x=("0000000"+x).slice(-8),p+=x}return p.substr(0,p.length-l)}catch{return null}}function Q0(a){if(typeof a!="string"||a.match(/^[01]+$/)==null)return null;try{var l=parseInt(a,2);return Gf(l)}catch{return null}}function Ku(a,l){for(var c=0,p=0;p<a.length;p++)c|=1<<l[a[p]];for(var y=c.toString(2),v="",p=y.length-1;p>=0;p--)v+=y[p];return v}function Hs(a,p,c){if(typeof a=="object"){for(var p=String(p).split("."),y=0;y<p.length&&a;y++){var v=p[y];v.match(/^[0-9]+$/)&&(v=parseInt(v)),a=a[v]}return a||a===!1?a:c}}function xe(a,l){var c=function(){};c.prototype=l.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=l.prototype,l.prototype.constructor==Object.prototype.constructor&&(l.prototype.constructor=l)}(typeof S>"u"||!S)&&(S={}),(typeof S.crypto>"u"||!S.crypto)&&(S.crypto={}),S.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:i.algo.MD5,sha1:i.algo.SHA1,sha224:i.algo.SHA224,sha256:i.algo.SHA256,sha384:i.algo.SHA384,sha512:i.algo.SHA512,ripemd160:i.algo.RIPEMD160},this.getDigestInfoHex=function(a,l){if(typeof this.DIGESTINFOHEAD[l]>"u")throw"alg not supported in Util.DIGESTINFOHEAD: "+l;return this.DIGESTINFOHEAD[l]+a},this.getPaddedDigestInfoHex=function(a,l,c){var p=this.getDigestInfoHex(a,l),y=c/4;if(p.length+22>y)throw"key is too short for SigAlg: keylen="+c+","+l;for(var v="0001",x="00"+p,C="",O=y-v.length-x.length,_=0;_<O;_+=2)C+="ff";var B=v+C+x;return B},this.hashString=function(a,l){var c=new S.crypto.MessageDigest({alg:l});return c.digestString(a)},this.hashHex=function(a,l){var c=new S.crypto.MessageDigest({alg:l});return c.digestHex(a)},this.sha1=function(a){return this.hashString(a,"sha1")},this.sha256=function(a){return this.hashString(a,"sha256")},this.sha256Hex=function(a){return this.hashHex(a,"sha256")},this.sha512=function(a){return this.hashString(a,"sha512")},this.sha512Hex=function(a){return this.hashHex(a,"sha512")},this.isKey=function(a){return a instanceof Je||a instanceof S.crypto.DSA||a instanceof S.crypto.ECDSA}},S.crypto.Util.md5=function(a){var l=new S.crypto.MessageDigest({alg:"md5",prov:"cryptojs"});return l.digestString(a)},S.crypto.Util.ripemd160=function(a){var l=new S.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"});return l.digestString(a)},S.crypto.Util.SECURERANDOMGEN=new bi,S.crypto.Util.getRandomHexOfNbytes=function(a){var l=new Array(a);return S.crypto.Util.SECURERANDOMGEN.nextBytes(l),Sa(l)},S.crypto.Util.getRandomBigIntegerOfNbytes=function(a){return new g(S.crypto.Util.getRandomHexOfNbytes(a),16)},S.crypto.Util.getRandomHexOfNbits=function(a){var l=a%8,c=(a-l)/8,p=new Array(c+1);return S.crypto.Util.SECURERANDOMGEN.nextBytes(p),p[0]=(255<<l&255^255)&p[0],Sa(p)},S.crypto.Util.getRandomBigIntegerOfNbits=function(a){return new g(S.crypto.Util.getRandomHexOfNbits(a),16)},S.crypto.Util.getRandomBigIntegerZeroToMax=function(a){for(var l=a.bitLength();;){var c=S.crypto.Util.getRandomBigIntegerOfNbits(l);if(a.compareTo(c)!=-1)return c}},S.crypto.Util.getRandomBigIntegerMinToMax=function(a,l){var c=a.compareTo(l);if(c==1)throw"biMin is greater than biMax";if(c==0)return a;var p=l.subtract(a),y=S.crypto.Util.getRandomBigIntegerZeroToMax(p);return y.add(a)},S.crypto.MessageDigest=function(a){this.setAlgAndProvider=function(l,c){if(l=S.crypto.MessageDigest.getCanonicalAlgName(l),l!==null&&c===void 0&&(c=S.crypto.Util.DEFAULTPROVIDER[l]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(l)!=-1&&c=="cryptojs"){try{this.md=S.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[l].create()}catch(p){throw"setAlgAndProvider hash alg set fail alg="+l+"/"+p}this.updateString=function(p){this.md.update(p)},this.updateHex=function(p){var y=i.enc.Hex.parse(p);this.md.update(y)},this.digest=function(){var p=this.md.finalize();return p.toString(i.enc.Hex)},this.digestString=function(p){return this.updateString(p),this.digest()},this.digestHex=function(p){return this.updateHex(p),this.digest()}}if(":sha256:".indexOf(l)!=-1&&c=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(p){throw"setAlgAndProvider hash alg set fail alg="+l+"/"+p}this.updateString=function(p){this.md.update(p)},this.updateHex=function(p){var y=sjcl.codec.hex.toBits(p);this.md.update(y)},this.digest=function(){var p=this.md.finalize();return sjcl.codec.hex.fromBits(p)},this.digestString=function(p){return this.updateString(p),this.digest()},this.digestHex=function(p){return this.updateHex(p),this.digest()}}},this.updateString=function(l){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(l){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(l){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(l){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},a!==void 0&&a.alg!==void 0&&(this.algName=a.alg,a.prov===void 0&&(this.provName=S.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},S.crypto.MessageDigest.getCanonicalAlgName=function(a){return typeof a=="string"&&(a=a.toLowerCase(),a=a.replace(/-/,"")),a},S.crypto.MessageDigest.getHashLength=function(a){var l=S.crypto.MessageDigest,c=l.getCanonicalAlgName(a);if(l.HASHLENGTH[c]===void 0)throw"not supported algorithm: "+a;return l.HASHLENGTH[c]},S.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},S.crypto.Mac=function(a){this.setAlgAndProvider=function(l,c){if(l=l.toLowerCase(),l==null&&(l="hmacsha1"),l=l.toLowerCase(),l.substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+l;c===void 0&&(c=S.crypto.Util.DEFAULTPROVIDER[l]),this.algProv=l+"/"+c;var p=l.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(p)!=-1&&c=="cryptojs"){try{var y=S.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[p];this.mac=i.algo.HMAC.create(y,this.pass)}catch(v){throw"setAlgAndProvider hash alg set fail hashAlg="+p+"/"+v}this.updateString=function(v){this.mac.update(v)},this.updateHex=function(v){var x=i.enc.Hex.parse(v);this.mac.update(x)},this.doFinal=function(){var v=this.mac.finalize();return v.toString(i.enc.Hex)},this.doFinalString=function(v){return this.updateString(v),this.doFinal()},this.doFinalHex=function(v){return this.updateHex(v),this.doFinal()}}},this.updateString=function(l){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(l){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(l){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(l){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(l){if(typeof l=="string"){var c=l;(l.length%2==1||!l.match(/^[0-9A-Fa-f]+$/))&&(c=Pn(l)),this.pass=i.enc.Hex.parse(c);return}if(typeof l!="object")throw"KJUR.crypto.Mac unsupported password type: "+l;var c=null;if(l.hex!==void 0){if(l.hex.length%2!=0||!l.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+l.hex;c=l.hex}if(l.utf8!==void 0&&(c=zu(l.utf8)),l.rstr!==void 0&&(c=Pn(l.rstr)),l.b64!==void 0&&(c=d(l.b64)),l.b64u!==void 0&&(c=Pt(l.b64u)),c==null)throw"KJUR.crypto.Mac unsupported password type: "+l;this.pass=i.enc.Hex.parse(c)},a!==void 0&&(a.pass!==void 0&&this.setPassword(a.pass),a.alg!==void 0&&(this.algName=a.alg,a.prov===void 0&&(this.provName=S.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},S.crypto.Signature=function(a){var l=null;if(this._setAlgNames=function(){var c=this.algName.match(/^(.+)with(.+)$/);c&&(this.mdAlgName=c[1].toLowerCase(),this.pubkeyAlgName=c[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(c,p){for(var y="",v=p/4-c.length,x=0;x<v;x++)y=y+"0";return y+c},this.setAlgAndProvider=function(c,p){if(this._setAlgNames(),p!="cryptojs/jsrsa")throw new Error("provider not supported: "+p);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new S.crypto.MessageDigest({alg:this.mdAlgName})}catch(y){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+y)}this.init=function(y,v){var x=null;try{v===void 0?x=gt.getKey(y):x=gt.getKey(y,v)}catch(C){throw"init failed:"+C}if(x.isPrivate===!0)this.prvKey=x,this.state="SIGN";else if(x.isPublic===!0)this.pubKey=x,this.state="VERIFY";else throw"init failed.:"+x},this.updateString=function(y){this.md.updateString(y)},this.updateHex=function(y){this.md.updateHex(y)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&S.crypto.ECDSA!==void 0&&(this.prvKey=new S.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof Je&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof Je&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof S.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else if(this.prvKey instanceof S.crypto.DSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;return this.hSign},this.signString=function(y){return this.updateString(y),this.sign()},this.signHex=function(y){return this.updateHex(y),this.sign()},this.verify=function(y){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&S.crypto.ECDSA!==void 0&&(this.pubKey=new S.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof Je&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,y,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof Je&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,y);if(S.crypto.ECDSA!==void 0&&this.pubKey instanceof S.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,y);if(S.crypto.DSA!==void 0&&this.pubKey instanceof S.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,y);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(c,p){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(c){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(c){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(c){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(c){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(c){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=a,a!==void 0&&(a.alg!==void 0&&(this.algName=a.alg,a.prov===void 0?this.provName=S.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=a.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),a.psssaltlen!==void 0&&(this.pssSaltLen=a.psssaltlen),a.prvkeypem!==void 0)){if(a.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{var l=gt.getKey(a.prvkeypem);this.init(l)}catch(c){throw"fatal error to load pem private key: "+c}}},S.crypto.Cipher=function(a){},S.crypto.Cipher.encrypt=function(a,l,c){if(l instanceof Je&&l.isPublic){var p=S.crypto.Cipher.getAlgByKeyAndName(l,c);if(p==="RSA")return l.encrypt(a);if(p==="RSAOAEP")return l.encryptOAEP(a,"sha1");var y=p.match(/^RSAOAEP(\d+)$/);if(y!==null)return l.encryptOAEP(a,"sha"+y[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+c}else throw"Cipher.encrypt: unsupported key or algorithm"},S.crypto.Cipher.decrypt=function(a,l,c){if(l instanceof Je&&l.isPrivate){var p=S.crypto.Cipher.getAlgByKeyAndName(l,c);if(p==="RSA")return l.decrypt(a);if(p==="RSAOAEP")return l.decryptOAEP(a,"sha1");var y=p.match(/^RSAOAEP(\d+)$/);if(y!==null)return l.decryptOAEP(a,"sha"+y[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+c}else throw"Cipher.decrypt: unsupported key or algorithm"},S.crypto.Cipher.getAlgByKeyAndName=function(a,l){if(a instanceof Je){if(":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(l)!=-1)return l;if(l==null)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+l}throw"getAlgByKeyAndName: not supported algorithm name: "+l},S.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040022":"secp384r1","2b81040023":"secp521r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},(typeof S>"u"||!S)&&(S={}),(typeof S.crypto>"u"||!S.crypto)&&(S.crypto={}),S.crypto.ECDSA=function(a){var l="secp256r1",c=Error,p=g,y=mt,v=S.crypto.ECDSA,x=S.crypto.ECParameterDB,C=v.getName,O=Fe,_=O.getVbyListEx,B=O.isASN1HEX,N=new bi;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(w){return new p(w.bitLength(),N).mod(w.subtract(p.ONE)).add(p.ONE)},this.setNamedCurve=function(w){this.ecparams=x.getByName(w),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=w},this.setPrivateKeyHex=function(w){this.isPrivate=!0,this.prvKeyHex=w},this.setPublicKeyHex=function(w){this.isPublic=!0,this.pubKeyHex=w},this.getPublicKeyXYHex=function(){var w=this.pubKeyHex;if(w.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var I=this.ecparams.keycharlen;if(w.length!==2+I*2)throw"malformed public key hex length";var R={};return R.x=w.substr(2,I),R.y=w.substr(2+I),R},this.getShortNISTPCurveName=function(){var w=this.curveName;return w==="secp256r1"||w==="NIST P-256"||w==="P-256"||w==="prime256v1"?"P-256":w==="secp384r1"||w==="NIST P-384"||w==="P-384"?"P-384":w==="secp521r1"||w==="NIST P-521"||w==="P-521"?"P-521":null},this.generateKeyPairHex=function(){var w=this.ecparams.n,I=this.getBigRandom(w),R=this.ecparams.keycharlen,F=("0000000000"+I.toString(16)).slice(-R);this.setPrivateKeyHex(F);var L=this.generatePublicKeyHex();return{ecprvhex:F,ecpubhex:L}},this.generatePublicKeyHex=function(){var w=new p(this.prvKeyHex,16),I=this.ecparams.G.multiply(w),R=I.getX().toBigInteger(),F=I.getY().toBigInteger(),L=this.ecparams.keycharlen,V=("0000000000"+R.toString(16)).slice(-L),te=("0000000000"+F.toString(16)).slice(-L),ue="04"+V+te;return this.setPublicKeyHex(ue),ue},this.signWithMessageHash=function(w){return this.signHex(w,this.prvKeyHex)},this.signHex=function(w,I){var R=new p(I,16),F=this.ecparams.n,L=new p(w.substring(0,this.ecparams.keycharlen),16);do var V=this.getBigRandom(F),te=this.ecparams.G,ue=te.multiply(V),ae=ue.getX().toBigInteger().mod(F);while(ae.compareTo(p.ZERO)<=0);var le=V.modInverse(F).multiply(L.add(R.multiply(ae))).mod(F);return v.biRSSigToASN1Sig(ae,le)},this.sign=function(w,I){var R=I,F=this.ecparams.n,L=p.fromByteArrayUnsigned(w);do var V=this.getBigRandom(F),te=this.ecparams.G,ue=te.multiply(V),ae=ue.getX().toBigInteger().mod(F);while(ae.compareTo(g.ZERO)<=0);var le=V.modInverse(F).multiply(L.add(R.multiply(ae))).mod(F);return this.serializeSig(ae,le)},this.verifyWithMessageHash=function(w,I){return this.verifyHex(w,I,this.pubKeyHex)},this.verifyHex=function(w,I,R){try{var F,L,V=v.parseSigHex(I);F=V.r,L=V.s;var te=y.decodeFromHex(this.ecparams.curve,R),ue=new p(w.substring(0,this.ecparams.keycharlen),16);return this.verifyRaw(ue,F,L,te)}catch{return!1}},this.verify=function(w,I,R){var F,L;if(Bitcoin.Util.isArray(I)){var V=this.parseSig(I);F=V.r,L=V.s}else if(typeof I=="object"&&I.r&&I.s)F=I.r,L=I.s;else throw"Invalid value for signature";var te;if(R instanceof mt)te=R;else if(Bitcoin.Util.isArray(R))te=y.decodeFrom(this.ecparams.curve,R);else throw"Invalid format for pubkey value, must be byte array or ECPointFp";var ue=p.fromByteArrayUnsigned(w);return this.verifyRaw(ue,F,L,te)},this.verifyRaw=function(w,I,R,F){var L=this.ecparams.n,V=this.ecparams.G;if(I.compareTo(p.ONE)<0||I.compareTo(L)>=0||R.compareTo(p.ONE)<0||R.compareTo(L)>=0)return!1;var te=R.modInverse(L),ue=w.multiply(te).mod(L),ae=I.multiply(te).mod(L),le=V.multiply(ue).add(F.multiply(ae)),H=le.getX().toBigInteger().mod(L);return H.equals(I)},this.serializeSig=function(w,I){var R=w.toByteArraySigned(),F=I.toByteArraySigned(),L=[];return L.push(2),L.push(R.length),L=L.concat(R),L.push(2),L.push(F.length),L=L.concat(F),L.unshift(L.length),L.unshift(48),L},this.parseSig=function(w){var I;if(w[0]!=48)throw new Error("Signature not a valid DERSequence");if(I=2,w[I]!=2)throw new Error("First element in signature must be a DERInteger");var R=w.slice(I+2,I+2+w[I+1]);if(I+=2+w[I+1],w[I]!=2)throw new Error("Second element in signature must be a DERInteger");var F=w.slice(I+2,I+2+w[I+1]);I+=2+w[I+1];var L=p.fromByteArrayUnsigned(R),V=p.fromByteArrayUnsigned(F);return{r:L,s:V}},this.parseSigCompact=function(w){if(w.length!==65)throw"Signature has the wrong length";var I=w[0]-27;if(I<0||I>7)throw"Invalid signature type";var R=this.ecparams.n,F=p.fromByteArrayUnsigned(w.slice(1,33)).mod(R),L=p.fromByteArrayUnsigned(w.slice(33,65)).mod(R);return{r:F,s:L,i:I}},this.readPKCS5PrvKeyHex=function(w){if(B(w)===!1)throw new Error("not ASN.1 hex string");var I,R,F;try{I=_(w,0,["[0]",0],"06"),R=_(w,0,[1],"04");try{F=_(w,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=C(I),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(F),this.setPrivateKeyHex(R),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(w){if(B(w)===!1)throw new c("not ASN.1 hex string");var I,R,F,L;try{I=_(w,0,[1,0],"06"),R=_(w,0,[1,1],"06"),F=_(w,0,[2,0,1],"04");try{L=_(w,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new c("malformed PKCS#8 plain ECC private key")}if(this.curveName=C(R),this.curveName===void 0)throw new c("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(L),this.setPrivateKeyHex(F),this.isPublic=!1},this.readPKCS8PubKeyHex=function(w){if(B(w)===!1)throw new c("not ASN.1 hex string");var I,R,F;try{I=_(w,0,[0,0],"06"),R=_(w,0,[0,1],"06"),F=_(w,0,[1],"03")}catch{throw new c("malformed PKCS#8 ECC public key")}if(this.curveName=C(R),this.curveName===null)throw new c("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(F)},this.readCertPubKeyHex=function(w,I){if(B(w)===!1)throw new c("not ASN.1 hex string");var R,F;try{R=_(w,0,[0,5,0,1],"06"),F=_(w,0,[0,5,1],"03")}catch{throw new c("malformed X.509 certificate ECC public key")}if(this.curveName=C(R),this.curveName===null)throw new c("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(F)},a!==void 0&&a.curve!==void 0&&(this.curveName=a.curve),this.curveName===void 0&&(this.curveName=l),this.setNamedCurve(this.curveName),a!==void 0&&(a.prv!==void 0&&this.setPrivateKeyHex(a.prv),a.pub!==void 0&&this.setPublicKeyHex(a.pub))},S.crypto.ECDSA.parseSigHex=function(a){var l=S.crypto.ECDSA.parseSigHexInHexRS(a),c=new g(l.r,16),p=new g(l.s,16);return{r:c,s:p}},S.crypto.ECDSA.parseSigHexInHexRS=function(a){var l=Fe,c=l.getChildIdx,p=l.getV;if(l.checkStrictDER(a,0),a.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var y=c(a,0);if(y.length!=2)throw new Error("signature shall have two elements");var v=y[0],x=y[1];if(a.substr(v,2)!="02")throw new Error("1st item not ASN.1 integer");if(a.substr(x,2)!="02")throw new Error("2nd item not ASN.1 integer");var C=p(a,v),O=p(a,x);return{r:C,s:O}},S.crypto.ECDSA.asn1SigToConcatSig=function(a){var l=S.crypto.ECDSA.parseSigHexInHexRS(a),c=l.r,p=l.s;if(c.length>=130&&c.length<=134){if(c.length%2!=0)throw Error("unknown ECDSA sig r length error");if(p.length%2!=0)throw Error("unknown ECDSA sig s length error");c.substr(0,2)=="00"&&(c=c.substr(2)),p.substr(0,2)=="00"&&(p=p.substr(2));var y=Math.max(c.length,p.length);return c=("000000"+c).slice(-y),p=("000000"+p).slice(-y),c+p}if(c.substr(0,2)=="00"&&c.length%32==2&&(c=c.substr(2)),p.substr(0,2)=="00"&&p.length%32==2&&(p=p.substr(2)),c.length%32==30&&(c="00"+c),p.length%32==30&&(p="00"+p),c.length%32!=0)throw Error("unknown ECDSA sig r length error");if(p.length%32!=0)throw Error("unknown ECDSA sig s length error");return c+p},S.crypto.ECDSA.concatSigToASN1Sig=function(a){if(a.length%4!=0)throw Error("unknown ECDSA concatinated r-s sig length error");var l=a.substr(0,a.length/2),c=a.substr(a.length/2);return S.crypto.ECDSA.hexRSSigToASN1Sig(l,c)},S.crypto.ECDSA.hexRSSigToASN1Sig=function(a,l){var c=new g(a,16),p=new g(l,16);return S.crypto.ECDSA.biRSSigToASN1Sig(c,p)},S.crypto.ECDSA.biRSSigToASN1Sig=function(a,l){var c=S.asn1,p=new c.DERInteger({bigint:a}),y=new c.DERInteger({bigint:l}),v=new c.DERSequence({array:[p,y]});return v.tohex()},S.crypto.ECDSA.getName=function(a){return a==="2b8104001f"?"secp192k1":a==="2a8648ce3d030107"?"secp256r1":a==="2b8104000a"?"secp256k1":a==="2b81040021"?"secp224r1":a==="2b81040022"?"secp384r1":a==="2b81040023"?"secp521r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(a)!==-1?"secp256r1":"|secp256k1|".indexOf(a)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(a)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(a)!==-1?"secp384r1":"|secp521r1|NIST P-521|P-521|".indexOf(a)!==-1?"secp521r1":null},(typeof S>"u"||!S)&&(S={}),(typeof S.crypto>"u"||!S.crypto)&&(S.crypto={}),S.crypto.ECParameterDB=new function(){var a={},l={};function c(p){return new g(p,16)}this.getByName=function(p){var y=p;if(typeof l[y]<"u"&&(y=l[p]),typeof a[y]<"u")return a[y];throw"unregistered EC curve name: "+y},this.regist=function(p,y,v,x,C,O,_,B,N,w,I,R){a[p]={};var F=c(v),L=c(x),V=c(C),te=c(O),ue=c(_),ae=new Yr(F,L,V),le=ae.decodePointHex("04"+B+N);a[p].name=p,a[p].keylen=y,a[p].keycharlen=Math.ceil(y/8)*2,a[p].curve=ae,a[p].G=le,a[p].n=te,a[p].h=ue,a[p].oid=I,a[p].info=R;for(var H=0;H<w.length;H++)l[w[H]]=p}},S.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),S.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),S.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),S.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),S.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),S.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),S.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),S.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),S.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),S.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]),(typeof S>"u"||!S)&&(S={}),(typeof S.crypto>"u"||!S.crypto)&&(S.crypto={}),S.crypto.DSA=function(){var a=Fe;a.getVbyList;var l=a.getVbyListEx,c=a.isASN1HEX,p=g;this.p=null,this.q=null,this.g=null,this.y=null,this.x=null,this.type="DSA",this.isPrivate=!1,this.isPublic=!1,this.setPrivate=function(y,v,x,C,O){this.isPrivate=!0,this.p=y,this.q=v,this.g=x,this.y=C,this.x=O},this.setPrivateHex=function(y,v,x,C,O){var _,B,N,w,I;_=new g(y,16),B=new g(v,16),N=new g(x,16),typeof C=="string"&&C.length>1?w=new g(C,16):w=null,I=new g(O,16),this.setPrivate(_,B,N,w,I)},this.setPublic=function(y,v,x,C){this.isPublic=!0,this.p=y,this.q=v,this.g=x,this.y=C,this.x=null},this.setPublicHex=function(y,v,x,C){var O,_,B,N;O=new g(y,16),_=new g(v,16),B=new g(x,16),N=new g(C,16),this.setPublic(O,_,B,N)},this.signWithMessageHash=function(y){var v=this.p,x=this.q,C=this.g;this.y;var O=this.x,_=S.crypto.Util.getRandomBigIntegerMinToMax(g.ONE.add(g.ONE),x.subtract(g.ONE)),B=y.substr(0,x.bitLength()/4),N=new g(B,16),w=C.modPow(_,v).mod(x),I=_.modInverse(x).multiply(N.add(O.multiply(w))).mod(x),R=S.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:w}},{int:{bigint:I}}]});return R},this.verifyWithMessageHash=function(y,v){var x=this.p,C=this.q,O=this.g,_=this.y,B=this.parseASN1Signature(v),N=B[0],w=B[1],I=y.substr(0,C.bitLength()/4),R=new g(I,16);if(g.ZERO.compareTo(N)>0||N.compareTo(C)>0||g.ZERO.compareTo(w)>=0||w.compareTo(C)>0)throw"invalid DSA signature";var F=w.modInverse(C),L=R.multiply(F).mod(C),V=N.multiply(F).mod(C),te=O.modPow(L,x).multiply(_.modPow(V,x)).mod(x).mod(C);return te.compareTo(N)==0},this.parseASN1Signature=function(y){try{var v=new p(l(y,0,[0],"02"),16),x=new p(l(y,0,[1],"02"),16);return[v,x]}catch{throw new Error("malformed ASN.1 DSA signature")}},this.readPKCS5PrvKeyHex=function(y){var v,x,C,O,_;if(c(y)===!1)throw new Error("not ASN.1 hex string");try{v=l(y,0,[1],"02"),x=l(y,0,[2],"02"),C=l(y,0,[3],"02"),O=l(y,0,[4],"02"),_=l(y,0,[5],"02")}catch{throw new Error("malformed PKCS#1/5 plain DSA private key")}this.setPrivateHex(v,x,C,O,_)},this.readPKCS8PrvKeyHex=function(y){var v,x,C,O;if(c(y)===!1)throw new Error("not ASN.1 hex string");try{v=l(y,0,[1,1,0],"02"),x=l(y,0,[1,1,1],"02"),C=l(y,0,[1,1,2],"02"),O=l(y,0,[2,0],"02")}catch{throw new Error("malformed PKCS#8 plain DSA private key")}this.setPrivateHex(v,x,C,null,O)},this.readPKCS8PubKeyHex=function(y){var v,x,C,O;if(c(y)===!1)throw new Error("not ASN.1 hex string");try{v=l(y,0,[0,1,0],"02"),x=l(y,0,[0,1,1],"02"),C=l(y,0,[0,1,2],"02"),O=l(y,0,[1,0],"02")}catch{throw new Error("malformed PKCS#8 DSA public key")}this.setPublicHex(v,x,C,O)},this.readCertPubKeyHex=function(y,v){var x,C,O,_;if(c(y)===!1)throw new Error("not ASN.1 hex string");try{x=l(y,0,[0,5,0,1,0],"02"),C=l(y,0,[0,5,0,1,1],"02"),O=l(y,0,[0,5,0,1,2],"02"),_=l(y,0,[0,5,1,0],"02")}catch{throw new Error("malformed X.509 certificate DSA public key")}this.setPublicHex(x,C,O,_)}};var gt=function(){var a=function(R,F,L){return p(i.AES,R,F,L)},l=function(R,F,L){return p(i.TripleDES,R,F,L)},c=function(R,F,L){return p(i.DES,R,F,L)},p=function(R,F,L,V){var te=i.enc.Hex.parse(F),ue=i.enc.Hex.parse(L),ae=i.enc.Hex.parse(V),le={};le.key=ue,le.iv=ae,le.ciphertext=te;var H=R.decrypt(le,ue,{iv:ae});return i.enc.Hex.stringify(H)},y=function(R,F,L){return C(i.AES,R,F,L)},v=function(R,F,L){return C(i.TripleDES,R,F,L)},x=function(R,F,L){return C(i.DES,R,F,L)},C=function(R,F,L,V){var te=i.enc.Hex.parse(F),ue=i.enc.Hex.parse(L),ae=i.enc.Hex.parse(V),le=R.encrypt(te,ue,{iv:ae}),H=i.enc.Hex.parse(le.toString()),W=i.enc.Base64.stringify(H);return W},O={"AES-256-CBC":{proc:a,eproc:y,keylen:32,ivlen:16},"AES-192-CBC":{proc:a,eproc:y,keylen:24,ivlen:16},"AES-128-CBC":{proc:a,eproc:y,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:l,eproc:v,keylen:24,ivlen:8},"DES-CBC":{proc:c,eproc:x,keylen:8,ivlen:8}},_=function(R){var F=i.lib.WordArray.random(R),L=i.enc.Hex.stringify(F);return L},B=function(R){var F={},L=R.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));L&&(F.cipher=L[1],F.ivsalt=L[2]);var V=R.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));V&&(F.type=V[1]);var te=-1,ue=0;R.indexOf(`\r
\r
`)!=-1&&(te=R.indexOf(`\r
\r
`),ue=2),R.indexOf(`

`)!=-1&&(te=R.indexOf(`

`),ue=1);var ae=R.indexOf("-----END");if(te!=-1&&ae!=-1){var le=R.substring(te+ue*2,ae-ue);le=le.replace(/\s+/g,""),F.data=le}return F},N=function(R,F,L){for(var V=L.substring(0,16),te=i.enc.Hex.parse(V),ue=i.enc.Utf8.parse(F),ae=O[R].keylen+O[R].ivlen,le="",H=null;;){var W=i.algo.MD5.create();if(H!=null&&W.update(H),W.update(ue),W.update(te),H=W.finalize(),le=le+i.enc.Hex.stringify(H),le.length>=ae*2)break}var J={};return J.keyhex=le.substr(0,O[R].keylen*2),J.ivhex=le.substr(O[R].keylen*2,O[R].ivlen*2),J},w=function(R,F,L,V){var te=i.enc.Base64.parse(R),ue=i.enc.Hex.stringify(te),ae=O[F].proc,le=ae(ue,L,V);return le},I=function(R,F,L,V){var te=O[F].eproc,ue=te(R,L,V);return ue};return{version:"1.0.0",parsePKCS5PEM:function(R){return B(R)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(R,F,L){return N(R,F,L)},decryptKeyB64:function(R,F,L,V){return w(R,F,L,V)},getDecryptedKeyHex:function(R,F){var L=B(R),V=L.cipher,te=L.ivsalt,ue=L.data,ae=N(V,F,te),le=ae.keyhex,H=w(ue,V,le,te);return H},getEncryptedPKCS5PEMFromPrvKeyHex:function(R,F,L,V,te){var $="";if((typeof V>"u"||V==null)&&(V="AES-256-CBC"),typeof O[V]>"u")throw new Error("KEYUTIL unsupported algorithm: "+V);if(typeof te>"u"||te==null){var ue=O[V].ivlen,ae=_(ue);te=ae.toUpperCase()}var le=N(V,L,te),H=le.keyhex,W=I(F,V,H,te),J=W.replace(/(.{64})/g,`$1\r
`),$="-----BEGIN "+R+` PRIVATE KEY-----\r
`;return $+=`Proc-Type: 4,ENCRYPTED\r
`,$+="DEK-Info: "+V+","+te+`\r
`,$+=`\r
`,$+=J,$+=`\r
-----END `+R+` PRIVATE KEY-----\r
`,$},parseHexOfEncryptedPKCS8:function(R){var F=Fe,L=F.getChildIdx,V=F.getV,te={},ue=L(R,0);if(ue.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+ue.length);te.ciphertext=V(R,ue[1]);var ae=L(R,ue[0]);if(ae.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+ae.length);if(V(R,ae[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var le=L(R,ae[1]);if(ae.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+le.length);var H=L(R,le[1]);if(H.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+H.length);if(V(R,H[0])!="2a864886f70d0307")throw"this only supports TripleDES";te.encryptionSchemeAlg="TripleDES",te.encryptionSchemeIV=V(R,H[1]);var W=L(R,le[0]);if(W.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+W.length);if(V(R,W[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var J=L(R,W[1]);if(J.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+J.length);te.pbkdf2Salt=V(R,J[0]);var $=V(R,J[1]);try{te.pbkdf2Iter=parseInt($,16)}catch{throw new Error("malformed format pbkdf2Iter: "+$)}return te},getPBKDF2KeyHexFromParam:function(R,F){var L=i.enc.Hex.parse(R.pbkdf2Salt),V=R.pbkdf2Iter,te=i.PBKDF2(F,L,{keySize:192/32,iterations:V}),ue=i.enc.Hex.stringify(te);return ue},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(R,F){var L=zt(R,"ENCRYPTED PRIVATE KEY"),V=this.parseHexOfEncryptedPKCS8(L),te=gt.getPBKDF2KeyHexFromParam(V,F),ue={};ue.ciphertext=i.enc.Hex.parse(V.ciphertext);var ae=i.enc.Hex.parse(te),le=i.enc.Hex.parse(V.encryptionSchemeIV),H=i.TripleDES.decrypt(ue,ae,{iv:le}),W=i.enc.Hex.stringify(H);return W},getKeyFromEncryptedPKCS8PEM:function(R,F){var L=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(R,F),V=this.getKeyFromPlainPrivatePKCS8Hex(L);return V},parsePlainPrivatePKCS8Hex:function(R){var F=Fe,L=F.getChildIdx,V=F.getV,te={};if(te.algparam=null,R.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var ue=L(R,0);if(ue.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(R.substr(ue[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var ae=L(R,ue[1]);if(ae.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(R.substr(ae[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(te.algoid=V(R,ae[0]),R.substr(ae[1],2)=="06"&&(te.algparam=V(R,ae[1])),R.substr(ue[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return te.keyidx=F.getVidx(R,ue[2]),te},getKeyFromPlainPrivatePKCS8PEM:function(R){var F=zt(R,"PRIVATE KEY"),L=this.getKeyFromPlainPrivatePKCS8Hex(F);return L},getKeyFromPlainPrivatePKCS8Hex:function(R){var F=this.parsePlainPrivatePKCS8Hex(R),L;if(F.algoid=="2a864886f70d010101")L=new Je;else if(F.algoid=="2a8648ce380401")L=new S.crypto.DSA;else if(F.algoid=="2a8648ce3d0201")L=new S.crypto.ECDSA;else throw new Error("unsupported private key algorithm");return L.readPKCS8PrvKeyHex(R),L},_getKeyFromPublicPKCS8Hex:function(R){var F,L=Fe.getVbyList(R,0,[0,0],"06");if(L==="2a864886f70d010101")F=new Je;else if(L==="2a8648ce380401")F=new S.crypto.DSA;else if(L==="2a8648ce3d0201")F=new S.crypto.ECDSA;else throw new Error("unsupported PKCS#8 public key hex");return F.readPKCS8PubKeyHex(R),F},parsePublicRawRSAKeyHex:function(R){var F=Fe,L=F.getChildIdx,V=F.getV,te={};if(R.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var ue=L(R,0);if(ue.length!=2)throw new Error("malformed RSA key(code:002)");if(R.substr(ue[0],2)!="02")throw new Error("malformed RSA key(code:003)");if(te.n=V(R,ue[0]),R.substr(ue[1],2)!="02")throw new Error("malformed RSA key(code:004)");return te.e=V(R,ue[1]),te},parsePublicPKCS8Hex:function(R){var F=Fe,L=F.getChildIdx,V=F.getV,te={};te.algparam=null;var ue=L(R,0);if(ue.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+ue.length);var ae=ue[0];if(R.substr(ae,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var le=L(R,ae);if(le.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(R.substr(le[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if(te.algoid=V(R,le[0]),R.substr(le[1],2)=="06"?te.algparam=V(R,le[1]):R.substr(le[1],2)=="30"&&(te.algparam={},te.algparam.p=F.getVbyList(R,le[1],[0],"02"),te.algparam.q=F.getVbyList(R,le[1],[1],"02"),te.algparam.g=F.getVbyList(R,le[1],[2],"02")),R.substr(ue[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return te.key=V(R,ue[1]).substr(2),te}}}();gt.getKey=function(a,l,c){var p=Fe,y=p.getChildIdx;p.getV;var v=p.getVbyList,x=S.crypto,C=x.ECDSA,O=x.DSA,_=Je,B=zt,N=gt;if(typeof _<"u"&&a instanceof _||typeof C<"u"&&a instanceof C||typeof O<"u"&&a instanceof O)return a;if(a.curve!==void 0&&a.xy!==void 0&&a.d===void 0)return new C({pub:a.xy,curve:a.curve});if(a.curve!==void 0&&a.d!==void 0)return new C({prv:a.d,curve:a.curve});if(a.kty===void 0&&a.n!==void 0&&a.e!==void 0&&a.d===void 0){var w=new _;return w.setPublic(a.n,a.e),w}if(a.kty===void 0&&a.n!==void 0&&a.e!==void 0&&a.d!==void 0&&a.p!==void 0&&a.q!==void 0&&a.dp!==void 0&&a.dq!==void 0&&a.co!==void 0&&a.qi===void 0){var w=new _;return w.setPrivateEx(a.n,a.e,a.d,a.p,a.q,a.dp,a.dq,a.co),w}if(a.kty===void 0&&a.n!==void 0&&a.e!==void 0&&a.d!==void 0&&a.p===void 0){var w=new _;return w.setPrivate(a.n,a.e,a.d),w}if(a.p!==void 0&&a.q!==void 0&&a.g!==void 0&&a.y!==void 0&&a.x===void 0){var w=new O;return w.setPublic(a.p,a.q,a.g,a.y),w}if(a.p!==void 0&&a.q!==void 0&&a.g!==void 0&&a.y!==void 0&&a.x!==void 0){var w=new O;return w.setPrivate(a.p,a.q,a.g,a.y,a.x),w}if(a.kty==="RSA"&&a.n!==void 0&&a.e!==void 0&&a.d===void 0){var w=new _;return w.setPublic(Pt(a.n),Pt(a.e)),w}if(a.kty==="RSA"&&a.n!==void 0&&a.e!==void 0&&a.d!==void 0&&a.p!==void 0&&a.q!==void 0&&a.dp!==void 0&&a.dq!==void 0&&a.qi!==void 0){var w=new _;return w.setPrivateEx(Pt(a.n),Pt(a.e),Pt(a.d),Pt(a.p),Pt(a.q),Pt(a.dp),Pt(a.dq),Pt(a.qi)),w}if(a.kty==="RSA"&&a.n!==void 0&&a.e!==void 0&&a.d!==void 0){var w=new _;return w.setPrivate(Pt(a.n),Pt(a.e),Pt(a.d)),w}if(a.kty==="EC"&&a.crv!==void 0&&a.x!==void 0&&a.y!==void 0&&a.d===void 0){var I=new C({curve:a.crv}),R=I.ecparams.keycharlen,F=("0000000000"+Pt(a.x)).slice(-R),L=("0000000000"+Pt(a.y)).slice(-R),V="04"+F+L;return I.setPublicKeyHex(V),I}if(a.kty==="EC"&&a.crv!==void 0&&a.x!==void 0&&a.y!==void 0&&a.d!==void 0){var I=new C({curve:a.crv}),R=I.ecparams.keycharlen,F=("0000000000"+Pt(a.x)).slice(-R),L=("0000000000"+Pt(a.y)).slice(-R),V="04"+F+L,te=("0000000000"+Pt(a.d)).slice(-R);return I.setPublicKeyHex(V),I.setPrivateKeyHex(te),I}if(c==="pkcs5prv"){var ue=a,p=Fe,ae,w;if(ae=y(ue,0),ae.length===9)w=new _,w.readPKCS5PrvKeyHex(ue);else if(ae.length===6)w=new O,w.readPKCS5PrvKeyHex(ue);else if(ae.length>2&&ue.substr(ae[1],2)==="04")w=new C,w.readPKCS5PrvKeyHex(ue);else throw new Error("unsupported PKCS#1/5 hexadecimal key");return w}if(c==="pkcs8prv"){var w=N.getKeyFromPlainPrivatePKCS8Hex(a);return w}if(c==="pkcs8pub")return N._getKeyFromPublicPKCS8Hex(a);if(c==="x509pub")return tt.getPublicKeyFromCertHex(a);if(a.indexOf("-END CERTIFICATE-",0)!=-1||a.indexOf("-END X509 CERTIFICATE-",0)!=-1||a.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return tt.getPublicKeyFromCertPEM(a);if(a.indexOf("-END PUBLIC KEY-")!=-1){var le=zt(a,"PUBLIC KEY");return N._getKeyFromPublicPKCS8Hex(le)}if(a.indexOf("-END RSA PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")==-1){var H=B(a,"RSA PRIVATE KEY");return N.getKey(H,null,"pkcs5prv")}if(a.indexOf("-END DSA PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")==-1){var W=B(a,"DSA PRIVATE KEY"),J=v(W,0,[1],"02"),$=v(W,0,[2],"02"),Z=v(W,0,[3],"02"),oe=v(W,0,[4],"02"),de=v(W,0,[5],"02"),w=new O;return w.setPrivate(new g(J,16),new g($,16),new g(Z,16),new g(oe,16),new g(de,16)),w}if(a.indexOf("-END EC PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")==-1){var H=B(a,"EC PRIVATE KEY");return N.getKey(H,null,"pkcs5prv")}if(a.indexOf("-END PRIVATE KEY-")!=-1)return N.getKeyFromPlainPrivatePKCS8PEM(a);if(a.indexOf("-END RSA PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")!=-1){var Te=N.getDecryptedKeyHex(a,l),h=new Je;return h.readPKCS5PrvKeyHex(Te),h}if(a.indexOf("-END EC PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")!=-1){var W=N.getDecryptedKeyHex(a,l),w=v(W,0,[1],"04"),T=v(W,0,[2,0],"06"),b=v(W,0,[3,0],"03").substr(2),A="";if(S.crypto.OID.oidhex2name[T]!==void 0)A=S.crypto.OID.oidhex2name[T];else throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+T);var I=new C({curve:A});return I.setPublicKeyHex(b),I.setPrivateKeyHex(w),I.isPublic=!1,I}if(a.indexOf("-END DSA PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")!=-1){var W=N.getDecryptedKeyHex(a,l),J=v(W,0,[1],"02"),$=v(W,0,[2],"02"),Z=v(W,0,[3],"02"),oe=v(W,0,[4],"02"),de=v(W,0,[5],"02"),w=new O;return w.setPrivate(new g(J,16),new g($,16),new g(Z,16),new g(oe,16),new g(de,16)),w}if(a.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return N.getKeyFromEncryptedPKCS8PEM(a,l);throw new Error("not supported argument")},gt.generateKeypair=function(a,l){if(a=="RSA"){var c=l,p=new Je;p.generate(c,"10001"),p.isPrivate=!0,p.isPublic=!0;var y=new Je,v=p.n.toString(16),x=p.e.toString(16);y.setPublic(v,x),y.isPrivate=!1,y.isPublic=!0;var C={};return C.prvKeyObj=p,C.pubKeyObj=y,C}else if(a=="EC"){var O=l,_=new S.crypto.ECDSA({curve:O}),B=_.generateKeyPairHex(),p=new S.crypto.ECDSA({curve:O});p.setPublicKeyHex(B.ecpubhex),p.setPrivateKeyHex(B.ecprvhex),p.isPrivate=!0,p.isPublic=!1;var y=new S.crypto.ECDSA({curve:O});y.setPublicKeyHex(B.ecpubhex),y.isPrivate=!1,y.isPublic=!0;var C={};return C.prvKeyObj=p,C.pubKeyObj=y,C}else throw new Error("unknown algorithm: "+a)},gt.getPEM=function(a,l,c,p,y,v){var x=S,C=x.asn1,O=C.DERObjectIdentifier,_=C.DERInteger,B=C.ASN1Util.newObject,N=C.x509,w=N.SubjectPublicKeyInfo,I=x.crypto,R=I.DSA,F=I.ECDSA,L=Je;function V(b){var A=B({seq:[{int:0},{int:{bigint:b.n}},{int:b.e},{int:{bigint:b.d}},{int:{bigint:b.p}},{int:{bigint:b.q}},{int:{bigint:b.dmp1}},{int:{bigint:b.dmq1}},{int:{bigint:b.coeff}}]});return A}function te(b){var A=B({seq:[{int:1},{octstr:{hex:b.prvKeyHex}},{tag:["a0",!0,{oid:{name:b.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+b.pubKeyHex}}]}]});return A}function ue(b){var A=B({seq:[{int:0},{int:{bigint:b.p}},{int:{bigint:b.q}},{int:{bigint:b.g}},{int:{bigint:b.y}},{int:{bigint:b.x}}]});return A}if((L!==void 0&&a instanceof L||R!==void 0&&a instanceof R||F!==void 0&&a instanceof F)&&a.isPublic==!0&&(l===void 0||l=="PKCS8PUB")){var ae=new w(a),le=ae.tohex();return dn(le,"PUBLIC KEY")}if(l=="PKCS1PRV"&&L!==void 0&&a instanceof L&&(c===void 0||c==null)&&a.isPrivate==!0){var ae=V(a),le=ae.tohex();return dn(le,"RSA PRIVATE KEY")}if(l=="PKCS1PRV"&&F!==void 0&&a instanceof F&&(c===void 0||c==null)&&a.isPrivate==!0){var H=new O({name:a.curveName}),W=H.tohex(),J=te(a),$=J.tohex(),Z="";return Z+=dn(W,"EC PARAMETERS"),Z+=dn($,"EC PRIVATE KEY"),Z}if(l=="PKCS1PRV"&&R!==void 0&&a instanceof R&&(c===void 0||c==null)&&a.isPrivate==!0){var ae=ue(a),le=ae.tohex();return dn(le,"DSA PRIVATE KEY")}if(l=="PKCS5PRV"&&L!==void 0&&a instanceof L&&c!==void 0&&c!=null&&a.isPrivate==!0){var ae=V(a),le=ae.tohex();return p===void 0&&(p="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",le,c,p,v)}if(l=="PKCS5PRV"&&F!==void 0&&a instanceof F&&c!==void 0&&c!=null&&a.isPrivate==!0){var ae=te(a),le=ae.tohex();return p===void 0&&(p="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",le,c,p,v)}if(l=="PKCS5PRV"&&R!==void 0&&a instanceof R&&c!==void 0&&c!=null&&a.isPrivate==!0){var ae=ue(a),le=ae.tohex();return p===void 0&&(p="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",le,c,p,v)}var oe=function(b,A){var q=de(b,A),G=new B({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:q.pbkdf2Salt}},{int:q.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:q.encryptionSchemeIV}}]}]}]},{octstr:{hex:q.ciphertext}}]});return G.tohex()},de=function(b,A){var q=100,G=i.lib.WordArray.random(8),Q="DES-EDE3-CBC",ne=i.lib.WordArray.random(8),me=i.PBKDF2(A,G,{keySize:192/32,iterations:q}),re=i.enc.Hex.parse(b),Se=i.TripleDES.encrypt(re,me,{iv:ne})+"",Ue={};return Ue.ciphertext=Se,Ue.pbkdf2Salt=i.enc.Hex.stringify(G),Ue.pbkdf2Iter=q,Ue.encryptionSchemeAlg=Q,Ue.encryptionSchemeIV=i.enc.Hex.stringify(ne),Ue};if(l=="PKCS8PRV"&&L!=null&&a instanceof L&&a.isPrivate==!0){var Te=V(a),h=Te.tohex(),ae=B({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:h}}]}),le=ae.tohex();if(c===void 0||c==null)return dn(le,"PRIVATE KEY");var $=oe(le,c);return dn($,"ENCRYPTED PRIVATE KEY")}if(l=="PKCS8PRV"&&F!==void 0&&a instanceof F&&a.isPrivate==!0){var T={seq:[{int:1},{octstr:{hex:a.prvKeyHex}}]};typeof a.pubKeyHex=="string"&&T.seq.push({tag:["a1",!0,{bitstr:{hex:"00"+a.pubKeyHex}}]});var Te=new B(T),h=Te.tohex(),ae=B({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:a.curveName}}]},{octstr:{hex:h}}]}),le=ae.tohex();if(c===void 0||c==null)return dn(le,"PRIVATE KEY");var $=oe(le,c);return dn($,"ENCRYPTED PRIVATE KEY")}if(l=="PKCS8PRV"&&R!==void 0&&a instanceof R&&a.isPrivate==!0){var Te=new _({bigint:a.x}),h=Te.tohex(),ae=B({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:a.p}},{int:{bigint:a.q}},{int:{bigint:a.g}}]}]},{octstr:{hex:h}}]}),le=ae.tohex();if(c===void 0||c==null)return dn(le,"PRIVATE KEY");var $=oe(le,c);return dn($,"ENCRYPTED PRIVATE KEY")}throw new Error("unsupported object nor format")},gt.getKeyFromCSRPEM=function(a){var l=zt(a,"CERTIFICATE REQUEST"),c=gt.getKeyFromCSRHex(l);return c},gt.getKeyFromCSRHex=function(a){var l=gt.parseCSRHex(a),c=gt.getKey(l.p8pubkeyhex,null,"pkcs8pub");return c},gt.parseCSRHex=function(a){var l=Fe,c=l.getChildIdx,p=l.getTLV,y={},v=a;if(v.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var x=c(v,0);if(x.length<1)throw new Error("malformed CSR(code:002)");if(v.substr(x[0],2)!="30")throw new Error("malformed CSR(code:003)");var C=c(v,x[0]);if(C.length<3)throw new Error("malformed CSR(code:004)");return y.p8pubkeyhex=p(v,C[2]),y},gt.getKeyID=function(a){var l=gt,c=Fe;typeof a=="string"&&a.indexOf("BEGIN ")!=-1&&(a=l.getKey(a));var p=zt(l.getPEM(a)),y=c.getIdxbyList(p,0,[1]),v=c.getV(p,y).substring(2);return S.crypto.Util.hashHex(v,"sha1")},gt.getJWK=function(a,l,c,p,y){var v,x={},C,O=S.crypto.Util.hashHex;if(typeof a=="string")v=gt.getKey(a),a.indexOf("CERTIFICATE")!=-1&&(C=zt(a));else if(typeof a=="object")a instanceof tt?(v=a.getPublicKey(),C=a.hex):v=a;else throw new Error("unsupported keyinfo type");if(v instanceof Je&&v.isPrivate)x.kty="RSA",x.n=Gt(v.n.toString(16)),x.e=Gt(v.e.toString(16)),x.d=Gt(v.d.toString(16)),x.p=Gt(v.p.toString(16)),x.q=Gt(v.q.toString(16)),x.dp=Gt(v.dmp1.toString(16)),x.dq=Gt(v.dmq1.toString(16)),x.qi=Gt(v.coeff.toString(16));else if(v instanceof Je&&v.isPublic)x.kty="RSA",x.n=Gt(v.n.toString(16)),x.e=Gt(v.e.toString(16));else if(v instanceof S.crypto.ECDSA&&v.isPrivate){var _=v.getShortNISTPCurveName();if(_!=="P-256"&&_!=="P-384"&&_!=="P-521")throw new Error("unsupported curve name for JWT: "+_);var B=v.getPublicKeyXYHex();x.kty="EC",x.crv=_,x.x=Gt(B.x),x.y=Gt(B.y),x.d=Gt(v.prvKeyHex)}else if(v instanceof S.crypto.ECDSA&&v.isPublic){var _=v.getShortNISTPCurveName();if(_!=="P-256"&&_!=="P-384"&&_!=="P-521")throw new Error("unsupported curve name for JWT: "+_);var B=v.getPublicKeyXYHex();x.kty="EC",x.crv=_,x.x=Gt(B.x),x.y=Gt(B.y)}if(x.kty==null)throw new Error("unsupported keyinfo");return!v.isPrivate&&l!=!0&&(x.kid=S.jws.JWS.getJWKthumbprint(x)),C!=null&&c!=!0&&(x.x5c=[u(C)]),C!=null&&p!=!0&&(x.x5t=Us(u(O(C,"sha1")))),C!=null&&y!=!0&&(x["x5t#S256"]=Us(u(O(C,"sha256")))),x},gt.getJWKFromKey=function(a){return gt.getJWK(a,!0,!0,!0,!0)},Je.getPosArrayOfChildrenFromHex=function(a){return Fe.getChildIdx(a,0)},Je.getHexValueArrayOfChildrenFromHex=function(a){var l=Fe,c=l.getV,w=Je.getPosArrayOfChildrenFromHex(a),p=c(a,w[0]),y=c(a,w[1]),v=c(a,w[2]),x=c(a,w[3]),C=c(a,w[4]),O=c(a,w[5]),_=c(a,w[6]),B=c(a,w[7]),N=c(a,w[8]),w=new Array;return w.push(p,y,v,x,C,O,_,B,N),w},Je.prototype.readPrivateKeyFromPEMString=function(a){var l=zt(a),c=Je.getHexValueArrayOfChildrenFromHex(l);this.setPrivateEx(c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8])},Je.prototype.readPKCS5PrvKeyHex=function(a){var l=Je.getHexValueArrayOfChildrenFromHex(a);this.setPrivateEx(l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8])},Je.prototype.readPKCS8PrvKeyHex=function(a){var l,c,p,y,v,x,C,O,_=Fe,B=_.getVbyListEx;if(_.isASN1HEX(a)===!1)throw new Error("not ASN.1 hex string");try{l=B(a,0,[2,0,1],"02"),c=B(a,0,[2,0,2],"02"),p=B(a,0,[2,0,3],"02"),y=B(a,0,[2,0,4],"02"),v=B(a,0,[2,0,5],"02"),x=B(a,0,[2,0,6],"02"),C=B(a,0,[2,0,7],"02"),O=B(a,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(l,c,p,y,v,x,C,O)},Je.prototype.readPKCS5PubKeyHex=function(a){var l=Fe,c=l.getV;if(l.isASN1HEX(a)===!1)throw new Error("keyHex is not ASN.1 hex string");var p=l.getChildIdx(a,0);if(p.length!==2||a.substr(p[0],2)!=="02"||a.substr(p[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var y=c(a,p[0]),v=c(a,p[1]);this.setPublic(y,v)},Je.prototype.readPKCS8PubKeyHex=function(a){var l=Fe;if(l.isASN1HEX(a)===!1)throw new Error("not ASN.1 hex string");if(l.getTLVbyListEx(a,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var c=l.getTLVbyListEx(a,0,[1,0]);this.readPKCS5PubKeyHex(c)},Je.prototype.readCertPubKeyHex=function(a,l){var c,p;c=new tt,c.readCertHex(a),p=c.getPublicKeyHex(),this.readPKCS8PubKeyHex(p)};function Jf(a,l){for(var c="",p=l/4-a.length,y=0;y<p;y++)c=c+"0";return c+a}Je.prototype.sign=function(a,l){var c=function(y){return S.crypto.Util.hashString(y,l)},p=c(a);return this.signWithMessageHash(p,l)},Je.prototype.signWithMessageHash=function(a,l){var c=S.crypto.Util.getPaddedDigestInfoHex(a,l,this.n.bitLength()),p=cn(c,16),y=this.doPrivate(p),v=y.toString(16);return Jf(v,this.n.bitLength())};function Qf(a,l,c){for(var p="",y=0;p.length<l;)p+=Kt(c(Pn(a+String.fromCharCode.apply(String,[(y&4278190080)>>24,(y&16711680)>>16,(y&65280)>>8,y&255])))),y+=1;return p}Je.prototype.signPSS=function(a,l,c){var p=function(v){return S.crypto.Util.hashHex(v,l)},y=p(Pn(a));return c===void 0&&(c=-1),this.signWithMessageHashPSS(y,l,c)},Je.prototype.signWithMessageHashPSS=function(a,l,c){var p=Kt(a),y=p.length,v=this.n.bitLength()-1,x=Math.ceil(v/8),C,O=function(L){return S.crypto.Util.hashHex(L,l)};if(c===-1||c===void 0)c=y;else if(c===-2)c=x-y-2;else if(c<-2)throw new Error("invalid salt length");if(x<y+c+2)throw new Error("data too long");var _="";c>0&&(_=new Array(c),new bi().nextBytes(_),_=String.fromCharCode.apply(String,_));var B=Kt(O(Pn("\0\0\0\0\0\0\0\0"+p+_))),N=[];for(C=0;C<x-c-y-2;C+=1)N[C]=0;var w=String.fromCharCode.apply(String,N)+""+_,I=Qf(B,w.length,O),R=[];for(C=0;C<w.length;C+=1)R[C]=w.charCodeAt(C)^I.charCodeAt(C);var F=65280>>8*x-v&255;for(R[0]&=~F,C=0;C<y;C++)R.push(B.charCodeAt(C));return R.push(188),Jf(this.doPrivate(new g(R)).toString(16),this.n.bitLength())};function Xf(a){for(var l in S.crypto.Util.DIGESTINFOHEAD){var c=S.crypto.Util.DIGESTINFOHEAD[l],p=c.length;if(a.substring(0,p)==c){var y=[l,a.substring(p)];return y}}return[]}Je.prototype.verify=function(a,l){if(l=l.toLowerCase(),l.match(/^[0-9a-f]+$/)==null)return!1;var c=cn(l,16),p=this.n.bitLength();if(c.bitLength()>p)return!1;var y=this.doPublic(c),v=y.toString(16);if(v.length+3!=p/4)return!1;var x=v.replace(/^1f+00/,""),C=Xf(x);if(C.length==0)return!1;var O=C[0],_=C[1],B=function(w){return S.crypto.Util.hashString(w,O)},N=B(a);return _==N},Je.prototype.verifyWithMessageHash=function(a,l){if(l.length!=Math.ceil(this.n.bitLength()/4))return!1;var c=cn(l,16);if(c.bitLength()>this.n.bitLength())return 0;var p=this.doPublic(c),y=p.toString(16).replace(/^1f+00/,""),v=Xf(y);if(v.length==0)return!1;v[0];var x=v[1];return x==a},Je.prototype.verifyPSS=function(a,l,c,p){var y=function(x){return S.crypto.Util.hashHex(x,c)},v=y(Pn(a));return p===void 0&&(p=-1),this.verifyWithMessageHashPSS(v,l,c,p)},Je.prototype.verifyWithMessageHashPSS=function(a,l,c,p){if(l.length!=Math.ceil(this.n.bitLength()/4))return!1;var y=new g(l,16),v=function(te){return S.crypto.Util.hashHex(te,c)},x=Kt(a),C=x.length,O=this.n.bitLength()-1,_=Math.ceil(O/8),B;if(p===-1||p===void 0)p=C;else if(p===-2)p=_-C-2;else if(p<-2)throw new Error("invalid salt length");if(_<C+p+2)throw new Error("data too long");var N=this.doPublic(y).toByteArray();for(B=0;B<N.length;B+=1)N[B]&=255;for(;N.length<_;)N.unshift(0);if(N[_-1]!==188)throw new Error("encoded message does not end in 0xbc");N=String.fromCharCode.apply(String,N);var w=N.substr(0,_-C-1),I=N.substr(w.length,C),R=65280>>8*_-O&255;if(w.charCodeAt(0)&R)throw new Error("bits beyond keysize not zero");var F=Qf(I,w.length,v),L=[];for(B=0;B<w.length;B+=1)L[B]=w.charCodeAt(B)^F.charCodeAt(B);L[0]&=~R;var V=_-C-p-2;for(B=0;B<V;B+=1)if(L[B]!==0)throw new Error("leftmost octets not zero");if(L[V]!==1)throw new Error("0x01 marker not found");return I===Kt(v(Pn("\0\0\0\0\0\0\0\0"+x+String.fromCharCode.apply(String,L.slice(-p)))))},Je.SALT_LEN_HLEN=-1,Je.SALT_LEN_MAX=-2,Je.SALT_LEN_RECOVER=-2;function tt(a){var l=Fe,c=l.getChildIdx,p=l.getV;l.dump;var y=l.parse,v=l.getTLV,x=l.getVbyList,C=l.getVbyListEx,O=l.getTLVbyList,_=l.getTLVbyListEx,B=l.getIdxbyList,N=l.getIdxbyListEx,w=l.getVidx,I=l.getInt,R=l.oidname,F=l.hextooidstr,L=zt,V,te=Error;try{V=S.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var H=O(this.hex,0,[0,0]);if(H.substr(0,2)=="a0"){var W=O(H,0,[0]),J=I(W,0);if(J<0||2<J)throw new Error("malformed version field");return this.version=J+1,this.version}else return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return C(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var H=_(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(H)},this.getAlgorithmIdentifierName=function(H){for(var W in V)if(H===V[W])return W;return R(C(H,0,[0],"06"))},this.getIssuer=function(H,W){return this.getX500Name(this.getIssuerHex(),H,W)},this.getIssuerHex=function(){return O(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){var H=this.getIssuer();return H.str},this.getSubject=function(H,W){return this.getX500Name(this.getSubjectHex(),H,W)},this.getSubjectHex=function(){return O(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){var H=this.getSubject();return H.str},this.getNotBefore=function(){var H=x(this.hex,0,[0,4+this.foffset,0]);return H=H.replace(/(..)/g,"%$1"),H=decodeURIComponent(H),H},this.getNotAfter=function(){var H=x(this.hex,0,[0,4+this.foffset,1]);return H=H.replace(/(..)/g,"%$1"),H=decodeURIComponent(H),H},this.getPublicKeyHex=function(){return this.getSPKI()},this.getSPKI=function(){return O(this.hex,0,[0,6+this.foffset],"30")},this.getSPKIValue=function(){var H=this.getSPKI();return H==null?null:x(H,0,[1],"03",!0)},this.getPublicKeyIdx=function(){return B(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var H=this.getPublicKeyIdx();return B(this.hex,H,[1,0],"30")},this.getPublicKey=function(){return gt.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var H=O(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(H)},this.getSignatureValueHex=function(){return x(this.hex,0,[2],"03",!0)},this.verifySignature=function(H){var W=this.getSignatureAlgorithmField(),J=this.getSignatureValueHex(),$=O(this.hex,0,[0],"30"),Z=new S.crypto.Signature({alg:W});return Z.init(H),Z.updateHex($),Z.verify(J)},this.parseExt=function(H){var W,J,$;if(H===void 0){if($=this.hex,this.version!==3)return-1;W=B($,0,[0,7,0],"30"),J=c($,W)}else{$=zt(H);var Z=B($,0,[0,3,0,0],"06");if(p($,Z)!="2a864886f70d01090e"){this.aExtInfo=new Array;return}W=B($,0,[0,3,0,1,0],"30"),J=c($,W),this.hex=$}this.aExtInfo=new Array;for(var oe=0;oe<J.length;oe++){var de={};de.critical=!1;var Te=c($,J[oe]),h=0;Te.length===3&&(de.critical=!0,h=1),de.oid=l.hextooidstr(x($,J[oe],[0],"06"));var T=B($,J[oe],[1+h]);de.vidx=w($,T),this.aExtInfo.push(de)}},this.getExtInfo=function(H){var W=this.aExtInfo,J=H;if(H.match(/^[0-9.]+$/)||(J=S.asn1.x509.OID.name2oid(H)),J!==""){for(var $=0;$<W.length;$++)if(W[$].oid===J)return W[$]}},this.getCriticalExtV=function(H,W,J){if(W!=null)return[W,J];var $=this.getExtInfo(H);return $==null?[null,null]:[v(this.hex,$.vidx),$.critical]},this.getExtBasicConstraints=function(H,W){if(H===void 0&&W===void 0){var J=this.getExtInfo("basicConstraints");if(J===void 0)return;H=v(this.hex,J.vidx),W=J.critical}var $={extname:"basicConstraints"};if(W&&($.critical=!0),H==="3000")return $;if(H==="30030101ff")return $.cA=!0,$;if(H.substr(0,12)==="30060101ff02"){var Z=p(H,10),oe=parseInt(Z,16);return $.cA=!0,$.pathLen=oe,$}throw new Error("hExtV parse error: "+H)},this.getExtNameConstraints=function(H,W){var J=this.getCriticalExtV("nameConstraints",H,W);if(H=J[0],W=J[1],H!=null){var $={extname:"nameConstraints"};W&&($.critical=!0);for(var Z=c(H,0),oe=0;oe<Z.length;oe++){for(var de=[],Te=c(H,Z[oe]),h=0;h<Te.length;h++){var T=v(H,Te[h]),b=this.getGeneralSubtree(T);de.push(b)}var A=H.substr(Z[oe],2);A=="a0"?$.permit=de:A=="a1"&&($.exclude=de)}return $}},this.getGeneralSubtree=function(H){var W=c(H,0),J=W.length;if(J<1||2<J)throw new Error("wrong num elements");for(var $=this.getGeneralName(v(H,W[0])),Z=1;Z<J;Z++){var oe=H.substr(W[Z],2),de=p(H,W[Z]),Te=parseInt(de,16);oe=="80"&&($.min=Te),oe=="81"&&($.max=Te)}return $},this.getExtKeyUsage=function(H,W){var J=this.getCriticalExtV("keyUsage",H,W);if(H=J[0],W=J[1],H!=null){var $={extname:"keyUsage"};return W&&($.critical=!0),$.names=this.getExtKeyUsageString(H).split(","),$}},this.getExtKeyUsageBin=function(H){if(H===void 0){var W=this.getExtInfo("keyUsage");if(W===void 0)return"";H=v(this.hex,W.vidx)}if(H.length!=8&&H.length!=10)throw new Error("malformed key usage value: "+H);var J="000000000000000"+parseInt(H.substr(6),16).toString(2);return H.length==8&&(J=J.slice(-8)),H.length==10&&(J=J.slice(-16)),J=J.replace(/0+$/,""),J==""&&(J="0"),J},this.getExtKeyUsageString=function(H){for(var W=this.getExtKeyUsageBin(H),J=new Array,$=0;$<W.length;$++)W.substr($,1)=="1"&&J.push(tt.KEYUSAGE_NAME[$]);return J.join(",")},this.getExtSubjectKeyIdentifier=function(H,W){if(H===void 0&&W===void 0){var J=this.getExtInfo("subjectKeyIdentifier");if(J===void 0)return;H=v(this.hex,J.vidx),W=J.critical}var $={extname:"subjectKeyIdentifier"};W&&($.critical=!0);var Z=p(H,0);return $.kid={hex:Z},$},this.getExtAuthorityKeyIdentifier=function(H,W){if(H===void 0&&W===void 0){var J=this.getExtInfo("authorityKeyIdentifier");if(J===void 0)return;H=v(this.hex,J.vidx),W=J.critical}var $={extname:"authorityKeyIdentifier"};W&&($.critical=!0);for(var Z=c(H,0),oe=0;oe<Z.length;oe++){var de=H.substr(Z[oe],2);if(de==="80"&&($.kid={hex:p(H,Z[oe])}),de==="a1"){var Te=v(H,Z[oe]),h=this.getGeneralNames(Te);$.issuer=h[0].dn}de==="82"&&($.sn={hex:p(H,Z[oe])})}return $},this.getExtExtKeyUsage=function(H,W){if(H===void 0&&W===void 0){var J=this.getExtInfo("extKeyUsage");if(J===void 0)return;H=v(this.hex,J.vidx),W=J.critical}var $={extname:"extKeyUsage",array:[]};W&&($.critical=!0);for(var Z=c(H,0),oe=0;oe<Z.length;oe++)$.array.push(R(p(H,Z[oe])));return $},this.getExtExtKeyUsageName=function(){var H=this.getExtInfo("extKeyUsage");if(H===void 0)return H;var W=new Array,J=v(this.hex,H.vidx);if(J==="")return W;for(var $=c(J,0),Z=0;Z<$.length;Z++)W.push(R(p(J,$[Z])));return W},this.getExtSubjectAltName=function(H,W){if(H===void 0&&W===void 0){var J=this.getExtInfo("subjectAltName");if(J===void 0)return;H=v(this.hex,J.vidx),W=J.critical}var $={extname:"subjectAltName",array:[]};return W&&($.critical=!0),$.array=this.getGeneralNames(H),$},this.getExtIssuerAltName=function(H,W){if(H===void 0&&W===void 0){var J=this.getExtInfo("issuerAltName");if(J===void 0)return;H=v(this.hex,J.vidx),W=J.critical}var $={extname:"issuerAltName",array:[]};return W&&($.critical=!0),$.array=this.getGeneralNames(H),$},this.getGeneralNames=function(H){for(var W=c(H,0),J=[],$=0;$<W.length;$++){var Z=this.getGeneralName(v(H,W[$]));Z!==void 0&&J.push(Z)}return J},this.getGeneralName=function(H){var W=H.substr(0,2),J=p(H,0),$=Kt(J);if(W=="81")return{rfc822:$};if(W=="82")return{dns:$};if(W=="86")return{uri:$};if(W=="87")return{ip:wo(J)};if(W=="a4")return{dn:this.getX500Name(J)};if(W=="a0")return{other:this.getOtherName(H)}},this.getExtSubjectAltName2=function(){var H,W,J,$=this.getExtInfo("subjectAltName");if($===void 0)return $;for(var Z=new Array,oe=v(this.hex,$.vidx),de=c(oe,0),Te=0;Te<de.length;Te++)J=oe.substr(de[Te],2),H=p(oe,de[Te]),J==="81"&&(W=St(H),Z.push(["MAIL",W])),J==="82"&&(W=St(H),Z.push(["DNS",W])),J==="84"&&(W=tt.hex2dn(H,0),Z.push(["DN",W])),J==="86"&&(W=St(H),Z.push(["URI",W])),J==="87"&&(W=wo(H),Z.push(["IP",W]));return Z},this.getExtCRLDistributionPoints=function(H,W){if(H===void 0&&W===void 0){var J=this.getExtInfo("cRLDistributionPoints");if(J===void 0)return;H=v(this.hex,J.vidx),W=J.critical}var $={extname:"cRLDistributionPoints",array:[]};W&&($.critical=!0);for(var Z=c(H,0),oe=0;oe<Z.length;oe++){var de=v(H,Z[oe]);$.array.push(this.getDistributionPoint(de))}return $},this.getDistributionPoint=function(H){for(var W={},J=c(H,0),$=0;$<J.length;$++){var Z=H.substr(J[$],2),oe=v(H,J[$]);Z=="a0"&&(W.dpname=this.getDistributionPointName(oe))}return W},this.getDistributionPointName=function(H){for(var W={},J=c(H,0),$=0;$<J.length;$++){var Z=H.substr(J[$],2),oe=v(H,J[$]);Z=="a0"&&(W.full=this.getGeneralNames(oe))}return W},this.getExtCRLDistributionPointsURI=function(){var H=this.getExtCRLDistributionPoints();if(H==null)return H;for(var W=H.array,J=[],$=0;$<W.length;$++)try{W[$].dpname.full[0].uri!=null&&J.push(W[$].dpname.full[0].uri)}catch{}return J},this.getExtAIAInfo=function(){var H=this.getExtInfo("authorityInfoAccess");if(H===void 0)return H;for(var W={ocsp:[],caissuer:[]},J=c(this.hex,H.vidx),$=0;$<J.length;$++){var Z=x(this.hex,J[$],[0],"06"),oe=x(this.hex,J[$],[1],"86");Z==="2b06010505073001"&&W.ocsp.push(St(oe)),Z==="2b06010505073002"&&W.caissuer.push(St(oe))}return W},this.getExtAuthorityInfoAccess=function(H,W){if(H===void 0&&W===void 0){var J=this.getExtInfo("authorityInfoAccess");if(J===void 0)return;H=v(this.hex,J.vidx),W=J.critical}var $={extname:"authorityInfoAccess",array:[]};W&&($.critical=!0);for(var Z=c(H,0),oe=0;oe<Z.length;oe++){var de=C(H,Z[oe],[0],"06"),Te=x(H,Z[oe],[1],"86"),h=St(Te);if(de=="2b06010505073001")$.array.push({ocsp:h});else if(de=="2b06010505073002")$.array.push({caissuer:h});else throw new Error("unknown method: "+de)}return $},this.getExtCertificatePolicies=function(H,W){if(H===void 0&&W===void 0){var J=this.getExtInfo("certificatePolicies");if(J===void 0)return;H=v(this.hex,J.vidx),W=J.critical}var $={extname:"certificatePolicies",array:[]};W&&($.critical=!0);for(var Z=c(H,0),oe=0;oe<Z.length;oe++){var de=v(H,Z[oe]),Te=this.getPolicyInformation(de);$.array.push(Te)}return $},this.getPolicyInformation=function(H){var W={},J=x(H,0,[0],"06");W.policyoid=R(J);var $=N(H,0,[1],"30");if($!=-1){W.array=[];for(var Z=c(H,$),oe=0;oe<Z.length;oe++){var de=v(H,Z[oe]),Te=this.getPolicyQualifierInfo(de);W.array.push(Te)}}return W},this.getOtherName=function(H){var W={},J=c(H,0),$=x(H,J[0],[],"06"),Z=x(H,J[1],[]);return W.oid=R($),W.value=y(Z),W},this.getPolicyQualifierInfo=function(H){var W={},J=x(H,0,[0],"06");if(J==="2b06010505070201"){var $=C(H,0,[1],"16");W.cps=Kt($)}else if(J==="2b06010505070202"){var Z=O(H,0,[1],"30");W.unotice=this.getUserNotice(Z)}return W},this.getUserNotice=function(H){var W=null;try{W=l.parse(H);var J=this._asn1ToUnotice(W);return J}catch{return}},this._asn1ToUnotice=function(H){try{for(var W={},J=Hs(H,"seq"),$=0;$<J.length;$++){var Z=this._asn1ToNoticeRef(J[$]);Z!=null&&(W.noticeref=Z);var oe=this.asn1ToDisplayText(J[$]);oe!=null&&(W.exptext=oe)}return Object.keys(W).length>0?W:void 0}catch{return}},this._asn1ToNoticeRef=function(H){try{for(var W={},J=Hs(H,"seq"),$=0;$<J.length;$++){var Z=this._asn1ToNoticeNum(J[$]);Z!=null&&(W.noticenum=Z);var oe=this.asn1ToDisplayText(J[$]);oe!=null&&(W.org=oe)}return Object.keys(W).length>0?W:void 0}catch{return}},this._asn1ToNoticeNum=function(H){try{for(var W=Hs(H,"seq"),J=[],$=0;$<W.length;$++){var Z=W[$];J.push(parseInt(Hs(Z,"int.hex"),16))}return J}catch{return}},this.getDisplayText=function(H){var W={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"},J={};return J.type=W[H.substr(0,2)],J.str=Kt(p(H,0)),J},this.asn1ToDisplayText=function(H){if(H.utf8str!=null)return{type:"utf8",str:H.utf8str.str};if(H.ia5str!=null)return{type:"ia5",str:H.ia5str.str};if(H.visstr!=null)return{type:"vis",str:H.visstr.str};if(H.bmpstr!=null)return{type:"bmp",str:H.bmpstr.str};if(H.prnstr!=null)return{type:"prn",str:H.prnstr.str}},this.getExtPolicyMappings=function(H,W){var J=this.getCriticalExtV("policyMappings",H,W);if(H=J[0],W=J[1],H!=null){var $={extname:"policyMappings"};W&&($.critical=!0);try{for(var Z=y(H),oe=Z.seq,de=[],Te=0;Te<oe.length;Te++){var h=oe[Te].seq;de.push([h[0].oid,h[1].oid])}$.array=de}catch{throw new te("malformed policyMappings")}return $}},this.getExtPolicyConstraints=function(H,W){var J=this.getCriticalExtV("policyConstraints",H,W);if(H=J[0],W=J[1],H!=null){var $={extname:"policyConstraints"};W&&($.critical=!0);var Z=y(H);try{for(var oe=Z.seq,de=0;de<oe.length;de++){var Te=oe[de].tag;Te.explicit==!1&&(Te.tag=="80"&&($.reqexp=parseInt(Te.hex,16)),Te.tag=="81"&&($.inhibit=parseInt(Te.hex,16)))}}catch{return new te("malformed policyConstraints value")}return $}},this.getExtInhibitAnyPolicy=function(H,W){var J=this.getCriticalExtV("inhibitAnyPolicy",H,W);if(H=J[0],W=J[1],H!=null){var $={extname:"inhibitAnyPolicy"};W&&($.critical=!0);var Z=I(H,0);return Z==-1?new te("wrong value"):($.skip=Z,$)}},this.getExtCRLNumber=function(H,W){var J={extname:"cRLNumber"};if(W&&(J.critical=!0),H.substr(0,2)=="02")return J.num={hex:p(H,0)},J;throw new te("hExtV parse error: "+H)},this.getExtCRLReason=function(H,W){var J={extname:"cRLReason"};if(W&&(J.critical=!0),H.substr(0,2)=="0a")return J.code=parseInt(p(H,0),16),J;throw new Error("hExtV parse error: "+H)},this.getExtOcspNonce=function(H,W){var J={extname:"ocspNonce"};W&&(J.critical=!0);var $=p(H,0);return J.hex=$,J},this.getExtOcspNoCheck=function(H,W){var J={extname:"ocspNoCheck"};return W&&(J.critical=!0),J},this.getExtAdobeTimeStamp=function(H,W){if(H===void 0&&W===void 0){var J=this.getExtInfo("adobeTimeStamp");if(J===void 0)return;H=v(this.hex,J.vidx),W=J.critical}var $={extname:"adobeTimeStamp"};W&&($.critical=!0);var Z=c(H,0);if(Z.length>1){var oe=v(H,Z[1]),de=this.getGeneralName(oe);de.uri!=null&&($.uri=de.uri)}if(Z.length>2){var Te=v(H,Z[2]);Te=="0101ff"&&($.reqauth=!0),Te=="010100"&&($.reqauth=!1)}return $},this.getExtSubjectDirectoryAttributes=function(H,W){if(H===void 0&&W===void 0){var J=this.getExtInfo("subjectDirectoryAttributes");if(J===void 0)return;H=v(this.hex,J.vidx),W=J.critical}var $={extname:"subjectDirectoryAttributes"};W&&($.critical=!0);try{for(var Z=y(H),oe=[],de=0;de<Z.seq.length;de++){var Te=Z.seq[de],h=Hs(Te,"seq.0.oid"),T=Hs(Te,"seq.1.set");if(h==null||T==null)throw"error";oe.push({attr:h,array:T})}return $.array=oe,$}catch{throw new Error("malformed subjectDirectoryAttributes extension value")}};var ue=function(H){var W={};try{var J=H.seq[0].oid,$=S.asn1.x509.OID.name2oid(J);W.type=S.asn1.x509.OID.oid2atype($);var Z=H.seq[1];if(Z.utf8str!=null)W.ds="utf8",W.value=Z.utf8str.str;else if(Z.numstr!=null)W.ds="num",W.value=Z.numstr.str;else if(Z.telstr!=null)W.ds="tel",W.value=Z.telstr.str;else if(Z.prnstr!=null)W.ds="prn",W.value=Z.prnstr.str;else if(Z.ia5str!=null)W.ds="ia5",W.value=Z.ia5str.str;else if(Z.visstr!=null)W.ds="vis",W.value=Z.visstr.str;else if(Z.bmpstr!=null)W.ds="bmp",W.value=Z.bmpstr.str;else throw"error";return W}catch{throw new Erorr("improper ASN.1 parsed AttrTypeAndValue")}},ae=function(H){try{return H.set.map(function(W){return ue(W)})}catch(W){throw new Error("improper ASN.1 parsed RDN: "+W)}},le=function(H){try{return H.seq.map(function(W){return ae(W)})}catch(W){throw new Error("improper ASN.1 parsed X500Name: "+W)}};this.getX500NameRule=function(H){for(var W=null,J=[],$=0;$<H.length;$++)for(var Z=H[$],oe=0;oe<Z.length;oe++)J.push(Z[oe]);for(var $=0;$<J.length;$++){var de=J[$],Te=de.ds,h=de.value,T=de.type;if(Te!="prn"&&Te!="utf8"&&Te!="ia5")return"mixed";if(Te=="ia5"){if(T!="CN")return"mixed";if(S.lang.String.isMail(h))continue;return"mixed"}if(T=="C"){if(Te=="prn")continue;return"mixed"}if(W==null)W=Te;else if(W!==Te)return"mixed"}return W??"prn"},this.getAttrTypeAndValue=function(H){var W=y(H);return ue(W)},this.getRDN=function(H){var W=y(H);return ae(W)},this.getX500NameArray=function(H){var W=y(H);return le(W)},this.getX500Name=function(H,W,J){var $=this.getX500NameArray(H),Z=this.dnarraytostr($),oe={str:Z};return oe.array=$,J==!0&&(oe.hex=H),W==!0&&(oe.canon=this.c14nRDNArray($)),oe},this.readCertPEM=function(H){this.readCertHex(L(H))},this.readCertHex=function(H){this.hex=H,this.getVersion();try{B(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(H){var W={};return H==null&&(H={}),W.version=this.getVersion(),W.serial={hex:this.getSerialNumberHex()},W.sigalg=this.getSignatureAlgorithmField(),W.issuer=this.getIssuer(H.dncanon,H.dnhex),W.notbefore=this.getNotBefore(),W.notafter=this.getNotAfter(),W.subject=this.getSubject(H.dncanon,H.dnhex),W.sbjpubkey=dn(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo!=null&&this.aExtInfo.length>0&&(W.ext=this.getExtParamArray()),W.sighex=this.getSignatureValueHex(),H.tbshex==!0&&(W.tbshex=O(this.hex,0,[0])),H.nodnarray==!0&&(delete W.issuer.array,delete W.subject.array),W},this.getExtParamArray=function(H){if(H==null){var W=N(this.hex,0,[0,"[3]"]);W!=-1&&(H=_(this.hex,0,[0,"[3]",0],"30"))}for(var J=[],$=c(H,0),Z=0;Z<$.length;Z++){var oe=v(H,$[Z]),de=this.getExtParam(oe);de!=null&&J.push(de)}return J},this.getExtParam=function(H){var W=c(H,0),J=W.length;if(J!=2&&J!=3)throw new Error("wrong number elements in Extension: "+J+" "+H);var $=F(x(H,0,[0],"06")),Z=!1;J==3&&O(H,0,[1])=="0101ff"&&(Z=!0);var oe=O(H,0,[J-1,0]),de=void 0;if($=="2.5.29.14"?de=this.getExtSubjectKeyIdentifier(oe,Z):$=="2.5.29.15"?de=this.getExtKeyUsage(oe,Z):$=="2.5.29.17"?de=this.getExtSubjectAltName(oe,Z):$=="2.5.29.18"?de=this.getExtIssuerAltName(oe,Z):$=="2.5.29.19"?de=this.getExtBasicConstraints(oe,Z):$=="2.5.29.30"?de=this.getExtNameConstraints(oe,Z):$=="2.5.29.31"?de=this.getExtCRLDistributionPoints(oe,Z):$=="2.5.29.32"?de=this.getExtCertificatePolicies(oe,Z):$=="2.5.29.33"?de=this.getExtPolicyMappings(oe,Z):$=="2.5.29.35"?de=this.getExtAuthorityKeyIdentifier(oe,Z):$=="2.5.29.36"?de=this.getExtPolicyConstraints(oe,Z):$=="2.5.29.37"?de=this.getExtExtKeyUsage(oe,Z):$=="2.5.29.54"?de=this.getExtInhibitAnyPolicy(oe,Z):$=="1.3.6.1.5.5.7.1.1"?de=this.getExtAuthorityInfoAccess(oe,Z):$=="2.5.29.20"?de=this.getExtCRLNumber(oe,Z):$=="2.5.29.21"?de=this.getExtCRLReason(oe,Z):$=="2.5.29.9"?de=this.getExtSubjectDirectoryAttributes(oe,Z):$=="1.3.6.1.5.5.7.48.1.2"?de=this.getExtOcspNonce(oe,Z):$=="1.3.6.1.5.5.7.48.1.5"?de=this.getExtOcspNoCheck(oe,Z):$=="1.2.840.113583.1.1.9.1"?de=this.getExtAdobeTimeStamp(oe,Z):tt.EXT_PARSER[$]!=null&&(de=tt.EXT_PARSER[$]($,Z,oe)),de!=null)return de;var Te={extname:$,extn:oe};try{Te.extn=y(oe)}catch{}return Z&&(Te.critical=!0),Te},this.findExt=function(H,W){for(var J=0;J<H.length;J++)if(H[J].extname==W)return H[J];return null},this.updateExtCDPFullURI=function(H,W){var J=this.findExt(H,"cRLDistributionPoints");if(J!=null&&J.array!=null){for(var $=J.array,Z=0;Z<$.length;Z++)if($[Z].dpname!=null&&$[Z].dpname.full!=null)for(var oe=$[Z].dpname.full,de=0;de<oe.length;de++){var Te=oe[Z];Te.uri!=null&&(Te.uri=W)}}},this.updateExtAIAOCSP=function(H,W){var J=this.findExt(H,"authorityInfoAccess");if(J!=null&&J.array!=null)for(var $=J.array,Z=0;Z<$.length;Z++)$[Z].ocsp!=null&&($[Z].ocsp=W)},this.updateExtAIACAIssuer=function(H,W){var J=this.findExt(H,"authorityInfoAccess");if(J!=null&&J.array!=null)for(var $=J.array,Z=0;Z<$.length;Z++)$[Z].caissuer!=null&&($[Z].caissuer=W)},this.dnarraytostr=function(H){function W($){return $.map(function(Z){return J(Z).replace(/\+/,"\\+")}).join("+")}function J($){return $.type+"="+$.value}return"/"+H.map(function($){return W($).replace(/\//,"\\/")}).join("/")},this.setCanonicalizedDN=function(H){var W;if(H.str!=null&&H.array==null){var J=new S.asn1.x509.X500Name({str:H.str}),$=J.tohex();W=this.getX500NameArray($)}else W=H.array;H.canon==null&&(H.canon=this.c14nRDNArray(W))},this.c14nRDNArray=function(H){for(var W=[],J=0;J<H.length;J++){for(var $=H[J],Z=[],oe=0;oe<$.length;oe++){var de=$[oe],Te=de.value;Te=Te.replace(/^\s*/,""),Te=Te.replace(/\s*$/,""),Te=Te.replace(/\s+/g," "),Te=Te.toLowerCase(),Z.push(de.type.toLowerCase()+"="+Te)}W.push(Z.join("+"))}return"/"+W.join("/")},this.getInfo=function(){var H=function(Oe){for(var Pe="",Me="    ",Ie=`
`,ze=Oe.array,Ye=0;Ye<ze.length;Ye++){var Ke=ze[Ye];if(Ke.dn!=null&&(Pe+=Me+"dn: "+Ke.dn.str+Ie),Ke.ip!=null&&(Pe+=Me+"ip: "+Ke.ip+Ie),Ke.rfc822!=null&&(Pe+=Me+"rfc822: "+Ke.rfc822+Ie),Ke.dns!=null&&(Pe+=Me+"dns: "+Ke.dns+Ie),Ke.uri!=null&&(Pe+=Me+"uri: "+Ke.uri+Ie),Ke.other!=null){var bn=Ke.other.oid,ir=JSON.stringify(Ke.other.value).replace(/\"/g,"");Pe+=Me+"other: "+bn+"="+ir+Ie}}return Pe=Pe.replace(/\n$/,""),Pe},W=function(Oe){for(var Pe="",Me=Oe.array,Ie=0;Ie<Me.length;Ie++){var ze=Me[Ie];if(Pe+="    policy oid: "+ze.policyoid+`
`,ze.array!==void 0)for(var Ye=0;Ye<ze.array.length;Ye++){var Ke=ze.array[Ye];Ke.cps!==void 0&&(Pe+="    cps: "+Ke.cps+`
`)}}return Pe},J=function(Oe){for(var Pe="",Me=Oe.array,Ie=0;Ie<Me.length;Ie++){var ze=Me[Ie];try{ze.dpname.full[0].uri!==void 0&&(Pe+="    "+ze.dpname.full[0].uri+`
`)}catch{}try{ze.dname.full[0].dn.hex!==void 0&&(Pe+="    "+tt.hex2dn(ze.dpname.full[0].dn.hex)+`
`)}catch{}}return Pe},$=function(Oe){for(var Pe="",Me=Oe.array,Ie=0;Ie<Me.length;Ie++){var ze=Me[Ie];ze.caissuer!==void 0&&(Pe+="    caissuer: "+ze.caissuer+`
`),ze.ocsp!==void 0&&(Pe+="    ocsp: "+ze.ocsp+`
`)}return Pe},Z,oe,de;if(Z=`Basic Fields
`,Z+="  serial number: "+this.getSerialNumberHex()+`
`,Z+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,Z+="  issuer: "+this.getIssuerString()+`
`,Z+="  notBefore: "+this.getNotBefore()+`
`,Z+="  notAfter: "+this.getNotAfter()+`
`,Z+="  subject: "+this.getSubjectString()+`
`,Z+=`  subject public key info: 
`,oe=this.getPublicKey(),Z+="    key algorithm: "+oe.type+`
`,oe.type==="RSA"&&(Z+="    n="+ed(oe.n.toString(16)).substr(0,16)+`...
`,Z+="    e="+ed(oe.e.toString(16))+`
`),de=this.aExtInfo,de!=null){Z+=`X509v3 Extensions:
`;for(var Te=0;Te<de.length;Te++){var h=de[Te],T=S.asn1.x509.OID.oid2name(h.oid);T===""&&(T=h.oid);var b="";if(h.critical===!0&&(b="CRITICAL"),Z+="  "+T+" "+b+`:
`,T==="basicConstraints"){var A=this.getExtBasicConstraints();A.cA===void 0?Z+=`    {}
`:(Z+="    cA=true",A.pathLen!==void 0&&(Z+=", pathLen="+A.pathLen),Z+=`
`)}else if(T=="policyMappings"){var q=this.getExtPolicyMappings().array,G=q.map(function(Oe){var Pe=Oe;return Pe[0]+":"+Pe[1]}).join(", ");Z+="    "+G+`
`}else if(T=="policyConstraints"){var Q=this.getExtPolicyConstraints();Z+="    ",Q.reqexp!=null&&(Z+=" reqexp="+Q.reqexp),Q.inhibit!=null&&(Z+=" inhibit="+Q.inhibit),Z+=`
`}else if(T=="inhibitAnyPolicy"){var Q=this.getExtInhibitAnyPolicy();Z+="    skip="+Q.skip+`
`}else if(T=="keyUsage")Z+="    "+this.getExtKeyUsageString()+`
`;else if(T=="subjectKeyIdentifier")Z+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(T=="authorityKeyIdentifier"){var ne=this.getExtAuthorityKeyIdentifier();ne.kid!==void 0&&(Z+="    kid="+ne.kid.hex+`
`)}else if(T=="extKeyUsage"){var me=this.getExtExtKeyUsage().array;Z+="    "+me.join(", ")+`
`}else if(T=="subjectAltName"){var re=H(this.getExtSubjectAltName());Z+=re+`
`}else if(T=="cRLDistributionPoints"){var Se=this.getExtCRLDistributionPoints();Z+=J(Se)}else if(T=="authorityInfoAccess"){var Ue=this.getExtAuthorityInfoAccess();Z+=$(Ue)}else T=="certificatePolicies"&&(Z+=W(this.getExtCertificatePolicies()))}}return Z+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,Z+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`,Z},typeof a=="string"&&(a.indexOf("-----BEGIN")!=-1?this.readCertPEM(a):S.lang.String.isHex(a)&&this.readCertHex(a))}tt.EXT_PARSER={},tt.registExtParser=function(a,l){tt.EXT_PARSER[a]=l},tt.hex2dn=function(a,l){l===void 0&&(l=0);var c=new tt;Fe.getTLV(a,l);var p=c.getX500Name(a);return p.str},tt.hex2rdn=function(a,l){if(l===void 0&&(l=0),a.substr(l,2)!=="31")throw new Error("malformed RDN");for(var c=new Array,p=Fe.getChildIdx(a,l),y=0;y<p.length;y++)c.push(tt.hex2attrTypeValue(a,p[y]));return c=c.map(function(v){return v.replace("+","\\+")}),c.join("+")},tt.hex2attrTypeValue=function(a,l){var c=Fe,p=c.getV;if(l===void 0&&(l=0),a.substr(l,2)!=="30")throw new Error("malformed attribute type and value");var y=c.getChildIdx(a,l);y.length!==2||a.substr(y[0],2);var v=p(a,y[0]),x=S.asn1.ASN1Util.oidHexToInt(v),C=S.asn1.x509.OID.oid2atype(x),O=p(a,y[1]),_=Kt(O);return C+"="+_},tt.getPublicKeyFromCertHex=function(a){var l=new tt;return l.readCertHex(a),l.getPublicKey()},tt.getPublicKeyFromCertPEM=function(a){var l=new tt;return l.readCertPEM(a),l.getPublicKey()},tt.getPublicKeyInfoPropOfCertPEM=function(a){var l=Fe,c=l.getVbyList,p={},y,v;return p.algparam=null,y=new tt,y.readCertPEM(a),v=y.getPublicKeyHex(),p.keyhex=c(v,0,[1],"03").substr(2),p.algoid=c(v,0,[0,0],"06"),p.algoid==="2a8648ce3d0201"&&(p.algparam=c(v,0,[0,1],"06")),p},tt.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"];var X0=function(a){var l=S,c=l.lang.String.isHex,p=Fe,y=p.getV,v=p.getTLV,x=p.getVbyList,C=p.getTLVbyList,O=p.getTLVbyListEx,_=p.getIdxbyList,B=p.getIdxbyListEx,N=p.getChildIdx,w=new tt;this.hex=null,this.posSigAlg=null,this.posRevCert=null,this.parsed=null,this._setPos=function(){var I=_(this.hex,0,[0,0]),R=this.hex.substr(I,2);if(R=="02")this.posSigAlg=1;else if(R=="30")this.posSigAlg=0;else throw new Error("malformed 1st item of TBSCertList: "+R);var F=_(this.hex,0,[0,this.posSigAlg+3]),L=this.hex.substr(F,2);if(L=="17"||L=="18"){var V,te;V=_(this.hex,0,[0,this.posSigAlg+4]),this.posRevCert=null,V!=-1&&(te=this.hex.substr(V,2),te=="30"&&(this.posRevCert=this.posSigAlg+4))}else if(L=="30")this.posRevCert=this.posSigAlg+3;else if(L=="a0")this.posRevCert=null;else throw new Error("malformed nextUpdate or revCert tag: "+L)},this.getVersion=function(){return this.posSigAlg==0?null:parseInt(x(this.hex,0,[0,0],"02"),16)+1},this.getSignatureAlgorithmField=function(){var I=C(this.hex,0,[0,this.posSigAlg],"30");return w.getAlgorithmIdentifierName(I)},this.getIssuer=function(){return w.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return C(this.hex,0,[0,this.posSigAlg+1],"30")},this.getThisUpdate=function(){var I=x(this.hex,0,[0,this.posSigAlg+2]);return result=Kt(I)},this.getNextUpdate=function(){var I=_(this.hex,0,[0,this.posSigAlg+3]),R=this.hex.substr(I,2);return R!="17"&&R!="18"?null:Kt(y(this.hex,I))},this.getRevCertArray=function(){if(this.posRevCert==null)return null;for(var I=[],R=_(this.hex,0,[0,this.posRevCert]),F=N(this.hex,R),L=0;L<F.length;L++){var V=v(this.hex,F[L]);I.push(this.getRevCert(V))}return I},this.getRevCert=function(I){var R={},F=N(I,0);return R.sn={hex:x(I,0,[0],"02")},R.date=Kt(x(I,0,[1])),F.length==3&&(R.ext=w.getExtParamArray(C(I,0,[2]))),R},this.findRevCert=function(I){var R=new tt(I),F=R.getSerialNumberHex();return this.findRevCertBySN(F)},this.findRevCertBySN=function(I){if(this.parsed==null&&this.getParam(),this.parsed.revcert==null)return null;for(var R=this.parsed.revcert,F=0;F<R.length;F++)if(I==R[F].sn.hex)return R[F];return null},this.getSignatureValueHex=function(){return x(this.hex,0,[2],"03",!0)},this.verifySignature=function(I){var R=this.getSignatureAlgorithmField(),F=this.getSignatureValueHex(),L=C(this.hex,0,[0],"30"),V=new S.crypto.Signature({alg:R});return V.init(I),V.updateHex(L),V.verify(F)},this.getParam=function(I){var R={},F=this.getVersion();F!=null&&(R.version=F),R.sigalg=this.getSignatureAlgorithmField(),R.issuer=this.getIssuer(),R.thisupdate=this.getThisUpdate();var L=this.getNextUpdate();L!=null&&(R.nextupdate=L);var V=this.getRevCertArray();V!=null&&(R.revcert=V);var te=B(this.hex,0,[0,"[0]"]);if(te!=-1){var ue=O(this.hex,0,[0,"[0]",0]);R.ext=w.getExtParamArray(ue)}return R.sighex=this.getSignatureValueHex(),this.parsed=R,typeof I=="object"&&(I.tbshex==!0&&(R.tbshex=C(this.hex,0,[0])),I.nodnarray==!0&&delete R.issuer.array),R},typeof a=="string"&&(c(a)?this.hex=a:a.match(/-----BEGIN X509 CRL/)&&(this.hex=zt(a)),this._setPos())};return(typeof S>"u"||!S)&&(S={}),(typeof S.jws>"u"||!S.jws)&&(S.jws={}),S.jws.JWS=function(){var a=S,l=a.jws.JWS,c=l.isSafeJSONString;this.parseJWS=function(p,y){if(!(this.parsedJWS!==void 0&&(y||this.parsedJWS.sigvalH!==void 0))){var v=p.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(v==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var x=v[1],C=v[2],O=v[3],_=x+"."+C;if(this.parsedJWS={},this.parsedJWS.headB64U=x,this.parsedJWS.payloadB64U=C,this.parsedJWS.sigvalB64U=O,this.parsedJWS.si=_,!y){var B=Pt(O),N=cn(B,16);this.parsedJWS.sigvalH=B,this.parsedJWS.sigvalBI=N}var w=Rr(x),I=Rr(C);if(this.parsedJWS.headS=w,this.parsedJWS.payloadS=I,!c(w,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+w}}},S.jws.JWS.sign=function(a,l,c,p,y){var v=S,x=v.jws,C=x.JWS,O=C.readSafeJSONString,_=C.isSafeJSONString,B=v.crypto;B.ECDSA;var N=B.Mac,w=B.Signature,I=JSON,R,F,L;if(typeof l!="string"&&typeof l!="object")throw"spHeader must be JSON string or object: "+l;if(typeof l=="object"&&(F=l,R=I.stringify(F)),typeof l=="string"){if(R=l,!_(R))throw"JWS Head is not safe JSON string: "+R;F=O(R)}if(L=c,typeof c=="object"&&(L=I.stringify(c)),(a==""||a==null)&&F.alg!==void 0&&(a=F.alg),a!=""&&a!=null&&F.alg===void 0&&(F.alg=a,R=I.stringify(F)),a!==F.alg)throw"alg and sHeader.alg doesn't match: "+a+"!="+F.alg;var V=null;if(C.jwsalg2sigalg[a]===void 0)throw"unsupported alg name: "+a;V=C.jwsalg2sigalg[a];var te=zs(R),ue=zs(L),ae=te+"."+ue,le="";if(V.substr(0,4)=="Hmac"){if(p===void 0)throw"mac key shall be specified for HS* alg";var H=new N({alg:V,prov:"cryptojs",pass:p});H.updateString(ae),le=H.doFinal()}else if(V.indexOf("withECDSA")!=-1){var W=new w({alg:V});W.init(p,y),W.updateString(ae);var J=W.sign();le=S.crypto.ECDSA.asn1SigToConcatSig(J)}else if(V!="none"){var W=new w({alg:V});W.init(p,y),W.updateString(ae),le=W.sign()}var $=Gt(le);return ae+"."+$},S.jws.JWS.verify=function(a,l,c){var p=S,y=p.jws,v=y.JWS,x=v.readSafeJSONString,C=p.crypto,O=C.ECDSA,_=C.Mac,B=C.Signature,N;if(typeof Je!==void 0&&(N=Je),!Zc(a))return!1;var w=a.split(".");if(w.length!==3)return!1;var I=w[0],R=w[1],F=I+"."+R,L=Pt(w[2]),V=x(Rr(w[0])),te=null,ue=null;if(V.alg===void 0)throw"algorithm not specified in header";if(te=V.alg,ue=te.substr(0,2),c!=null&&Object.prototype.toString.call(c)==="[object Array]"&&c.length>0){var ae=":"+c.join(":")+":";if(ae.indexOf(":"+te+":")==-1)throw"algorithm '"+te+"' not accepted in the list"}if(te!="none"&&l===null)throw"key shall be specified to verify.";if(typeof l=="string"&&l.indexOf("-----BEGIN ")!=-1&&(l=gt.getKey(l)),(ue=="RS"||ue=="PS")&&!(l instanceof N))throw"key shall be a RSAKey obj for RS* and PS* algs";if(ue=="ES"&&!(l instanceof O))throw"key shall be a ECDSA obj for ES* algs";var le=null;if(v.jwsalg2sigalg[V.alg]===void 0)throw"unsupported alg name: "+te;if(le=v.jwsalg2sigalg[te],le=="none")throw"not supported";if(le.substr(0,4)=="Hmac"){var H=null;if(l===void 0)throw"hexadecimal key shall be specified for HMAC";var W=new _({alg:le,pass:l});return W.updateString(F),H=W.doFinal(),L==H}else if(le.indexOf("withECDSA")!=-1){var J=null;try{J=O.concatSigToASN1Sig(L)}catch{return!1}var $=new B({alg:le});return $.init(l),$.updateString(F),$.verify(J)}else{var $=new B({alg:le});return $.init(l),$.updateString(F),$.verify(L)}},S.jws.JWS.parse=function(a){var l=a.split("."),c={},p,y,v;if(l.length!=2&&l.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return p=l[0],y=l[1],l.length==3&&(v=l[2]),c.headerObj=S.jws.JWS.readSafeJSONString(Rr(p)),c.payloadObj=S.jws.JWS.readSafeJSONString(Rr(y)),c.headerPP=JSON.stringify(c.headerObj,null,"  "),c.payloadObj==null?c.payloadPP=Rr(y):c.payloadPP=JSON.stringify(c.payloadObj,null,"  "),v!==void 0&&(c.sigHex=Pt(v)),c},S.jws.JWS.verifyJWT=function(a,l,c){var p=S,y=p.jws,v=y.JWS,x=v.readSafeJSONString,C=v.inArray,O=v.includedArray;if(!Zc(a))return!1;var _=a.split(".");if(_.length!=3)return!1;var B=_[0],N=_[1];Pt(_[2]);var w=x(Rr(B)),I=x(Rr(N));if(w.alg===void 0)return!1;if(c.alg===void 0)throw"acceptField.alg shall be specified";if(!C(w.alg,c.alg)||I.iss!==void 0&&typeof c.iss=="object"&&!C(I.iss,c.iss)||I.sub!==void 0&&typeof c.sub=="object"&&!C(I.sub,c.sub))return!1;if(I.aud!==void 0&&typeof c.aud=="object"){if(typeof I.aud=="string"){if(!C(I.aud,c.aud))return!1}else if(typeof I.aud=="object"&&!O(I.aud,c.aud))return!1}var R=y.IntDate.getNow();return c.verifyAt!==void 0&&typeof c.verifyAt=="number"&&(R=c.verifyAt),(c.gracePeriod===void 0||typeof c.gracePeriod!="number")&&(c.gracePeriod=0),!(I.exp!==void 0&&typeof I.exp=="number"&&I.exp+c.gracePeriod<R||I.nbf!==void 0&&typeof I.nbf=="number"&&R<I.nbf-c.gracePeriod||I.iat!==void 0&&typeof I.iat=="number"&&R<I.iat-c.gracePeriod||I.jti!==void 0&&c.jti!==void 0&&I.jti!==c.jti||!v.verify(a,l,c.alg))},S.jws.JWS.includedArray=function(a,l){var c=S.jws.JWS.inArray;if(a===null||typeof a!="object"||typeof a.length!="number")return!1;for(var p=0;p<a.length;p++)if(!c(a[p],l))return!1;return!0},S.jws.JWS.inArray=function(a,l){if(l===null||typeof l!="object"||typeof l.length!="number")return!1;for(var c=0;c<l.length;c++)if(l[c]==a)return!0;return!1},S.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",ES512:"SHA512withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},S.jws.JWS.isSafeJSONString=function(a,l,c){var p=null;try{return p=Bf(a),typeof p!="object"||p.constructor===Array?0:(l&&(l[c]=p),1)}catch{return 0}},S.jws.JWS.readSafeJSONString=function(a){var l=null;try{return l=Bf(a),typeof l!="object"||l.constructor===Array?null:l}catch{return null}},S.jws.JWS.getEncodedSignatureValueFromJWS=function(a){var l=a.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(l==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return l[1]},S.jws.JWS.getJWKthumbprint=function(a){if(a.kty!=="RSA"&&a.kty!=="EC"&&a.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var l="{";if(a.kty==="RSA"){if(typeof a.n!="string"||typeof a.e!="string")throw"wrong n and e value for RSA key";l+='"e":"'+a.e+'",',l+='"kty":"'+a.kty+'",',l+='"n":"'+a.n+'"}'}else if(a.kty==="EC"){if(typeof a.crv!="string"||typeof a.x!="string"||typeof a.y!="string")throw"wrong crv, x and y value for EC key";l+='"crv":"'+a.crv+'",',l+='"kty":"'+a.kty+'",',l+='"x":"'+a.x+'",',l+='"y":"'+a.y+'"}'}else if(a.kty==="oct"){if(typeof a.k!="string")throw"wrong k value for oct(symmetric) key";l+='"kty":"'+a.kty+'",',l+='"k":"'+a.k+'"}'}var c=Pn(l),p=S.crypto.Util.hashHex(c,"sha256"),y=Gt(p);return y},S.jws.IntDate={},S.jws.IntDate.get=function(a){var l=S.jws.IntDate,c=l.getNow,p=l.getZulu;if(a=="now")return c();if(a=="now + 1hour")return c()+60*60;if(a=="now + 1day")return c()+60*60*24;if(a=="now + 1month")return c()+60*60*24*30;if(a=="now + 1year")return c()+60*60*24*365;if(a.match(/Z$/))return p(a);if(a.match(/^[0-9]+$/))return parseInt(a);throw"unsupported format: "+a},S.jws.IntDate.getZulu=function(a){return Jc(a)},S.jws.IntDate.getNow=function(){var a=~~(new Date/1e3);return a},S.jws.IntDate.intDate2UTCString=function(a){var l=new Date(a*1e3);return l.toUTCString()},S.jws.IntDate.intDate2Zulu=function(a){var l=new Date(a*1e3),c=("0000"+l.getUTCFullYear()).slice(-4),p=("00"+(l.getUTCMonth()+1)).slice(-2),y=("00"+l.getUTCDate()).slice(-2),v=("00"+l.getUTCHours()).slice(-2),x=("00"+l.getUTCMinutes()).slice(-2),C=("00"+l.getUTCSeconds()).slice(-2);return c+p+y+v+x+C+"Z"},(typeof S>"u"||!S)&&(S={}),(typeof S.jws>"u"||!S.jws)&&(S.jws={}),S.jws.JWSJS=function(){var a=S,l=a.jws,c=l.JWS,p=c.readSafeJSONString;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(y){this.init();var v=y.split(".");if(v.length!=3)throw"malformed input JWS";this.aHeader.push(v[0]),this.sPayload=v[1],this.aSignature.push(v[2])},this.addSignature=function(y,v,x,C){if(this.sPayload===void 0||this.sPayload===null)throw"there's no JSON-JS signature to add.";var O=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var _=S.jws.JWS.sign(y,v,this.sPayload,x,C),B=_.split("."),N=B[0],w=B[2];this.aHeader.push(B[0]),this.aSignature.push(B[2])}catch(I){throw this.aHeader.length>O&&this.aHeader.pop(),this.aSignature.length>O&&this.aSignature.pop(),"addSignature failed: "+I}},this.verifyAll=function(y){if(this.aHeader.length!==y.length||this.aSignature.length!==y.length)return!1;for(var v=0;v<y.length;v++){var x=y[v];if(x.length!==2)return!1;var C=this.verifyNth(v,x[0],x[1]);if(C===!1)return!1}return!0},this.verifyNth=function(y,v,x){if(this.aHeader.length<=y||this.aSignature.length<=y)return!1;var C=this.aHeader[y],O=this.aSignature[y],_=C+"."+this.sPayload+"."+O,B=!1;try{B=c.verify(_,v,x)}catch{return!1}return B},this.readJWSJS=function(y){if(typeof y=="string"){var v=p(y);if(v==null)throw"argument is not safe JSON object string";this.aHeader=v.headers,this.sPayload=v.payload,this.aSignature=v.signatures}else try{if(y.headers.length>0)this.aHeader=y.headers;else throw"malformed header";if(typeof y.payload=="string")this.sPayload=y.payload;else throw"malformed signatures";if(y.signatures.length>0)this.aSignature=y.signatures;else throw"malformed signatures"}catch(x){throw"malformed JWS-JS JSON object: "+x}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return this.aHeader.length==0?1:0}},Be.SecureRandom=bi,Be.rng_seed_time=Dc,Be.BigInteger=g,Be.RSAKey=Je,Be.ECDSA=S.crypto.ECDSA,Be.DSA=S.crypto.DSA,Be.Signature=S.crypto.Signature,Be.MessageDigest=S.crypto.MessageDigest,Be.Mac=S.crypto.Mac,Be.Cipher=S.crypto.Cipher,Be.KEYUTIL=gt,Be.ASN1HEX=Fe,Be.X509=tt,Be.X509CRL=X0,Be.CryptoJS=i,Be.b64tohex=d,Be.b64toBA=f,Be.ECFieldElementFp=rn,Be.ECPointFp=mt,Be.ECCurveFp=Yr,Be.stoBA=jf,Be.BAtos=qf,Be.BAtohex=Sa,Be.stohex=rr,Be.stob64=q0,Be.stob64u=$c,Be.b64utos=Hc,Be.b64tob64u=Us,Be.b64utob64=ba,Be.hex2b64=u,Be.hextob64u=Gt,Be.b64utohex=Pt,Be.utf8tob64u=zs,Be.b64utoutf8=Rr,Be.utf8tob64=Vc,Be.b64toutf8=Wc,Be.utf8tohex=zu,Be.hextoutf8=St,Be.hextorstr=Kt,Be.rstrtohex=Pn,Be.hextob64=Gc,Be.hextob64nl=Uf,Be.b64nltohex=$s,Be.hextopem=dn,Be.pemtohex=zt,Be.hextoArrayBuffer=$0,Be.ArrayBuffertohex=H0,Be.zulutomsec=Kc,Be.msectozulu=V0,Be.zulutosec=Jc,Be.zulutodate=cs,Be.datetozulu=Qc,Be.uricmptohex=So,Be.hextouricmp=bo,Be.ipv6tohex=wa,Be.hextoipv6=Ca,Be.hextoip=wo,Be.iptohex=Hu,Be.ucs2hextoutf8=Yc,Be.encodeURIComponentAll=Vu,Be.newline_toUnix=W0,Be.newline_toDos=G0,Be.hextoposhex=ed,Be.intarystrtohex=K0,Be.strdiffidx=J0,Be.oidtohex=Vf,Be.hextooid=Wu,Be.strpad=Gu,Be.bitstrtoint=Wf,Be.inttobitstr=Gf,Be.bitstrtobinstr=Kf,Be.binstrtobitstr=Q0,Be.isBase64URLDot=Zc,Be.namearraytobinstr=Ku,Be.extendClass=xe,Be.foldnl=$i,Be.b64topem=zf,Be.pemtob64=$f,Be.timeogen=$u,Be.aryval=Hs,Be.KJUR=S,Be.crypto=S.crypto,Be.asn1=S.asn1,Be.jws=S.jws,Be.lang=S.lang,Be.VERSION=t,Be.VERSION_FULL=r,Be}var Ap,gX=new Uint8Array(16);function z3(){if(!Ap&&(Ap=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Ap))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ap(gX)}const vX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function mv(n){return typeof n=="string"&&vX.test(n)}var Hn=[];for(var xS=0;xS<256;++xS)Hn.push((xS+256).toString(16).substr(1));function gv(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Hn[n[e+0]]+Hn[n[e+1]]+Hn[n[e+2]]+Hn[n[e+3]]+"-"+Hn[n[e+4]]+Hn[n[e+5]]+"-"+Hn[n[e+6]]+Hn[n[e+7]]+"-"+Hn[n[e+8]]+Hn[n[e+9]]+"-"+Hn[n[e+10]]+Hn[n[e+11]]+Hn[n[e+12]]+Hn[n[e+13]]+Hn[n[e+14]]+Hn[n[e+15]]).toLowerCase();if(!mv(t))throw TypeError("Stringified UUID is invalid");return t}var bR,ES,TS=0,PS=0;function yX(n,e,t){var r=e&&t||0,i=e||new Array(16);n=n||{};var s=n.node||bR,o=n.clockseq!==void 0?n.clockseq:ES;if(s==null||o==null){var u=n.random||(n.rng||z3)();s==null&&(s=bR=[u[0]|1,u[1],u[2],u[3],u[4],u[5]]),o==null&&(o=ES=(u[6]<<8|u[7])&16383)}var d=n.msecs!==void 0?n.msecs:Date.now(),f=n.nsecs!==void 0?n.nsecs:PS+1,m=d-TS+(f-PS)/1e4;if(m<0&&n.clockseq===void 0&&(o=o+1&16383),(m<0||d>TS)&&n.nsecs===void 0&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");TS=d,PS=f,ES=o,d+=122192928e5;var g=((d&268435455)*1e4+f)%4294967296;i[r++]=g>>>24&255,i[r++]=g>>>16&255,i[r++]=g>>>8&255,i[r++]=g&255;var P=d/4294967296*1e4&268435455;i[r++]=P>>>8&255,i[r++]=P&255,i[r++]=P>>>24&15|16,i[r++]=P>>>16&255,i[r++]=o>>>8|128,i[r++]=o&255;for(var D=0;D<6;++D)i[r+D]=s[D];return e||gv(i)}function $3(n){if(!mv(n))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}function SX(n){n=unescape(encodeURIComponent(n));for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}var bX="6ba7b810-9dad-11d1-80b4-00c04fd430c8",wX="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function H3(n,e,t){function r(i,s,o,u){if(typeof i=="string"&&(i=SX(i)),typeof s=="string"&&(s=$3(s)),s.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var d=new Uint8Array(16+i.length);if(d.set(s),d.set(i,s.length),d=t(d),d[6]=d[6]&15|e,d[8]=d[8]&63|128,o){u=u||0;for(var f=0;f<16;++f)o[u+f]=d[f];return o}return gv(d)}try{r.name=n}catch{}return r.DNS=bX,r.URL=wX,r}function CX(n){if(typeof n=="string"){var e=unescape(encodeURIComponent(n));n=new Uint8Array(e.length);for(var t=0;t<e.length;++t)n[t]=e.charCodeAt(t)}return xX(EX(TX(n),n.length*8))}function xX(n){for(var e=[],t=n.length*32,r="0123456789abcdef",i=0;i<t;i+=8){var s=n[i>>5]>>>i%32&255,o=parseInt(r.charAt(s>>>4&15)+r.charAt(s&15),16);e.push(o)}return e}function V3(n){return(n+64>>>9<<4)+14+1}function EX(n,e){n[e>>5]|=128<<e%32,n[V3(e)-1]=e;for(var t=1732584193,r=-271733879,i=-1732584194,s=271733878,o=0;o<n.length;o+=16){var u=t,d=r,f=i,m=s;t=dr(t,r,i,s,n[o],7,-680876936),s=dr(s,t,r,i,n[o+1],12,-389564586),i=dr(i,s,t,r,n[o+2],17,606105819),r=dr(r,i,s,t,n[o+3],22,-1044525330),t=dr(t,r,i,s,n[o+4],7,-176418897),s=dr(s,t,r,i,n[o+5],12,1200080426),i=dr(i,s,t,r,n[o+6],17,-1473231341),r=dr(r,i,s,t,n[o+7],22,-45705983),t=dr(t,r,i,s,n[o+8],7,1770035416),s=dr(s,t,r,i,n[o+9],12,-1958414417),i=dr(i,s,t,r,n[o+10],17,-42063),r=dr(r,i,s,t,n[o+11],22,-1990404162),t=dr(t,r,i,s,n[o+12],7,1804603682),s=dr(s,t,r,i,n[o+13],12,-40341101),i=dr(i,s,t,r,n[o+14],17,-1502002290),r=dr(r,i,s,t,n[o+15],22,1236535329),t=hr(t,r,i,s,n[o+1],5,-165796510),s=hr(s,t,r,i,n[o+6],9,-1069501632),i=hr(i,s,t,r,n[o+11],14,643717713),r=hr(r,i,s,t,n[o],20,-373897302),t=hr(t,r,i,s,n[o+5],5,-701558691),s=hr(s,t,r,i,n[o+10],9,38016083),i=hr(i,s,t,r,n[o+15],14,-660478335),r=hr(r,i,s,t,n[o+4],20,-405537848),t=hr(t,r,i,s,n[o+9],5,568446438),s=hr(s,t,r,i,n[o+14],9,-1019803690),i=hr(i,s,t,r,n[o+3],14,-187363961),r=hr(r,i,s,t,n[o+8],20,1163531501),t=hr(t,r,i,s,n[o+13],5,-1444681467),s=hr(s,t,r,i,n[o+2],9,-51403784),i=hr(i,s,t,r,n[o+7],14,1735328473),r=hr(r,i,s,t,n[o+12],20,-1926607734),t=fr(t,r,i,s,n[o+5],4,-378558),s=fr(s,t,r,i,n[o+8],11,-2022574463),i=fr(i,s,t,r,n[o+11],16,1839030562),r=fr(r,i,s,t,n[o+14],23,-35309556),t=fr(t,r,i,s,n[o+1],4,-1530992060),s=fr(s,t,r,i,n[o+4],11,1272893353),i=fr(i,s,t,r,n[o+7],16,-155497632),r=fr(r,i,s,t,n[o+10],23,-1094730640),t=fr(t,r,i,s,n[o+13],4,681279174),s=fr(s,t,r,i,n[o],11,-358537222),i=fr(i,s,t,r,n[o+3],16,-722521979),r=fr(r,i,s,t,n[o+6],23,76029189),t=fr(t,r,i,s,n[o+9],4,-640364487),s=fr(s,t,r,i,n[o+12],11,-421815835),i=fr(i,s,t,r,n[o+15],16,530742520),r=fr(r,i,s,t,n[o+2],23,-995338651),t=pr(t,r,i,s,n[o],6,-198630844),s=pr(s,t,r,i,n[o+7],10,1126891415),i=pr(i,s,t,r,n[o+14],15,-1416354905),r=pr(r,i,s,t,n[o+5],21,-57434055),t=pr(t,r,i,s,n[o+12],6,1700485571),s=pr(s,t,r,i,n[o+3],10,-1894986606),i=pr(i,s,t,r,n[o+10],15,-1051523),r=pr(r,i,s,t,n[o+1],21,-2054922799),t=pr(t,r,i,s,n[o+8],6,1873313359),s=pr(s,t,r,i,n[o+15],10,-30611744),i=pr(i,s,t,r,n[o+6],15,-1560198380),r=pr(r,i,s,t,n[o+13],21,1309151649),t=pr(t,r,i,s,n[o+4],6,-145523070),s=pr(s,t,r,i,n[o+11],10,-1120210379),i=pr(i,s,t,r,n[o+2],15,718787259),r=pr(r,i,s,t,n[o+9],21,-343485551),t=jo(t,u),r=jo(r,d),i=jo(i,f),s=jo(s,m)}return[t,r,i,s]}function TX(n){if(n.length===0)return[];for(var e=n.length*8,t=new Uint32Array(V3(e)),r=0;r<e;r+=8)t[r>>5]|=(n[r/8]&255)<<r%32;return t}function jo(n,e){var t=(n&65535)+(e&65535),r=(n>>16)+(e>>16)+(t>>16);return r<<16|t&65535}function PX(n,e){return n<<e|n>>>32-e}function vv(n,e,t,r,i,s){return jo(PX(jo(jo(e,n),jo(r,s)),i),t)}function dr(n,e,t,r,i,s,o){return vv(e&t|~e&r,n,e,i,s,o)}function hr(n,e,t,r,i,s,o){return vv(e&r|t&~r,n,e,i,s,o)}function fr(n,e,t,r,i,s,o){return vv(e^t^r,n,e,i,s,o)}function pr(n,e,t,r,i,s,o){return vv(t^(e|~r),n,e,i,s,o)}var RX=H3("v3",48,CX);const _X=RX;function IX(n,e,t){n=n||{};var r=n.random||(n.rng||z3)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return gv(r)}function AX(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function RS(n,e){return n<<e|n>>>32-e}function kX(n){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){var r=unescape(encodeURIComponent(n));n=[];for(var i=0;i<r.length;++i)n.push(r.charCodeAt(i))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);for(var s=n.length/4+2,o=Math.ceil(s/16),u=new Array(o),d=0;d<o;++d){for(var f=new Uint32Array(16),m=0;m<16;++m)f[m]=n[d*64+m*4]<<24|n[d*64+m*4+1]<<16|n[d*64+m*4+2]<<8|n[d*64+m*4+3];u[d]=f}u[o-1][14]=(n.length-1)*8/Math.pow(2,32),u[o-1][14]=Math.floor(u[o-1][14]),u[o-1][15]=(n.length-1)*8&4294967295;for(var g=0;g<o;++g){for(var P=new Uint32Array(80),D=0;D<16;++D)P[D]=u[g][D];for(var M=16;M<80;++M)P[M]=RS(P[M-3]^P[M-8]^P[M-14]^P[M-16],1);for(var U=t[0],j=t[1],E=t[2],k=t[3],z=t[4],K=0;K<80;++K){var ie=Math.floor(K/20),he=RS(U,5)+AX(ie,j,E,k)+z+e[ie]+P[K]>>>0;z=k,k=E,E=RS(j,30)>>>0,j=U,U=he}t[0]=t[0]+U>>>0,t[1]=t[1]+j>>>0,t[2]=t[2]+E>>>0,t[3]=t[3]+k>>>0,t[4]=t[4]+z>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var OX=H3("v5",80,kX);const FX=OX,NX="00000000-0000-0000-0000-000000000000";function DX(n){if(!mv(n))throw TypeError("Invalid UUID");return parseInt(n.substr(14,1),16)}const LX=Object.freeze(Object.defineProperty({__proto__:null,NIL:NX,parse:$3,stringify:gv,v1:yX,v3:_X,v4:IX,v5:FX,validate:mv,version:DX},Symbol.toStringTag,{value:"Module"})),yv=Li(LX);var wR;function MX(){if(wR)return Pa;wR=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Pa,"__esModule",{value:!0}),Pa.generateUser=Pa.generateToken=void 0;const n=mX(),e=yv;function t(i,s,o,u,d,f=60*60,m="1.0"){let g=d||r();(g.id===""||g.id===void 0)&&(g=r());const P=Math.round(Date.now()/1e3),M={documentId:u??"",scopes:o,tenantId:i,user:g,iat:P,exp:P+f,ver:m,jti:(0,e.v4)()},U={utf8:s};return n.KJUR.jws.JWS.sign(null,JSON.stringify({alg:"HS256",typ:"JWT"}),M,U)}Pa.generateToken=t;function r(){return{id:(0,e.v4)(),name:(0,e.v4)()}}return Pa.generateUser=r,Pa}var CR;function BX(){if(CR)return pd;CR=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(pd,"__esModule",{value:!0}),pd.InsecureTokenProvider=void 0;const n=U3,e=MX();class t{constructor(i,s){this.tenantKey=i,this.user=s}async fetchOrdererToken(i,s){return{fromCache:!0,jwt:(0,e.generateToken)(i,this.tenantKey,[n.ScopeType.DocRead,n.ScopeType.DocWrite,n.ScopeType.SummaryWrite],s,this.user)}}async fetchStorageToken(i,s){return{fromCache:!0,jwt:(0,e.generateToken)(i,this.tenantKey,[n.ScopeType.DocRead,n.ScopeType.DocWrite,n.ScopeType.SummaryWrite],s,this.user)}}}return pd.InsecureTokenProvider=t,pd}var md={};const W3=Li(Wz);var xR;function jX(){if(xR)return md;xR=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(md,"__esModule",{value:!0}),md.MockFluidDataStoreContext=void 0;const n=W3,e=yv;class t{constructor(i=(0,e.v4)(),s=!1,o=n.DebugLogger.create("fluid:MockFluidDataStoreContext")){this.id=i,this.existing=s,this.logger=o,this.documentId=void 0,this.isLocalDataStore=!0,this.packagePath=void 0,this.options=void 0,this.clientId=(0,e.v4)(),this.clientDetails=void 0,this.connected=!0,this.deltaManager=void 0,this.containerRuntime=void 0,this.storage=void 0,this.IFluidDataStoreRegistry=void 0,this.IFluidHandleContext=void 0,this.attachState=void 0,this.scope=void 0}on(i,s){switch(i){case"attaching":case"attached":return this;default:throw new Error("Method not implemented.")}}once(i,s){return this}off(i,s){throw new Error("Method not implemented.")}getQuorum(){}getAudience(){}submitMessage(i,s,o){throw new Error("Method not implemented.")}submitSignal(i,s){throw new Error("Method not implemented.")}bindToContext(){throw new Error("Method not implemented.")}setChannelDirty(i){throw new Error("Method not implemented.")}async getAbsoluteUrl(i){throw new Error("Method not implemented.")}getCreateChildSummarizerNodeFn(i,s){throw new Error("Method not implemented.")}async uploadBlob(i){throw new Error("Method not implemented.")}async getInitialGCSummaryDetails(){throw new Error("Method not implemented.")}async getBaseGCDetails(){throw new Error("Method not implemented.")}}return md.MockFluidDataStoreContext=t,md}var Ra={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function xi(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function G3(n,e){switch(e){case"base64":return yi(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const qX=(n,e)=>Fu.from(n,e).buffer,UX=(n,e)=>Fu.from(n).toString(e);function yw(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let Fu=class Ha extends Uint8Array{toString(e){return G3(this,e)}static from(e,t,r){if(typeof e=="string")return Ha.fromString(e,t);if(e!==null&&typeof e=="object"&&yw(e.buffer))return xi(e.byteOffset===0,0),xi(e.byteLength===e.buffer.byteLength,1),Ha.fromArrayBuffer(e.buffer,t,r);if(yw(e))return Ha.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Ha(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=js(r);return new Ha(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Ha(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};async function zX(n,e){const t=await crypto.subtle.digest(e,n);return new Uint8Array(t)}function $X(n,e){switch(e){case"hex":return Array.prototype.map.call(n,r=>r.toString(16).padStart(2,"0")).join("");case"base64":return yi(n)}}async function K3(n,e="SHA-1",t="hex"){if(crypto.subtle===void 0)return WC(()=>import("./hashFileNode-0150a0a8.js"),["./hashFileNode-0150a0a8.js","./sha256-738eea55.js"],import.meta.url).then(async i=>i.hashFile(n,e,t));const r=await zX(n,e);return $X(r,t)}async function HX(n){const t=`blob ${n.byteLength.toString()}${String.fromCharCode(0)}`,r=Fu.from(t+n.toString());return K3(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Sw=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const VX=n=>Fu.from(n,"base64").toString("utf-8"),WX=n=>Fu.from(n,"utf8").toString("base64"),GX=(n,e)=>{switch(e){case"utf8":case"utf-8":return n;default:return Fu.from(n,e).toString()}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class KX{constructor(e,t=100){this.process=e,this.maxBatchSize=t,this.pendingWork=new Map}add(e,t){this.pendingWork.has(e)||this.pendingWork.set(e,[]),this.pendingWork.get(e).push(t),this.pendingWork.get(e).length>=this.maxBatchSize?(this.pendingTimer!==void 0&&clearTimeout(this.pendingTimer),this.pendingTimer=void 0,this.startWork()):this.pendingTimer===void 0&&(this.pendingTimer=setTimeout(()=>{this.pendingTimer=void 0,this.startWork()},0))}drain(){this.startWork()}startWork(){const e=this.pendingWork;this.pendingWork=new Map;for(const[t,r]of e)this.process(t,r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function JX(n,e){return(...t)=>{if(n.disposed)throw new Error("Already disposed");return e(...t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class J3 extends Fn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class bs extends J3{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,e!==void 0){const t=i=>this.unforwardEvent(e,i),r=i=>this.forwardEvent(e,i);this.on(bs.removeListenerEvent,t),this.on(bs.newListenerEvent,r)}}static isEmitterEvent(e){return e===bs.newListenerEvent||e===bs.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(e!==void 0&&r!==void 0&&!bs.isEmitterEvent(r)){let i=this.forwardingEvents.get(r);if(i===void 0&&(i=new Map,this.forwardingEvents.set(r,i)),!i.has(e)){const s=(...o)=>this.emit(r,...o);i.set(e,()=>e.off(r,s)),e.on(r,s)}}}unforwardEvent(e,...t){for(const r of t)if(r!==void 0&&!bs.isEmitterEvent(r)){const i=this.forwardingEvents.get(r);if(i!=null&&i.has(e)&&this.listenerCount(r)===0){const s=i.get(e);s!==void 0&&s(),i.delete(e),i.size===0&&this.forwardingEvents.delete(r)}}}}bs.newListenerEvent="newListener";bs.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const QX={compare:(n,e)=>n-e,min:Number.MIN_VALUE};class XX{constructor(e){this.comp=e,this.L=[{value:e.min,position:0}]}peek(){return this.L[1]}get(){this.swap(1,this.count());const e=this.L.pop();return this.fixdown(1),e.value}add(e){const t={value:e,position:this.L.length};return this.L.push(t),this.fixup(this.count()),t}update(e){const t=e.position;this.isGreaterThanParent(t)?this.fixup(t):this.fixdown(t)}remove(e){const t=e.position;this.swap(e.position,this.L.length-1),this.L.splice(this.L.length-1),t!==this.L.length&&this.update(this.L[t])}count(){return this.L.length-1}fixup(e){let t=e;for(;this.isGreaterThanParent(t);){const r=t>>1;this.swap(t,r),t=r}}isGreaterThanParent(e){return e>1&&this.comp.compare(this.L[e>>1].value,this.L[e].value)>0}fixdown(e){let t=e;for(;t<<1<=this.count();){let r=t<<1;if(r<this.count()&&this.comp.compare(this.L[r].value,this.L[r+1].value)>0&&r++,this.comp.compare(this.L[t].value,this.L[r].value)<=0)break;this.swap(t,r),t=r}}swap(e,t){const r=this.L[e];this.L[e]=this.L[t],this.L[e].position=e,this.L[t]=r,this.L[t].position=t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class YX{send(e){}}let ZX=class{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}};function eY(n){const e=s=>s!==null&&!Array.isArray(s)&&typeof s=="object",t=(s,o)=>{const u=s.split(`
`);return u.shift(),o!==void 0&&u.unshift(o),u.join(`
`)},i={message:typeof(n==null?void 0:n.message)=="string"?n.message:String(n)};if(e(n)){const{errorType:s,stack:o,name:u}=n;if(typeof s=="string"&&(i.errorType=s),typeof o=="string"){const d=typeof u=="string"?u:void 0;i.stack=t(o,d)}}return i}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class tY{constructor(e,t){this.expiry=e,this.cleanup=t,this.gcTimeouts=new Map}schedule(e){this.expiry.policy!=="indefinite"&&this.gcTimeouts.set(e,setTimeout(()=>{this.cleanup(e),this.cancel(e)},this.expiry.durationMs))}cancel(e){const t=this.gcTimeouts.get(e);t!==void 0&&(clearTimeout(t),this.gcTimeouts.delete(e))}update(e){this.expiry.policy==="sliding"&&(this.cancel(e),this.schedule(e))}}class nY{constructor({expiry:e={policy:"indefinite"},removeOnError:t=()=>!0}={}){this.cache=new Map,this.removeOnError=t,this.gc=new tY(e,r=>this.remove(r))}has(e){return this.cache.has(e)}get(e){return this.has(e)&&this.gc.update(e),this.cache.get(e)}remove(e){return this.gc.cancel(e),this.cache.delete(e)}async addOrGet(e,t){let r=this.get(e);return r===void 0&&(r=(async()=>t())(),this.cache.set(e,r),r.catch(s=>{this.removeOnError(s)&&this.remove(e)}),this.gc.schedule(e)),r}add(e,t){const r=this.has(e);return this.addOrGet(e,t).catch(()=>{}),!r}async addValueOrGet(e,t){return this.addOrGet(e,async()=>t)}addValue(e,t){return this.add(e,async()=>t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Q3=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}};class rY{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class iY{constructor(e,t){typeof e=="number"?(this.ranges=[{length:0,primary:e,secondary:t}],this.lastPrimary=e,this.lastSecondary=t):(this.ranges=ia(e.ranges),this.lastPrimary=e.lastPrimary,this.lastSecondary=e.lastSecondary)}get base(){return this.ranges[0].primary}get primaryHead(){return this.lastPrimary}get secondaryHead(){return this.lastSecondary}serialize(){return{lastPrimary:this.lastPrimary,lastSecondary:this.lastSecondary,ranges:ia(this.ranges)}}add(e,t){xi(e>=this.lastPrimary,3),this.lastSecondary!==void 0&&xi(t>=this.lastSecondary,4),this.lastPrimary=e,this.lastSecondary=t;const r=this.ranges[this.ranges.length-1],i=r.primary+r.length,s=r.secondary+r.length;t!==s&&(e===i?r.length===0?r.secondary=t:(r.length--,this.ranges.push({length:0,primary:e,secondary:t})):i+1===e&&s+1===t?r.length++:this.ranges.push({length:0,primary:e,secondary:t}))}get(e){xi(e>=this.ranges[0].primary,5);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);xi(e>=this.ranges[t-1].primary,6);const r=this.ranges[t-1];return Math.min(e-r.primary,r.length)+r.secondary}updateBase(e){xi(e>=this.ranges[0].primary,7);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);xi(e>=this.ranges[t-1].primary,8);const r=this.ranges[t-1],i=e-r.primary;r.secondary=r.secondary+Math.min(i,r.length),r.length=Math.max(r.length-i,0),r.primary=e,this.ranges=t-1>0?this.ranges.slice(t-1):this.ranges,xi(e===this.ranges[0].primary,9)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class sY{constructor(e){this.windowMSec=e,this.requestMap=new Map}filter(e,t){const r=[],i=Date.now();for(const s of t){const o=`${e}/${s}`;if(!this.requestMap.has(o))this.requestMap.set(o,i),r.push(s);else{if(this.requestMap.get(o)+this.windowMSec>i)continue;this.requestMap.set(o,i),r.push(s)}}return r}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function oY(n){let e;try{e=JSON.parse(n)}catch{}return e}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class X3{constructor(e,t,r=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,i;if(!this.runningState)this.start(e,t);else{const s=e??this.runningState.intendedDuration,o=(i=t??((r=this.runningState.restart)===null||r===void 0?void 0:r.handler))!==null&&i!==void 0?i:this.runningState.handler,u=this.calculateRemainingTime(this.runningState);s<u?this.start(s,o):s===u?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:setTimeout(()=>this.handler(),e)}}handler(){xi(!!this.runningState,10);const e=this.runningState.restart;if(e!==void 0){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}}class aY{constructor(e,t){this.timer=new X3(e,()=>this.wrapHandler(t))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new Q3,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),xi(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class oE{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=Sw.now();return new oE(e)}trace(){const e=Sw.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function uY(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class lY{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const cY=async n=>new Promise(e=>setTimeout(()=>e(),n));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function dY(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const hY=Object.freeze(Object.defineProperty({__proto__:null,BaseTelemetryNullLogger:YX,BatchManager:KX,Deferred:Q3,EventForwarder:bs,Heap:XX,IsoBuffer:Fu,Lazy:lY,LazyPromise:rY,NumberComparer:QX,PromiseCache:nY,PromiseTimer:aY,RangeTracker:iY,RateLimiter:sY,TelemetryNullLogger:ZX,Timer:X3,Trace:oE,TypedEventEmitter:J3,Uint8ArrayToArrayBuffer:dY,Uint8ArrayToString:G3,assert:xi,bufferToString:UX,delay:cY,doIfNotDisposed:JX,extractLogSafeErrorProperties:eY,fromBase64ToUtf8:VX,fromUtf8ToBase64:WX,gitHashFile:HX,hashFile:K3,isArrayBuffer:yw,performance:Sw,safelyParseJSON:oY,stringToBuffer:qX,toUtf8:GX,unreachableCase:uY},Symbol.toStringTag,{value:"Module"})),Sv=Li(hY);var ER;function Y3(){if(ER)return Ra;ER=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ra,"__esModule",{value:!0}),Ra.MockDeltaManager=Ra.MockDeltaQueue=void 0;const n=Fn,e=Sv;class t extends n.EventEmitter{constructor(){super(),this.queue=[],this.pauseCount=0,this.processCallback=()=>{}}get disposed(){}get paused(){return this.pauseCount!==0}get length(){return this.queue.length}get idle(){return this.queue.length===0}process(){Promise.resolve().then(()=>{for(;this.pauseCount===0&&this.length>0;){const s=this.pop();(0,e.assert)(s!==void 0,"this is impossible due to the above length check"),this.processCallback(s)}})}push(s){this.queue.push(s),this.emit("push",s),this.process()}pop(){return this.queue.shift()}async pause(){this.pauseCount++}resume(){this.pauseCount--,this.process()}peek(){return this.queue[0]}toArray(){return this.queue}dispose(){}async waitTillProcessingDone(){throw new Error("NYI")}}Ra.MockDeltaQueue=t;class r extends e.TypedEventEmitter{constructor(){super(),this.readOnlyInfo={readonly:!1},this.clientType=void 0,this.clientDetails=void 0,this._inbound=void 0,this._inboundSignal=void 0,this._outbound=void 0,this.minimumSequenceNumber=0,this.lastSequenceNumber=0,this.lastKnownSeqNumber=0,this.initialSequenceNumber=0,this.hasCheckpointSequenceNumber=!1,this._inbound=new t,this._outbound=new t,this._inboundSignal=new t}get disposed(){}get IDeltaSender(){return this}get inbound(){return this._inbound}get outbound(){return this._outbound}get inboundSignal(){return this._inboundSignal}get version(){}get maxMessageSize(){return 0}get serviceConfiguration(){}get active(){return!0}close(){}submitSignal(s){}flush(){}submit(s,o,u=!1,d){return 0}dispose(){}}return Ra.MockDeltaManager=r,Ra}var gd={};const Z3=Li(YL);var TR;function fY(){if(TR)return gd;TR=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(gd,"__esModule",{value:!0}),gd.MockHandle=void 0;const n=Z3;class e{constructor(r,i=`mock-handle-${Math.random().toString(36).slice(2)}`,s=`/${i}`){this.value=r,this.path=i,this.absolutePath=s,this.graphAttachState=n.AttachState.Detached}get IFluidHandle(){return this}get isAttached(){return this.graphAttachState===n.AttachState.Attached}async get(){return this.value}attachGraph(){this.graphAttachState=n.AttachState.Attached}bind(){throw Error("MockHandle.bind() unimplemented.")}}return gd.MockHandle=e,gd}var wn={};const eN=Li(_W);var PR;function tN(){if(PR)return wn;PR=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(wn,"__esModule",{value:!0}),wn.MockSharedObjectServices=wn.MockObjectStorageService=wn.MockEmptyDeltaConnection=wn.MockFluidDataStoreRuntime=wn.MockQuorumClients=wn.MockContainerRuntimeFactory=wn.MockContainerRuntime=wn.MockDeltaConnection=void 0;const n=Fn,e=Sv,t=Z3,r=W3,i=U3,s=eN,o=yv,u=Y3();class d{constructor(E,k){this.submitFn=E,this.dirtyFn=k,this._connected=!0}get connected(){return this._connected}attach(E){this.handler=E,E.setConnectionState(this.connected)}submit(E,k){return this.submitFn(E,k)}dirty(){this.dirtyFn()}setConnectionState(E){var k;this._connected=E,(k=this.handler)===null||k===void 0||k.setConnectionState(E)}process(E,k,z){var K;(K=this.handler)===null||K===void 0||K.process(E,k,z)}reSubmit(E,k){var z;(z=this.handler)===null||z===void 0||z.reSubmit(E,k)}}wn.MockDeltaConnection=d;class f{constructor(E,k){var z;this.dataStoreRuntime=E,this.factory=k,this.clientSequenceNumber=0,this.deltaConnections=[],this.pendingMessages=[],this.deltaManager=new u.MockDeltaManager,this.dataStoreRuntime.deltaManager=this.deltaManager,this.dataStoreRuntime.quorum=k.quorum,this.clientId=(z=this.dataStoreRuntime.clientId)!==null&&z!==void 0?z:(0,o.v4)(),k.quorum.addMember(this.clientId,{})}createDeltaConnection(){const E=new d((k,z)=>this.submit(k,z),()=>this.dirty());return this.deltaConnections.push(E),E}submit(E,k){const z=this.clientSequenceNumber++,K={clientId:this.clientId,clientSequenceNumber:z,contents:E,referenceSequenceNumber:this.deltaManager.lastSequenceNumber,type:i.MessageType.Operation};return this.factory.pushMessage(K),this.addPendingMessage(E,k,z),z}dirty(){}process(E){this.deltaManager.lastSequenceNumber=E.sequenceNumber,this.deltaManager.lastMessage=E,this.deltaManager.minimumSequenceNumber=E.minimumSequenceNumber;const[k,z]=this.processInternal(E);this.deltaConnections.forEach(K=>{K.process(E,k,z)})}addPendingMessage(E,k,z){const K={content:E,clientSequenceNumber:z,localOpMetadata:k};this.pendingMessages.push(K)}processInternal(E){let k;const z=this.clientId===E.clientId;if(z){const K=this.pendingMessages.shift();(0,e.assert)((K==null?void 0:K.clientSequenceNumber)===E.clientSequenceNumber,"Unexpected client sequence number from message"),k=K.localOpMetadata}return[z,k]}}wn.MockContainerRuntime=f;class m{constructor(){this.sequenceNumber=0,this.minSeq=new Map,this.quorum=new g,this.messages=[],this.runtimes=[]}get outstandingMessageCount(){return this.messages.length}getMinSeq(){let E;for(const[,k]of this.minSeq)E?E=Math.min(E,k):E=k;return E??0}createContainerRuntime(E){const k=new f(E,this);return this.runtimes.push(k),k}pushMessage(E){E.clientId&&E.referenceSequenceNumber!==void 0&&!this.minSeq.has(E.clientId)&&this.minSeq.set(E.clientId,E.referenceSequenceNumber),this.messages.push(E)}processOneMessage(){if(this.messages.length===0)throw new Error("Tried to process a message that did not exist");let E=this.messages.shift();E=JSON.parse(JSON.stringify(E)),this.minSeq.set(E.clientId,E.referenceSequenceNumber),E.sequenceNumber=++this.sequenceNumber,E.minimumSequenceNumber=this.getMinSeq();for(const k of this.runtimes)k.process(E)}processSomeMessages(E){if(E>this.messages.length)throw new Error("Tried to process more messages than exist");for(let k=0;k<E;k++)this.processOneMessage()}processAllMessages(){for(;this.messages.length>0;)this.processOneMessage()}}wn.MockContainerRuntimeFactory=m;class g{constructor(...E){var k;this.eventEmitter=new n.EventEmitter,this.disposed=!1,this.members=new Map((k=E)!==null&&k!==void 0?k:[])}addMember(E,k){this.members.set(E,k),this.eventEmitter.emit("addMember",E,k)}removeMember(E){this.members.delete(E)&&this.eventEmitter.emit("removeMember",E)}getMembers(){return this.members}getMember(E){return this.getMembers().get(E)}dispose(){throw new Error("Method not implemented.")}addListener(E,k){throw new Error("Method not implemented.")}on(E,k){switch(E){case"afterOn":return this.eventEmitter.on(E,k),this;case"addMember":case"removeMember":return this.eventEmitter.on(E,k),this.eventEmitter.emit("afterOn",E),this;default:throw new Error("Method not implemented.")}}once(E,k){throw new Error("Method not implemented.")}prependListener(E,k){throw new Error("Method not implemented.")}prependOnceListener(E,k){throw new Error("Method not implemented.")}removeListener(E,k){return this.eventEmitter.removeListener(E,k),this}off(E,k){return this.eventEmitter.off(E,k),this}removeAllListeners(E){throw new Error("Method not implemented.")}setMaxListeners(E){throw new Error("Method not implemented.")}getMaxListeners(){throw new Error("Method not implemented.")}listeners(E){throw new Error("Method not implemented.")}rawListeners(E){throw new Error("Method not implemented.")}emit(E,...k){throw new Error("Method not implemented.")}eventNames(){throw new Error("Method not implemented.")}listenerCount(E){throw new Error("Method not implemented.")}}wn.MockQuorumClients=g;class P extends n.EventEmitter{constructor(){super(...arguments),this.documentId=void 0,this.id=(0,o.v4)(),this.existing=void 0,this.options={},this.clientId=(0,o.v4)(),this.path="",this.connected=!0,this.deltaManager=new u.MockDeltaManager,this.loader=void 0,this.logger=r.DebugLogger.create("fluid:MockFluidDataStoreRuntime"),this.quorum=new g,this._local=!1,this._disposed=!1}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get IFluidRouter(){return this}get absolutePath(){return`/${this.id}`}get local(){return this._local}set local(E){this._local=E}get disposed(){return this._disposed}dispose(){this._disposed=!0}async getChannel(E){return null}createChannel(E,k){return null}get isAttached(){return!this.local}get attachState(){return this.local?t.AttachState.Detached:t.AttachState.Attached}bindChannel(E){}attachGraph(){}bindToContext(){}bind(E){}getQuorum(){return this.quorum}getAudience(){return null}save(E){}async close(){}async uploadBlob(E){return null}async getBlob(E){return null}submitMessage(E,k){return null}submitSignal(E,k){return null}process(E,k){}processSignal(E,k){}updateMinSequenceNumber(E){}setConnectionState(E,k){}async resolveHandle(E){return this.request(E)}async request(E){return null}addedGCOutboundReference(E,k){}async summarize(E,k){const z=(0,s.mergeStats)();return z.treeNodeCount++,{summary:{type:i.SummaryType.Tree,tree:{}},stats:z}}async getGCData(){return{gcNodes:{}}}updateUsedRoutes(E,k){}getAttachSnapshot(){return[]}getAttachSummary(){const E=(0,s.mergeStats)();return E.treeNodeCount++,{summary:{type:i.SummaryType.Tree,tree:{}},stats:E}}setAttachState(E){}async waitAttached(){}async requestDataStore(E){return null}reSubmit(E,k){}async applyStashedOp(E){}rollback(E,k){}}wn.MockFluidDataStoreRuntime=P;class D{constructor(){this.connected=!1}attach(E){}submit(E){return(0,e.assert)(!1,"Throw submit error on mock empty delta connection"),0}dirty(){}}wn.MockEmptyDeltaConnection=D;class M{constructor(E){this.contents=E}async readBlob(E){return(0,e.stringToBuffer)(this.contents[E],"utf8")}async contains(E){return this.contents[E]!==void 0}async list(E){const k=(0,s.getNormalizedObjectStoragePathParts)(E).length;return Object.keys(this.contents).filter(z=>z.startsWith(E)&&z.split("/").length===k+1)}}wn.MockObjectStorageService=M;class U{constructor(E){this.deltaConnection=new D,this.objectStorage=new M(E)}static createFromSummary(E){const k={};for(const[z,K]of Object.entries(E.tree))(0,e.assert)(K.type===i.SummaryType.Blob,"Unexpected summary type on mock createFromSummary"),k[z]=K.content;return new U(k)}}return wn.MockSharedObjectServices=U,wn}var _a={},RR;function pY(){if(RR)return _a;RR=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(_a,"__esModule",{value:!0}),_a.MockContainerRuntimeFactoryForReconnection=_a.MockContainerRuntimeForReconnection=void 0;const n=yv,e=Sv,t=tN();class r extends t.MockContainerRuntime{constructor(o,u){super(o,u),this.pendingRemoteMessages=[],this._connected=!0}get connected(){return this._connected}set connected(o){if(this._connected!==o){if(this._connected=o,o){for(const u of this.pendingRemoteMessages)this.process(u);this.pendingRemoteMessages.length=0,this.clientSequenceNumber=0,this.clientId=(0,n.v4)(),this.dataStoreRuntime.clientId=this.clientId,this.factory.quorum.addMember(this.clientId,{}),this.reSubmitMessages()}else this.factory.clearOutstandingClientMessages(this.clientId),this.factory.quorum.removeMember(this.clientId);this.deltaConnections.forEach(u=>{u.setConnectionState(this.connected)})}}process(o){this.connected?super.process(o):this.pendingRemoteMessages.push(o)}submit(o,u){return this.connected?super.submit(o,u):(this.addPendingMessage(o,u,-1),-1)}reSubmitMessages(){let o=this.pendingMessages.length;for(;o>0;){const u=this.pendingMessages.shift();(0,e.assert)(u!==void 0,"this is impossible due to the above length check"),this.deltaConnections.forEach(d=>{d.reSubmit(u.content,u.localOpMetadata)}),o--}}}_a.MockContainerRuntimeForReconnection=r;class i extends t.MockContainerRuntimeFactory{createContainerRuntime(o){const u=new r(o,this);return this.runtimes.push(u),u}clearOutstandingClientMessages(o){this.messages=this.messages.filter(u=>u.clientId!==o)}}return _a.MockContainerRuntimeFactoryForReconnection=i,_a}var vd={},_R;function mY(){if(_R)return vd;_R=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(vd,"__esModule",{value:!0}),vd.MockStorage=void 0;const n=Sv,e=eN;class t{constructor(i){this.tree=i}static createFromSummary(i){const s=(0,e.convertSummaryTreeToITree)(i);return new t(s)}static readBlobCore(i,s){if(i){for(const o of i.entries)if(o.path===s[0])return o.type==="Blob"?((0,n.assert)(s.length===1,JSON.stringify(Object.assign({},arguments))),o.value):o.type==="Tree"?t.readBlobCore(o.value,s.slice(1)):void 0;return}}async readBlob(i){const s=t.readBlobCore(this.tree,i.split("/"));return(0,n.assert)(s!==void 0,`Blob does not exist: ${i}`),(0,n.stringToBuffer)(s.contents,s.encoding)}async contains(i){return t.readBlobCore(this.tree,i.split("/"))!==void 0}async list(i){return(0,e.listBlobsAtTreePath)(this.tree,i)}}return vd.MockStorage=t,vd}var yd={},Sd={},IR;function gY(){if(IR)return Sd;IR=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */return Object.defineProperty(Sd,"__esModule",{value:!0}),Sd.shortCodeMap=void 0,Sd.shortCodeMap={"0x000":"nonzero isobuffer byte offset","0x001":"unexpected isobuffer byte length","0x003":"Primary to add to range < last primary!","0x004":"Secondary to add to range < last secondary!","0x005":"Target primary to retrieve < first range's primary!","0x006":"Target primary to retrieve < last range's primary!","0x007":"Target primary to update < first range's primary!","0x008":"Target primary to update < last range's primary!","0x009":"After update, target primary is not first range's primary!","0x00a":"Running timer missing handler","0x00b":"Handler executed without deferred","0x00c":"messageId is incorrect from from the local client's ACK","0x00d":"Missing message handler for message type","0x00e":"Missing message handler for message type","0x00f":"pendingMessageId is missing from the local client's operation","0x010":"Received out of order storage op when there is an unackd clear message","0x011":"pendingMessageId is missing from the local client's operation","0x012":"pendingMessageId is missing from the local client's operation","0x013":"Received out of order op when there is an unackd clear message","0x014":"pendingMessageId is missing from the local client's operation","0x015":"pendingMessageId is missing from the local client's clear operation","0x016":"apply stashed op not implemented for custom value type ops","0x017":"Trying to add invalid handle!","0x018":"Trying to insert handle into position with already valid handle!","0x019":"SharedMatrix.openUndo() supports at most a single IUndoConsumer.","0x01a":"Trying to set out-of-bounds cell!","0x01b":"Trying to set multiple out-of-bounds cells!","0x01c":"The 'localSeq' of the vector submitting an op must >= the 'localSeq' of the other vector.","0x01d":"Trying to submit message to runtime while detached!","0x01e":"Row and col collab window 'localSeq' desynchronized!","0x01f":"Row and col collab window 'collaborating' status desynchronized!","0x020":"Unknown SharedMatrix 'op' type.","0x021":"SharedMatrix message contents have unexpected type!","0x022":"SharedMatrix row and/or col handles are invalid!","0x023":"The 'localSeq' of pending write (if any) must be <= the localSeq of the currently processed op.","0x024":"Start of PermutationSegment already allocated!","0x025":"Trying to set start of PermutationSegment to invalid handle!","0x026":"Trying to split segment at out-of-bounds position!","0x027":"Trying to get handle of out-of-bounds position!","0x028":"'localSeq' for op being resubmitted must be <= the 'localSeq' of the last submitted op.","0x029":"Invalid handle at start of containing segment!","0x02a":"On vector undo, unexpected 'currentOp' type/state!","0x02b":"Must not nest calls to IRevertible.revert()","0x02c":"On cellSet(), invalid row and/or column handles!","0x02d":"Unexpected op type on range remove!","0x02e":"Unexpected op type on range annotate!","0x02f":"Unexpected op type on range insert!","0x030":"Incoming remote op sequence# <= local collabWindow's currentSequence#","0x031":"Incoming remote op minSequence# < local collabWindow's minSequence#","0x032":"localSeq greater than collab window","0x033":"Segment group undefined","0x034":"Segment group not at head of merge tree pending queue","0x035":"Segment group not at head of segment pending queue","0x036":"Segment has no pending properties","0x037":"Segment already has assigned sequence number","0x038":"Incoming op sequence# < local collabWindow's currentSequence#","0x039":"Incoming op sequence# < minSequence#","0x03a":"Number of ops in 'resetOp' must match the number of segment groups provided.","0x03b":"Number of ops in 'resetOp' must match the number of segment groups provided.","0x03c":"Reset op has 'group' delta type!","0x03d":"segmentGroup is array rather than singleton!","0x03e":"minSeq mismatch between collab window and delta manager!","0x03f":"New format should not emit catchup ops","0x040":"Child count is not within [1,7] range!","0x041":"Unexpected child ordinal length!","0x043":"On ack, unexpected segmentGroup!","0x044":"On annotate ack, missing segment property manager!","0x045":"On insert, seq number already assigned!","0x046":"On remove ack, missing removal info!","0x048":"onMinGE()","0x049":"Trying to reload from segments while collaborating!","0x04f":"minSeq of collab window > target minSeq!","0x050":"Next segment changes are undefined!","0x051":"Too many children on merge block!","0x054":"Sequence number less than minSeq!","0x055":"Sequence number is not sorted!","0x056":"Unexpected total for accumulation of all seglen adjustments!","0x057":"Negative length after length adjustment!","0x058":"Both overlapRemoveClients and clientPartials are set!","0x059":"Client view exists but flat view does not!","0x05a":"Mismatch between number of partial lengths on client and flat views!","0x05b":"Flat view exists but client view does not!","0x05c":"Trying to update more annotate props than do exist!","0x05d":"emit: mismatch in segmentsTotalLength","0x05e":"emit: mismatch in totalSegmentCount","0x05f":"Missing blob header on legacy snapshot!","0x060":"There should be only one blob with catch up ops","0x061":"Mismatch in totalLength","0x062":"Mismatch in totalSegmentCount","0x063":"Mismatch in totalLength","0x064":"Mismatch in totalSegmentCount","0x065":"On removal info preservation, segment has invalid removed sequence number!","0x066":"Corrupted preservation of segment metadata!","0x067":"Missing clientId for removal!","0x068":"On consensusOrderedCollection load, job tracking size > 0","0x069":"On consensusOrderedCollection load, data size > 0","0x06a":"Trying to submit message while detached!","0x06b":"Loading snapshot into a non-empty collection","0x06c":"Value should be undefined or non-empty","0x06d":"SharedObjects contained in ConsensusRegisterCollection can no longer be deserialized as of 0.17","0x06e":"Message's reference sequence number < op's reference sequence number!","0x06f":"data missing for non-atomic inbound update!","0x070":"sequence numbers are expected to be 0 when unattached","0x071":"Versions should naturally be ordered by sequenceNumber","0x072":"Unexpected local op when loading not finished","0x073":"Sequence message not operation","0x074":"Snapshot called when not fully loaded","0x075":"SummarySerializer should be used for serializing data during summary.","0x078":"Possible re-entrancy! Summary should not already be in progress.","0x079":"Possible re-entrancy! Summary should have been in progress.","0x07a":"Services should be there to attach delta handler","0x07b":"Unexpected op","0x07c":"Unexpected op type","0x07d":"Unexpected op","0x07e":"Unexpected op type","0x07f":"clientId undefined","0x080":"Invalid document service!","0x081":"Document service already set!","0x082":"Document storage service already set!","0x083":"User selection status does not match replay controller use status!","0x084":"On storage resolve, user selection already made!","0x085":"On storage resolve, missing storage!","0x086":"After storage resolve, user selection status still false!","0x088":"Missing button ops button!","0x089":"Stringified length of chunk contents > total starting length","0x08a":"resetting ChunkedOpProcessor that never wrote back its contents","0x08b":"Unexpected type on contents for fix of an attach!","0x08c":"innerContent for fixing op contents is undefined!","0x08d":"After sanitize, pending incomplete ops!","0x08e":"Potentially missed initial messages","0x08f":"No op handler is setup!","0x090":"No signal handler is setup!","0x091":"Retrieved ops' first sequence number has unexpected value!","0x092":"version input for reading snapshot tree is null!","0x093":"invalid version input for reading snapshot tree!","0x094":"Missing snapshot tree!","0x096":"Trying to remove valid tree IDs in removeNullTreeIds()!","0x097":"Missing param from office.com URL parameter","0x098":"OuterDocumentServiceFactoryProxy unavailable","0x099":"OuterUrlResolverProxy unavailable","0x09a":"'documentId' must be a defined, non-zero length string.","0x09d":"Connection details should contain epoch","0x09f":"No more socketIO refs to remove!","0x0a0":"Unexpected socketIO references on timeout","0x0a1":"Socket reference set unexpectedly does not point to this socket!","0x0a2":"reentrancy not supported!","0x0a4":"Unexpected blob encoding type","0x0a5":"Trying to set ops when they are already set!","0x0a8":"Docid should not contain slashes!!","0x0ad":"Snapshot entry has both a tree value and a referenced id!","0x0ae":"Tried to create rate limiter with 0 max requests!","0x0b0":"Missing document snapshot tree!","0x0b1":"Storage service not initialized","0x0b2":"Missing orderer URL!","0x0b7":"Pathname should be defined","0x0b8":"'tenantId' and 'documentId' must be defined, non-zero length strings.","0x0b9":"PathName should exist","0x0ba":"Tenant id should exist","0x0bb":"Document id should exist","0x0bc":"Runtime has no DataObject!","0x0bd":"Object runtime already has DataObject!","0x0be":"Trying to initialize from existing while initProps is set!","0x0bf":"set called recursively from the interception callback","0x0c0":"set called recursively from the interception callback","0x0c1":"Interception wrapper methods called recursively from the interception callback","0x0c2":"Interception wrapper methods called recursively from the interception callback","0x0c3":"Interception wrapper methods called recursively from the interception callback","0x0c4":"Interception wrapper methods called recursively from the interception callback","0x0c5":"Interception wrapper methods called recursively from the interception callback","0x0c6":"Interception wrapper methods called recursively from the interception callback","0x0c7":"Interception wrapper methods called recursively from the interception callback","0x0c8":"Interception wrapper methods called recursively from the interception callback","0x0c9":"Interception wrapper methods called recursively from the interception callback","0x0ca":"Trying to use legacy graph attach!","0x0cd":"Container disconnected while waiting for ops!","0x0cf":"disconnect event was not raised!","0x0d1":"Container should be attached before close","0x0d2":"resolved url should be valid Fluid url","0x0d3":"Should only be called in detached container","0x0d6":"Inbound queue should be empty when attaching","0x0d9":"Attempting to connect() a closed DeltaManager","0x0dd":"Existing context not disposed","0x0de":"Mismatch in connection state while setting","0x0df":"Missing active connection","0x0e0":"lost minBlobSize policy","0x0e2":"DeltaManager already has attached op handler!","0x0e3":"Newly set op handler is null/undefined!","0x0e4":"Lost old connection!","0x0e6":"old connection exists on new connection setup","0x0e7":"claims/connectionMode mismatch","0x0e8":"readonly perf with write connection","0x0e9":"messageBuffer is not empty on new connection","0x0eb":"Missing connection for reconnect","0x0ec":"Unexpected value for previously processed message's sequence number","0x0ed":"non-system message have to have clientId","0x0ee":"Not accounting local messages correctly","0x0ef":"client seq# not growing","0x0f0":"Incoming local client seq# > generated by this client","0x0f2":"previouslyProcessedMessage","0x0f3":"not positive","0x0f4":"Nonzero pause-count on resume()","0x0f6":"real blob ID exists","0x0f7":"aggregate blob missing","0x0f8":"blob from aggregate blob exists on its own","0x0f9":"never read summary","0x0fa":"virtual blob not found","0x0fb":"logic err with aggregator","0x0fc":"tree reuse at lower level","0x0fd":"data stores are writing incremental summaries!","0x0fe":"attachment is aggregate blob","0x0ff":"duplicate aggregate blob","0x100":"logic error","0x101":"Unexpected tree entry type on flatten!","0x102":"invalid level of concurrency","0x103":"trying to parallel run while not working","0x104":"undefined end point for parallel fetch","0x105":"unexpected end point for parallel fetch","0x107":"ending dispatch with remaining results to be sent","0x108":"ending results dispatch but knew in advance about more requests","0x109":"unexpected next chunk position","0x10a":"cannot add parallel request while not working","0x10b":"invalid parallel request range","0x10c":"invalid parallel request start point","0x10d":"invalid parallel request end point","0x10e":"should not throw result if we knew about boundary in advance","0x10f":"empty/partial chunks should not be returned by caching","0x110":"callback should retry until valid fetch before it learns new boundary","0x112":"cannot push onto queue if done","0x113":"deferred queue should be empty","0x114":"cannot pop if deferred","0x115":"queue should not be done during pop","0x116":"Missing handle on scheduler load","0x117":"Trying to get missing clientId!","0x118":"Bad client interactive check","0x119":"This agent became inactive while releasing","0x11a":"Unsuccessful registration","0x11b":"Trying to clear tasks on inactive agent","0x11c":"Detached object routing context","0x11d":"task is already running","0x11e":"client is undefined","0x11f":"requesting unknown blobs","0x120":"Undefined latency statistics (op send time)","0x121":"Undefined inner contents type!","0x122":"Message to unpack is not proper runtime message","0x124":"inconsistent readonly property/event state","0x125":"Unsafe to transition to read-only state!","0x126":"Expected createSubRequest url to include a leading slash","0x127":"dirty document event not set on replay","0x12a":"Missing blob id on metadata","0x12b":"did not get root data store","0x12d":"Container Context should already be in attaching state","0x12e":"Container Context should already be in attached state","0x12f":"Container Runtime's summarize should always return a tree","0x131":"Mismatch between new chunkId and expected chunkMap","0x132":"sending ops in detached container","0x133":"Container disconnected when trying to submit system message","0x137":"Failed to get version from storage","0x138":"Failed to get snapshot from storage","0x139":"Undefined package path","0x13a":"Data store ID contains slash","0x13b":"datastore context is already in bound state","0x13c":"undefined channel on datastore context","0x13d":"Detached runtime creation on realize()","0x13e":"Unexpected package path","0x13f":"datastore context registry is already set","0x140":"undefined channel on datastore context","0x141":"Unexpected connected state","0x142":"local store channel is not loaded","0x143":"Channel should not be undefined when running GC","0x144":"Channel should be loaded when updating used routes","0x145":"Channel should be present when data store is loaded","0x146":"Channel must exist when submitting message","0x147":"Channel must exist on submitting signal","0x148":"Detached runtime creation on runtime bind","0x149":"Undefined channel deferral","0x14a":"Undefined package path","0x14b":"Channel must exist when resubmitting ops","0x14c":"Channel must exist when rebasing ops","0x14d":"Should move from detached to attaching","0x14e":"Should move from attaching to attached","0x14f":"There should be a channel when generating attach message","0x150":"pkg should be available in local data store context","0x152":"pkg should be available in local data store","0x154":"runtime creation is already attached","0x155":"channel deferral is already set","0x156":"Unexpected factory for package path","0x157":"datastore registry already attached","0x158":"Creating store with existing ID","0x159":"The given id was not found in notBoundContexts to delete","0x15a":"Cannot find context to resolve to","0x15b":"Expected this id to already be removed from notBoundContexts","0x15c":"Cannot find deferred to resolve","0x15d":"Creating store with existing ID","0x15e":"Local object does not have matching attach message id","0x15f":"Could not find unbound context to bind","0x160":"There should be a store context for the op","0x161":"There should be a store context for the op","0x162":"There should be a store context for the op","0x163":"Missing datastore for local signal","0x165":"Summarizer cannot work if client has local changes","0x166":"BaseSnapshot should be there as detached container loaded from snapshot","0x167":"Used route does not belong to any known data store","0x168":"Expected tree in snapshot not found","0x169":"No pending message found for this remote message","0x16b":"The pending batch state indicates we are already processing a batch","0x16d":"There is no pending batch begin message","0x16e":"Batch with single message should not have batch metadata","0x16f":"Did not receive batch begin metadata","0x170":"Did not receive batch end metadata","0x171":"No pending state found for the remote message","0x172":"The connection state is not consistent with the runtime","0x173":"replayPendingStates called twice for same clientId!","0x174":"initial states should be empty before replaying pending","0x175":"Can only broadcast if summarizer starts in local state","0x176":"Can only ack/nack if summarizer is in broadcasting state","0x177":"Missing delta handler","0x178":"Missing delta handler on attach","0x179":"createChannel() with existing ID","0x17a":"Channel should be loaded when created!!","0x17b":"Channel to be binded should be in not bounded set","0x17c":"Unexpected attach (local) channel OP","0x17e":"Used route does not belong to any known context","0x17f":"Not expecting detached channels during summarize","0x180":"getAttachSummary should always return a tree","0x181":"BaseSnapshot should be there as detached container loaded from snapshot","0x182":"Data store should be attached to attach the channel.","0x183":"There should be a channel context for the op","0x184":"There should be a channel context for the op","0x185":"Channel not found","0x189":"Should always be remote because a local dds shouldn't generate ops before loading","0x18a":"Channel should be loaded to resubmit ops","0x18c":"Channel should be loaded to summarize","0x18d":"Channel should be loaded to take snapshot","0x18e":"Channel must not already be loaded when loading","0x190":".attributes blob should be present","0x192":"Channel should be there if loaded!!","0x193":"Channel should be loaded to run GC","0x194":"Remote channel must be loaded when rebasing op","0x195":"Remote channel must not be local when processing op","0x196":"Remote channel must be loaded when resubmitting op","0x197":"Remote channel must not already be loaded when loading","0x198":"Used route should always be an absolute route","0x19a":"Invalid response value for Fluid object request","0x19b":"Cannot not create response error on 200 status","0x19c":"storage service path has trailing separator","0x19d":"Handles should always have absolute paths","0x19f":"wipSummaryLogger should not be set yet in startSummary","0x1a0":"Already tracking a summary","0x1a1":"summarize should not be called when not tracking the summary","0x1a2":"wipSummaryLogger should have been set in startSummary or ctor","0x1a3":"wipSummaryLogger should have been set in startSummary or ctor","0x1a4":"Not tracking a summary","0x1a5":"Tracked summary local paths not set","0x1a6":"Not found pending summary, but this node has previously completed a summary","0x1a7":"Pending summary reference sequence number should be consistent","0x1a9":"When loading base summary, expected outstanding ops <= tracking sequence number","0x1aa":"Out of order change recorded","0x1ab":"Create SummarizerNode child already exists","0x1ac":"Cannot create child from summary if parent does not have latest summary","0x1ad":"Missing child summary tree","0x1ae":"Child summary object is not a tree","0x1af":"Outstanding ops blob missing, but base summary tree exists","0x1b0":"Base summary tree missing, but outstanding ops blob exists","0x1b1":"wip used routes should be set if tracking a summary","0x1b2":"Getting GC data should not be called when GC is disabled!","0x1b3":"GC data cannot be retrieved without getGCDataFn","0x1b4":"We should not already be tracking used routes when to track a new summary","0x1b5":"We should have been tracking used routes","0x1b6":"Create SummarizerNode child already exists","0x1b7":"Bad session state for processing quorum messages","0x1b8":"Bad session state for processing quorum messages","0x1b9":"Unexpected value for sequence number of first message in file","0x1ba":"should not return empty buckets","0x1bb":"Unexpected sequence number on first of messages to save","0x1bc":"Unexpected sequence number on last of messages to save","0x1bd":"Stopped writing at unexpected sequence number","0x1c5":"snapshot should be set before retrieving it","0x1c6":"snapshot should be set before retrieving it","0x1c7":"snapshot should be set before retrieving it as expanded string","0x1c8":"Mismatch between document sequence number and current op number","0x1c9":"Leftover documents after replay!","0x1ca":"replay-to target is <= current op in replay cycle","0x1cb":"Bad window to verify snapshot","0x1cc":"Unexpected previous snapshot op number","0x1ce":"clientId not found","0x1cf":"clientId not found","0x1d0":"sequenceNumber not found","0x1d3":"Missing client id on disconnect","0x1d5":"Invalid snapshot format version","0x1d6":"Parent summary object is not a tree","0x1d8":"Should only transition from Connecting state","0x1d9":"addRequestCore() should break into smaller chunks","0x1da":"Client id should be set if connected","0x1db":"epoch exists","0x1dc":"all entries have to have epoch","0x1dd":"no epoch","0x1de":"Not an ODSP resolved url","0x1e0":"Protocol and App summary trees should be present","0x1e2":"Caller must ensure 'isAttached()' before calling 'sendSetCellOp'.","0x1e4":"Unexpected serializable type","0x1e5":"Storage token should not be null","0x1e6":"Epoch  should be present in response","0x1e7":"caching was not performed!","0x1e8":"reentrancy","0x1e9":"Pending ops","0x1ea":"Prefetch snapshot only available for odsp!","0x1eb":"Snapshot should be prefetched!","0x1ec":"No refresh token provided.","0x1ed":"Share link should be present","0x1ef":"services must be defined","0x1f0":"Unexpected mismatch in readonly","0x1f5":"Attached state should have storage","0x1f6":"Negative client sequence number not allowed","0x1f7":"Previous client should always be defined","0x1f8":"local BlobAttach op with no pending blob","0x1fc":"summary is not a tree","0x1fe":"isolated channels subtree should exist in remote datastore snapshot","0x1ff":"isolated channels subtree should exist in local datastore snapshot","0x200":"Returned odsp snapshot is malformed. No trees!","0x201":"Returned odsp snapshot is malformed. No blobs!","0x203":"Summary handle is undefined","0x205":"attach() called more than once","0x207":"Channel should be defined","0x208":"Factory should be undefined before loading","0x209":"Factory Type should be defined","0x20a":"register for event on disposed object","0x20b":"mismatch","0x20c":"connection disposed","0x20d":"double connection listener","0x20e":"double tracked listener","0x20f":"Driver min read version should >= to server minReadVersion","0x210":"Snapshot should be created with minReadVersion or above","0x219":"1 root should be there","0x21b":"Snapshot id should be provided","0x21c":"Seq number should be provided","0x21d":"body is not string","0x21e":"improper boundary format","0x220":"socket key collision","0x221":"Root tree should contain the id","0x222":"Root tree should contain the id!!","0x223":"unexpected end of buffer","0x224":"Skip length should be positive","0x225":"Data should be there","0x226":"Should write complete data","0x227":"Data should be there","0x22b":"Should be a pair","0x22c":"reading pairs","0x231":"Number should be an integer","0x232":"Payload should not be negative","0x233":"Unexpected data at the end of buffer","0x234":"has joinOpTimer","0x235":"no joinOpTimer","0x236":"In all cases it should be already installed","0x237":"Snapshot should exist","0x238":"called only in connected state","0x239":"called only in disconnected state","0x23a":"seq#'s","0x23b":"we are not packing at the right level","0x23c":"we are not packing at the right level","0x23d":"pending is undefined","0x23e":"pending is undefined","0x23f":"pending undefined","0x240":"Binary format snapshot only for odsp driver!!","0x241":"disconnect should result in stopSequenceNumberUpdate() call","0x242":"has timer","0x243":"stopSequenceNumberUpdate should be called as result of sending any op!","0x244":"Socket is closed, but connection is not!","0x245":"tracked listener","0x246":"checking consistency of socket & _disposed flags","0x247":"Use addTrackedListener instead","0x248":"should not subscribe to forwarded events","0x24c":"Cannot call `flush()` from `orderSequentially`'s callback","0x24e":"assertion for type narrowing","0x250":"serialized container with attachment blobs must be rehydrated with detached blob storage","0x251":"creation summary has to have seq=0 && handle === undefined","0x252":"redirect table can only be set in detached container","0x253":"redirect table already exists","0x254":"unrecognized id in redirect table","0x255":"detached blob id absent in redirect table","0x256":"storage undefined in attached container","0x257":"This is not summarizing container","0x258":"connected","0x259":"Container disconnected when trying to submit system message","0x25b":"Caller is responsible for checking lock","0x25d":"We should never connect as 'read'","0x25e":"no reason to call fail if all promises have been completed","0x25f":"retryAfterSeconds","0x260":"Disposed should mean disconnected!","0x261":"Expected: off","0x262":"Old summarizer is still working!","0x263":"Expected: starting","0x264":"Expected: Not Off","0x266":"lastKnownSeqNumber should never be below last processed sequence number","0x267":"lastObservedSeqNumber should be updated first","0x268":"There can't be pending fetch that early in boot sequence!","0x269":"pending ops are not dropped","0x26a":"not closed","0x26b":"initial state","0x26c":"handler should be installed","0x26d":"wrong start","0x26e":"wrong start","0x26f":"continuous and no duplicates","0x270":"All requested ops fetched","0x272":"empty request","0x273":"Invalid document id from parsed URL","0x274":"type check","0x275":"Root tree should contain the id","0x278":"API is not supported for non-connecting or closed container","0x27b":"reentrancy may result in incorrect behavior","0x280":"Validate first op seq number","0x281":"Unreferenced if present should be true","0x282":"Headers should be present now","0x283":"Length of data len should fit in the bytes from the map","0x284":"Length of id should fit in the bytes from the map","0x285":"Start code should not undefined","0x286":"End code should not undefined","0x287":"key must exist in the map","0x288":"All properties should exist","0x289":"logic error","0x28a":"can't be disposed - Callers need to ensure that!","0x292":"Unexpected undefined result from getFileLinkCore","0x293":"initial state","0x294":"can't have op processing paused if we are processing an op","0x295":"there should be no pending batch if we have no ops","0x296":"we should never start processing incomplete batch!","0x297":"always called from resumed state","0x298":"we have something in the queue that generates this event","0x299":"non-synchronized state","0x29a":"System message in the middle of batch!","0x29b":"system op in a batch?","0x29c":"we should be processing ops when there is no active batch","0x29d":"we should be processing ops when there is no active batch","0x29e":"there can't be active batch","0x29f":"we should be processing ops when there is no active batch","0x2a0":"batch presence was validated above","0x2a1":"logic error","0x2a2":"Batch is interrupted by other client op. Should be caught by trackPending()","0x2a3":"container should be closed on any error","0x2a5":"join timer","0x2a6":"waitingForLeaveOp should imply writeConnection (we need to be ready to flush pending ops)","0x2a7":"Container is not attached","0x2a8":"Expected data store snapshot tree in base snapshot","0x2a9":"GC nodes for data store not in GC blob","0x2ac":"Connected when timeout waiting for leave from previous session fired!","0x2ad":"GC blob missing from snapshot","0x2ae":"node id should always be an absolute route","0x2af":"Child GC data should have been initialized","0x2b0":"Used route should always be an absolute route","0x2b1":"This should have be initiallized when generate GC nodes above","0x2b2":"Two entries for the same GC node with different unreferenced timestamp","0x2b3":"logic error","0x2b4":"not connected on sending ops!","0x2b5":"logic error","0x2b6":"Missing data store context","0x2b8":"Chunk should be set in map","0x2ba":"batchBegin must fire before batchEnd","0x2bb":"Instrumented token fetcher with throwOnNullToken = true should never return null","0x2bc":"Instrumented token fetcher with throwOnNullToken =true should never return null","0x2bd":"We should not see a pending FlushMode until we see a flush when processing a batch","0x2be":"LocalReferences array contains a gap","0x2bf":"both removedClientIds and removedSeq should be set or not set","0x2c0":"ID must be created before adding interval to collection","0x2c1":"Creating an interval collection that already exists?","0x2c2":"Create Version should be equal to currentReadVersion","0x2c4":"client should not be summarizer before container is created","0x2c5":"Attempting to connect() a closed Container","0x2c6":"Attempting to connect() a container that is not attached","0x2c7":"Attempting to disconnect() a closed Container","0x2c8":"outboundPushEventTime should be undefined","0x2c9":"durationNetwork should be undefined","0x2ca":"durationOutboundBatching should be undefined","0x2cb":"submitOpEventTime should be undefined","0x2cc":"OpTimeSittingInboundQueue should be undefined","0x2cd":"durationNetwork should be undefined","0x2ce":"msnTrackingTimestamp should not be undefined","0x2cf":"undefined channel on datastore context","0x2d0":"Data store should be globally visible to attach channels.","0x2d1":"Data store should be locally visible before it can become globally visible.","0x2d2":"Data store should be globally visible when its attached.","0x2d3":"Local channel must be globally visible when processing op","0x2d4":"Local channel must be globally visible when resubmitting op","0x2d5":"Invalid blob node id in unused routes.","0x2d7":"No data store with specified id","0x2d8":"Empty change event should not be emitted.","0x2da":"Unknown SharedMatrix 'op' type.","0x2db":"Applying op must generate a pending segment","0x2dc":"Cannot find code proposal","0x2dd":"Cannot find blob for a given id","0x2de":"Package path requested for unsupported node type.","0x2df":"transient references cannot be bound to segments","0x2e0":"lref not a Local Reference","0x2e1":"Support for plain value types removed.","0x2e2":"Must only wait for leave message when clientId in quorum","0x2e3":"Must have a valid protocol handler instance","0x2e4":"there should be service config for active connection","0x2e5":"Must have a base snapshot","0x2e6":"Must have a base snapshot","0x2e7":"Must serialize base snapshot blobs before getting runtime state","0x2e8":"There should be a store context for the op","0x2e9":"Must call getLocalState() after applying initial states","0x2ea":"Configuration state should be enabled","0x2eb":"Summary not supported with configuration disabled","0x2ec":"Blob must be present in blobsContents","0x2ed":"There should be a channel context for the op","0x2ee":"Channel should be loaded to rollback ops","0x2ef":"Local channel must be globally visible when rolling back op","0x2f0":"Remote channel must be loaded when rolling back op","0x2f1":"slideReferences from a segment which has not been removed and acked","0x2f2":"Ref not in the segment localRefs","0x2f3":"Ref not in the segment localRefs","0x2f4":"localRefs must be allocated","0x2f5":"op create references must be SlideOnRemove","0x2f6":"SlideOnRemove references must be op created","0x2f8":"Unexpected accept op, nothing pending","0x2f9":"Unexpected accept op, client not in expectedSignoffs","0x2fa":"Unexpected pending message received","0x2fb":"pendingMessageId does not match","0x2fc":"Invalid localOpMetadata for clear","0x2fd":"pendingMessageId does not match","0x2fe":"Invalid localOpMetadata in submit","0x2ff":"Unexpected pending message received","0x300":"localSeq greater than collab window","0x301":"Either seq or localSeq should be defined","0x302":"No segment found","0x303":"Invalid offset","0x304":"Id cannot contain slashes","0x305":"registerDependent on disposed Dependee","0x306":"invalidateDependents on disposed Dependee","0x307":"endInitialization should be called exactly once","0x308":"onDispose should be set when disposing","0x309":"Cannot unregister dependees on a disposed SimpleObservingDependent.","0x30a":"shouldClientJoinWrite should imply this is a writeConnection","0x30b":"Must have a valid protocol handler instance","0x30c":"Id cannot contain slashes","0x30d":"Id cannot contain slashes","0x30e":"Id cannot contain slashes. DataStoreContext should have validated this.","0x30f":"Channel context ID cannot contain slashes","0x310":"Channel context ID cannot contain slashes","0x311":"expected id to exist on interval","0x312":"snapshot should be parsed","0x313":'Specified user was not of type "TinyliciousUser".',"0x314":"Container properly closed","0x315":"re-entrancy","0x316":"There should be a cached promise of in-progress aliasing","0x317":"dataStoreFactory is undefined","0x318":"resolvedUrl is undefined","0x319":"No delta connection server associated with specified document ID","0x31a":"resolvedUrl is undefined","0x31b":"container1.resolvedUrl is undefined","0x31c":"rightDiv is undefined","0x31d":'options are not of type "IRouterliciousRouteOptions" as expected',"0x31e":"options.tenantId is undefined","0x320":"options.tenantId is undefined","0x322":"options.fluidHost is undefined","0x324":"options.server is undefined","0x325":"options.odspAccessToken is undefined","0x326":"lockResolver is undefined","0x327":"options.server is undefined","0x328":"options.server is undefined","0x329":"browser.umd property is undefined","0x32a":"pendingMessageId does not match","0x32b":"Invalid localOpMetadata for clear","0x32c":"pendingMessageId does not match","0x32d":"Invalid localOpMetadata in submit","0x32e":"Unexpected pending message received","0x32f":"Invalid localOpMetadata for sub directory op","0x330":"Unexpected pending message received","0x331":"Unexpected pending message received","0x332":"Unexpected pending message received","0x333":"PathShared.splice can only insert detached ranges","0x334":"Anchor must not be double freed","0x335":"ObjectForest.getRoot only valid for existing roots","0x336":"ObjectForest must only be given its own Anchors","0x337":"ObjectForest must only be given its own Cursor type","0x338":"ObjectForest must only be given its own Cursor","0x339":"Anchor must not be double freed","0x33a":"Anchor must not be double freed","0x33b":"Cursor must not be freed","0x33c":"Cursor must not be freed","0x33d":"Cursor must be current to be used","0x33e":"Cursor must be current to be used","0x33f":"Cursor must not be double freed","0x340":"Cursor must be current to be used","0x341":"Cursor must be current to be used","0x342":'Invalid usage. "blobid" should always be null',"0x343":'Invalid usage. "count" should always be 1',"0x344":"this.pendingConnection should be undefined","0x345":"this.pendingConnection is undefined when trying to cancel","0x346":"inboundQueuePausedFromInit should be true"},Sd}var AR;function vY(){if(AR)return yd;AR=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(yd,"__esModule",{value:!0}),yd.validateAssertionError=void 0;const n=gY();function e(t,r){var i;const s=(i=n.shortCodeMap[t.message])!==null&&i!==void 0?i:t.message;if(s!==r)throw new Error(`Unexpected assertion thrown: ${t.message} ('${s}')`);return!0}return yd.validateAssertionError=e,yd}var kR;function yY(){return kR||(kR=1,function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Ne&&Ne.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s),Object.defineProperty(r,o,{enumerable:!0,get:function(){return i[s]}})}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=Ne&&Ne.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(BX(),n),t(jX(),n),t(Y3(),n),t(fY(),n),t(tN(),n),t(pY(),n),t(mY(),n),t(vY(),n)}(CS)),CS}var bd={},wd={exports:{}},OR;function SY(){if(OR)return wd.exports;OR=1;var n=["Black","White","Gray","Brown","Red","Pink","Crimson","Carnelian","Orange","Yellow","Ivory","Cream","Green","Viridian","Aquamarine","Cyan","Blue","Cerulean","Azure","Indigo","Navy","Violet","Purple","Lavender","Magenta","Rainbow","Iridescent","Spectrum","Prism","Bold","Vivid","Pale","Clear","Glass","Translucent","Misty","Dark","Light","Gold","Silver","Copper","Bronze","Steel","Iron","Brass","Mercury","Zinc","Chrome","Platinum","Titanium","Nickel","Lead","Pewter","Rust","Metal","Stone","Quartz","Granite","Marble","Alabaster","Agate","Jasper","Pebble","Pyrite","Crystal","Geode","Obsidian","Mica","Flint","Sand","Gravel","Boulder","Basalt","Ruby","Beryl","Scarlet","Citrine","Sulpher","Topaz","Amber","Emerald","Malachite","Jade","Abalone","Lapis","Sapphire","Diamond","Peridot","Gem","Jewel","Bevel","Coral","Jet","Ebony","Wood","Tree","Cherry","Maple","Cedar","Branch","Bramble","Rowan","Ash","Fir","Pine","Cactus","Alder","Grove","Forest","Jungle","Palm","Bush","Mulberry","Juniper","Vine","Ivy","Rose","Lily","Tulip","Daffodil","Honeysuckle","Fuschia","Hazel","Walnut","Almond","Lime","Lemon","Apple","Blossom","Bloom","Crocus","Rose","Buttercup","Dandelion","Iris","Carnation","Fern","Root","Branch","Leaf","Seed","Flower","Petal","Pollen","Orchid","Mangrove","Cypress","Sequoia","Sage","Heather","Snapdragon","Daisy","Mountain","Hill","Alpine","Chestnut","Valley","Glacier","Forest","Grove","Glen","Tree","Thorn","Stump","Desert","Canyon","Dune","Oasis","Mirage","Well","Spring","Meadow","Field","Prairie","Grass","Tundra","Island","Shore","Sand","Shell","Surf","Wave","Foam","Tide","Lake","River","Brook","Stream","Pool","Pond","Sun","Sprinkle","Shade","Shadow","Rain","Cloud","Storm","Hail","Snow","Sleet","Thunder","Lightning","Wind","Hurricane","Typhoon","Dawn","Sunrise","Morning","Noon","Twilight","Evening","Sunset","Midnight","Night","Sky","Star","Stellar","Comet","Nebula","Quasar","Solar","Lunar","Planet","Meteor","Sprout","Pear","Plum","Kiwi","Berry","Apricot","Peach","Mango","Pineapple","Coconut","Olive","Ginger","Root","Plain","Fancy","Stripe","Spot","Speckle","Spangle","Ring","Band","Blaze","Paint","Pinto","Shade","Tabby","Brindle","Patch","Calico","Checker","Dot","Pattern","Glitter","Glimmer","Shimmer","Dull","Dust","Dirt","Glaze","Scratch","Quick","Swift","Fast","Slow","Clever","Fire","Flicker","Flash","Spark","Ember","Coal","Flame","Chocolate","Vanilla","Sugar","Spice","Cake","Pie","Cookie","Candy","Caramel","Spiral","Round","Jelly","Square","Narrow","Long","Short","Small","Tiny","Big","Giant","Great","Atom","Peppermint","Mint","Butter","Fringe","Rag","Quilt","Truth","Lie","Holy","Curse","Noble","Sly","Brave","Shy","Lava","Foul","Leather","Fantasy","Keen","Luminous","Feather","Sticky","Gossamer","Cotton","Rattle","Silk","Satin","Cord","Denim","Flannel","Plaid","Wool","Linen","Silent","Flax","Weak","Valiant","Fierce","Gentle","Rhinestone","Splash","North","South","East","West","Summer","Winter","Autumn","Spring","Season","Equinox","Solstice","Paper","Motley","Torch","Ballistic","Rampant","Shag","Freckle","Wild","Free","Chain","Sheer","Crazy","Mad","Candle","Ribbon","Lace","Notch","Wax","Shine","Shallow","Deep","Bubble","Harvest","Fluff","Venom","Boom","Slash","Rune","Cold","Quill","Love","Hate","Garnet","Zircon","Power","Bone","Void","Horn","Glory","Cyber","Nova","Hot","Helix","Cosmic","Quark","Quiver","Holly","Clover","Polar","Regal","Ripple","Ebony","Wheat","Phantom","Dew","Chisel","Crack","Chatter","Laser","Foil","Tin","Clever","Treasure","Maze","Twisty","Curly","Fortune","Fate","Destiny","Cute","Slime","Ink","Disco","Plume","Time","Psychadelic","Relic","Fossil","Water","Savage","Ancient","Rapid","Road","Trail","Stitch","Button","Bow","Nimble","Zest","Sour","Bitter","Phase","Fan","Frill","Plump","Pickle","Mud","Puddle","Pond","River","Spring","Stream","Battle","Arrow","Plume","Roan","Pitch","Tar","Cat","Dog","Horse","Lizard","Bird","Fish","Saber","Scythe","Sharp","Soft","Razor","Neon","Dandy","Weed","Swamp","Marsh","Bog","Peat","Moor","Muck","Mire","Grave","Fair","Just","Brick","Puzzle","Skitter","Prong","Fork","Dent","Dour","Warp","Luck","Coffee","Split","Chip","Hollow","Heavy","Legend","Hickory","Mesquite","Nettle","Rogue","Charm","Prickle","Bead","Sponge","Whip","Bald","Frost","Fog","Oil","Veil","Cliff","Volcano","Rift","Maze","Proud","Dew","Mirror","Shard","Salt","Pepper","Honey","Thread","Bristle","Ripple","Glow","Zenith"],e=["head","crest","crown","tooth","fang","horn","frill","skull","bone","tongue","throat","voice","nose","snout","chin","eye","sight","seer","speaker","singer","song","chanter","howler","chatter","shrieker","shriek","jaw","bite","biter","neck","shoulder","fin","wing","arm","lifter","grasp","grabber","hand","paw","foot","finger","toe","thumb","talon","palm","touch","racer","runner","hoof","fly","flier","swoop","roar","hiss","hisser","snarl","dive","diver","rib","chest","back","ridge","leg","legs","tail","beak","walker","lasher","swisher","carver","kicker","roarer","crusher","spike","shaker","charger","hunter","weaver","crafter","binder","scribe","muse","snap","snapper","slayer","stalker","track","tracker","scar","scarer","fright","killer","death","doom","healer","saver","friend","foe","guardian","thunder","lightning","cloud","storm","forger","scale","hair","braid","nape","belly","thief","stealer","reaper","giver","taker","dancer","player","gambler","twister","turner","painter","dart","drifter","sting","stinger","venom","spur","ripper","swallow","devourer","knight","lady","lord","queen","king","master","mistress","prince","princess","duke","dutchess","samurai","ninja","knave","slave","servant","sage","wizard","witch","warlock","warrior","jester","paladin","bard","trader","sword","shield","knife","dagger","arrow","bow","fighter","bane","follower","leader","scourge","watcher","cat","panther","tiger","cougar","puma","jaguar","ocelot","lynx","lion","leopard","ferret","weasel","wolverine","bear","raccoon","dog","wolf","kitten","puppy","cub","fox","hound","terrier","coyote","hyena","jackal","pig","horse","donkey","stallion","mare","zebra","antelope","gazelle","deer","buffalo","bison","boar","elk","whale","dolphin","shark","fish","minnow","salmon","ray","fisher","otter","gull","duck","goose","crow","raven","bird","eagle","raptor","hawk","falcon","moose","heron","owl","stork","crane","sparrow","robin","parrot","cockatoo","carp","lizard","gecko","iguana","snake","python","viper","boa","condor","vulture","spider","fly","scorpion","heron","oriole","toucan","bee","wasp","hornet","rabbit","bunny","hare","brow","mustang","ox","piper","soarer","flasher","moth","mask","hide","hero","antler","chill","chiller","gem","ogre","myth","elf","fairy","pixie","dragon","griffin","unicorn","pegasus","sprite","fancier","chopper","slicer","skinner","butterfly","legend","wanderer","rover","raver","loon","lancer","glass","glazer","flame","crystal","lantern","lighter","cloak","bell","ringer","keeper","centaur","bolt","catcher","whimsey","quester","rat","mouse","serpent","wyrm","gargoyle","thorn","whip","rider","spirit","sentry","bat","beetle","burn","cowl","stone","gem","collar","mark","grin","scowl","spear","razor","edge","seeker","jay","ape","monkey","gorilla","koala","kangaroo","yak","sloth","ant","roach","weed","seed","eater","razor","shirt","face","goat","mind","shift","rider","face","mole","vole","pirate","llama","stag","bug","cap","boot","drop","hugger","sargent","snagglefoot","carpet","curtain"];function t(s){return s=s||Math.random,e[Math.floor(s()*e.length)]}function r(s){return s=s||Math.random,n[Math.floor(s()*n.length)]}function i(s){var o=t(s),u=t(s);u=u.substr(0,1).toUpperCase()+u.substr(1);var d=r(s);return d+o+" "+u}return wd.exports=i,wd.exports.randomNoun=t,wd.exports.randomAdjective=r,wd.exports}var FR;function bY(){if(FR)return bd;FR=1;var n=Ne&&Ne.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(bd,"__esModule",{value:!0}),bd.generateTestUser=void 0;const e=n(SY()),t=nv,r=()=>({id:(0,t.v4)(),name:(0,e.default)()});return bd.generateTestUser=r,bd}var NR;function wY(){return NR||(NR=1,function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.generateTestUser=n.InsecureTokenProvider=void 0;var e=yY();Object.defineProperty(n,"InsecureTokenProvider",{enumerable:!0,get:function(){return e.InsecureTokenProvider}});var t=bY();Object.defineProperty(n,"generateTestUser",{enumerable:!0,get:function(){return t.generateTestUser}})}(wS)),wS}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var aE=Ne&&Ne.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(m){try{f(r.next(m))}catch(g){o(g)}}function d(m){try{f(r.throw(m))}catch(g){o(g)}}function f(m){m.done?s(m.value):i(m.value).then(u,d)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(Jt,"__esModule",{value:!0});Jt.waitUntilConnected=Jt.getInsecureTokenProvider=Jt.timeoutRequest=Jt.waitForResult=Jt.TimeoutError=Jt.waitForDelay=Jt.parseJwt=Jt.decodeBase64=Jt.cloneValue=void 0;const CY=nv;function xY(n){return typeof n=="object"?JSON.parse(JSON.stringify(n)):n}Jt.cloneValue=xY;function nN(n){return typeof atob=="function"?atob(n):Buffer.from(n,"base64").toString()}Jt.decodeBase64=nN;const EY=n=>{try{return JSON.parse(nN(n.split(".")[1]))}catch{return null}};Jt.parseJwt=EY;function rN(n){return new Promise(e=>{setTimeout(()=>e(),n)})}Jt.waitForDelay=rN;class uE extends Error{constructor(){super("timed out")}}Jt.TimeoutError=uE;function TY(n,e,t,r,i,s,o=1e3){let u=0;return new Promise((d,f)=>aE(this,void 0,void 0,function*(){for(;;){try{const m=yield iN(n,Math.max(o*(u+1),o*3),s),g=e(m);if(g!==null){d(g.response);break}else if(u>=r.length){f(new Error("waitForResult: invalid response"));break}}catch(m){if(u>=r.length){f(t(m));break}if(i&&!(m instanceof uE)){const g=i(m);if(g!==null){f(g);break}}}yield rN(r[u++])}}))}Jt.waitForResult=TY;function iN(n,e,t){return new Promise((r,i)=>aE(this,void 0,void 0,function*(){let s=setTimeout(()=>{i(new uE),s=null},e);try{const o=yield n();r(o),s==null&&(t==null||t())}catch(o){i(o),s==null&&(t==null||t())}clearTimeout(s)}))}Jt.timeoutRequest=iN;function PY(){var n,e;return aE(this,void 0,void 0,function*(){try{const{InsecureTokenProvider:t}=yield wY(),r=(e=(n=new URL(window.location.href))===null||n===void 0?void 0:n.searchParams)===null||e===void 0?void 0:e.get("userId");return new t("",{id:r??(0,CY.v4)(),name:"Test User"})}catch{throw new Error("@microsoft/live-share: when using 'local' connection type, you must have @fluidframework/test-client-utils installed")}})}Jt.getInsecureTokenProvider=PY;function RY(n){return new Promise(e=>{const t=r=>{n.off("connected",t),e(r)};n.clientId?e(n.clientId):n.on("connected",t)})}Jt.waitUntilConnected=RY;var bv={},wr={};Object.defineProperty(wr,"__esModule",{value:!0});wr.isTimestampProvider=wr.isILiveEvent=wr.isErrorLike=wr.isIClientInfo=wr.isClientRolesResponse=wr.isMobileWorkaroundRolesResponse=void 0;function _Y(n){return lE(n==null?void 0:n.userRoles)}wr.isMobileWorkaroundRolesResponse=_Y;function lE(n){return Array.isArray(n)&&n.every(e=>typeof e=="string")}wr.isClientRolesResponse=lE;function IY(n){return n===void 0||(n==null?void 0:n.userId)!==void 0&&lE(n==null?void 0:n.roles)}wr.isIClientInfo=IY;function AY(n){return typeof(n==null?void 0:n.message)=="string"}wr.isErrorLike=AY;function kY(n){return typeof n=="object"&&typeof n.clientId=="string"&&typeof n.timestamp=="number"&&typeof n.name=="string"}wr.isILiveEvent=kY;function OY(n){return typeof(n==null?void 0:n.start)=="function"}wr.isTimestampProvider=OY;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var Cd=Ne&&Ne.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(m){try{f(r.next(m))}catch(g){o(g)}}function d(m){try{f(r.throw(m))}catch(g){o(g)}}function f(m){m.done?s(m.value):i(m.value).then(u,d)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(bv,"__esModule",{value:!0});bv.LiveShareHostDecorator=void 0;const DR=xc,el=wr,LR=Jt,MR=[100,200,200,400,600],BR=4*1e3;class FY{constructor(e){this._host=e,this._registerRequestCache=new DR.RequestCache(BR),this._userInfoRequestCache=new DR.RequestCache(BR)}getFluidTenantInfo(){return this._host.getFluidTenantInfo()}getFluidToken(e){return this._host.getFluidToken(e)}getFluidContainerId(){return this._host.getFluidContainerId()}setFluidContainerId(e){return this._host.setFluidContainerId(e)}getNtpTime(){return this._host.getNtpTime()}getClientRoles(e){return Cd(this,void 0,void 0,function*(){return this._host.getClientRoles(e)})}getClientInfo(e,t,r){return Cd(this,void 0,void 0,function*(){if(!e)throw new Error("LiveShareHostDecorator: called getClientInfo() without a clientId");const i=r?`${e}backwardsCompat`:e;return this._userInfoRequestCache.cacheRequest(i,()=>(0,LR.waitForResult)(()=>Cd(this,void 0,void 0,function*(){return yield this._host.getClientInfo(e)}),s=>(0,el.isIClientInfo)(s)?{response:s}:null,s=>new Error(`LiveShareHostDecorator: getting client info for a remote client ID for reason: ${(0,el.isErrorLike)(s)?s.message:"unknown"}`),r??MR,s=>e==="fakeId"?new Error((0,el.isErrorLike)(s)?s.message:"an unknown error occurred"):null,t))})}registerClientId(e){return Cd(this,void 0,void 0,function*(){return this._registerRequestCache.cacheRequest(e,()=>(0,LR.waitForResult)(()=>Cd(this,void 0,void 0,function*(){return yield this._host.registerClientId(e)}),t=>(0,el.isClientRolesResponse)(t)?{response:t}:(0,el.isMobileWorkaroundRolesResponse)(t)?{response:t.userRoles}:null,t=>new Error(`LiveShareHostDecorator: registering local client ID for reason: ${(0,el.isErrorLike)(t)?t.message:"unknown"}`),MR))})}}bv.LiveShareHostDecorator=FY;var wv={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var kp=Ne&&Ne.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(m){try{f(r.next(m))}catch(g){o(g)}}function d(m){try{f(r.throw(m))}catch(g){o(g)}}function f(m){m.done?s(m.value):i(m.value).then(u,d)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(wv,"__esModule",{value:!0});wv.BackwardsCompatibilityHostDecorator=void 0;const NY=xc,_S=wr,DY=Jt,jR=[100,200,200,400,600],LY=5*60*1e3;class MY{constructor(e){this._host=e,this._userRolesRequestCache=new NY.RequestCache(LY),this._totalTries=4,this._getClientInfoTriesRemaining=this._totalTries,this._getClientInfoExists=!1,this._hasWarnedPolyfill=!1,this.warmupCheckGetClientInfoExists()}getFluidTenantInfo(){return this._host.getFluidTenantInfo()}getFluidToken(e){return this._host.getFluidToken(e)}getFluidContainerId(){return this._host.getFluidContainerId()}setFluidContainerId(e){return this._host.setFluidContainerId(e)}getNtpTime(){return this._host.getNtpTime()}getClientRoles(e){return kp(this,void 0,void 0,function*(){if(!e)throw new Error("BackwardsCompatibilityHostDecorator: called getClientInfo() without a clientId");return this._userRolesRequestCache.cacheRequest(e,()=>(0,DY.waitForResult)(()=>kp(this,void 0,void 0,function*(){return yield this._host.getClientRoles(e)}),t=>(0,_S.isClientRolesResponse)(t)?{response:t}:(0,_S.isMobileWorkaroundRolesResponse)(t)?{response:t.userRoles}:null,()=>new Error("BackwardsCompatibilityHostDecorator: timed out getting roles for a remote client ID"),jR))})}getClientInfo(e){return kp(this,void 0,void 0,function*(){if(this._getClientInfoExists)return yield this._host.getClientInfo(e);if(this._getClientInfoTriesRemaining<=0){this._hasWarnedPolyfill||(console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: using getClientInfo polyfill"),this._hasWarnedPolyfill=!0);const r=yield this.getClientRoles(e);return{userId:e,displayName:void 0,roles:r??[]}}const t=this.getClientRoles(e);try{const r=yield this._host.getClientInfo(e,()=>{this._getClientInfoExists=!0},this.getRetrySchedule());return this._getClientInfoExists=!0,r}catch(r){if((0,_S.isErrorLike)(r)&&r.message.includes("timed out")){this._getClientInfoTriesRemaining--,this._getClientInfoTriesRemaining<=0&&console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: will use getClientInfo polyfill");const i=yield t;return{userId:e,displayName:void 0,roles:i??[]}}}return this._getClientInfoExists=!0,console.log("BackwardsCompatibilityHostDecorator: error, retryingWithActual"),yield this.getClientInfo(e)})}registerClientId(e){return kp(this,void 0,void 0,function*(){return this._host.registerClientId(e)})}warmupCheckGetClientInfoExists(){this._getClientInfoExists||this._host.getClientInfo("fakeId",()=>{this._getClientInfoExists=!0},[]).catch(e=>{e.message.includes("timed out")?(this._getClientInfoTriesRemaining--,this._getClientInfoTriesRemaining>0?this.warmupCheckGetClientInfoExists():console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: will use getClientInfo polyfill")):this._getClientInfoExists=!0})}getRetrySchedule(){const e=this._totalTries-Math.max(0,this._getClientInfoTriesRemaining);return jR.slice(0,e)}}wv.BackwardsCompatibilityHostDecorator=MY;var Cv={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Cv,"__esModule",{value:!0});Cv.Deferred=void 0;class BY{constructor(){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}get promise(){return this._promise}get resolve(){return this._resolve}get reject(){return this._reject}}Cv.Deferred=BY;var sN={};Object.defineProperty(sN,"__esModule",{value:!0});var xd={},qR;function jY(){if(qR)return xd;qR=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=Ne&&Ne.__awaiter||function(s,o,u,d){function f(m){return m instanceof u?m:new u(function(g){g(m)})}return new(u||(u=Promise))(function(m,g){function P(U){try{M(d.next(U))}catch(j){g(j)}}function D(U){try{M(d.throw(U))}catch(j){g(j)}}function M(U){U.done?m(U.value):f(U.value).then(P,D)}M((d=d.apply(s,o||[])).next())})};Object.defineProperty(xd,"__esModule",{value:!0}),xd.LiveObjectManager=void 0;const e=sf,t=Ec(),r=ss();let i=class extends e.TypedEventEmitter{constructor(o,u){super(),this._liveRuntime=o,this._containerRuntime=u,this.objectStoreMap=new Map,this.updateInterval=1e4}start(){this.startReceivingSignalUpdates()}stop(){this.stopReceivingSignalUpdates(),this.objectStoreMap.clear()}registerObject(o,u,d,f){return n(this,void 0,void 0,function*(){this._synchronizer||(this._synchronizer=new r.ContainerSynchronizer(u,this._containerRuntime,this._liveRuntime,this)),this._synchronizer.registerObject(o,f);const m={clientId:yield(0,r.waitUntilConnected)(u),timestamp:0,data:d,name:r.ObjectSynchronizerEvents.update};this.updateEventLocallyInStore(o,m)})}unregisterObject(o){this._synchronizer&&this._synchronizer.unregisterObject(o)}getLatestEventForObject(o){var u;return(u=this.getEventsForObject(o))===null||u===void 0?void 0:u[0]}getLatestEventForObjectClient(o,u){var d;return(d=this.objectStoreMap.get(o))===null||d===void 0?void 0:d.get(u)}getEventsForObject(o){var u;const d=this.objectStoreMap.get(o);if(d)return(u=[...d.values()])===null||u===void 0?void 0:u.sort((f,m)=>m.timestamp-f.timestamp)}sendEventForObject(o,u){return n(this,void 0,void 0,function*(){if(!this._synchronizer)throw new Error("LiveObjectManager.sendEventForObject: cannot send the event");const d=yield this._synchronizer.sendEventForObject(o,u);return this.updateEventLocallyInStore(o,d),d})}clientIdDidChange(o,u){this.objectStoreMap.forEach(d=>{const f=d.get(o);f&&(d.set(u,f),d.delete(o))})}__dangerouslySetContainerRuntime(o){var u;this._containerRuntime!==o&&(this.stopReceivingSignalUpdates(),this._containerRuntime=o,this.startReceivingSignalUpdates(),(u=this._synchronizer)===null||u===void 0||u.__dangerouslySetContainerRuntime(o))}setAudience(o){this._audience=o}onReceivedSignal(o,u){var d;u||!o.clientId||!(0,r.isILiveEvent)(o.content)||typeof o.content.data!="object"||(this.dispatchUpdates(r.ObjectSynchronizerEvents.update,o.clientId,o.content.data,u),o.type===r.ObjectSynchronizerEvents.connect&&((d=this._synchronizer)===null||d===void 0||d.onSendUpdates()))}dispatchUpdates(o,u,d,f){for(const m in d){const g=d[m],P={clientId:u,timestamp:g.timestamp,data:(0,r.cloneValue)(g.data),name:o};this.updateEventLocallyInStore(m,P)&&this.emit(r.ObjectSynchronizerEvents.update,m,(0,r.cloneValue)(P),f,this.updateEventLocallyInStore.bind(this))}}updateEventLocallyInStore(o,u){let d=this.objectStoreMap.get(o);if(d){const f=d.get(u.clientId);if(f&&!t.LiveEvent.isNewer(f,u))return!1;d.set(u.clientId,u)}else d=new Map,d.set(u.clientId,u),this.objectStoreMap.set(o,d);return!0}startReceivingSignalUpdates(){this._onBoundReceivedSignalListener&&this.stopReceivingSignalUpdates(),this._onBoundReceivedSignalListener=this.onReceivedSignal.bind(this),this._containerRuntime.on("signal",this._onBoundReceivedSignalListener)}stopReceivingSignalUpdates(){this._onBoundReceivedSignalListener&&this._containerRuntime.off("signal",this._onBoundReceivedSignalListener)}};return xd.LiveObjectManager=i,xd}var xv={},tl=Ne&&Ne.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(m){try{f(r.next(m))}catch(g){o(g)}}function d(m){try{f(r.throw(m))}catch(g){o(g)}}function f(m){m.done?s(m.value):i(m.value).then(u,d)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(xv,"__esModule",{value:!0});xv.ContainerSynchronizer=void 0;const Ia=wu,qY=Jt;class UY{constructor(e,t,r,i){this._runtime=e,this._containerRuntime=t,this._liveRuntime=r,this._objectStore=i,this._objects=new Map,this._connectedKeys=[],this._refCount=0,this.startListeningForConnected()}registerObject(e,t){if(this._objects.has(e))throw new Error(`LiveObjectSynchronizer: too many calls to registerObject() for object '${e}'`);this._connectedKeys.push(e),this._objects.set(e,t),this._runtime.clientId&&this._runtime.clientId!==this._connectSentForClientId&&this.onConnected(this._runtime.clientId),this._refCount++==0&&this.startBackgroundObjectUpdates()}unregisterObject(e){if(this._objects.has(e)){if(this._objects.delete(e),--this._refCount==0)return this.stopBackgroundObjectUpdates(),!0;this._connectedKeys=this._connectedKeys.filter(t=>t!=e)}return!1}onSendUpdates(){return tl(this,void 0,void 0,function*(){yield this.sendGroupEvent(this._connectedKeys,Ia.ObjectSynchronizerEvents.update).catch(e=>console.error(e))})}sendEventForObject(e,t){return tl(this,void 0,void 0,function*(){const r=this._objects.get(e);if(!r)throw new Error("ContainerSynchronizer.sendEventForObject(): cannot send an event for an object that is not registered");if(!(yield r.getLocalUserCanSend(!1)))throw new Error("The local user doesn't meet the app requirements to send a message for this object");const s=yield this.sendEventUpdates({[e]:{data:t,timestamp:this._liveRuntime.getTimestamp()}},Ia.ObjectSynchronizerEvents.update);if(!s)throw new Error("Unable to send an event with empty updates");return{clientId:s.clientId,timestamp:s.data[e].timestamp,name:s.name,data:s.data[e].data}})}__dangerouslySetContainerRuntime(e){this._containerRuntime!==e&&(this._containerRuntime=e)}onConnected(e){return tl(this,void 0,void 0,function*(){if(e!==this._connectSentForClientId){this._connectSentForClientId&&this._objectStore.clientIdDidChange(this._connectSentForClientId,e),this._connectSentForClientId=e,this._liveRuntime.host.registerClientId(e).catch(t=>{console.error(t)});try{yield this.sendGroupEvent(this._connectedKeys,Ia.ObjectSynchronizerEvents.connect)}catch(t){console.error(`LiveObjectSynchronizer: error sending update - ${t.toString()}`)}}})}sendEventUpdates(e,t){return tl(this,void 0,void 0,function*(){if(Object.keys(e).length>0){const i={clientId:yield this.waitUntilConnected(),data:e,timestamp:t===Ia.ObjectSynchronizerEvents.connect?0:this._liveRuntime.getTimestamp(),name:t};return this._containerRuntime.submitSignal(t,i),i}})}sendGroupEvent(e,t){return tl(this,void 0,void 0,function*(){const r=[],i={},s=yield this.waitUntilConnected();for(let u=0;u<e.length;u++){const d=e[u];try{const f=this._objects.get(d);if(f&&(yield f.getLocalUserCanSend(t===Ia.ObjectSynchronizerEvents.connect))){const m=this._objectStore.getLatestEventForObjectClient(d,s);if(typeof m=="object"){i[d]={data:m.data,timestamp:f.shouldUpdateTimestampPeriodically?this._liveRuntime.getTimestamp():t===Ia.ObjectSynchronizerEvents.connect?0:m.timestamp};continue}}}catch(f){console.error(`LiveObjectSynchronizer: error getting an objects state - ${f.toString()}`)}r.push(d)}const o=Object.keys(i);return yield this.sendEventUpdates(i,t),{sent:o,skipped:r}})}onReceiveUpdate(e,t,r,i){return tl(this,void 0,void 0,function*(){const s=this._objects.get(e);!s||!(yield s.updateState(t,t.clientId,r))||i(e,Object.assign(Object.assign({},t),{clientId:yield this.waitUntilConnected()}))})}waitUntilConnected(){return(0,qY.waitUntilConnected)(this._runtime)}startListeningForConnected(){this._onBoundConnectedListener&&this.stopListeningForConnected(),this._onBoundConnectedListener=this.onConnected.bind(this),this._runtime.on("connected",this._onBoundConnectedListener)}stopListeningForConnected(){this._onBoundConnectedListener&&this._runtime.off("connected",this._onBoundConnectedListener)}startBackgroundObjectUpdates(){this.stopBackgroundObjectUpdates(),this._onReceiveObjectUpdateListener=this.onReceiveUpdate.bind(this),this._objectStore.on(Ia.ObjectSynchronizerEvents.update,this._onReceiveObjectUpdateListener),this._onSendUpdatesIntervalCallback=this.onSendUpdates.bind(this),this._hTimer=setInterval(this._onSendUpdatesIntervalCallback,this._liveRuntime.objectManager.updateInterval)}stopBackgroundObjectUpdates(){this._hTimer&&(clearInterval(this._hTimer),this._hTimer=void 0,this._onSendUpdatesIntervalCallback=void 0),this._onReceiveObjectUpdateListener&&(this._objectStore.off("update",this._onReceiveObjectUpdateListener),this._onReceiveObjectUpdateListener=void 0)}}xv.ContainerSynchronizer=UY;var UR;function ss(){return UR||(UR=1,function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=Ne&&Ne.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var u=Object.getOwnPropertyDescriptor(i,s);(!u||("get"in u?!i.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,u)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=Ne&&Ne.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(wu,n),t(ev,n),t(xc,n),t(tv,n),t(Jt,n),t(bv,n),t(wv,n),t(Cv,n),t(wr,n),t(sN,n),t(jY(),n),t(xv,n)}(mS)),mS}var zR;function oN(){if(zR)return fd;zR=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=Ne&&Ne.__awaiter||function(o,u,d,f){function m(g){return g instanceof d?g:new d(function(P){P(g)})}return new(d||(d=Promise))(function(g,P){function D(j){try{U(f.next(j))}catch(E){P(E)}}function M(j){try{U(f.throw(j))}catch(E){P(E)}}function U(j){j.done?g(j.value):m(j.value).then(D,M)}U((f=f.apply(o,u||[])).next())})},e=Ne&&Ne.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(fd,"__esModule",{value:!0}),fd.LiveEventScope=void 0;const t=e(Fn),r=sf,i=ss();let s=class extends r.TypedEventEmitter{constructor(u,d,f){super(),this._liveRuntime=d,this.emitter=new t.default,this._runtime=u,this._allowedRoles=f||[],this.emitter.on("error",m=>{this.emit("error",m)}),this._runtime.on("signal",(m,g)=>{if(!m.clientId||!this._runtime.connected)return;const P=m.clientId;m.content.clientId=P,this._liveRuntime.verifyRolesAllowed(P,this._allowedRoles).then(D=>{D?this.emitter.emit(m.type,m.content,g):this._runtime.logger.sendErrorEvent({eventName:"LiveEvent:invalidRole"},new Error(`The clientId of "${P}" doesn't have a role of ${JSON.stringify(this._allowedRoles)}.`))}).catch(D=>{this._runtime.logger.sendErrorEvent({eventName:"LiveEvent:invalidRole"},D)})})}get allowedRoles(){return this._allowedRoles}set allowedRoles(u){this._allowedRoles=u}get clientId(){return this._runtime.clientId}onEvent(u,d){return this.emitter.on(u,d),this}offEvent(u,d){return this.emitter.off(u,d),this}sendEvent(u,d){return n(this,void 0,void 0,function*(){const f=yield this.waitUntilConnected();if(!(yield this._liveRuntime.verifyRolesAllowed(f,this._allowedRoles)))throw new Error(`The local user doesn't have a role of ${JSON.stringify(this._allowedRoles)}.`);const g={clientId:f,name:u,timestamp:this._liveRuntime.getTimestamp(),data:d};return this._runtime.submitSignal(u,g),g})}waitUntilConnected(){return(0,i.waitUntilConnected)(this._runtime)}};return fd.LiveEventScope=s,fd}var af={},uf={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var zY=Ne&&Ne.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(m){try{f(r.next(m))}catch(g){o(g)}}function d(m){try{f(r.throw(m))}catch(g){o(g)}}function f(m){m.done?s(m.value):i(m.value).then(u,d)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(uf,"__esModule",{value:!0});uf.LiveEventSource=void 0;class $Y{constructor(e,t){this._scope=e,this._eventName=t}sendEvent(e){return zY(this,void 0,void 0,function*(){return yield this._scope.sendEvent(this._eventName,e)})}}uf.LiveEventSource=$Y;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(af,"__esModule",{value:!0});af.LiveEventTarget=void 0;const HY=uf;class VY extends HY.LiveEventSource{constructor(e,t,r){super(e,t),e.onEvent(t,r)}}af.LiveEventTarget=VY;var Ed={},$R;function lf(){if($R)return Ed;$R=1;var n=Ne&&Ne.__awaiter||function(s,o,u,d){function f(m){return m instanceof u?m:new u(function(g){g(m)})}return new(u||(u=Promise))(function(m,g){function P(U){try{M(d.next(U))}catch(j){g(j)}}function D(U){try{M(d.throw(U))}catch(j){g(j)}}function M(U){U.done?m(U.value):f(U.value).then(P,D)}M((d=d.apply(s,o||[])).next())})};Object.defineProperty(Ed,"__esModule",{value:!0}),Ed.LiveDataObject=void 0;const e=Cc,t=sf,r=ss();let i=class extends e.DataObject{get liveRuntime(){return(0,t.assert)(this._liveRuntime!==null,"LiveShareRuntime not initialized. Ensure your Fluid `ContainerSchema` was first wrapped inside of `getLiveShareSchema`, or use `.joinContainer()` in `LiveShareClient`."),this._liveRuntime}constructor(o){super(o),this._allowedRoles=[],this._liveRuntime=null}waitUntilConnected(){return(0,r.waitUntilConnected)(this.runtime)}verifyLocalUserRoles(){var o;return n(this,void 0,void 0,function*(){const u=yield this.waitUntilConnected();return this.liveRuntime.verifyRolesAllowed(u,(o=this._allowedRoles)!==null&&o!==void 0?o:[])})}__dangerouslySetLiveRuntime(o){this._liveRuntime=o}onLocalUserAllowed(o){return n(this,void 0,void 0,function*(){(yield this.verifyLocalUserRoles())&&o()})}};return i.LiveEnabled=!0,Ed.LiveDataObject=i,Ed}var HR;function Ec(){return HR||(HR=1,function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=Ne&&Ne.__awaiter||function(m,g,P,D){function M(U){return U instanceof P?U:new P(function(j){j(U)})}return new(P||(P=Promise))(function(U,j){function E(K){try{z(D.next(K))}catch(ie){j(ie)}}function k(K){try{z(D.throw(K))}catch(ie){j(ie)}}function z(K){K.done?U(K.value):M(K.value).then(E,k)}z((D=D.apply(m,g||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveEvent=n.LiveEventEvents=void 0;const t=Cc,r=oN(),i=af,s=la,o=lf(),u=ss();var d;(function(m){m.received="received"})(d=n.LiveEventEvents||(n.LiveEventEvents={}));class f extends o.LiveDataObject{get isInitialized(){return!!this._eventTarget}initialize(g){if(this._eventTarget)throw new Error("LiveEvent already started.");this._allowedRoles=g??[];const P=new r.LiveEventScope(this.runtime,this.liveRuntime,g);return this._eventTarget=new i.LiveEventTarget(P,"event",(D,M)=>{this.emit(d.received,(0,u.cloneValue)(D.data),M,D.clientId,D.timestamp)}),Promise.resolve()}send(g){return e(this,void 0,void 0,function*(){if(!this._eventTarget)throw new Error("LiveEvent not started.");return yield this._eventTarget.sendEvent(g)})}static isNewer(g,P,D=0){if(g){if(g.timestamp==P.timestamp){if((g.clientId||"").localeCompare(P.clientId||"")<=0)return!1}else if(g.timestamp>P.timestamp){if(g.timestamp-P.timestamp>D)return!1}else if(P.timestamp-g.timestamp<D)return!1}return!0}}f.TypeName="@microsoft/live-share:LiveEvent",f.factory=new t.DataObjectFactory(f.TypeName,f,[],{}),n.LiveEvent=f,s.DynamicObjectRegistry.registerObjectClass(f,f.TypeName)}(fS)),fS}var Ev={},Tc={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Tc,"__esModule",{value:!0});Tc.TimeInterval=void 0;class WY{constructor(e){this._value=e}get milliseconds(){return this._value}set milliseconds(e){this._value=e}get seconds(){return this._value/1e3}set seconds(e){this._value=Math.floor(e*1e3)}}Tc.TimeInterval=WY;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Ev,"__esModule",{value:!0});Ev.LiveEventTimer=void 0;const GY=Tc;class KY{constructor(e,t,r,i=!1){this._isRunning=!1,this._eventSource=e,this._createEvent=t,this._delay=new GY.TimeInterval(r),this.repeat=i}get delay(){return this._delay.milliseconds}set delay(e){this._delay.milliseconds=e}get isRunning(){return this._isRunning}sendEvent(){const e=this._createEvent();return this._eventSource.sendEvent(e)}start(){this.stop(),this._isRunning=!0,this.delayedEmit(this.delay)}stop(){this._timer!=null&&(clearTimeout(this._timer),this._timer=void 0),this._isRunning=!1}delayedEmit(e){this._timer=setTimeout(()=>{this._timer=void 0;const t=new Date().getTime();if(this.sendEvent().catch(r=>{console.warn(r)}),this._isRunning&&this.repeat){const r=(new Date().getTime()-t)%this.delay;this.delayedEmit(this.delay-r)}},e)}}Ev.LiveEventTimer=KY;var aN={},IS={},Td={},VR;function JY(){if(VR)return Td;VR=1,Object.defineProperty(Td,"__esModule",{value:!0}),Td.LivePresenceConnection=void 0;const n=ss(),e=Ec(),t=cE();let r=class{constructor(s,o,u,d){this._evt=s,this._isLocalConnection=o,this._expirationPeriod=u,this._liveRuntime=d}get isLocalConnection(){return this._isLocalConnection}get clientId(){return this._evt.clientId}get state(){return this.hasExpired()?t.PresenceState.offline:this._evt.data.state}get data(){return(0,n.cloneValue)(this._evt.data.data)}updateConnection(s){if(this._evt.clientId!==s.clientId)throw new Error("LivePresenceConnection.updateConnection called with event with different clientId");e.LiveEvent.isNewer(this._evt,s)&&(this._evt=s)}set expirationPeriod(s){this._expirationPeriod=s}hasExpired(){const o=this._liveRuntime.getTimestamp()-this._evt.timestamp;return!this._isLocalConnection&&o>this._expirationPeriod.milliseconds}};return Td.LivePresenceConnection=r,Td}var WR;function cE(){return WR||(WR=1,function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.LivePresenceUser=n.PresenceState=void 0;const e=Ec(),t=ss(),r=JY();var i;(function(o){o.online="online",o.away="away",o.offline="offline"})(i=n.PresenceState||(n.PresenceState={}));class s{constructor(u,d,f,m,g){this._clientInfo=u,this._evt=d,this._expirationPeriod=f,this._liveRuntime=m,this._connections=new Map,this._isLocalUser=!1,this.updateClients(this._evt,g),this._lastUpdateTime=this._liveRuntime.getTimestamp()}get isLocalUser(){return this._isLocalUser}get userId(){return this._clientInfo.userId}get displayName(){return this._clientInfo.displayName}get state(){return this.hasExpired()?i.offline:this._evt.data.state}get data(){return(0,t.cloneValue)(this._evt.data.data)}get roles(){return this._clientInfo.roles}getConnections(u){const d=[];return this._connections.forEach(f=>{(u==null||f.state==u)&&d.push(f)}),d}getConnection(u){return this._connections.get(u)}isFromClient(u){return this._connections.get(u)!==void 0}updateReceived(u,d,f){const m=this.updateClients(u,f),g=this._evt,P=this._clientInfo;return e.LiveEvent.isNewer(g,u)?(this._evt=u,this._clientInfo=d,this._lastUpdateTime=this._liveRuntime.getTimestamp(),m||u.data.state!=g.data.state||JSON.stringify(d)!=JSON.stringify(P)||JSON.stringify(u.data.data)!=JSON.stringify(g.data.data)):m}set expirationPeriod(u){this._expirationPeriod=u,this._connections.forEach(d=>{d.expirationPeriod=u})}hasExpired(){const d=this._liveRuntime.getTimestamp()-this._lastUpdateTime;return!this._isLocalUser&&d>this._expirationPeriod.milliseconds}updateClients(u,d){const f=this._connections.get(u.clientId);return f?(f.updateConnection(u),!1):(this._connections.set(u.clientId,new r.LivePresenceConnection(u,d,this._expirationPeriod,this._liveRuntime)),d&&!this._isLocalUser?(this._isLocalUser=d,!0):!1)}}n.LivePresenceUser=s}(IS)),IS}var Nu={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Nu,"__esModule",{value:!0});Nu.LiveObjectSynchronizer=void 0;class QY{constructor(e,t,r){this.id=e,this.runtime=t,this.liveRuntime=r,this._isDisposed=!1}start(e,t,r,i=!1){return this.liveRuntime.objectManager.registerObject(this.id,this.runtime,e,{updateState:t,getLocalUserCanSend:r,shouldUpdateTimestampPeriodically:i})}dispose(){this._isDisposed||(this._isDisposed=!0,this.liveRuntime.objectManager.unregisterObject(this.id))}getLatestEvent(){return this.liveRuntime.objectManager.getLatestEventForObject(this.id)}getLatestEventForClient(e){return this.liveRuntime.objectManager.getLatestEventForObjectClient(this.id,e)}getEvents(){return this.liveRuntime.objectManager.getEventsForObject(this.id)}sendEvent(e){return this.liveRuntime.objectManager.sendEventForObject(this.id,e)}}Nu.LiveObjectSynchronizer=QY;var Pc={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Pc,"__esModule",{value:!0});Pc.LiveTelemetryLogger=void 0;class dE{constructor(e,t){this._liveRuntime=t,this._runtime=e}sendTelemetryEvent(e,t,r){if(this._runtime.logger){const i=this.createTelemetryEvent(e,r);this._runtime.logger.sendTelemetryEvent(i,t)}}sendErrorEvent(e,t,r){if(this._runtime.logger){const i=this.createTelemetryEvent(e,r);this._runtime.logger.sendErrorEvent(i,t)}}sendPerformanceEvent(e,t,r,i){if(this._runtime.logger){const s=Object.assign({duration:t},this.createTelemetryEvent(e,i));this._runtime.logger.sendPerformanceEvent(s,r)}}createTelemetryEvent(e,t){const r=this._liveRuntime.getTimestamp();return Object.assign({eventName:e,clientId:this._runtime.clientId,correlationId:dE.formatCorrelationId(this._runtime.clientId,r),timestamp:r},t)}static formatCorrelationId(e,t){return`${e}:${t}`}}Pc.LiveTelemetryLogger=dE;(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=Ne&&Ne.__awaiter||function(D,M,U,j){function E(k){return k instanceof U?k:new U(function(z){z(k)})}return new(U||(U=Promise))(function(k,z){function K(pe){try{he(j.next(pe))}catch(X){z(X)}}function ie(pe){try{he(j.throw(pe))}catch(X){z(X)}}function he(pe){pe.done?k(pe.value):E(pe.value).then(K,ie)}he((j=j.apply(D,M||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LivePresence=n.LivePresenceEvents=void 0;const t=Cc,r=cE(),i=Nu,s=Pc,o=ss(),u=Tc,d=la,f=wc,m=lf();var g;(function(D){D.presenceChanged="presenceChanged"})(g=n.LivePresenceEvents||(n.LivePresenceEvents={}));class P extends m.LiveDataObject{constructor(){super(...arguments),this._expirationPeriod=new u.TimeInterval(2e4),this._users=[],this._lastEmitPresenceStateMap=new Map}get isInitialized(){return!!this._synchronizer}get expirationPeriod(){return this._expirationPeriod.seconds}set expirationPeriod(M){this._expirationPeriod.seconds=M>.1?M:.1,this.getUsers().forEach(U=>{U.expirationPeriod=this._expirationPeriod})}get localUser(){var M;const U=(M=this._currentPresence)===null||M===void 0?void 0:M.clientId;if(U)return this.getUserForClient(U)}initialize(M,U=r.PresenceState.online,j){var E;return e(this,void 0,void 0,function*(){if(this._synchronizer)throw new Error("LivePresence: already started.");this._logger=new s.LiveTelemetryLogger(this.runtime,this.liveRuntime),this._allowedRoles=j||[],this._currentPresence={clientId:yield this.waitUntilConnected(),name:"UpdatePresence",timestamp:0,data:{state:U,data:M}},this._synchronizer=new i.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime),yield this._synchronizer.start(this._currentPresence.data,(k,z,K)=>e(this,void 0,void 0,function*(){return yield this.updateMembersList(k,K),!1}),k=>e(this,void 0,void 0,function*(){if(k)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}),!0),yield this.update(this._currentPresence.data.data,this._currentPresence.data.state).catch(()=>{}),(E=this._synchronizer.getEvents())===null||E===void 0||E.forEach(k=>{k.clientId!==this._currentPresence.clientId&&this.updateMembersList(k,!1).catch(()=>{})})})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}getUsers(M){return M?this._users.filter(U=>U.state==M):this._users}update(M,U){var j;return e(this,void 0,void 0,function*(){if(!this._synchronizer||!this._currentPresence)throw new Error("LivePresence: not started.");const E=yield this._synchronizer.sendEvent({state:U??this._currentPresence.data.state,data:(j=(0,o.cloneValue)(M))!==null&&j!==void 0?j:this._currentPresence.data.data});yield this.updateMembersList(E,!0)})}getUserForClient(M){return this._users.find(U=>U.isFromClient(M))}getUser(M){return this._users.find(U=>U.userId==M)}updateMembersList(M,U){var j;return e(this,void 0,void 0,function*(){try{if(!(yield this.liveRuntime.verifyRolesAllowed(M.clientId,this._allowedRoles)))return!1;U&&(this._currentPresence=M);const k=yield this.liveRuntime.getClientInfo(M.clientId);return k?this.useTransientParticipantWorkaround(k)?this.transientParticipantWorkaround(M,U,k):this.updateMembersListWithInfo(M,U,k):!1}catch(E){(j=this._logger)===null||j===void 0||j.sendErrorEvent(o.TelemetryEvents.LiveState.RoleVerificationError,E)}return!1})}useTransientParticipantWorkaround(M){const U={userId:M.userId,roles:[f.UserMeetingRole.guest],displayName:void 0};return JSON.stringify(M)===JSON.stringify(U)}transientParticipantWorkaround(M,U,j){const E=this._users.find(k=>k.userId===j.userId);if(E){const k={userId:E.userId,roles:E.roles,displayName:E.displayName};return this.updateMembersListWithInfo(M,U,k)}return this.updateMembersListWithInfo(M,U,j)}updateMembersListWithInfo(M,U,j){const E=ie=>{var he,pe;this._lastEmitPresenceStateMap.set(ie.userId,ie.state),this.emit(g.presenceChanged,ie,U,M.clientId),U?(he=this._logger)===null||he===void 0||he.sendTelemetryEvent(o.TelemetryEvents.LivePresence.LocalPresenceChanged,{user:M}):(pe=this._logger)===null||pe===void 0||pe.sendTelemetryEvent(o.TelemetryEvents.LivePresence.RemotePresenceChanged,{user:M})};let k=!1,z=!0;for(let ie=0;ie<this._users.length;ie++){const he=this._users[ie];j.userId===he.userId?(he.updateReceived(M,j,U)&&(E(he),k=!0),z=!1):this._lastEmitPresenceStateMap.get(he.userId)!==he.state&&(E(he),k=!0)}if(!z)return k;const K=new r.LivePresenceUser(j,M,this._expirationPeriod,this.liveRuntime,U);return this._users.push(K),E(K),!0}}P.TypeName="@microsoft/live-share:LivePresence",P.factory=new t.DataObjectFactory(P.TypeName,P,[],{}),n.LivePresence=P,d.DynamicObjectRegistry.registerObjectClass(P,P.TypeName)})(aN);var Tv={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class uN extends a3{createServiceMember(e){const t=e.user;return Ki((t==null?void 0:t.name)!==void 0,'Provided user was not an "AzureUser".'),{userId:e.user.id,userName:t.name,connections:[],additionalDetails:t.additionalDetails}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var bw;(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(bw||(bw={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var rg;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(rg||(rg={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Oh(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Pv(n,e){switch(e){case"base64":return yi(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const lN=(n,e)=>cN.from(n,e).buffer;function GR(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let cN=class Va extends Uint8Array{toString(e){return Pv(this,e)}static from(e,t,r){if(typeof e=="string")return Va.fromString(e,t);if(e!==null&&typeof e=="object"&&GR(e.buffer))return Oh(e.byteOffset===0,0),Oh(e.byteLength===e.buffer.byteLength,1),Va.fromArrayBuffer(e.buffer,t,r);if(GR(e))return Va.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Va(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=js(r);return new Va(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Va(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const XY=n=>cN.from(n,"utf8").toString("base64");/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class YY{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const ZY=2e3;class eZ{constructor(e,t,r,i){this.tenantId=e,this.id=t,this.deltaStorageService=r,this.documentStorageService=i,this.logtailSha=this.documentStorageService.logTailSha}fetchMessages(e,t,r,i,s){return i?OV:kV(this.getCore.bind(this),1,e,t,ZY,new YY,r,s)}async getCore(e,t){const r=this.logtailSha?await En(this.documentStorageService,this.logtailSha):[];if(this.logtailSha=void 0,r.length>0){const i=r.filter(s=>s.sequenceNumber>=e);if(i.length>0)return{messages:i,partialResult:!0}}return this.deltaStorageService.get(this.tenantId,this.id,e,t)}}class tZ{constructor(e,t,r,i=async()=>this.restWrapper,s=()=>this.url){this.url=e,this.restWrapper=t,this.logger=r,this.getRestWrapper=i,this.getDeltaStorageUrl=s}async get(e,t,r,i){return{messages:await dt.timedExecAsync(this.logger,{eventName:"getDeltas",from:r,to:i},async o=>{const u=await this.getRestWrapper(),d=this.getDeltaStorageUrl(),f=await u.get(d,{from:r-1,to:i});return o.end({count:f.length}),f}),partialResult:!1}}}var Op,nZ=new Uint8Array(16);function rZ(){if(!Op&&(Op=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Op))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Op(nZ)}const iZ=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function sZ(n){return typeof n=="string"&&iZ.test(n)}var Vn=[];for(var AS=0;AS<256;++AS)Vn.push((AS+256).toString(16).substr(1));function oZ(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Vn[n[e+0]]+Vn[n[e+1]]+Vn[n[e+2]]+Vn[n[e+3]]+"-"+Vn[n[e+4]]+Vn[n[e+5]]+"-"+Vn[n[e+6]]+Vn[n[e+7]]+"-"+Vn[n[e+8]]+Vn[n[e+9]]+"-"+Vn[n[e+10]]+Vn[n[e+11]]+Vn[n[e+12]]+Vn[n[e+13]]+Vn[n[e+14]]+Vn[n[e+15]]).toLowerCase();if(!sZ(t))throw TypeError("Stringified UUID is invalid");return t}function aZ(n,e,t){n=n||{};var r=n.random||(n.rng||rZ)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return oZ(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class nl extends Error{constructor(e,t,r,i,s){super(t),this.code=e,this.canRetry=r,this.isFatal=i,this.retryAfterMs=s,this.name="NetworkError",this.retryAfter=s!==void 0?s/1e3:void 0}get details(){return this.canRetry===void 0&&this.isFatal===void 0&&this.retryAfterMs===void 0?this.message:{message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfter:this.retryAfter,retryAfterMs:this.retryAfterMs}}toJSON(){return{code:this.code,message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfterMs:this.retryAfterMs,retryAfter:this.retryAfter}}}function kS(n,e){var t;let r,i,s,o;switch(e&&typeof e=="object"?(r=(t=e.message)!==null&&t!==void 0?t:"Unknown Error",i=e.canRetry,s=e.isFatal,o=e.retryAfter):e&&typeof e=="string"?r=e:r="Unknown Error",n){case 401:case 403:case 404:return new nl(n,r,!1,!1);case 413:case 422:return new nl(n,r,i??!1,s??!1,i?o:void 0);case 429:return new nl(n,r,!0,!1,o);case 500:return new nl(n,r,i??!0,s??!1,i?o:void 0);case 502:case 503:case 504:return new nl(n,r,!0,!1,o);default:return new nl(n,r,!1,!0)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const OS="x-correlation-id";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function qo(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function hE(n,e){switch(e){case"base64":return yi(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const uZ=(n,e)=>Xi.from(n,e).buffer;function KR(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}class Xi extends Uint8Array{toString(e){return hE(this,e)}static from(e,t,r){if(typeof e=="string")return Xi.fromString(e,t);if(e!==null&&typeof e=="object"&&KR(e.buffer))return qo(e.byteOffset===0,0),qo(e.byteLength===e.buffer.byteLength,1),Xi.fromArrayBuffer(e.buffer,t,r);if(KR(e))return Xi.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Xi(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=js(r);return new Xi(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Xi(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}}async function lZ(n,e){const t=await crypto.subtle.digest(e,n);return new Uint8Array(t)}function cZ(n,e){switch(e){case"hex":return Array.prototype.map.call(n,r=>r.toString(16).padStart(2,"0")).join("");case"base64":return yi(n)}}async function dZ(n,e="SHA-1",t="hex"){if(crypto.subtle===void 0)return WC(()=>import("./hashFileNode-f0b23f93.js"),["./hashFileNode-f0b23f93.js","./sha256-738eea55.js"],import.meta.url).then(async i=>i.hashFile(n,e,t));const r=await lZ(n,e);return cZ(r,t)}async function hZ(n){const t=`blob ${n.byteLength.toString()}${String.fromCharCode(0)}`,r=Xi.from(t+n.toString());return dZ(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const fZ=n=>Xi.from(n,"utf8").toString("base64");/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function dN(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var ww;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(ww||(ww={}));var Qa;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(Qa||(Qa={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ri;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(Ri||(Ri={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const pZ="@fluidframework/server-services-client",mZ="0.1036.5001";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const nu=Pb.debug("fluid:services-client");nu(`Package: ${pZ} - Version: ${mZ}`);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class JR{constructor(e){this.historian=e,this.blobCache=new Map,this.commitCache=new Map,this.treeCache=new Map,this.refCache=new Map}async getHeader(e,t){const r=await this.historian.getHeader(t);for(const i of r.blobs)this.blobCache.set(i.sha,i);return hx(r.tree)}async getFullTree(e){return this.historian.getFullTree(e)}async getCommit(e){return this.commitCache.has(e)?(nu(`Cache hit on ${e}`),this.commitCache.get(e)):this.historian.getCommit(e)}async getCommits(e,t){let r=e;if(this.refCache.has(e)&&(nu(`Commit cache hit on ${e}`),r=this.refCache.get(e),this.refCache.delete(e),!r))return[];if(this.commitCache.has(r)){const i=this.commitCache.get(r);return[{commit:{author:i.author,committer:i.committer,message:i.message,tree:i.tree,url:i.url},parents:i.parents,sha:i.sha,url:i.url}]}return this.historian.getCommits(r,t)}async getTree(e,t=!0){return this.treeCache.has(e)?(nu(`Tree cache hit on ${e}`),this.treeCache.get(e)):this.historian.getTree(e,t)}async getBlob(e){return this.blobCache.has(e)?(nu(`Blob cache hit on ${e}`),this.blobCache.get(e)):this.historian.getBlob(e)}getRawUrl(e){return`${this.historian.endpoint}/git/blobs/raw/${e}`}async getContent(e,t){return this.historian.getContent(t,e)}async createBlob(e,t){const r={content:e,encoding:t};return this.historian.createBlob(r)}async createGitTree(e){return this.historian.createTree(e)}async createTree(e){return this.createTreeCore(e,0)}async createCommit(e){return this.historian.createCommit(e)}async createSummary(e){return this.historian.createSummary(e)}async deleteSummary(e){return this.historian.deleteSummary(e)}async getSummary(e){return this.historian.getSummary(e)}async getRef(e){return this.historian.getRef(`heads/${e}`).catch(t=>{if(t===400||t===404)return null;throw t})}async createRef(e,t){const r={ref:`refs/heads/${e}`,sha:t,config:{enabled:!0}};return this.historian.createRef(r)}async upsertRef(e,t){const r={force:!0,sha:t,config:{enabled:!0}};return this.historian.updateRef(`heads/${e}`,r)}addRef(e,t){this.refCache.set(e,t)}addCommit(e){this.commitCache.set(e.sha,e)}addTree(e){this.treeCache.set(e.sha,e)}addBlob(e){this.blobCache.set(e.sha,e)}async write(e,t,r,i){const s=await this.createTree(t),o={author:{date:new Date().toISOString(),email:"kurtb@microsoft.com",name:"Kurt Berglund"},message:i,parents:r,tree:s.sha},u=await this.historian.createCommit(o);return await this.getRef(e)?await this.upsertRef(e,u.sha):await this.createRef(e,u.sha),u}async createTreeCore(e,t){if(e.id)return this.getTree(e.id);const r=[];for(const d of e.entries)switch(Qa[d.type]){case Qa.Blob:{const f=d.value;d.mode===ww.Symlink&&(f.contents=this.translateSymlink(f.contents,t));const m=this.createBlob(f.contents,f.encoding);r.push(m);break}case Qa.Tree:{const f=d.value,m=this.createTreeCore(f,t+1);r.push(m);break}default:throw new Error("Unknown entry type")}const i=await Promise.all(r),s=[];qo(i.length===e.entries.length,"File entries length is not correct");for(let d=0;d<e.entries.length;d++){const f=e.entries[d].type===Qa.Tree?"tree":e.entries[d].type===Qa.Blob?"blob":"commit";s.push({mode:e.entries[d].mode,path:e.entries[d].path,sha:i[d].sha,type:f})}const o={tree:s};return this.historian.createTree(o)}translateSymlink(e,t){let r="";for(let i=0;i<=t;i++)r+="../";return`${r}${e}`}}var Pd=function(n){switch(typeof n){case"string":return n;case"boolean":return n?"true":"false";case"number":return isFinite(n)?n:"";default:return""}},gZ=function(n,e,t,r){return e=e||"&",t=t||"=",n===null&&(n=void 0),typeof n=="object"?Object.keys(n).map(function(i){var s=encodeURIComponent(Pd(i))+t;return Array.isArray(n[i])?n[i].map(function(o){return s+encodeURIComponent(Pd(o))}).join(e):s+encodeURIComponent(Pd(n[i]))}).filter(Boolean).join(e):r?encodeURIComponent(Pd(r))+t+encodeURIComponent(Pd(n)):""},hN;hN=gZ;var Cw={exports:{}};(function(n,e){e=n.exports=t,e.getSerialize=r;function t(i,s,o,u){return JSON.stringify(i,r(s,u),o)}function r(i,s){var o=[],u=[];return s==null&&(s=function(d,f){return o[0]===f?"[Circular ~]":"[Circular ~."+u.slice(0,o.indexOf(f)).join(".")+"]"}),function(d,f){if(o.length>0){var m=o.indexOf(this);~m?o.splice(m+1):o.push(this),~m?u.splice(m,1/0,d):u.push(d),~o.indexOf(f)&&(f=s.call(this,d,f))}else o.push(f);return i==null?f:i.call(this,d,f)}}})(Cw,Cw.exports);var vZ=Cw.exports;const xw=Ms(vZ);var fE={exports:{}},fN=function(e,t){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return e.apply(t,i)}},yZ=fN,fa=Object.prototype.toString;function pE(n){return Array.isArray(n)}function Ew(n){return typeof n>"u"}function SZ(n){return n!==null&&!Ew(n)&&n.constructor!==null&&!Ew(n.constructor)&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function pN(n){return fa.call(n)==="[object ArrayBuffer]"}function bZ(n){return fa.call(n)==="[object FormData]"}function wZ(n){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&pN(n.buffer),e}function CZ(n){return typeof n=="string"}function xZ(n){return typeof n=="number"}function mN(n){return n!==null&&typeof n=="object"}function nm(n){if(fa.call(n)!=="[object Object]")return!1;var e=Object.getPrototypeOf(n);return e===null||e===Object.prototype}function EZ(n){return fa.call(n)==="[object Date]"}function TZ(n){return fa.call(n)==="[object File]"}function PZ(n){return fa.call(n)==="[object Blob]"}function gN(n){return fa.call(n)==="[object Function]"}function RZ(n){return mN(n)&&gN(n.pipe)}function _Z(n){return fa.call(n)==="[object URLSearchParams]"}function IZ(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")}function AZ(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function mE(n,e){if(!(n===null||typeof n>"u"))if(typeof n!="object"&&(n=[n]),pE(n))for(var t=0,r=n.length;t<r;t++)e.call(null,n[t],t,n);else for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.call(null,n[i],i,n)}function Tw(){var n={};function e(i,s){nm(n[s])&&nm(i)?n[s]=Tw(n[s],i):nm(i)?n[s]=Tw({},i):pE(i)?n[s]=i.slice():n[s]=i}for(var t=0,r=arguments.length;t<r;t++)mE(arguments[t],e);return n}function kZ(n,e,t){return mE(e,function(i,s){t&&typeof i=="function"?n[s]=yZ(i,t):n[s]=i}),n}function OZ(n){return n.charCodeAt(0)===65279&&(n=n.slice(1)),n}var Jr={isArray:pE,isArrayBuffer:pN,isBuffer:SZ,isFormData:bZ,isArrayBufferView:wZ,isString:CZ,isNumber:xZ,isObject:mN,isPlainObject:nm,isUndefined:Ew,isDate:EZ,isFile:TZ,isBlob:PZ,isFunction:gN,isStream:RZ,isURLSearchParams:_Z,isStandardBrowserEnv:AZ,forEach:mE,merge:Tw,extend:kZ,trim:IZ,stripBOM:OZ},rl=Jr;function QR(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var vN=function(e,t,r){if(!t)return e;var i;if(r)i=r(t);else if(rl.isURLSearchParams(t))i=t.toString();else{var s=[];rl.forEach(t,function(d,f){d===null||typeof d>"u"||(rl.isArray(d)?f=f+"[]":d=[d],rl.forEach(d,function(g){rl.isDate(g)?g=g.toISOString():rl.isObject(g)&&(g=JSON.stringify(g)),s.push(QR(f)+"="+QR(g))}))}),i=s.join("&")}if(i){var o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e},FZ=Jr;function Rv(){this.handlers=[]}Rv.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1};Rv.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};Rv.prototype.forEach=function(e){FZ.forEach(this.handlers,function(r){r!==null&&e(r)})};var NZ=Rv,DZ=Jr,LZ=function(e,t){DZ.forEach(e,function(i,s){s!==t&&s.toUpperCase()===t.toUpperCase()&&(e[t]=i,delete e[s])})},yN=function(e,t,r,i,s){return e.config=t,r&&(e.code=r),e.request=i,e.response=s,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e},SN={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},FS,XR;function bN(){if(XR)return FS;XR=1;var n=yN;return FS=function(t,r,i,s,o){var u=new Error(t);return n(u,r,i,s,o)},FS}var NS,YR;function MZ(){if(YR)return NS;YR=1;var n=bN();return NS=function(t,r,i){var s=i.config.validateStatus;!i.status||!s||s(i.status)?t(i):r(n("Request failed with status code "+i.status,i.config,null,i.request,i))},NS}var DS,ZR;function BZ(){if(ZR)return DS;ZR=1;var n=Jr;return DS=n.isStandardBrowserEnv()?function(){return{write:function(r,i,s,o,u,d){var f=[];f.push(r+"="+encodeURIComponent(i)),n.isNumber(s)&&f.push("expires="+new Date(s).toGMTString()),n.isString(o)&&f.push("path="+o),n.isString(u)&&f.push("domain="+u),d===!0&&f.push("secure"),document.cookie=f.join("; ")},read:function(r){var i=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),DS}var LS,e_;function jZ(){return e_||(e_=1,LS=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}),LS}var MS,t_;function qZ(){return t_||(t_=1,MS=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}),MS}var BS,n_;function UZ(){if(n_)return BS;n_=1;var n=jZ(),e=qZ();return BS=function(r,i){return r&&!n(i)?e(r,i):i},BS}var jS,r_;function zZ(){if(r_)return jS;r_=1;var n=Jr,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return jS=function(r){var i={},s,o,u;return r&&n.forEach(r.split(`
`),function(f){if(u=f.indexOf(":"),s=n.trim(f.substr(0,u)).toLowerCase(),o=n.trim(f.substr(u+1)),s){if(i[s]&&e.indexOf(s)>=0)return;s==="set-cookie"?i[s]=(i[s]?i[s]:[]).concat([o]):i[s]=i[s]?i[s]+", "+o:o}}),i},jS}var qS,i_;function $Z(){if(i_)return qS;i_=1;var n=Jr;return qS=n.isStandardBrowserEnv()?function(){var t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),i;function s(o){var u=o;return t&&(r.setAttribute("href",u),u=r.href),r.setAttribute("href",u),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return i=s(window.location.href),function(u){var d=n.isString(u)?s(u):u;return d.protocol===i.protocol&&d.host===i.host}}():function(){return function(){return!0}}(),qS}var US,s_;function _v(){if(s_)return US;s_=1;function n(e){this.message=e}return n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,US=n,US}var zS,o_;function a_(){if(o_)return zS;o_=1;var n=Jr,e=MZ(),t=BZ(),r=vN,i=UZ(),s=zZ(),o=$Z(),u=bN(),d=SN,f=_v();return zS=function(g){return new Promise(function(D,M){var U=g.data,j=g.headers,E=g.responseType,k;function z(){g.cancelToken&&g.cancelToken.unsubscribe(k),g.signal&&g.signal.removeEventListener("abort",k)}n.isFormData(U)&&delete j["Content-Type"];var K=new XMLHttpRequest;if(g.auth){var ie=g.auth.username||"",he=g.auth.password?unescape(encodeURIComponent(g.auth.password)):"";j.Authorization="Basic "+btoa(ie+":"+he)}var pe=i(g.baseURL,g.url);K.open(g.method.toUpperCase(),r(pe,g.params,g.paramsSerializer),!0),K.timeout=g.timeout;function X(){if(K){var ge="getAllResponseHeaders"in K?s(K.getAllResponseHeaders()):null,we=!E||E==="text"||E==="json"?K.responseText:K.response,be={data:we,status:K.status,statusText:K.statusText,headers:ge,config:g,request:K};e(function(ce){D(ce),z()},function(ce){M(ce),z()},be),K=null}}if("onloadend"in K?K.onloadend=X:K.onreadystatechange=function(){!K||K.readyState!==4||K.status===0&&!(K.responseURL&&K.responseURL.indexOf("file:")===0)||setTimeout(X)},K.onabort=function(){K&&(M(u("Request aborted",g,"ECONNABORTED",K)),K=null)},K.onerror=function(){M(u("Network Error",g,null,K)),K=null},K.ontimeout=function(){var we=g.timeout?"timeout of "+g.timeout+"ms exceeded":"timeout exceeded",be=g.transitional||d;g.timeoutErrorMessage&&(we=g.timeoutErrorMessage),M(u(we,g,be.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",K)),K=null},n.isStandardBrowserEnv()){var fe=(g.withCredentials||o(pe))&&g.xsrfCookieName?t.read(g.xsrfCookieName):void 0;fe&&(j[g.xsrfHeaderName]=fe)}"setRequestHeader"in K&&n.forEach(j,function(we,be){typeof U>"u"&&be.toLowerCase()==="content-type"?delete j[be]:K.setRequestHeader(be,we)}),n.isUndefined(g.withCredentials)||(K.withCredentials=!!g.withCredentials),E&&E!=="json"&&(K.responseType=g.responseType),typeof g.onDownloadProgress=="function"&&K.addEventListener("progress",g.onDownloadProgress),typeof g.onUploadProgress=="function"&&K.upload&&K.upload.addEventListener("progress",g.onUploadProgress),(g.cancelToken||g.signal)&&(k=function(ge){K&&(M(!ge||ge&&ge.type?new f("canceled"):ge),K.abort(),K=null)},g.cancelToken&&g.cancelToken.subscribe(k),g.signal&&(g.signal.aborted?k():g.signal.addEventListener("abort",k))),U||(U=null),K.send(U)})},zS}var Jn=Jr,u_=LZ,HZ=yN,VZ=SN,WZ={"Content-Type":"application/x-www-form-urlencoded"};function l_(n,e){!Jn.isUndefined(n)&&Jn.isUndefined(n["Content-Type"])&&(n["Content-Type"]=e)}function GZ(){var n;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(n=a_()),n}function KZ(n,e,t){if(Jn.isString(n))try{return(e||JSON.parse)(n),Jn.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}var Iv={transitional:VZ,adapter:GZ(),transformRequest:[function(e,t){return u_(t,"Accept"),u_(t,"Content-Type"),Jn.isFormData(e)||Jn.isArrayBuffer(e)||Jn.isBuffer(e)||Jn.isStream(e)||Jn.isFile(e)||Jn.isBlob(e)?e:Jn.isArrayBufferView(e)?e.buffer:Jn.isURLSearchParams(e)?(l_(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):Jn.isObject(e)||t&&t["Content-Type"]==="application/json"?(l_(t,"application/json"),KZ(e)):e}],transformResponse:[function(e){var t=this.transitional||Iv.transitional,r=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,s=!r&&this.responseType==="json";if(s||i&&Jn.isString(e)&&e.length)try{return JSON.parse(e)}catch(o){if(s)throw o.name==="SyntaxError"?HZ(o,this,"E_JSON_PARSE"):o}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Jn.forEach(["delete","get","head"],function(e){Iv.headers[e]={}});Jn.forEach(["post","put","patch"],function(e){Iv.headers[e]=Jn.merge(WZ)});var gE=Iv,JZ=Jr,QZ=gE,XZ=function(e,t,r){var i=this||QZ;return JZ.forEach(r,function(o){e=o.call(i,e,t)}),e},$S,c_;function wN(){return c_||(c_=1,$S=function(e){return!!(e&&e.__CANCEL__)}),$S}var d_=Jr,HS=XZ,YZ=wN(),ZZ=gE,eee=_v();function VS(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new eee("canceled")}var tee=function(e){VS(e),e.headers=e.headers||{},e.data=HS.call(e,e.data,e.headers,e.transformRequest),e.headers=d_.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),d_.forEach(["delete","get","head","post","put","patch","common"],function(i){delete e.headers[i]});var t=e.adapter||ZZ.adapter;return t(e).then(function(i){return VS(e),i.data=HS.call(e,i.data,i.headers,e.transformResponse),i},function(i){return YZ(i)||(VS(e),i&&i.response&&(i.response.data=HS.call(e,i.response.data,i.response.headers,e.transformResponse))),Promise.reject(i)})},Zr=Jr,CN=function(e,t){t=t||{};var r={};function i(m,g){return Zr.isPlainObject(m)&&Zr.isPlainObject(g)?Zr.merge(m,g):Zr.isPlainObject(g)?Zr.merge({},g):Zr.isArray(g)?g.slice():g}function s(m){if(Zr.isUndefined(t[m])){if(!Zr.isUndefined(e[m]))return i(void 0,e[m])}else return i(e[m],t[m])}function o(m){if(!Zr.isUndefined(t[m]))return i(void 0,t[m])}function u(m){if(Zr.isUndefined(t[m])){if(!Zr.isUndefined(e[m]))return i(void 0,e[m])}else return i(void 0,t[m])}function d(m){if(m in t)return i(e[m],t[m]);if(m in e)return i(void 0,e[m])}var f={url:o,method:o,data:o,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:d};return Zr.forEach(Object.keys(e).concat(Object.keys(t)),function(g){var P=f[g]||s,D=P(g);Zr.isUndefined(D)&&P!==d||(r[g]=D)}),r},WS,h_;function xN(){return h_||(h_=1,WS={version:"0.26.1"}),WS}var nee=xN().version,vE={};["object","boolean","number","function","string","symbol"].forEach(function(n,e){vE[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});var f_={};vE.transitional=function(e,t,r){function i(s,o){return"[Axios v"+nee+"] Transitional option '"+s+"'"+o+(r?". "+r:"")}return function(s,o,u){if(e===!1)throw new Error(i(o," has been removed"+(t?" in "+t:"")));return t&&!f_[o]&&(f_[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,u):!0}};function ree(n,e,t){if(typeof n!="object")throw new TypeError("options must be an object");for(var r=Object.keys(n),i=r.length;i-- >0;){var s=r[i],o=e[s];if(o){var u=n[s],d=u===void 0||o(u,s,n);if(d!==!0)throw new TypeError("option "+s+" must be "+d);continue}if(t!==!0)throw Error("Unknown option "+s)}}var iee={assertOptions:ree,validators:vE},EN=Jr,see=vN,p_=NZ,m_=tee,Av=CN,TN=iee,il=TN.validators;function cf(n){this.defaults=n,this.interceptors={request:new p_,response:new p_}}cf.prototype.request=function(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Av(this.defaults,t),t.method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;r!==void 0&&TN.assertOptions(r,{silentJSONParsing:il.transitional(il.boolean),forcedJSONParsing:il.transitional(il.boolean),clarifyTimeoutError:il.transitional(il.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach(function(D){typeof D.runWhen=="function"&&D.runWhen(t)===!1||(s=s&&D.synchronous,i.unshift(D.fulfilled,D.rejected))});var o=[];this.interceptors.response.forEach(function(D){o.push(D.fulfilled,D.rejected)});var u;if(!s){var d=[m_,void 0];for(Array.prototype.unshift.apply(d,i),d=d.concat(o),u=Promise.resolve(t);d.length;)u=u.then(d.shift(),d.shift());return u}for(var f=t;i.length;){var m=i.shift(),g=i.shift();try{f=m(f)}catch(P){g(P);break}}try{u=m_(f)}catch(P){return Promise.reject(P)}for(;o.length;)u=u.then(o.shift(),o.shift());return u};cf.prototype.getUri=function(e){return e=Av(this.defaults,e),see(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")};EN.forEach(["delete","get","head","options"],function(e){cf.prototype[e]=function(t,r){return this.request(Av(r||{},{method:e,url:t,data:(r||{}).data}))}});EN.forEach(["post","put","patch"],function(e){cf.prototype[e]=function(t,r,i){return this.request(Av(i||{},{method:e,url:t,data:r}))}});var oee=cf,GS,g_;function aee(){if(g_)return GS;g_=1;var n=_v();function e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var r;this.promise=new Promise(function(o){r=o});var i=this;this.promise.then(function(s){if(i._listeners){var o,u=i._listeners.length;for(o=0;o<u;o++)i._listeners[o](s);i._listeners=null}}),this.promise.then=function(s){var o,u=new Promise(function(d){i.subscribe(d),o=d}).then(s);return u.cancel=function(){i.unsubscribe(o)},u},t(function(o){i.reason||(i.reason=new n(o),r(i.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]},e.prototype.unsubscribe=function(r){if(this._listeners){var i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}},e.source=function(){var r,i=new e(function(o){r=o});return{token:i,cancel:r}},GS=e,GS}var KS,v_;function uee(){return v_||(v_=1,KS=function(e){return function(r){return e.apply(null,r)}}),KS}var JS,y_;function lee(){if(y_)return JS;y_=1;var n=Jr;return JS=function(t){return n.isObject(t)&&t.isAxiosError===!0},JS}var S_=Jr,cee=fN,rm=oee,dee=CN,hee=gE;function PN(n){var e=new rm(n),t=cee(rm.prototype.request,e);return S_.extend(t,rm.prototype,e),S_.extend(t,e),t.create=function(i){return PN(dee(n,i))},t}var qs=PN(hee);qs.Axios=rm;qs.Cancel=_v();qs.CancelToken=aee();qs.isCancel=wN();qs.VERSION=xN().version;qs.all=function(e){return Promise.all(e)};qs.spread=uee();qs.isAxiosError=lee();fE.exports=qs;fE.exports.default=qs;var fee=fE.exports,pee=fee;const mee=Ms(pee);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class RN{constructor(e,t={},r=1e3*1024*1024,i=1e3*1024*1024){this.baseurl=e,this.defaultQueryString=t,this.maxBodyLength=r,this.maxContentLength=i}async get(e,t,r){const i={baseURL:this.baseurl,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"GET",url:`${e}${this.generateQueryString(t)}`};return this.request(i,200)}async post(e,t,r,i){const s={baseURL:this.baseurl,data:t,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"POST",url:`${e}${this.generateQueryString(r)}`};return this.request(s,201)}async delete(e,t,r){const i={baseURL:this.baseurl,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"DELETE",url:`${e}${this.generateQueryString(t)}`};return this.request(i,204)}async patch(e,t,r,i){const s={baseURL:this.baseurl,data:t,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"PATCH",url:`${e}${this.generateQueryString(r)}`};return this.request(s,200)}generateQueryString(e){if(this.defaultQueryString||e){const t=Object.assign(Object.assign({},this.defaultQueryString),e),r=hN(t);if(r!=="")return`?${r}`}return""}}class gee extends RN{constructor(e,t={},r=1e3*1024*1024,i=1e3*1024*1024,s={},o=mee,u,d,f){super(e,t,r,i),this.defaultHeaders=s,this.axios=o,this.refreshDefaultQueryString=u,this.refreshDefaultHeaders=d,this.getCorrelationId=f}async request(e,t,r=!0){var i,s;const o=Object.assign({},e);return o.headers=this.generateHeaders(o.headers,(s=(i=this.getCorrelationId)===null||i===void 0?void 0:i.call(this))!==null&&s!==void 0?s:aZ()),new Promise((u,d)=>{this.axios.request(o).then(f=>{u(f.data)}).catch(f=>{var m,g,P,D,M,U,j,E,k,z,K,ie,he,pe;if(((m=f==null?void 0:f.response)===null||m===void 0?void 0:m.status)===t&&u((g=f==null?void 0:f.response)===null||g===void 0?void 0:g.data),f!=null&&f.config?nu(`[${f.config.method}] request to [${(P=f.config.baseURL)!==null&&P!==void 0?P:""}${(D=f.config.url)!==null&&D!==void 0?D:""}] failed with [${(M=f.response)===null||M===void 0?void 0:M.status}] [${xw((U=f.response)===null||U===void 0?void 0:U.data,void 0,2)}]`):nu(`request to ${o.url} failed ${f?f.message:""}`),((j=f==null?void 0:f.response)===null||j===void 0?void 0:j.status)===429&&((k=(E=f==null?void 0:f.response)===null||E===void 0?void 0:E.data)===null||k===void 0?void 0:k.retryAfter)>0&&r)setTimeout(()=>{this.request(o,t).then(u).catch(d)},f.response.data.retryAfter*1e3);else if(((z=f==null?void 0:f.response)===null||z===void 0?void 0:z.status)===401&&r&&this.refreshOnAuthError()){const X=Object.assign({},e);X.headers=this.generateHeaders(X.headers,o.headers[OS]),this.request(X,t,!1).then(u).catch(d)}else if(f!=null&&f.response)d(kS((K=f==null?void 0:f.response)===null||K===void 0?void 0:K.status,(ie=f==null?void 0:f.response)===null||ie===void 0?void 0:ie.data));else if(f!=null&&f.request)d(kS(502,`Network Error: ${(he=f==null?void 0:f.message)!==null&&he!==void 0?he:"undefined"}`));else{const X={canRetry:!1,isFatal:!1,message:(pe=f==null?void 0:f.message)!==null&&pe!==void 0?pe:"Unknown Error"};d(kS(500,X))}})})}generateHeaders(e,t){let r=e??{};return this.defaultHeaders&&(r=Object.assign(Object.assign({},this.defaultHeaders),e)),r[OS]?r:Object.assign({[OS]:t},r)}refreshOnAuthError(){return this.refreshDefaultQueryString===void 0&&this.refreshDefaultHeaders===void 0?!1:(this.refreshDefaultHeaders!==void 0&&(this.defaultHeaders=this.refreshDefaultHeaders()),this.refreshDefaultQueryString!==void 0&&(this.defaultQueryString=this.refreshDefaultQueryString()),!0)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function vee(n,e){for(const t of e)if(n.endsWith(t))return!0;return!1}const yee=n=>`Basic ${fZ(`${n.user}:${n.password}`)}`;class b_{constructor(e,t,r,i){this.endpoint=e,this.historianApi=t,this.restWrapper=i,this.defaultQueryString={},r&&this.historianApi?(this.defaultQueryString.disableCache=r,this.cacheBust=!1):this.cacheBust=r,this.restWrapper===void 0&&(this.restWrapper=new gee(this.endpoint))}async getHeader(e){return this.historianApi?this.restWrapper.get(`/headers/${encodeURIComponent(e)}`,this.getQueryString()):this.getHeaderDirect(e)}async getFullTree(e){return this.restWrapper.get(`/tree/${encodeURIComponent(e)}`,this.getQueryString())}async getBlob(e){return this.restWrapper.get(`/git/blobs/${encodeURIComponent(e)}`,this.getQueryString())}async createBlob(e){return this.restWrapper.post("/git/blobs",e,this.getQueryString())}async getContent(e,t){return this.restWrapper.get(`/contents/${e}`,this.getQueryString({ref:t}))}async getCommits(e,t){return this.restWrapper.get("/commits",this.getQueryString({count:t,sha:e})).catch(r=>r===400||r===404?[]:Promise.reject(r))}async getCommit(e){return this.restWrapper.get(`/git/commits/${encodeURIComponent(e)}`,this.getQueryString())}async createCommit(e){return this.restWrapper.post("/git/commits",e,this.getQueryString())}async getRefs(){return this.restWrapper.get("/git/refs",this.getQueryString())}async getRef(e){return this.restWrapper.get(`/git/refs/${e}`,this.getQueryString())}async createRef(e){return this.restWrapper.post("/git/refs",e,this.getQueryString())}async updateRef(e,t){return this.restWrapper.patch(`/git/refs/${e}`,t,this.getQueryString())}async deleteRef(e){await this.restWrapper.delete(`/git/refs/${e}`,this.getQueryString())}async createTag(e){return this.restWrapper.post("/git/tags",e,this.getQueryString())}async getTag(e){return this.restWrapper.get(`/git/tags/${e}`,this.getQueryString())}async createTree(e){return this.restWrapper.post("/git/trees",e,this.getQueryString())}async getTree(e,t){return this.restWrapper.get(`/git/trees/${encodeURIComponent(e)}`,this.getQueryString({recursive:t?1:0}))}async createSummary(e){return this.restWrapper.post("/git/summaries",e,this.getQueryString())}async deleteSummary(e){const t={"Soft-Delete":e};return this.restWrapper.delete("/git/summaries",this.getQueryString(),t)}async getSummary(e){return this.restWrapper.get(`/git/summaries/${e}`,this.getQueryString())}async getHeaderDirect(e){const t=await this.getTree(e,!0),r=[".attributes",".blobs",".messages","header"],i=[];for(const o of t.tree)if(o.type==="blob"&&vee(o.path,r)){const u=this.getBlob(o.sha);i.push(u)}return{blobs:await Promise.all(i),tree:t}}getQueryString(e){return this.cacheBust?Object.assign(Object.assign({cacheBust:Date.now()},this.defaultQueryString),e):Object.assign(Object.assign({},this.defaultQueryString),e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var eh;(function(n){n.Method="method",n.Header="header",n.Body="body"})(eh||(eh={}));const See=(n,e)=>`${n}: ${e}`;class bee{translate(e){var t,r;const i=Object.assign({},e),s=new URLSearchParams;if(s.append(eh.Method,(t=i.method)!==null&&t!==void 0?t:"GET"),i.headers)for(const[o,u]of Object.entries(i.headers)){const d=See(o,u);s.append(eh.Header,d)}if(i.data&&["post","put","patch"].includes((r=i.method)===null||r===void 0?void 0:r.toLowerCase())){const o=JSON.stringify(i.data);s.append(eh.Body,o)}return i.data=s.toString(),i.method="POST",i.headers={"Content-Type":"application/x-www-form-urlencoded;restless"},i}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const QS=(...n)=>n.map(e=>e.replace(/^\//,"").replace(/\/$/,"")).filter(e=>!!e).join("/");function _N(n,e,t="",r=""){const i={type:"tree",entries:[]},s=Object.keys(e.tree);for(const o of s){const u=e.tree[o];let d,f,m;const g=QS(t===""?r:t,o);switch(u.type){case Ri.Tree:{f=_N(n,u,g,r),m=u.unreferenced||void 0;break}case Ri.Blob:{typeof u.content=="string"?f={type:"blob",content:u.content,encoding:"utf-8"}:f={type:"blob",content:hE(u.content,"base64"),encoding:"base64"};break}case Ri.Handle:{if(u.embedded)d=u.handle;else{if(!n)throw Error("Parent summary does not exist to reference by handle.");d=QS(n,r,u.handle)}break}case Ri.Attachment:{d=u.id;break}default:dN(u,`Unknown type: ${u.type}`)}const P={path:encodeURIComponent(o),type:qO(u)};let D;if(f)qo(d===void 0,173),D=Object.assign({value:f,unreferenced:m},P);else if(d)D=Object.assign(Object.assign({},P),{id:d});else throw new Error(`Invalid tree entry for ${u.type}`);i.entries.push(D)}return i}function wee(n,e){const t={},r={id:n.id,blobs:{},trees:{}};t[""]=r;for(const i of n.entries){const s=i.path.replace(new RegExp(`^${e}/`),""),o=s.lastIndexOf("/"),u=s.slice(0,Math.max(0,o)),d=s.slice(o+1),f=t[u];if(i.type==="tree"){const m={blobs:{},trees:{},unreferenced:i.unreferenced};f.trees[decodeURIComponent(d)]=m,t[s]=m}else if(i.type==="blob")f.blobs[decodeURIComponent(d)]=i.id;else throw new Error("Unknown entry type!!")}return r}function w_(n,e=".app"){var t;const r=new Map;n.blobs&&n.blobs.forEach(u=>{var d;r.set(u.id,uZ(u.content,(d=u.encoding)!==null&&d!==void 0?d:"utf-8"))});const i=(t=n.trees)===null||t===void 0?void 0:t[0],s=i==null?void 0:i.sequenceNumber,o=wee(i,e);return{blobs:r,snapshotTree:o,sequenceNumber:s}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Cee{constructor(e,t,r){this.manager=e,this.blobsShaCache=t,this.getPreviousFullSnapshot=r}async writeSummaryTree(e,t,r,i){const s=await this.getPreviousFullSnapshot(t);return this.writeSummaryTreeCore(e,s??void 0)}async writeSummaryTreeCore(e,t){const r=await Promise.all(Object.keys(e.tree).map(async s=>{const o=e.tree[s],u=await this.writeSummaryTreeObject(o,t);return{mode:Zz(o),path:encodeURIComponent(s),sha:u,type:qO(o)}}));return(await this.manager.createGitTree({tree:r})).sha}async writeSummaryTreeObject(e,t){switch(e.type){case Ri.Blob:return this.writeSummaryBlob(e.content);case Ri.Handle:{if(t===void 0)throw Error("Parent summary does not exist to reference by handle.");return this.getIdFromPath(e.handleType,e.handle,t)}case Ri.Tree:return this.writeSummaryTreeCore(e,t);case Ri.Attachment:return e.id;default:dN(e,`Unknown type: ${e.type}`)}}async writeSummaryBlob(e){const{parsedContent:t,encoding:r}=typeof e=="string"?{parsedContent:e,encoding:"utf-8"}:{parsedContent:hE(e,"base64"),encoding:"base64"},i=await hZ(Xi.from(t,r));if(!this.blobsShaCache.has(i)){this.blobsShaCache.set(i,"");const s=await this.manager.createBlob(t,r);qo(i===s.sha,182)}return i}getIdFromPath(e,t,r){const i=t.split("/").map(s=>decodeURIComponent(s));return i[0]===""&&i.shift(),i.length===0?r.id:this.getIdFromPathCore(e,i,r)}getIdFromPathCore(e,t,r){var i;qo(t.length>0,179);const s=t[0];if(t.length===1)switch(e){case Ri.Blob:{const o=r.blobs[s];return qo(!!o,180),o}case Ri.Tree:{const o=(i=r.trees[s])===null||i===void 0?void 0:i.id;return qo(!!o,181),o}default:throw Error(`Unexpected handle summary object type: "${e}".`)}return this.getIdFromPathCore(e,t.slice(1),r.trees[s])}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class xee{constructor(e){this.manager=e}async writeSummaryTree(e,t,r,i){const s=await this.writeSummaryTreeCore(t,e,r,i??0);if(!s)throw new Error("Failed to write summary tree");return s}async writeSummaryTreeCore(e,t,r,i){const o={entries:_N(e,t,"",r==="channel"?".app":"").entries,message:void 0,sequenceNumber:i,type:r};return this.manager.createSummary(o).then(u=>u.id)}}const Ds=Object.create(null);Ds.open="0";Ds.close="1";Ds.ping="2";Ds.pong="3";Ds.message="4";Ds.upgrade="5";Ds.noop="6";const im=Object.create(null);Object.keys(Ds).forEach(n=>{im[Ds[n]]=n});const Pw={type:"error",data:"parser error"},IN=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",AN=typeof ArrayBuffer=="function",kN=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,yE=({type:n,data:e},t,r)=>IN&&e instanceof Blob?t?r(e):C_(e,r):AN&&(e instanceof ArrayBuffer||kN(e))?t?r(e):C_(new Blob([e]),r):r(Ds[n]+(e||"")),C_=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)};function x_(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let XS;function Eee(n,e){if(IN&&n.data instanceof Blob)return n.data.arrayBuffer().then(x_).then(e);if(AN&&(n.data instanceof ArrayBuffer||kN(n.data)))return e(x_(n.data));yE(n,!1,t=>{XS||(XS=new TextEncoder),e(XS.encode(t))})}const E_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Dd=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<E_.length;n++)Dd[E_.charCodeAt(n)]=n;const Tee=n=>{let e=n.length*.75,t=n.length,r,i=0,s,o,u,d;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const f=new ArrayBuffer(e),m=new Uint8Array(f);for(r=0;r<t;r+=4)s=Dd[n.charCodeAt(r)],o=Dd[n.charCodeAt(r+1)],u=Dd[n.charCodeAt(r+2)],d=Dd[n.charCodeAt(r+3)],m[i++]=s<<2|o>>4,m[i++]=(o&15)<<4|u>>2,m[i++]=(u&3)<<6|d&63;return f},Pee=typeof ArrayBuffer=="function",SE=(n,e)=>{if(typeof n!="string")return{type:"message",data:ON(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:Ree(n.substring(1),e)}:im[t]?n.length>1?{type:im[t],data:n.substring(1)}:{type:im[t]}:Pw},Ree=(n,e)=>{if(Pee){const t=Tee(n);return ON(t,e)}else return{base64:!0,data:n}},ON=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},FN=String.fromCharCode(30),_ee=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((s,o)=>{yE(s,!1,u=>{r[o]=u,++i===t&&e(r.join(FN))})})},Iee=(n,e)=>{const t=n.split(FN),r=[];for(let i=0;i<t.length;i++){const s=SE(t[i],e);if(r.push(s),s.type==="error")break}return r};function Aee(){return new TransformStream({transform(n,e){Eee(n,t=>{const r=t.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const s=new DataView(i.buffer);s.setUint8(0,126),s.setUint16(1,r)}else{i=new Uint8Array(9);const s=new DataView(i.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(r))}n.data&&typeof n.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(t)})}})}let YS;function Fp(n){return n.reduce((e,t)=>e+t.length,0)}function Np(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let r=0;for(let i=0;i<e;i++)t[i]=n[0][r++],r===n[0].length&&(n.shift(),r=0);return n.length&&r<n[0].length&&(n[0]=n[0].slice(r)),t}function kee(n,e){YS||(YS=new TextDecoder);const t=[];let r=0,i=-1,s=!1;return new TransformStream({transform(o,u){for(t.push(o);;){if(r===0){if(Fp(t)<1)break;const d=Np(t,1);s=(d[0]&128)===128,i=d[0]&127,i<126?r=3:i===126?r=1:r=2}else if(r===1){if(Fp(t)<2)break;const d=Np(t,2);i=new DataView(d.buffer,d.byteOffset,d.length).getUint16(0),r=3}else if(r===2){if(Fp(t)<8)break;const d=Np(t,8),f=new DataView(d.buffer,d.byteOffset,d.length),m=f.getUint32(0);if(m>Math.pow(2,53-32)-1){u.enqueue(Pw);break}i=m*Math.pow(2,32)+f.getUint32(4),r=3}else{if(Fp(t)<i)break;const d=Np(t,i);u.enqueue(SE(s?d:YS.decode(d),e)),r=0}if(i===0||i>n){u.enqueue(Pw);break}}}})}const NN=4;function pn(n){if(n)return Oee(n)}function Oee(n){for(var e in pn.prototype)n[e]=pn.prototype[e];return n}pn.prototype.on=pn.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};pn.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};pn.prototype.off=pn.prototype.removeListener=pn.prototype.removeAllListeners=pn.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};pn.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};pn.prototype.emitReserved=pn.prototype.emit;pn.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};pn.prototype.hasListeners=function(n){return!!this.listeners(n).length};const _i=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function DN(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const Fee=_i.setTimeout,Nee=_i.clearTimeout;function kv(n,e){e.useNativeTimers?(n.setTimeoutFn=Fee.bind(_i),n.clearTimeoutFn=Nee.bind(_i)):(n.setTimeoutFn=_i.setTimeout.bind(_i),n.clearTimeoutFn=_i.clearTimeout.bind(_i))}const Dee=1.33;function Lee(n){return typeof n=="string"?Mee(n):Math.ceil((n.byteLength||n.size)*Dee)}function Mee(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function Bee(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function jee(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let s=t[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class qee extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class bE extends pn{constructor(e){super(),this.writable=!1,kv(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new qee(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=SE(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=Bee(e);return t.length?"?"+t:""}}const LN="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Rw=64,Uee={};let T_=0,Dp=0,P_;function R_(n){let e="";do e=LN[n%Rw]+e,n=Math.floor(n/Rw);while(n>0);return e}function MN(){const n=R_(+new Date);return n!==P_?(T_=0,P_=n):n+"."+R_(T_++)}for(;Dp<Rw;Dp++)Uee[LN[Dp]]=Dp;let BN=!1;try{BN=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const zee=BN;function jN(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||zee))return new XMLHttpRequest}catch{}if(!e)try{return new _i[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function $ee(){}const Hee=function(){return new jN({xdomain:!1}).responseType!=null}();class Vee extends bE{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}const t=e&&e.forceBase64;this.supportsBinary=Hee&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};Iee(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,_ee(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=MN()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Os(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class Os extends pn{constructor(e,t){super(),kv(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=t.data!==void 0?t.data:null,this.create()}create(){var e;const t=DN(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const r=this.xhr=new jN(t);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this.opts.extraHeaders[i])}}catch{}if(this.method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this.opts.cookieJar)===null||i===void 0||i.parseCookies(r)),r.readyState===4&&(r.status===200||r.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof r.status=="number"?r.status:0)},0))},r.send(this.data)}catch(i){this.setTimeoutFn(()=>{this.onError(i)},0);return}typeof document<"u"&&(this.index=Os.requestsCount++,Os.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=$ee,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Os.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Os.requestsCount=0;Os.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",__);else if(typeof addEventListener=="function"){const n="onpagehide"in _i?"pagehide":"unload";addEventListener(n,__,!1)}}function __(){for(let n in Os.requests)Os.requests.hasOwnProperty(n)&&Os.requests[n].abort()}const wE=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),Lp=_i.WebSocket||_i.MozWebSocket,I_=!0,Wee="arraybuffer",A_=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Gee extends bE{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=A_?{}:DN(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=I_&&!A_?t?new Lp(e,t):new Lp(e):new Lp(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;yE(r,this.supportsBinary,s=>{const o={};try{I_&&this.ws.send(s)}catch{}i&&wE(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=MN()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!Lp}}class Kee extends bE{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const t=kee(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),i=Aee();i.readable.pipeTo(e.writable),this.writer=i.writable.getWriter();const s=()=>{r.read().then(({done:u,value:d})=>{u||(this.onPacket(d),s())}).catch(u=>{})};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;this.writer.write(r).then(()=>{i&&wE(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const Jee={websocket:Gee,webtransport:Kee,polling:Vee},Qee=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Xee=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function _w(n){const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=Qee.exec(n||""),s={},o=14;for(;o--;)s[Xee[o]]=i[o]||"";return t!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=Yee(s,s.path),s.queryKey=Zee(s,s.query),s}function Yee(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Zee(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(t[i]=s)}),t}let qN=class cl extends pn{constructor(e,t={}){super(),this.binaryType=Wee,this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=_w(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=_w(t.host).host),kv(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=jee(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=NN,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Jee[e](r)}open(){let e;if(this.opts.rememberUpgrade&&cl.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),r=!1;cl.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",g=>{if(!r)if(g.type==="pong"&&g.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;cl.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(m(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const P=new Error("probe error");P.transport=t.name,this.emitReserved("upgradeError",P)}}))};function s(){r||(r=!0,m(),t.close(),t=null)}const o=g=>{const P=new Error("probe error: "+g);P.transport=t.name,s(),this.emitReserved("upgradeError",P)};function u(){o("transport closed")}function d(){o("socket closed")}function f(g){t&&g.name!==t.name&&s()}const m=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",u),this.off("close",d),this.off("upgrading",f)};t.once("open",i),t.once("error",o),t.once("close",u),this.once("close",d),this.once("upgrading",f),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onOpen(){if(this.readyState="open",cl.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(t+=Lee(i)),r>0&&t>this.maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){cl.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}};qN.protocol=NN;function ete(n,e="",t){let r=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),r=_w(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+e,r.href=r.protocol+"://"+s+(t&&t.port===r.port?"":":"+r.port),r}const tte=typeof ArrayBuffer=="function",nte=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,UN=Object.prototype.toString,rte=typeof Blob=="function"||typeof Blob<"u"&&UN.call(Blob)==="[object BlobConstructor]",ite=typeof File=="function"||typeof File<"u"&&UN.call(File)==="[object FileConstructor]";function CE(n){return tte&&(n instanceof ArrayBuffer||nte(n))||rte&&n instanceof Blob||ite&&n instanceof File}function sm(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(sm(n[t]))return!0;return!1}if(CE(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return sm(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&sm(n[t]))return!0;return!1}function ste(n){const e=[],t=n.data,r=n;return r.data=Iw(t,e),r.attachments=e.length,{packet:r,buffers:e}}function Iw(n,e){if(!n)return n;if(CE(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=Iw(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=Iw(n[r],e));return t}return n}function ote(n,e){return n.data=Aw(n.data,e),delete n.attachments,n}function Aw(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=Aw(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=Aw(n[t],e));return n}const ate=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ute=5;var pt;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(pt||(pt={}));class lte{constructor(e){this.replacer=e}encode(e){return(e.type===pt.EVENT||e.type===pt.ACK)&&sm(e)?this.encodeAsBinary({type:e.type===pt.EVENT?pt.BINARY_EVENT:pt.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===pt.BINARY_EVENT||e.type===pt.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=ste(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}function k_(n){return Object.prototype.toString.call(n)==="[object Object]"}class xE extends pn{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===pt.BINARY_EVENT;r||t.type===pt.BINARY_ACK?(t.type=r?pt.EVENT:pt.ACK,this.reconstructor=new cte(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(CE(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(pt[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===pt.BINARY_EVENT||r.type===pt.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(s,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(xE.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case pt.CONNECT:return k_(t);case pt.DISCONNECT:return t===void 0;case pt.CONNECT_ERROR:return typeof t=="string"||k_(t);case pt.EVENT:case pt.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&ate.indexOf(t[0])===-1);case pt.ACK:case pt.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class cte{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=ote(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const dte=Object.freeze(Object.defineProperty({__proto__:null,Decoder:xE,Encoder:lte,get PacketType(){return pt},protocol:ute},Symbol.toStringTag,{value:"Module"}));function Ji(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const hte=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class zN extends pn{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ji(e,"open",this.onopen.bind(this)),Ji(e,"packet",this.onpacket.bind(this)),Ji(e,"error",this.onerror.bind(this)),Ji(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(hte.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:pt.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,u=t.pop();this._registerAckCallback(o,u),r.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...o])}}emitWithAck(e,...t){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{t.push((o,u)=>r?o?s(o):i(u):i(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:pt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case pt.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case pt.EVENT:case pt.BINARY_EVENT:this.onevent(e);break;case pt.ACK:case pt.BINARY_ACK:this.onack(e);break;case pt.DISCONNECT:this.ondisconnect();break;case pt.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:pt.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:pt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Rc(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}Rc.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=Math.floor(e*10)&1?n+t:n-t}return Math.min(n,this.max)|0};Rc.prototype.reset=function(){this.attempts=0};Rc.prototype.setMin=function(n){this.ms=n};Rc.prototype.setMax=function(n){this.max=n};Rc.prototype.setJitter=function(n){this.jitter=n};class kw extends pn{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,kv(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Rc({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||dte;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new qN(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=Ji(t,"open",function(){r.onopen(),e&&e()}),s=u=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",u),e?e(u):this.maybeReconnectOnOpen()},o=Ji(t,"error",s);if(this._timeout!==!1){const u=this._timeout,d=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),t.close()},u);this.opts.autoUnref&&d.unref(),this.subs.push(()=>{this.clearTimeoutFn(d)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ji(e,"ping",this.onping.bind(this)),Ji(e,"data",this.ondata.bind(this)),Ji(e,"error",this.onerror.bind(this)),Ji(e,"close",this.onclose.bind(this)),Ji(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){wE(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new zN(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Rd={};function om(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=ete(n,e.path||"/socket.io"),r=t.source,i=t.id,s=t.path,o=Rd[i]&&s in Rd[i].nsps,u=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let d;return u?d=new kw(r,e):(Rd[i]||(Rd[i]=new kw(r,e)),d=Rd[i]),t.query&&!e.query&&(e.query=t.queryKey),d.socket(t.path,e)}Object.assign(om,{Manager:kw,Socket:zN,io:om,connect:om});/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class uc{constructor(){this.cache=new Map}async get(e){return this.cache.get(e)}async put(e,t){this.cache.set(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const O_="latest";class fte{constructor(e,t,r,i={},s,o=new uc,u=new uc,d,f=async m=>m&&this.noCacheGitManager!==void 0?this.noCacheGitManager:this.manager){this.id=e,this.manager=t,this.logger=r,this.policies=i,this.driverPolicies=s,this.blobCache=o,this.snapshotTreeCache=u,this.noCacheGitManager=d,this.getStorageManager=f,this.firstVersionsCall=!0}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new xee(e)}async getVersions(e,t){var r;if(e!==this.id&&e!==null)return[{id:e,treeId:void 0}];if(this.firstVersionsCall&&t===1){this.firstVersionsCall=!1;const{id:o,snapshotTree:u}=!((r=this.driverPolicies)===null||r===void 0)&&r.enableDiscovery?await this.fetchAndCacheSnapshotTree(O_,!0):await this.fetchAndCacheSnapshotTree(O_,!1);return[{id:o,treeId:u.id}]}const i=e||this.id;return(await dt.timedExecAsync(this.logger,{eventName:"getVersions",versionId:i,count:t},async()=>(await this.getStorageManager()).getCommits(i,t))).map(o=>({date:o.commit.author.date,id:o.sha,treeId:o.commit.tree.sha}))}async getSnapshotTree(e){let t=e;if(!t){const r=await this.getVersions(this.id,1);if(r.length===0)return null;t=r[0]}return(await this.fetchAndCacheSnapshotTree(t.id)).snapshotTree}async readBlob(e){const t=await this.blobCache.get(this.getCacheKey(e));if(t!==void 0)return t;const r=await dt.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},async s=>{const u=await(await this.getStorageManager()).getBlob(e);return s.end({size:u.size}),u}),i=lN(r.content,r.encoding);return await this.blobCache.put(this.getCacheKey(r.sha),i),i}async uploadSummaryWithContext(e,t){return await dt.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},async()=>{var i;return(await this.getSummaryUploadManager()).writeSummaryTree(e,(i=t.ackHandle)!==null&&i!==void 0?i:"","channel")})}async downloadSummary(e){const t=await dt.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e.handle},async s=>{var o;const d=await(await this.getStorageManager()).getSummary(e.handle);return s.end({size:(o=d.trees[0])===null||o===void 0?void 0:o.entries.length}),d}),{blobs:r,snapshotTree:i}=w_(t,"");return aF(i,r)}async createBlob(e){const t=new Uint8Array(e);return dt.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},async r=>{const s=await(await this.getStorageManager()).createBlob(Pv(t,"base64"),"base64").then(o=>({id:o.sha,url:o.url}));return r.end({blobId:s.id}),s})}async fetchAndCacheSnapshotTree(e,t){const r=await this.snapshotTreeCache.get(this.getCacheKey(e));if(r!==void 0)return{id:r.id,snapshotTree:r.snapshotTree};const i=await dt.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e},async m=>{var g;const D=await(await this.getStorageManager(t)).getSummary(e);return m.end({size:(g=D.trees[0])===null||g===void 0?void 0:g.entries.length}),D}),s=w_(i),o=i.id,u=s.snapshotTree.id;Oh(u!==void 0,629);const d={id:o,snapshotTree:s.snapshotTree},f=[this.snapshotTreeCache.put(this.getCacheKey(u),d),this.initBlobCache(s.blobs)];return u!==e&&f.push(this.snapshotTreeCache.put(this.getCacheKey(e),d)),await Promise.all(f),d}async initBlobCache(e){const t=[];e.forEach((r,i)=>{const s=this.getCacheKey(i);t.push(this.blobCache.put(s,r))}),await Promise.all(t)}getCacheKey(e){return`${this.id}:${e}`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class pte{constructor(e,t){this.internalGitManager=e,this.logger=t}async getHeader(e,t){return this.runWithRetry(async()=>this.internalGitManager.getHeader(e,t),"gitManager_getHeader")}async getFullTree(e){return this.runWithRetry(async()=>this.internalGitManager.getFullTree(e),"gitManager_getFullTree")}async getCommit(e){return this.runWithRetry(async()=>this.internalGitManager.getCommit(e),"gitManager_getCommit")}async getCommits(e,t){return this.runWithRetry(async()=>this.internalGitManager.getCommits(e,t),"gitManager_getCommits")}async getTree(e,t){return this.runWithRetry(async()=>this.internalGitManager.getTree(e,t),"gitManager_getTree")}async getBlob(e){return this.runWithRetry(async()=>this.internalGitManager.getBlob(e),"gitManager_getBlob")}getRawUrl(e){return this.internalGitManager.getRawUrl(e)}async getContent(e,t){return this.runWithRetry(async()=>this.internalGitManager.getContent(e,t),"gitManager_getContent")}async createBlob(e,t){return this.runWithRetry(async()=>this.internalGitManager.createBlob(e,t),"gitManager_createBlob")}async createGitTree(e){return this.runWithRetry(async()=>this.internalGitManager.createGitTree(e),"gitManager_createGitTree")}async createTree(e){return this.runWithRetry(async()=>this.internalGitManager.createTree(e),"gitManager_createTree")}async createCommit(e){return this.runWithRetry(async()=>this.internalGitManager.createCommit(e),"gitManager_createCommit")}async getRef(e){return this.runWithRetry(async()=>this.internalGitManager.getRef(e),"gitManager_getRef")}async createRef(e,t){return this.runWithRetry(async()=>this.internalGitManager.createRef(e,t),"gitManager_createRef")}async upsertRef(e,t){return this.runWithRetry(async()=>this.internalGitManager.upsertRef(e,t),"gitManager_upsertRef")}async write(e,t,r,i){return this.runWithRetry(async()=>this.internalGitManager.write(e,t,r,i),"gitManager_write")}async createSummary(e){return this.runWithRetry(async()=>this.internalGitManager.createSummary(e),"gitManager_createSummary")}async deleteSummary(e){return this.runWithRetry(async()=>this.internalGitManager.deleteSummary(e),"gitManager_deleteSummary")}async getSummary(e){return this.runWithRetry(async()=>this.internalGitManager.getSummary(e),"gitManager_getSummary")}async runWithRetry(e,t){return Tx(e,t,this.logger,{})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const mte=typeof window>"u";class gte{constructor(e,t,r,i={},s,o,u,d=async()=>this.manager){this.id=e,this.manager=t,this.logger=r,this.policies=i,this.getStorageManager=d,this.blobsShaCache=new Map,((s==null?void 0:s.enableRestLess)===!0||mte)&&(this.blobCache=o??new uc,this.snapshotTreeCache=u??new uc)}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new Cee(new pte(e,this.logger),this.blobsShaCache,this.getPreviousFullSnapshot.bind(this))}async getVersions(e,t){const r=e||this.id;return(await dt.timedExecAsync(this.logger,{eventName:"getVersions",versionId:r,count:t},async()=>(await this.getStorageManager()).getCommits(r,t))).map(s=>({date:s.commit.author.date,id:s.sha,treeId:s.commit.tree.sha}))}async getSnapshotTree(e){var t,r;let i=e;if(!i){const d=await this.getVersions(this.id,1);if(d.length===0)return null;i=d[0]}const s=await((t=this.snapshotTreeCache)===null||t===void 0?void 0:t.get(this.getCacheKey(i.treeId)));if(s)return s.snapshotTree;const o=await dt.timedExecAsync(this.logger,{eventName:"getSnapshotTree",treeId:i.treeId},async d=>{const m=await(await this.getStorageManager()).getTree(i.treeId);return d.end({size:m.tree.length}),m}),u=hx(o,this.blobsShaCache,!0);return await((r=this.snapshotTreeCache)===null||r===void 0?void 0:r.put(this.getCacheKey(u.id),{id:i.id,snapshotTree:u})),u}async readBlob(e){var t,r;const i=await((t=this.blobCache)===null||t===void 0?void 0:t.get(this.getCacheKey(e)));if(i)return i;const s=await dt.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},async u=>{const f=await(await this.getStorageManager()).getBlob(e);return u.end({size:f.size}),f});this.blobsShaCache.set(s.sha,"");const o=lN(s.content,s.encoding);return await((r=this.blobCache)===null||r===void 0?void 0:r.put(this.getCacheKey(s.sha),o)),o}async uploadSummaryWithContext(e,t){return await dt.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},async()=>{var i;return(await this.getSummaryUploadManager()).writeSummaryTree(e,(i=t.ackHandle)!==null&&i!==void 0?i:"","channel")})}async downloadSummary(e){throw new Error("NOT IMPLEMENTED!")}async createBlob(e){const t=new Uint8Array(e);return dt.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},async r=>{const s=await(await this.getStorageManager()).createBlob(Pv(t,"base64"),"base64").then(o=>({id:o.sha,url:o.url}));return r.end({blobId:s.id}),s})}async getPreviousFullSnapshot(e){return e?this.getVersions(e,1).then(async t=>(this.blobsShaCache.clear(),this.getSnapshotTree(t[0]))):void 0}getCacheKey(e){return`${this.id}:${e}`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class EE extends lx{constructor(e,t,r,i={},s,o,u,d,f){super(EE.loadInternalDocumentStorageService(e,t,r,i,s,o,u,d,f)),this.id=e,this.manager=t,this.noCacheGitManager=d,this._logTailSha=void 0}get logTailSha(){return this._logTailSha}static loadInternalDocumentStorageService(e,t,r,i,s,o,u,d,f){const m=s!=null&&s.enableWholeSummaryUpload?new fte(e,t,r,i,s,o,u,d,f):new gte(e,t,r,i,s,o,u,f);return!(s!=null&&s.enableWholeSummaryUpload)&&i.caching===tc.Prefetch?new FV(m):m}async getSnapshotTree(e){const t=await this.internalStorageService.getSnapshotTree(e);return t!==null&&(this._logTailSha=".logTail"in t.trees?t.trees[".logTail"].blobs.logTail:void 0),t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ei(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function vte(n){const e=s=>s!==null&&!Array.isArray(s)&&typeof s=="object",t=(s,o)=>{const u=s.split(`
`);return u.shift(),o!==void 0&&u.unshift(o),u.join(`
`)},i={message:typeof(n==null?void 0:n.message)=="string"?n.message:String(n)};if(e(n)){const{errorType:s,stack:o,name:u}=n;if(typeof s=="string"&&(i.errorType=s),typeof o=="string"){const d=typeof u=="string"?u:void 0;i.stack=t(o,d)}}return i}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ow;(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(Ow||(Ow={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const F_="1.3.6";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Uo extends Fg{constructor(e,t,r,i=!1){super((s,o)=>{r.sendErrorEvent({eventName:"DeltaConnection:EventException",name:s},o)}),this.socket=e,this.documentId=t,this.enableLongPollingDowngrades=i,this.queuedMessages=[],this.queuedSignals=[],this.earlyOpHandlerAttached=!1,this.connectionListeners=new Map,this.trackedListeners=new Map,this._disposed=!1,this.earlyOpHandler=(s,o)=>{this.queuedMessages.push(...o)},this.earlySignalHandler=s=>{this.queuedSignals.push(s)},this.mc=Iu(at.create(r,"DeltaConnection")),this.on("newListener",(s,o)=>{if(ei(!this.disposed,522),Uo.eventsAlwaysForwarded.includes(s)){ei(this.trackedListeners.has(s),581);return}if(!Uo.eventsToForward.includes(s))throw new Error(`DocumentDeltaConnection: Registering for unknown event: ${s}`);ei(this.listeners(s).length!==0===this.trackedListeners.has(s),523),this.trackedListeners.has(s)||this.addTrackedListener(s,(...u)=>{this.emit(s,...u)})})}get hasDetails(){return!!this._details}get disposed(){return ei(this._disposed||this.socket.connected,580),this._disposed}get logger(){return this.mc.logger}get details(){if(!this._details)throw new Error("Internal error: calling method before _details is initialized!");return this._details}get clientId(){return this.details.clientId}get mode(){return this.details.mode}get claims(){return this.details.claims}get existing(){return this.details.existing}get maxMessageSize(){return this.details.serviceConfiguration.maxMessageSize}get version(){return this.details.version}get serviceConfiguration(){return this.details.serviceConfiguration}checkNotClosed(){ei(!this.disposed,524)}get initialMessages(){return this.checkNotClosed(),ei(this.earlyOpHandlerAttached,142),ei(this.listeners("op").length!==0,143),this.removeEarlyOpHandler(),this.queuedMessages.length>0&&(this.details.initialMessages.push(...this.queuedMessages),this.details.initialMessages.sort((e,t)=>e.sequenceNumber-t.sequenceNumber),this.queuedMessages.length=0),this.details.initialMessages}get initialSignals(){return this.checkNotClosed(),ei(this.listeners("signal").length!==0,144),this.removeEarlySignalHandler(),this.queuedSignals.length>0&&(this.details.initialSignals.push(...this.queuedSignals),this.queuedSignals.length=0),this.details.initialSignals}get initialClients(){return this.checkNotClosed(),this.details.initialClients}emitMessages(e,t){this.disposed||this.socket.emit(e,this.clientId,t)}submitCore(e,t){this.emitMessages(e,[t])}submit(e){this.checkNotClosed(),this.submitCore("submitOp",e)}submitSignal(e){this.checkNotClosed(),this.submitCore("submitSignal",[e])}dispose(){this.disposeCore(!1,rc("Client closing delta connection",{canRetry:!0},{driverVersion:F_}))}disposeCore(e,t){this._disposed||(this._disposed=!0,this.removeTrackedListeners(),this.disconnect(e,t))}disconnect(e,t){this.socket.disconnect()}async initialize(e,t){this.socket.on("op",this.earlyOpHandler),this.socket.on("signal",this.earlySignalHandler),this.earlyOpHandlerAttached=!0;let r=0;const i=()=>this.socket.io.reconnection(),s=()=>i()?this.socket.io.reconnectionAttempts():0,o=()=>s()+1;this._details=await new Promise((u,d)=>{const f=(m,g)=>{this.disposeCore(m,g),d(g)};this.addConnectionListener("connect_error",m=>{var g;r++;let P=!1;try{const D=m==null?void 0:m.description;D&&typeof D=="object"&&(m.type==="TransportError"&&(P=!0),D.target=void 0)}catch{}P&&this.enableLongPollingDowngrades&&((g=this.socket.io.opts.transports)===null||g===void 0?void 0:g[0])!=="polling"&&(this.socket.io.opts.transports=["polling","websocket"],i()||(this.socket.io.reconnection(!0),this.socket.io.reconnectionAttempts(1))),!(i()&&r<o())&&f(!0,this.createErrorObject("connect_error",m))}),this.addConnectionListener("connect_timeout",()=>{f(!0,this.createErrorObject("connect_timeout"))}),this.addConnectionListener("connect_document_success",m=>{if(e.nonce!==void 0&&m.nonce!==void 0&&m.nonce!==e.nonce)return;const g=e.mode,P=m.mode;if(m.claims.scopes.includes(Ow.DocWrite)){if(P!==g){f(!1,this.createErrorObject("connect_document_success","Connected in a different mode than was requested",!1));return}}else if(P==="write"){f(!1,this.createErrorObject("connect_document_success","Connected in write mode without write permissions",!1));return}this.checkpointSequenceNumber=m.checkpointSequenceNumber,this.removeConnectionListeners(),u(m)}),this.addTrackedListener("disconnect",m=>{const g=this.createErrorObject("disconnect",m);this.emit("disconnect",g),f(!0,g)}),this.addTrackedListener("error",m=>{const g=this.createErrorObject("error",m,m!=="Invalid namespace");this.emit("error",g),f(!0,g)}),this.addConnectionListener("connect_document_error",m=>{e.nonce!==void 0&&m.nonce!==void 0&&m.nonce!==e.nonce||f(!1,this.createErrorObject("connect_document_error",m))}),this.socket.emit("connect_document",e),this.socketConnectionTimeout=setTimeout(()=>{f(!1,this.createErrorObject("orderingServiceHandshakeTimeout"))},t+2e3)}),ei(!this.disposed,582)}removeEarlyOpHandler(){this.socket.removeListener("op",this.earlyOpHandler),this.earlyOpHandlerAttached=!1}removeEarlySignalHandler(){this.socket.removeListener("signal",this.earlySignalHandler)}addConnectionListener(e,t){ei(!Uo.eventsAlwaysForwarded.includes(e),583),ei(!Uo.eventsToForward.includes(e),584),this.socket.on(e,t),ei(!this.connectionListeners.has(e),525),this.connectionListeners.set(e,t)}addTrackedListener(e,t){this.socket.on(e,t),ei(!this.trackedListeners.has(e),526),this.trackedListeners.set(e,t)}removeTrackedListeners(){for(const[e,t]of this.trackedListeners.entries())this.socket.off(e,t);this.removeConnectionListeners(),this.removeEarlyOpHandler(),this.removeEarlySignalHandler(),this.trackedListeners.clear()}removeConnectionListeners(){this.socketConnectionTimeout!==void 0&&clearTimeout(this.socketConnectionTimeout);for(const[e,t]of this.connectionListeners.entries())this.socket.off(e,t);this.connectionListeners.clear()}createErrorObject(e,t,r=!0){let i;return(t==null?void 0:t.type)==="TransportError"?i=`${(t==null?void 0:t.message)!==void 0?`${t.message}: `:""}${JSON.stringify(t,FO())}`:i=vte(t).message,rc(`socket.io (${e}): ${i}`,{canRetry:r},{driverVersion:F_})}}Uo.eventsToForward=["nack","op","signal","pong"];Uo.eventsAlwaysForwarded=["disconnect","error"];/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const Ov="1.3.6";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Fw;(function(n){n.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError"})(Fw||(Fw={}));function $N(n,e,t){const r={statusCode:e,driverVersion:Ov};switch(e){case void 0:return new jb(n,n.startsWith("NetworkError"),r);case 401:case 403:return new bV(n,void 0,void 0,r);case 404:const i=Fw.fileNotFoundOrAccessDeniedError;return new Lg(n,i,r);case 429:return rc(n,{canRetry:!0,retryAfterMs:t},r);case 500:case 502:return new jb(n,!0,r);default:return rc(n,{canRetry:t!==void 0,retryAfterMs:t},r)}}function N_(n,e,t){throw $N(n,e,t)}function yte(n,e){const t=`R11s socket error (${e}): ${n.message}`;return $N(t,n.code,n.retryAfterMs)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Ste=["^0.4.0","^0.3.0","^0.2.0","^0.1.0"];class TE extends Uo{static async create(e,t,r,i,s,o,u,d=2e4){const f=i(o,{query:{documentId:t,tenantId:e},reconnection:!1,transports:["websocket"],timeout:d}),m={client:s,id:t,mode:s.mode,tenantId:e,token:r,versions:Ste,relayUserAgent:[s.details.environment,` driverVersion:${Ov}`].join(";")},g=!0,P=new TE(f,t,u,g);return await P.initialize(m,d),P}createErrorObject(e,t,r=!0){return r&&Number.isInteger(t==null?void 0:t.code)&&typeof(t==null?void 0:t.message)=="string"?yte(t,e):super.createErrorObject(e,t,r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class bte{get repositoryUrl(){throw new Error("Invalid operation")}async getSnapshotTree(e){return e?Promise.reject(new Error("Invalid operation")):null}async getVersions(e,t){return[]}async uploadSummaryWithContext(e,t){return Promise.reject(new Error("Invalid operation"))}async downloadSummary(e){return Promise.reject(new Error("Invalid operation"))}async createBlob(e){return Promise.reject(new Error("Null blob storage can not create blob"))}async readBlob(e){return Promise.reject(new Error("Null blob storage can not read blob"))}}var Nw={exports:{}};(function(n,e){var t=typeof self<"u"?self:Ne,r=function(){function s(){this.fetch=!1,this.DOMException=t.DOMException}return s.prototype=t,new s}();(function(s){(function(o){var u={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function d(ce){return ce&&DataView.prototype.isPrototypeOf(ce)}if(u.arrayBuffer)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],m=ArrayBuffer.isView||function(ce){return ce&&f.indexOf(Object.prototype.toString.call(ce))>-1};function g(ce){if(typeof ce!="string"&&(ce=String(ce)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(ce))throw new TypeError("Invalid character in header field name");return ce.toLowerCase()}function P(ce){return typeof ce!="string"&&(ce=String(ce)),ce}function D(ce){var ve={next:function(){var De=ce.shift();return{done:De===void 0,value:De}}};return u.iterable&&(ve[Symbol.iterator]=function(){return ve}),ve}function M(ce){this.map={},ce instanceof M?ce.forEach(function(ve,De){this.append(De,ve)},this):Array.isArray(ce)?ce.forEach(function(ve){this.append(ve[0],ve[1])},this):ce&&Object.getOwnPropertyNames(ce).forEach(function(ve){this.append(ve,ce[ve])},this)}M.prototype.append=function(ce,ve){ce=g(ce),ve=P(ve);var De=this.map[ce];this.map[ce]=De?De+", "+ve:ve},M.prototype.delete=function(ce){delete this.map[g(ce)]},M.prototype.get=function(ce){return ce=g(ce),this.has(ce)?this.map[ce]:null},M.prototype.has=function(ce){return this.map.hasOwnProperty(g(ce))},M.prototype.set=function(ce,ve){this.map[g(ce)]=P(ve)},M.prototype.forEach=function(ce,ve){for(var De in this.map)this.map.hasOwnProperty(De)&&ce.call(ve,this.map[De],De,this)},M.prototype.keys=function(){var ce=[];return this.forEach(function(ve,De){ce.push(De)}),D(ce)},M.prototype.values=function(){var ce=[];return this.forEach(function(ve){ce.push(ve)}),D(ce)},M.prototype.entries=function(){var ce=[];return this.forEach(function(ve,De){ce.push([De,ve])}),D(ce)},u.iterable&&(M.prototype[Symbol.iterator]=M.prototype.entries);function U(ce){if(ce.bodyUsed)return Promise.reject(new TypeError("Already read"));ce.bodyUsed=!0}function j(ce){return new Promise(function(ve,De){ce.onload=function(){ve(ce.result)},ce.onerror=function(){De(ce.error)}})}function E(ce){var ve=new FileReader,De=j(ve);return ve.readAsArrayBuffer(ce),De}function k(ce){var ve=new FileReader,De=j(ve);return ve.readAsText(ce),De}function z(ce){for(var ve=new Uint8Array(ce),De=new Array(ve.length),Xe=0;Xe<ve.length;Xe++)De[Xe]=String.fromCharCode(ve[Xe]);return De.join("")}function K(ce){if(ce.slice)return ce.slice(0);var ve=new Uint8Array(ce.byteLength);return ve.set(new Uint8Array(ce)),ve.buffer}function ie(){return this.bodyUsed=!1,this._initBody=function(ce){this._bodyInit=ce,ce?typeof ce=="string"?this._bodyText=ce:u.blob&&Blob.prototype.isPrototypeOf(ce)?this._bodyBlob=ce:u.formData&&FormData.prototype.isPrototypeOf(ce)?this._bodyFormData=ce:u.searchParams&&URLSearchParams.prototype.isPrototypeOf(ce)?this._bodyText=ce.toString():u.arrayBuffer&&u.blob&&d(ce)?(this._bodyArrayBuffer=K(ce.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):u.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(ce)||m(ce))?this._bodyArrayBuffer=K(ce):this._bodyText=ce=Object.prototype.toString.call(ce):this._bodyText="",this.headers.get("content-type")||(typeof ce=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):u.searchParams&&URLSearchParams.prototype.isPrototypeOf(ce)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},u.blob&&(this.blob=function(){var ce=U(this);if(ce)return ce;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?U(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(E)}),this.text=function(){var ce=U(this);if(ce)return ce;if(this._bodyBlob)return k(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(z(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},u.formData&&(this.formData=function(){return this.text().then(fe)}),this.json=function(){return this.text().then(JSON.parse)},this}var he=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function pe(ce){var ve=ce.toUpperCase();return he.indexOf(ve)>-1?ve:ce}function X(ce,ve){ve=ve||{};var De=ve.body;if(ce instanceof X){if(ce.bodyUsed)throw new TypeError("Already read");this.url=ce.url,this.credentials=ce.credentials,ve.headers||(this.headers=new M(ce.headers)),this.method=ce.method,this.mode=ce.mode,this.signal=ce.signal,!De&&ce._bodyInit!=null&&(De=ce._bodyInit,ce.bodyUsed=!0)}else this.url=String(ce);if(this.credentials=ve.credentials||this.credentials||"same-origin",(ve.headers||!this.headers)&&(this.headers=new M(ve.headers)),this.method=pe(ve.method||this.method||"GET"),this.mode=ve.mode||this.mode||null,this.signal=ve.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&De)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(De)}X.prototype.clone=function(){return new X(this,{body:this._bodyInit})};function fe(ce){var ve=new FormData;return ce.trim().split("&").forEach(function(De){if(De){var Xe=De.split("="),Re=Xe.shift().replace(/\+/g," "),je=Xe.join("=").replace(/\+/g," ");ve.append(decodeURIComponent(Re),decodeURIComponent(je))}}),ve}function ge(ce){var ve=new M,De=ce.replace(/\r?\n[\t ]+/g," ");return De.split(/\r?\n/).forEach(function(Xe){var Re=Xe.split(":"),je=Re.shift().trim();if(je){var Ae=Re.join(":").trim();ve.append(je,Ae)}}),ve}ie.call(X.prototype);function we(ce,ve){ve||(ve={}),this.type="default",this.status=ve.status===void 0?200:ve.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in ve?ve.statusText:"OK",this.headers=new M(ve.headers),this.url=ve.url||"",this._initBody(ce)}ie.call(we.prototype),we.prototype.clone=function(){return new we(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new M(this.headers),url:this.url})},we.error=function(){var ce=new we(null,{status:0,statusText:""});return ce.type="error",ce};var be=[301,302,303,307,308];we.redirect=function(ce,ve){if(be.indexOf(ve)===-1)throw new RangeError("Invalid status code");return new we(null,{status:ve,headers:{location:ce}})},o.DOMException=s.DOMException;try{new o.DOMException}catch{o.DOMException=function(ve,De){this.message=ve,this.name=De;var Xe=Error(ve);this.stack=Xe.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function He(ce,ve){return new Promise(function(De,Xe){var Re=new X(ce,ve);if(Re.signal&&Re.signal.aborted)return Xe(new o.DOMException("Aborted","AbortError"));var je=new XMLHttpRequest;function Ae(){je.abort()}je.onload=function(){var Ce={status:je.status,statusText:je.statusText,headers:ge(je.getAllResponseHeaders()||"")};Ce.url="responseURL"in je?je.responseURL:Ce.headers.get("X-Request-URL");var Ve="response"in je?je.response:je.responseText;De(new we(Ve,Ce))},je.onerror=function(){Xe(new TypeError("Network request failed"))},je.ontimeout=function(){Xe(new TypeError("Network request failed"))},je.onabort=function(){Xe(new o.DOMException("Aborted","AbortError"))},je.open(Re.method,Re.url,!0),Re.credentials==="include"?je.withCredentials=!0:Re.credentials==="omit"&&(je.withCredentials=!1),"responseType"in je&&u.blob&&(je.responseType="blob"),Re.headers.forEach(function(Ce,Ve){je.setRequestHeader(Ve,Ce)}),Re.signal&&(Re.signal.addEventListener("abort",Ae),je.onreadystatechange=function(){je.readyState===4&&Re.signal.removeEventListener("abort",Ae)}),je.send(typeof Re._bodyInit>"u"?null:Re._bodyInit)})}return He.polyfill=!0,s.fetch||(s.fetch=He,s.Headers=M,s.Request=X,s.Response=we),o.Headers=M,o.Request=X,o.Response=we,o.fetch=He,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,n.exports=e})(Nw,Nw.exports);var wte=Nw.exports;const Cte=Ms(wte);var Mp,xte=new Uint8Array(16);function Ete(){if(!Mp&&(Mp=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Mp))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Mp(xte)}const Tte=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Pte(n){return typeof n=="string"&&Tte.test(n)}var Wn=[];for(var ZS=0;ZS<256;++ZS)Wn.push((ZS+256).toString(16).substr(1));function Rte(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Wn[n[e+0]]+Wn[n[e+1]]+Wn[n[e+2]]+Wn[n[e+3]]+"-"+Wn[n[e+4]]+Wn[n[e+5]]+"-"+Wn[n[e+6]]+Wn[n[e+7]]+"-"+Wn[n[e+8]]+Wn[n[e+9]]+"-"+Wn[n[e+10]]+Wn[n[e+11]]+Wn[n[e+12]]+Wn[n[e+13]]+Wn[n[e+14]]+Wn[n[e+15]]).toLowerCase();if(!Pte(t))throw TypeError("Stringified UUID is invalid");return t}function _te(n,e,t){n=n||{};var r=n.random||(n.rng||Ete)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return Rte(r)}const Ite=n=>{var e,t;const r=n.baseURL!==void 0?`${n.baseURL}${(e=n.url)!==null&&e!==void 0?e:""}`:(t=n.url)!==null&&t!==void 0?t:"",i={method:n.method,headers:n.headers,body:n.data};return[r,i]};class HN extends RN{constructor(e,t,r,i,s,o={}){super(s,o),this.rateLimiter=t,this.getAuthorizationHeader=r,this.useRestLess=i,this.restLess=new bee}async load(){this.authorizationHeader=await this.getAuthorizationHeader()}async request(e,t,r=!0){var i;const s=Object.assign(Object.assign({},e),{headers:this.generateHeaders(e.headers)}),o=this.useRestLess?this.restLess.translate(s):s,u=Ite(o),d=await this.rateLimiter.schedule(async()=>Cte(...u).catch(async g=>{const P=["TypeError","FetchError"].includes(g==null?void 0:g.name);N_(P?`NetworkError: ${g.message}`:xw(g))})),f=!((i=d.headers.get("content-type"))===null||i===void 0)&&i.includes("application/json")?await d.json():await d.text();if(d.ok||d.status===t)return f;if(d.status===401&&r)return this.authorizationHeader=await this.getAuthorizationHeader(!0),this.request(s,t,!1);if(d.status===429&&(f==null?void 0:f.retryAfter)>0)return new Promise((g,P)=>setTimeout(()=>{this.request(s,t).then(g).catch(P)},f.retryAfter*1e3));const m=f!==void 0?typeof f=="string"?f:xw(f):d.statusText;N_(`R11s fetch error: ${m}`,d.status,f==null?void 0:f.retryAfter)}generateHeaders(e){const t=(e==null?void 0:e["x-correlation-id"])||_te();return Object.assign(Object.assign({},e),{"x-correlation-id":t,"x-driver-version":Ov,Authorization:this.authorizationHeader})}}class PE extends HN{constructor(e,t,r,i,s,o={}){super(e,t,r,i,s,o)}static async load(e,t,r,i,s,o,u){const d={token:`${XY(e)}`},f=async g=>{const D={password:(await r.fetchStorageToken(e,t,g)).jwt,user:e};return yee(D)},m=new PE(i,s,f,o,u,d);try{await m.load()}catch(g){i.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},g),await m.load()}return m}}class Fh extends HN{constructor(e,t,r,i,s,o={}){super(e,t,r,i,s,o)}static async load(e,t,r,i,s,o,u){const d=async m=>`Basic ${(await r.fetchOrdererToken(e,t,m)).jwt}`,f=new Fh(i,s,d,o,u);try{await f.load()}catch(m){i.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},m),await f.load()}return f}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Ate=5*6e4;class kte{constructor(e,t,r,i,s,o,u,d,f,m,g,P){this._resolvedUrl=e,this.ordererUrl=t,this.deltaStorageUrl=r,this.storageUrl=i,this.logger=s,this.tokenProvider=o,this.tenantId=u,this.documentId=d,this.driverPolicies=f,this.blobCache=m,this.snapshotTreeCache=g,this.discoverFluidResolvedUrl=P,this.lastDiscoveredAt=Date.now()}get resolvedUrl(){return this._resolvedUrl}dispose(){}async connectToStorage(){if(this.documentStorageService!==void 0)return this.documentStorageService;if(this.storageUrl===void 0)return new bte;const e=async s=>{const o=this.shouldUpdateDiscoveredSessionInfo();if(o&&await this.refreshDiscovery(),!this.storageManager||!this.noCacheStorageManager||o){const u=new Vm(this.driverPolicies.maxConcurrentStorageRequests),d=await PE.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,u,this.driverPolicies.enableRestLess,this.storageUrl),f=new b_(this.storageUrl,!0,!1,d);this.storageManager=new JR(f);const m=new b_(this.storageUrl,!0,!0,d);this.noCacheStorageManager=new JR(m)}return s?this.noCacheStorageManager:this.storageManager},t=await e(),r=await e(!0),i={caching:this.driverPolicies.enablePrefetch?tc.Prefetch:tc.NoCaching,minBlobSize:this.driverPolicies.aggregateBlobsSmallerThanBytes};return this.documentStorageService=new EE(this.documentId,t,this.logger,i,this.driverPolicies,this.blobCache,this.snapshotTreeCache,r,e),this.documentStorageService}async connectToDeltaStorage(){await this.connectToStorage(),Oh(!!this.documentStorageService,177);const e=async()=>{const i=this.shouldUpdateDiscoveredSessionInfo();if(i&&await this.refreshDiscovery(),!this.ordererRestWrapper||i){const s=new Vm(this.driverPolicies.maxConcurrentOrdererRequests);this.ordererRestWrapper=await Fh.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,s,this.driverPolicies.enableRestLess)}return this.ordererRestWrapper},t=await e(),r=new tZ(this.deltaStorageUrl,t,this.logger,e,()=>this.deltaStorageUrl);return new eZ(this.tenantId,this.documentId,r,this.documentStorageService)}async connectToDeltaStream(e){const t=async r=>{this.shouldUpdateDiscoveredSessionInfo()&&await this.refreshDiscovery();const i=await this.tokenProvider.fetchOrdererToken(this.tenantId,this.documentId,r);return TE.create(this.tenantId,this.documentId,i.jwt,om,e,this.ordererUrl,this.logger)};try{return await t()}catch(r){if((r==null?void 0:r.statusCode)===401)return t(!0);throw r}}async refreshDiscovery(){return this.discoverP||(this.discoverP=dt.timedExecAsync(this.logger,{eventName:"refreshSessionDiscovery"},async()=>this.refreshDiscoveryCore())),this.discoverP}async refreshDiscoveryCore(){const e=await this.discoverFluidResolvedUrl();this._resolvedUrl=e,this.storageUrl=e.endpoints.storageUrl,this.ordererUrl=e.endpoints.ordererUrl,this.deltaStorageUrl=e.endpoints.deltaStorageUrl}shouldUpdateDiscoveredSessionInfo(){if(!this.driverPolicies.enableDiscovery)return!1;const t=Date.now()-this.lastDiscoveredAt>Ate;return t&&(this.lastDiscoveredAt=Date.now(),this.discoverP=void 0,this.refreshDiscovery().catch(()=>{this.lastDiscoveredAt=0})),t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var th;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(th||(th={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function VN(n){const e=Object.keys(n.tree);for(const t of e){const r=n.tree[t];switch(r.type){case th.Tree:{n.tree[t]=VN(r);break}case th.Blob:{r.content=typeof r.content=="string"?r.content:Pv(r.content,"utf8");break}case th.Handle:throw new Error("No handle should be present for first summary!!");default:throw new Error(`Unknown tree type ${r.type}`)}}return n}var Ote=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0},RE={},Fte=Object.prototype.hasOwnProperty,Nte;function D_(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch{return null}}function L_(n){try{return encodeURIComponent(n)}catch{return null}}function Dte(n){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},r;r=e.exec(n);){var i=D_(r[1]),s=D_(r[2]);i===null||s===null||i in t||(t[i]=s)}return t}function Lte(n,e){e=e||"";var t=[],r,i;typeof e!="string"&&(e="?");for(i in n)if(Fte.call(n,i)){if(r=n[i],!r&&(r===null||r===Nte||isNaN(r))&&(r=""),i=L_(i),r=L_(r),i===null||r===null)continue;t.push(i+"="+r)}return t.length?e+t.join("&"):""}RE.stringify=Lte;RE.parse=Dte;var WN=Ote,Fv=RE,Mte=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,GN=/[\n\r\t]/g,Bte=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,KN=/:\d+$/,jte=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,qte=/^[a-zA-Z]:/;function _E(n){return(n||"").toString().replace(Mte,"")}var Dw=[["#","hash"],["?","query"],function(e,t){return Fs(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],M_={hash:1,query:1};function JN(n){var e;typeof window<"u"?e=window:typeof Ne<"u"?e=Ne:typeof self<"u"?e=self:e={};var t=e.location||{};n=n||t;var r={},i=typeof n,s;if(n.protocol==="blob:")r=new Ls(unescape(n.pathname),{});else if(i==="string"){r=new Ls(n,{});for(s in M_)delete r[s]}else if(i==="object"){for(s in n)s in M_||(r[s]=n[s]);r.slashes===void 0&&(r.slashes=Bte.test(n.href))}return r}function Fs(n){return n==="file:"||n==="ftp:"||n==="http:"||n==="https:"||n==="ws:"||n==="wss:"}function QN(n,e){n=_E(n),n=n.replace(GN,""),e=e||{};var t=jte.exec(n),r=t[1]?t[1].toLowerCase():"",i=!!t[2],s=!!t[3],o=0,u;return i?s?(u=t[2]+t[3]+t[4],o=t[2].length+t[3].length):(u=t[2]+t[4],o=t[2].length):s?(u=t[3]+t[4],o=t[3].length):u=t[4],r==="file:"?o>=2&&(u=u.slice(2)):Fs(r)?u=t[4]:r?i&&(u=u.slice(2)):o>=2&&Fs(e.protocol)&&(u=t[4]),{protocol:r,slashes:i||Fs(r),slashesCount:o,rest:u}}function Ute(n,e){if(n==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(n.split("/")),r=t.length,i=t[r-1],s=!1,o=0;r--;)t[r]==="."?t.splice(r,1):t[r]===".."?(t.splice(r,1),o++):o&&(r===0&&(s=!0),t.splice(r,1),o--);return s&&t.unshift(""),(i==="."||i==="..")&&t.push(""),t.join("/")}function Ls(n,e,t){if(n=_E(n),n=n.replace(GN,""),!(this instanceof Ls))return new Ls(n,e,t);var r,i,s,o,u,d,f=Dw.slice(),m=typeof e,g=this,P=0;for(m!=="object"&&m!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=Fv.parse),e=JN(e),i=QN(n||"",e),r=!i.protocol&&!i.slashes,g.slashes=i.slashes||r&&e.slashes,g.protocol=i.protocol||e.protocol||"",n=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||qte.test(n))||!i.slashes&&(i.protocol||i.slashesCount<2||!Fs(g.protocol)))&&(f[3]=[/(.*)/,"pathname"]);P<f.length;P++){if(o=f[P],typeof o=="function"){n=o(n,g);continue}s=o[0],d=o[1],s!==s?g[d]=n:typeof s=="string"?(u=s==="@"?n.lastIndexOf(s):n.indexOf(s),~u&&(typeof o[2]=="number"?(g[d]=n.slice(0,u),n=n.slice(u+o[2])):(g[d]=n.slice(u),n=n.slice(0,u)))):(u=s.exec(n))&&(g[d]=u[1],n=n.slice(0,u.index)),g[d]=g[d]||r&&o[3]&&e[d]||"",o[4]&&(g[d]=g[d].toLowerCase())}t&&(g.query=t(g.query)),r&&e.slashes&&g.pathname.charAt(0)!=="/"&&(g.pathname!==""||e.pathname!=="")&&(g.pathname=Ute(g.pathname,e.pathname)),g.pathname.charAt(0)!=="/"&&Fs(g.protocol)&&(g.pathname="/"+g.pathname),WN(g.port,g.protocol)||(g.host=g.hostname,g.port=""),g.username=g.password="",g.auth&&(u=g.auth.indexOf(":"),~u?(g.username=g.auth.slice(0,u),g.username=encodeURIComponent(decodeURIComponent(g.username)),g.password=g.auth.slice(u+1),g.password=encodeURIComponent(decodeURIComponent(g.password))):g.username=encodeURIComponent(decodeURIComponent(g.auth)),g.auth=g.password?g.username+":"+g.password:g.username),g.origin=g.protocol!=="file:"&&Fs(g.protocol)&&g.host?g.protocol+"//"+g.host:"null",g.href=g.toString()}function zte(n,e,t){var r=this;switch(n){case"query":typeof e=="string"&&e.length&&(e=(t||Fv.parse)(e)),r[n]=e;break;case"port":r[n]=e,WN(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[n]="");break;case"hostname":r[n]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[n]=e,KN.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!t;break;case"pathname":case"hash":if(e){var i=n==="pathname"?"/":"#";r[n]=e.charAt(0)!==i?i+e:e}else r[n]=e;break;case"username":case"password":r[n]=encodeURIComponent(e);break;case"auth":var s=e.indexOf(":");~s?(r.username=e.slice(0,s),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=e.slice(s+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(e))}for(var o=0;o<Dw.length;o++){var u=Dw[o];u[4]&&(r[u[1]]=r[u[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&Fs(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function $te(n){(!n||typeof n!="function")&&(n=Fv.stringify);var e,t=this,r=t.host,i=t.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var s=i+(t.protocol&&t.slashes||Fs(t.protocol)?"//":"");return t.username?(s+=t.username,t.password&&(s+=":"+t.password),s+="@"):t.password?(s+=":"+t.password,s+="@"):t.protocol!=="file:"&&Fs(t.protocol)&&!r&&t.pathname!=="/"&&(s+="@"),(r[r.length-1]===":"||KN.test(t.hostname)&&!t.port)&&(r+=":"),s+=r+t.pathname,e=typeof t.query=="object"?n(t.query):t.query,e&&(s+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(s+=t.hash),s}Ls.prototype={set:zte,toString:$te};Ls.extractProtocol=QN;Ls.location=JN;Ls.trimLeft=_E;Ls.qs=Fv;var Hte=Ls;const dl=Ms(Hte);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const am=n=>new dl(n,!0),B_=(n,e)=>n.split("/").slice(0,-1).concat([e]).join("/"),j_=(n,e)=>{if(e){const t=new dl(e.ordererUrl),r=new dl(n.endpoints.deltaStorageUrl);r.set("host",t.host);const i=new dl(e.historianUrl),s=new dl(n.endpoints.storageUrl);s.set("host",i.host);const o=am(n.url);return{endpoints:{deltaStorageUrl:r.toString(),ordererUrl:e.ordererUrl,storageUrl:s.toString()},id:n.id,tokens:n.tokens,type:n.type,url:new dl(`fluid://${t.host}${o.pathname}`).toString()}}else return n};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Vte={enablePrefetch:!0,maxConcurrentStorageRequests:100,maxConcurrentOrdererRequests:100,aggregateBlobsSmallerThanBytes:void 0,enableDiscovery:!1,enableWholeSummaryUpload:!1,enableRestLess:!0};class Wte{constructor(e,t={}){this.tokenProvider=e,this.protocolName="fluid:",this.blobCache=new uc,this.snapshotTreeCache=new uc,this.driverPolicies=Object.assign(Object.assign({},Vte),t)}async createContainer(e,t,r,i){if(Ns(t),e===void 0)throw new Error("Empty file summary creation isn't supported in this driver.");Oh(!!t.endpoints.ordererUrl,178);let s=am(t.url);if(!s.pathname)throw new Error("Parsed url should contain tenant and doc Id!!");const[,o]=s.pathname.split("/"),u=e.tree[".protocol"],d=e.tree[".app"];if(!(u&&d))throw new Error("Protocol and App Summary required in the full summary");const f=EV(u),m=TV(u),g=at.create(r,"RouterliciousDriver"),P=new Vm(this.driverPolicies.maxConcurrentOrdererRequests),M=await(await Fh.load(o,void 0,this.tokenProvider,g,P,this.driverPolicies.enableRestLess,t.endpoints.ordererUrl)).post(`/documents/${o}`,{summary:VN(d),sequenceNumber:f.sequenceNumber,values:m,enableDiscovery:this.driverPolicies.enableDiscovery,generateToken:this.tokenProvider.documentPostCreateCallback!==void 0});let U,j,E;if(typeof M=="string"?U=M:(U=M.id,j=M.token,E=this.driverPolicies.enableDiscovery?M.session:void 0),s=am(t.url),j&&this.tokenProvider.documentPostCreateCallback!==void 0)try{await this.tokenProvider.documentPostCreateCallback(U,j)}catch(K){throw new Gte(K)}s.set("pathname",B_(s.pathname,U));const k=t.endpoints.deltaStorageUrl;if(!k)throw new Error(`All endpoints urls must be provided. [deltaStorageUrl:${k}]`);const z=new URL(k);return z.pathname=B_(z.pathname,U),this.createDocumentService(Object.assign(Object.assign({},t),{url:s.toString(),id:U,endpoints:Object.assign(Object.assign({},t.endpoints),{deltaStorageUrl:z.toString()})}),r,i,E)}async createDocumentService(e,t,r,i){Ns(e);const s=am(e.url),[,o,u]=s.pathname.split("/");if(!u||!o)throw new Error(`Couldn't parse documentId and/or tenantId. [documentId:${u}][tenantId:${o}]`);const d=at.create(t,"RouterliciousDriver",{all:{driverVersion:Ov}}),f=async()=>{if(!this.driverPolicies.enableDiscovery)return e;const M=new Vm(this.driverPolicies.maxConcurrentOrdererRequests),j=await(await Fh.load(o,u,this.tokenProvider,d,M,this.driverPolicies.enableRestLess,e.endpoints.ordererUrl)).get(`/documents/${o}/session/${u}`);return j_(e,j)},m=i!==void 0?j_(e,i):await f(),g=m.endpoints.storageUrl,P=m.endpoints.ordererUrl,D=m.endpoints.deltaStorageUrl;if(!P||!D)throw new Error(`All endpoints urls must be provided. [ordererUrl:${P}][deltaStorageUrl:${D}]`);return new kte(m,P,D,g,d,this.tokenProvider,o,u,this.driverPolicies,this.blobCache,this.snapshotTreeCache,f)}}class Gte extends Error{constructor(e){super(e.message),this.innerError=e,this.name="DocumentPostCreateError"}get stack(){return this.innerError.stack}}class Kte{constructor(){}async resolve(e){const{ordererUrl:t,storageUrl:r,tenantId:i,containerId:s}=Jte(e.url);if(e.headers&&e.headers[nc.createNew]===!0)return{endpoints:{deltaStorageUrl:`${t}/deltas/${i}/new`,ordererUrl:t,storageUrl:`${r}/repos/${i}`},id:"",tokens:{},type:"fluid",url:`${t}/${i}/new`};if(s===void 0)throw new Error("Azure URL did not contain containerId");const o=`${t}/${i}/${s}`;return{endpoints:{deltaStorageUrl:`${t}/deltas/${i}/${s}`,ordererUrl:t,storageUrl:`${r}/repos/${i}`},id:s,tokens:{},type:"fluid",url:o}}async getAbsoluteUrl(e,t){if(e.type!=="fluid")throw new Error("Invalid Resolved Url");return`${e.url}/${t}`}}function Jte(n){const e=new URL(n),t=e.origin,r=e.searchParams,i=r.get("storage");if(i===null)throw new Error("Azure URL did not contain a storage URL");const s=r.get("tenantId");if(s===null)throw new Error("Azure URL did not contain a tenant ID");const o=decodeURIComponent(i),u=decodeURIComponent(s),d=r.get("containerId"),f=d!==null?decodeURIComponent(d):void 0;return{ordererUrl:t,storageUrl:o,tenantId:u,containerId:f}}const Qte=(n,e)=>{const t=new URL(n);return t.searchParams.append("storage",encodeURIComponent(n)),t.searchParams.append("tenantId",encodeURIComponent(e)),{url:t.href,headers:{[nc.createNew]:!0}}};function XN(n){return n.type==="remote"}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Xte="local",Bp=n=>XN(n)?n.tenantId:Xte,Yte=5;class Zte{constructor(e){this.props=e,e.connection.endpoint=e.connection.endpoint.replace(/\/$/,""),this.urlResolver=new Kte;const t=XN(this.props.connection);this.documentServiceFactory=new Wte(this.props.connection.tokenProvider,{enableWholeSummaryUpload:t,enableDiscovery:t})}async createContainer(e){const r=await this.createLoader(e).createDetachedContainer({package:"no-dynamic-package",config:{}}),i=await this.createFluidContainer(r,this.props.connection),s=this.getContainerServices(r);return{container:i,services:s}}async copyContainer(e,t,r){var i;const s=this.createLoader(t),o=new URL(this.props.connection.endpoint);o.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),o.searchParams.append("tenantId",encodeURIComponent(Bp(this.props.connection))),o.searchParams.append("containerId",encodeURIComponent(e));const u=await s.resolve({url:o.href});if(u.resolvedUrl===void 0)throw new Error("Source container cannot resolve URL.");const f=await(await this.documentServiceFactory.createDocumentService(u.resolvedUrl)).connectToStorage(),m={type:rg.Handle,handleType:rg.Tree,handle:(i=r==null?void 0:r.id)!==null&&i!==void 0?i:"latest"},g=await f.downloadSummary(m),P=await s.rehydrateDetachedContainerFromSnapshot(JSON.stringify(g)),D=await this.createFluidContainer(P,this.props.connection),M=this.getContainerServices(P);return{container:D,services:M}}async getContainer(e,t){const r=this.createLoader(t),i=new URL(this.props.connection.endpoint);i.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(Bp(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(e));const s=await r.resolve({url:i.href}),o=await ic(s,"/"),u=new Wb(s,o),d=this.getContainerServices(s);return{container:u,services:d}}async getContainerVersions(e,t){var r;const i=new URL(this.props.connection.endpoint);i.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(Bp(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(e));const s=await this.urlResolver.resolve({url:i.href});if(!s)throw new Error("Unable to resolved URL");return(await(await(await this.documentServiceFactory.createDocumentService(s)).connectToStorage()).getVersions(null,(r=t==null?void 0:t.maxCount)!==null&&r!==void 0?r:Yte)).map(f=>({id:f.id,date:f.date}))}getContainerServices(e){return{audience:new uN(e)}}createLoader(e){const t=new o3(e),i={load:async()=>({module:{fluidExport:t},details:{package:"no-dynamic-package",config:{}}})};return new JV({urlResolver:this.urlResolver,documentServiceFactory:this.documentServiceFactory,codeLoader:i,logger:this.props.logger})}async createFluidContainer(e,t){const r=Qte(t.endpoint,Bp(t)),i=await ic(e,"/"),s=async()=>{if(e.attachState!==Qe.Detached)throw new Error("Cannot attach container. Container is not in detached state");await e.attach(r);const u=e.resolvedUrl;return Ns(u),u.id},o=new Wb(e,i);return o.attach=s,o}}var IE={exports:{}},YN=function(e,t){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return e.apply(t,i)}},ene=YN,Du=Object.prototype.toString;function AE(n){return Du.call(n)==="[object Array]"}function Lw(n){return typeof n>"u"}function tne(n){return n!==null&&!Lw(n)&&n.constructor!==null&&!Lw(n.constructor)&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function nne(n){return Du.call(n)==="[object ArrayBuffer]"}function rne(n){return typeof FormData<"u"&&n instanceof FormData}function ine(n){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&n.buffer instanceof ArrayBuffer,e}function sne(n){return typeof n=="string"}function one(n){return typeof n=="number"}function ZN(n){return n!==null&&typeof n=="object"}function um(n){if(Du.call(n)!=="[object Object]")return!1;var e=Object.getPrototypeOf(n);return e===null||e===Object.prototype}function ane(n){return Du.call(n)==="[object Date]"}function une(n){return Du.call(n)==="[object File]"}function lne(n){return Du.call(n)==="[object Blob]"}function eD(n){return Du.call(n)==="[object Function]"}function cne(n){return ZN(n)&&eD(n.pipe)}function dne(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}function hne(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")}function fne(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function kE(n,e){if(!(n===null||typeof n>"u"))if(typeof n!="object"&&(n=[n]),AE(n))for(var t=0,r=n.length;t<r;t++)e.call(null,n[t],t,n);else for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.call(null,n[i],i,n)}function Mw(){var n={};function e(i,s){um(n[s])&&um(i)?n[s]=Mw(n[s],i):um(i)?n[s]=Mw({},i):AE(i)?n[s]=i.slice():n[s]=i}for(var t=0,r=arguments.length;t<r;t++)kE(arguments[t],e);return n}function pne(n,e,t){return kE(e,function(i,s){t&&typeof i=="function"?n[s]=ene(i,t):n[s]=i}),n}function mne(n){return n.charCodeAt(0)===65279&&(n=n.slice(1)),n}var Si={isArray:AE,isArrayBuffer:nne,isBuffer:tne,isFormData:rne,isArrayBufferView:ine,isString:sne,isNumber:one,isObject:ZN,isPlainObject:um,isUndefined:Lw,isDate:ane,isFile:une,isBlob:lne,isFunction:eD,isStream:cne,isURLSearchParams:dne,isStandardBrowserEnv:fne,forEach:kE,merge:Mw,extend:pne,trim:hne,stripBOM:mne},sl=Si;function q_(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var tD=function(e,t,r){if(!t)return e;var i;if(r)i=r(t);else if(sl.isURLSearchParams(t))i=t.toString();else{var s=[];sl.forEach(t,function(d,f){d===null||typeof d>"u"||(sl.isArray(d)?f=f+"[]":d=[d],sl.forEach(d,function(g){sl.isDate(g)?g=g.toISOString():sl.isObject(g)&&(g=JSON.stringify(g)),s.push(q_(f)+"="+q_(g))}))}),i=s.join("&")}if(i){var o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e},gne=Si;function Nv(){this.handlers=[]}Nv.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1};Nv.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};Nv.prototype.forEach=function(e){gne.forEach(this.handlers,function(r){r!==null&&e(r)})};var vne=Nv,yne=Si,Sne=function(e,t){yne.forEach(e,function(i,s){s!==t&&s.toUpperCase()===t.toUpperCase()&&(e[t]=i,delete e[s])})},nD=function(e,t,r,i,s){return e.config=t,r&&(e.code=r),e.request=i,e.response=s,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e},e1,U_;function rD(){if(U_)return e1;U_=1;var n=nD;return e1=function(t,r,i,s,o){var u=new Error(t);return n(u,r,i,s,o)},e1}var t1,z_;function bne(){if(z_)return t1;z_=1;var n=rD();return t1=function(t,r,i){var s=i.config.validateStatus;!i.status||!s||s(i.status)?t(i):r(n("Request failed with status code "+i.status,i.config,null,i.request,i))},t1}var n1,$_;function wne(){if($_)return n1;$_=1;var n=Si;return n1=n.isStandardBrowserEnv()?function(){return{write:function(r,i,s,o,u,d){var f=[];f.push(r+"="+encodeURIComponent(i)),n.isNumber(s)&&f.push("expires="+new Date(s).toGMTString()),n.isString(o)&&f.push("path="+o),n.isString(u)&&f.push("domain="+u),d===!0&&f.push("secure"),document.cookie=f.join("; ")},read:function(r){var i=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),n1}var r1,H_;function Cne(){return H_||(H_=1,r1=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}),r1}var i1,V_;function xne(){return V_||(V_=1,i1=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}),i1}var s1,W_;function Ene(){if(W_)return s1;W_=1;var n=Cne(),e=xne();return s1=function(r,i){return r&&!n(i)?e(r,i):i},s1}var o1,G_;function Tne(){if(G_)return o1;G_=1;var n=Si,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return o1=function(r){var i={},s,o,u;return r&&n.forEach(r.split(`
`),function(f){if(u=f.indexOf(":"),s=n.trim(f.substr(0,u)).toLowerCase(),o=n.trim(f.substr(u+1)),s){if(i[s]&&e.indexOf(s)>=0)return;s==="set-cookie"?i[s]=(i[s]?i[s]:[]).concat([o]):i[s]=i[s]?i[s]+", "+o:o}}),i},o1}var a1,K_;function Pne(){if(K_)return a1;K_=1;var n=Si;return a1=n.isStandardBrowserEnv()?function(){var t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),i;function s(o){var u=o;return t&&(r.setAttribute("href",u),u=r.href),r.setAttribute("href",u),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return i=s(window.location.href),function(u){var d=n.isString(u)?s(u):u;return d.protocol===i.protocol&&d.host===i.host}}():function(){return function(){return!0}}(),a1}var u1,J_;function Q_(){if(J_)return u1;J_=1;var n=Si,e=bne(),t=wne(),r=tD,i=Ene(),s=Tne(),o=Pne(),u=rD();return u1=function(f){return new Promise(function(g,P){var D=f.data,M=f.headers,U=f.responseType;n.isFormData(D)&&delete M["Content-Type"];var j=new XMLHttpRequest;if(f.auth){var E=f.auth.username||"",k=f.auth.password?unescape(encodeURIComponent(f.auth.password)):"";M.Authorization="Basic "+btoa(E+":"+k)}var z=i(f.baseURL,f.url);j.open(f.method.toUpperCase(),r(z,f.params,f.paramsSerializer),!0),j.timeout=f.timeout;function K(){if(j){var he="getAllResponseHeaders"in j?s(j.getAllResponseHeaders()):null,pe=!U||U==="text"||U==="json"?j.responseText:j.response,X={data:pe,status:j.status,statusText:j.statusText,headers:he,config:f,request:j};e(g,P,X),j=null}}if("onloadend"in j?j.onloadend=K:j.onreadystatechange=function(){!j||j.readyState!==4||j.status===0&&!(j.responseURL&&j.responseURL.indexOf("file:")===0)||setTimeout(K)},j.onabort=function(){j&&(P(u("Request aborted",f,"ECONNABORTED",j)),j=null)},j.onerror=function(){P(u("Network Error",f,null,j)),j=null},j.ontimeout=function(){var pe="timeout of "+f.timeout+"ms exceeded";f.timeoutErrorMessage&&(pe=f.timeoutErrorMessage),P(u(pe,f,f.transitional&&f.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",j)),j=null},n.isStandardBrowserEnv()){var ie=(f.withCredentials||o(z))&&f.xsrfCookieName?t.read(f.xsrfCookieName):void 0;ie&&(M[f.xsrfHeaderName]=ie)}"setRequestHeader"in j&&n.forEach(M,function(pe,X){typeof D>"u"&&X.toLowerCase()==="content-type"?delete M[X]:j.setRequestHeader(X,pe)}),n.isUndefined(f.withCredentials)||(j.withCredentials=!!f.withCredentials),U&&U!=="json"&&(j.responseType=f.responseType),typeof f.onDownloadProgress=="function"&&j.addEventListener("progress",f.onDownloadProgress),typeof f.onUploadProgress=="function"&&j.upload&&j.upload.addEventListener("progress",f.onUploadProgress),f.cancelToken&&f.cancelToken.promise.then(function(pe){j&&(j.abort(),P(pe),j=null)}),D||(D=null),j.send(D)})},u1}var Qn=Si,X_=Sne,Rne=nD,_ne={"Content-Type":"application/x-www-form-urlencoded"};function Y_(n,e){!Qn.isUndefined(n)&&Qn.isUndefined(n["Content-Type"])&&(n["Content-Type"]=e)}function Ine(){var n;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(n=Q_()),n}function Ane(n,e,t){if(Qn.isString(n))try{return(e||JSON.parse)(n),Qn.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}var Dv={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:Ine(),transformRequest:[function(e,t){return X_(t,"Accept"),X_(t,"Content-Type"),Qn.isFormData(e)||Qn.isArrayBuffer(e)||Qn.isBuffer(e)||Qn.isStream(e)||Qn.isFile(e)||Qn.isBlob(e)?e:Qn.isArrayBufferView(e)?e.buffer:Qn.isURLSearchParams(e)?(Y_(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):Qn.isObject(e)||t&&t["Content-Type"]==="application/json"?(Y_(t,"application/json"),Ane(e)):e}],transformResponse:[function(e){var t=this.transitional,r=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,s=!r&&this.responseType==="json";if(s||i&&Qn.isString(e)&&e.length)try{return JSON.parse(e)}catch(o){if(s)throw o.name==="SyntaxError"?Rne(o,this,"E_JSON_PARSE"):o}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300}};Dv.headers={common:{Accept:"application/json, text/plain, */*"}};Qn.forEach(["delete","get","head"],function(e){Dv.headers[e]={}});Qn.forEach(["post","put","patch"],function(e){Dv.headers[e]=Qn.merge(_ne)});var OE=Dv,kne=Si,One=OE,Fne=function(e,t,r){var i=this||One;return kne.forEach(r,function(o){e=o.call(i,e,t)}),e},l1,Z_;function iD(){return Z_||(Z_=1,l1=function(e){return!!(e&&e.__CANCEL__)}),l1}var eI=Si,c1=Fne,Nne=iD(),Dne=OE;function d1(n){n.cancelToken&&n.cancelToken.throwIfRequested()}var Lne=function(e){d1(e),e.headers=e.headers||{},e.data=c1.call(e,e.data,e.headers,e.transformRequest),e.headers=eI.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),eI.forEach(["delete","get","head","post","put","patch","common"],function(i){delete e.headers[i]});var t=e.adapter||Dne.adapter;return t(e).then(function(i){return d1(e),i.data=c1.call(e,i.data,i.headers,e.transformResponse),i},function(i){return Nne(i)||(d1(e),i&&i.response&&(i.response.data=c1.call(e,i.response.data,i.response.headers,e.transformResponse))),Promise.reject(i)})},mr=Si,sD=function(e,t){t=t||{};var r={},i=["url","method","data"],s=["headers","auth","proxy","params"],o=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],u=["validateStatus"];function d(P,D){return mr.isPlainObject(P)&&mr.isPlainObject(D)?mr.merge(P,D):mr.isPlainObject(D)?mr.merge({},D):mr.isArray(D)?D.slice():D}function f(P){mr.isUndefined(t[P])?mr.isUndefined(e[P])||(r[P]=d(void 0,e[P])):r[P]=d(e[P],t[P])}mr.forEach(i,function(D){mr.isUndefined(t[D])||(r[D]=d(void 0,t[D]))}),mr.forEach(s,f),mr.forEach(o,function(D){mr.isUndefined(t[D])?mr.isUndefined(e[D])||(r[D]=d(void 0,e[D])):r[D]=d(void 0,t[D])}),mr.forEach(u,function(D){D in t?r[D]=d(e[D],t[D]):D in e&&(r[D]=d(void 0,e[D]))});var m=i.concat(s).concat(o).concat(u),g=Object.keys(e).concat(Object.keys(t)).filter(function(D){return m.indexOf(D)===-1});return mr.forEach(g,f),r};const Mne="axios@^0.21.2",Bne="axios@0.21.4",jne=!1,qne="sha512-ut5vewkiu8jjGBdqpM44XxjuCjq9LAKeHVmoVfHVzy8eHgxxq8SbAVQNovDA8mVi05kP0Ea/n/UzcSHcTJQfNg==",Une="/axios",zne={},$ne={type:"range",registry:!0,raw:"axios@^0.21.2",name:"axios",escapedName:"axios",rawSpec:"^0.21.2",saveSpec:null,fetchSpec:"^0.21.2"},Hne=["/@fluidframework/azure-client"],Vne="https://registry.npmmirror.com/axios/-/axios-0.21.4.tgz",Wne="c67b90dc0568e5c1cf2b0b858c43ba28e2eda575",Gne="axios@^0.21.2",Kne="F:\\workspace\\live-share-sdk-main\\samples\\javascript\\23.react-live-canvas\\node_modules\\@fluidframework\\azure-client",Jne={name:"Matt Zabriskie"},Qne={"./lib/adapters/http.js":"./lib/adapters/xhr.js"},Xne={url:"https://github.com/axios/axios/issues"},Yne=!1,Zne=[{path:"./dist/axios.min.js",threshold:"5kB"}],ere={"follow-redirects":"^1.14.0"},tre=!1,nre="Promise based HTTP client for the browser and node.js",rre={coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},ire="https://axios-http.com",sre="dist/axios.min.js",ore=["xhr","http","ajax","promise","node"],are="MIT",ure="index.js",lre="axios",cre={type:"git",url:"git+https://github.com/axios/axios.git"},dre={build:"NODE_ENV=production grunt build",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",examples:"node ./examples/server.js",fix:"eslint --fix lib/**/*.js",postversion:"git push && git push --tags",preversion:"npm test",start:"node ./sandbox/server.js",test:"grunt test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json"},hre="./index.d.ts",fre="dist/axios.min.js",pre="0.21.4",mre={_from:Mne,_id:Bne,_inBundle:jne,_integrity:qne,_location:Une,_phantomChildren:zne,_requested:$ne,_requiredBy:Hne,_resolved:Vne,_shasum:Wne,_spec:Gne,_where:Kne,author:Jne,browser:Qne,bugs:Xne,bundleDependencies:Yne,bundlesize:Zne,dependencies:ere,deprecated:tre,description:nre,devDependencies:rre,homepage:ire,jsdelivr:sre,keywords:ore,license:are,main:ure,name:lre,repository:cre,scripts:dre,typings:hre,unpkg:fre,version:pre};var oD=mre,FE={};["object","boolean","number","function","string","symbol"].forEach(function(n,e){FE[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});var tI={},gre=oD.version.split(".");function aD(n,e){for(var t=e?e.split("."):gre,r=n.split("."),i=0;i<3;i++){if(t[i]>r[i])return!0;if(t[i]<r[i])return!1}return!1}FE.transitional=function(e,t,r){var i=t&&aD(t);function s(o,u){return"[Axios v"+oD.version+"] Transitional option '"+o+"'"+u+(r?". "+r:"")}return function(o,u,d){if(e===!1)throw new Error(s(u," has been removed in "+t));return i&&!tI[u]&&(tI[u]=!0,console.warn(s(u," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,u,d):!0}};function vre(n,e,t){if(typeof n!="object")throw new TypeError("options must be an object");for(var r=Object.keys(n),i=r.length;i-- >0;){var s=r[i],o=e[s];if(o){var u=n[s],d=u===void 0||o(u,s,n);if(d!==!0)throw new TypeError("option "+s+" must be "+d);continue}if(t!==!0)throw Error("Unknown option "+s)}}var yre={isOlderVersion:aD,assertOptions:vre,validators:FE},uD=Si,Sre=tD,nI=vne,rI=Lne,Lv=sD,lD=yre,ol=lD.validators;function df(n){this.defaults=n,this.interceptors={request:new nI,response:new nI}}df.prototype.request=function(e){typeof e=="string"?(e=arguments[1]||{},e.url=arguments[0]):e=e||{},e=Lv(this.defaults,e),e.method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;t!==void 0&&lD.assertOptions(t,{silentJSONParsing:ol.transitional(ol.boolean,"1.0.0"),forcedJSONParsing:ol.transitional(ol.boolean,"1.0.0"),clarifyTimeoutError:ol.transitional(ol.boolean,"1.0.0")},!1);var r=[],i=!0;this.interceptors.request.forEach(function(P){typeof P.runWhen=="function"&&P.runWhen(e)===!1||(i=i&&P.synchronous,r.unshift(P.fulfilled,P.rejected))});var s=[];this.interceptors.response.forEach(function(P){s.push(P.fulfilled,P.rejected)});var o;if(!i){var u=[rI,void 0];for(Array.prototype.unshift.apply(u,r),u=u.concat(s),o=Promise.resolve(e);u.length;)o=o.then(u.shift(),u.shift());return o}for(var d=e;r.length;){var f=r.shift(),m=r.shift();try{d=f(d)}catch(g){m(g);break}}try{o=rI(d)}catch(g){return Promise.reject(g)}for(;s.length;)o=o.then(s.shift(),s.shift());return o};df.prototype.getUri=function(e){return e=Lv(this.defaults,e),Sre(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")};uD.forEach(["delete","get","head","options"],function(e){df.prototype[e]=function(t,r){return this.request(Lv(r||{},{method:e,url:t,data:(r||{}).data}))}});uD.forEach(["post","put","patch"],function(e){df.prototype[e]=function(t,r,i){return this.request(Lv(i||{},{method:e,url:t,data:r}))}});var bre=df,h1,iI;function cD(){if(iI)return h1;iI=1;function n(e){this.message=e}return n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,h1=n,h1}var f1,sI;function wre(){if(sI)return f1;sI=1;var n=cD();function e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var r;this.promise=new Promise(function(o){r=o});var i=this;t(function(o){i.reason||(i.reason=new n(o),r(i.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.source=function(){var r,i=new e(function(o){r=o});return{token:i,cancel:r}},f1=e,f1}var p1,oI;function Cre(){return oI||(oI=1,p1=function(e){return function(r){return e.apply(null,r)}}),p1}var m1,aI;function xre(){return aI||(aI=1,m1=function(e){return typeof e=="object"&&e.isAxiosError===!0}),m1}var uI=Si,Ere=YN,lm=bre,Tre=sD,Pre=OE;function dD(n){var e=new lm(n),t=Ere(lm.prototype.request,e);return uI.extend(t,lm.prototype,e),uI.extend(t,e),t}var is=dD(Pre);is.Axios=lm;is.create=function(e){return dD(Tre(is.defaults,e))};is.Cancel=cD();is.CancelToken=wre();is.isCancel=iD();is.all=function(e){return Promise.all(e)};is.spread=Cre();is.isAxiosError=xre();IE.exports=is;IE.exports.default=is;var Rre=IE.exports,_re=Rre;const Ire=Ms(_re);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Are{constructor(e,t){this.azFunctionUrl=e,this.user=t}async fetchOrdererToken(e,t){return{jwt:await this.getToken(e,t)}}async fetchStorageToken(e,t){return{jwt:await this.getToken(e,t)}}async getToken(e,t){var r,i,s;return(await Ire.get(this.azFunctionUrl,{params:{tenantId:e,documentId:t,userId:(r=this.user)===null||r===void 0?void 0:r.userId,userName:(i=this.user)===null||i===void 0?void 0:i.userName,additionalDetails:(s=this.user)===null||s===void 0?void 0:s.additionalDetails}})).data}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const kre=Object.freeze(Object.defineProperty({__proto__:null,AzureAudience:uN,AzureClient:Zte,AzureFunctionTokenProvider:Are,get ScopeType(){return bw}},Symbol.toStringTag,{value:"Module"})),Ore=Li(kre);var hf={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(hf,"__esModule",{value:!0});hf.LocalTimestampProvider=void 0;class $l{constructor(e=!1){this._lastTimeSent=0,e&&($l._warned=!0)}getTimestamp(){return $l._warned||(console.warn("LiveEvent is using a LocalTimestampProvider which could cause issues when used across multiple clients."),$l._warned=!0),this._lastTimeSent=Math.max(new Date().getTime(),this._lastTimeSent+1)}getMaxTimestampError(){return 0}}$l._warned=!1;hf.LocalTimestampProvider=$l;var ff={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var lI=Ne&&Ne.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(m){try{f(r.next(m))}catch(g){o(g)}}function d(m){try{f(r.throw(m))}catch(g){o(g)}}function f(m){m.done?s(m.value):i(m.value).then(u,d)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(ff,"__esModule",{value:!0});ff.TestLiveShareHost=void 0;const Vs=wc;class eo{static create(e,t){return new eo(e,t)}constructor(e,t){this._getLocalTestContainerId=e,this._setLocalTestContainerId=t,this.roleCache=new Map,this.defaultRemoteRoles=[Vs.UserMeetingRole.organizer,Vs.UserMeetingRole.presenter,Vs.UserMeetingRole.attendee],this.defaultLocalRoles=[Vs.UserMeetingRole.organizer,Vs.UserMeetingRole.presenter,Vs.UserMeetingRole.attendee]}getFluidTenantInfo(){return eo.ensureWarned(),Promise.resolve({tenantId:"local",serviceEndpoint:"http://localhost:7070"})}getFluidToken(e){return Promise.resolve(eo.LOCAL_MODE_TEST_TOKEN)}getFluidContainerId(){const e=this.getLocalTestContainerId();return Promise.resolve({containerState:e?Vs.ContainerState.alreadyExists:Vs.ContainerState.notFound,shouldCreate:!e,containerId:e,retryAfter:0})}setFluidContainerId(e){return this.setLocalTestContainerId(e),Promise.resolve({containerState:Vs.ContainerState.added,containerId:e,shouldCreate:!1,retryAfter:0})}getNtpTime(){const e=new Date;return Promise.resolve({ntpTime:e.toUTCString(),ntpTimeInUTC:e.getTime()})}registerClientId(e){if(this.roleCache.has(e))throw new Error("Already registered clientId");return this.addClient(e,this.defaultLocalRoles),Promise.resolve(this.defaultLocalRoles)}addClient(e,t){return this.roleCache.set(e,t),this}getClientInfo(e){return lI(this,void 0,void 0,function*(){const t={userId:e,roles:yield this.getClientRoles(e),displayName:e.substring(0,4)};return Promise.resolve(t)})}getClientRoles(e){return lI(this,void 0,void 0,function*(){if(!e)throw new Error("TestLiveShareHost: called getClientRoles() without a clientId");let t;return this.roleCache.has(e)?t=this.roleCache.get(e):t=this.defaultRemoteRoles,Promise.resolve(t)})}getLocalTestContainerId(){return this._getLocalTestContainerId?this._getLocalTestContainerId():window.location.hash?window.location.hash.substring(1):void 0}setLocalTestContainerId(e){this._setLocalTestContainerId?this._setLocalTestContainerId(e):window.location.hash=e}static ensureWarned(){eo._warned||(console.warn("TestLiveShareHost is being used. This should only be used for local testing purposes."),eo._warned=!0)}}eo.LOCAL_MODE_TEST_TOKEN="test-token";eo._warned=!1;ff.TestLiveShareHost=eo;var pf={},Fre=Ne&&Ne.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(m){try{f(r.next(m))}catch(g){o(g)}}function d(m){try{f(r.throw(m))}catch(g){o(g)}}function f(m){m.done?s(m.value):i(m.value).then(u,d)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(pf,"__esModule",{value:!0});pf.LiveShareRuntime=void 0;const Nre=sf,g1=nf,gs=ss();class Dre{constructor(e,t,r,i=!0){this._started=!1,this._objectManager=null,this._host=i?new gs.BackwardsCompatibilityHostDecorator(new gs.LiveShareHostDecorator(e)):e,this._timestampProvider=t||new g1.HostTimestampProvider(this._host),this._roleVerifier=r||new gs.RoleVerifier(this._host)}get objectManager(){return(0,Nre.assert)(this._objectManager!==null,"LiveObjectSynchronizerManager not initialized."),this._objectManager}get timestampProvider(){return this._timestampProvider}get host(){return this._host}getTimestamp(){return this._timestampProvider.getTimestamp()}verifyRolesAllowed(e,t){return this._roleVerifier.verifyRolesAllowed(e,t)}getClientInfo(e){return this._host.getClientInfo(e)}setTimestampProvider(e){this._timestampProvider=e}setRoleVerifier(e){this._roleVerifier=e}setHost(e,t=!0){this._host=t?new gs.BackwardsCompatibilityHostDecorator(new gs.LiveShareHostDecorator(e)):e,this._timestampProvider instanceof g1.HostTimestampProvider&&(this._timestampProvider.stop(),this.setTimestampProvider(new g1.HostTimestampProvider(this._host))),this._roleVerifier instanceof gs.RoleVerifier&&this.setRoleVerifier(new gs.RoleVerifier(this._host))}setAudience(e){var t;this._audience=e,(t=this._objectManager)===null||t===void 0||t.setAudience(this._audience)}start(){return Fre(this,void 0,void 0,function*(){if(this._started)throw new Error("LiveShareRuntime.start(): cannot call start when already started");this._started=!0,this._objectManager&&this.startObjectSynchronizerManager(),(0,gs.isTimestampProvider)(this._timestampProvider)&&!this._timestampProvider.isRunning&&(yield this._timestampProvider.start())})}stop(){var e;if(!this._started)throw new Error("LiveShareRuntime.stop(): cannot call stop when not already started");this._started=!1,(0,gs.isTimestampProvider)(this._timestampProvider)&&this._timestampProvider.isRunning&&this._timestampProvider.stop(),(e=this._objectManager)===null||e===void 0||e.stop()}__dangerouslySetContainerRuntime(e){if(this._containerRuntime!==e){if(this._containerRuntime=e,this._objectManager){this._objectManager.__dangerouslySetContainerRuntime(e);return}this._objectManager=new gs.LiveObjectManager(this,this._containerRuntime),this.startObjectSynchronizerManager()}}startObjectSynchronizerManager(){this.objectManager.start()}}pf.LiveShareRuntime=Dre;var Cu={},Lre=Ne&&Ne.__setFunctionName||function(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};Object.defineProperty(Cu,"__esModule",{value:!0});Cu.getLiveDataObjectClassProxy=Cu.getLiveShareContainerSchemaProxy=void 0;function Mre(n,e){var t;const r=new Map,i=Object.entries(n.initialObjects).map(([o,u])=>[o,Bw(u,e,r)]);return{initialObjects:Object.fromEntries(i),dynamicObjectTypes:(t=n.dynamicObjectTypes)===null||t===void 0?void 0:t.map(o=>Bw(o,e,r))}}Cu.getLiveShareContainerSchemaProxy=Mre;function Bw(n,e,t=new Map){if(Bre(n)){const r=n.TypeName,i=t.get(r);if(i!==void 0)return i;const s=jre(n,e);return t.set(r,s),s}return n}Cu.getLiveDataObjectClassProxy=Bw;function Bre(n){return n.LiveEnabled===!0}function jre(n,e){var t;class r extends n{constructor(o){if(super(o),this.__dangerouslySetLiveRuntime(e),!this.context||!this.context.containerRuntime)throw Error("getLiveDataObjectProxyClassInternal: required dependencies unknown");this.context.clientDetails.capabilities.interactive!==!1&&e.__dangerouslySetContainerRuntime(this.context.containerRuntime)}}return t=class extends n{},Lre(t,"DynamicClass"),t.TypeName=n.TypeName,t.factory=new Proxy(n.factory,{get:function(s,o,u){return o==="ctor"?r:Reflect.get(s,o,u)}}),t}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var v1=Ne&&Ne.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(m){try{f(r.next(m))}catch(g){o(g)}}function d(m){try{f(r.throw(m))}catch(g){o(g)}}function f(m){m.done?s(m.value):i(m.value).then(u,d)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(Tv,"__esModule",{value:!0});Tv.LiveShareClient=void 0;const cI=ss(),qre=Ore,Ure=wc,zre=hf,dI=ff,$re=pf,Hre=Cu,hI=new Map().set("https://alfred.westus2.fluidrelay.azure.com","https://us.fluidrelay.azure.com").set("https://alfred.westeurope.fluidrelay.azure.com","https://eu.fluidrelay.azure.com").set("https://alfred.southeastasia.fluidrelay.azure.com","https://global.fluidrelay.azure.com");class Vre{constructor(e,t){if(this._host=dI.TestLiveShareHost.create(void 0,void 0),this.maxContainerLookupTries=3,!e||typeof e.getFluidTenantInfo!="function")throw new Error("LiveShareClient: host not passed in");this._host=e,this._options=Object.assign({},t)}get isTesting(){var e;return((e=this._options.connection)===null||e===void 0?void 0:e.type)=="local"||this._host instanceof dI.TestLiveShareHost}joinContainer(e,t){var r;return v1(this,void 0,void 0,function*(){performance.mark("TeamsSync: join container");try{const i=this.isTesting?new zre.LocalTimestampProvider:(r=this._options)===null||r===void 0?void 0:r.timestampProvider,s=new $re.LiveShareRuntime(this._host,i,this._options.roleVerifier),o=s.start(),u=(0,Hre.getLiveShareContainerSchemaProxy)(e,s);let d=this._options.connection;if(!d){const P=yield this._host.getFluidTenantInfo();let D=P.serviceEndpoint;if(!D)if(hI.has(P.serviceEndpoint))D=hI.get(P.serviceEndpoint);else throw new Error(`LiveShareClient: Unable to find fluid endpoint for: ${P.serviceEndpoint}`);P.tenantId=="local"?d={type:"local",endpoint:D,tokenProvider:yield(0,cI.getInsecureTokenProvider)()}:d={type:"remote",tenantId:P.tenantId,endpoint:D,tokenProvider:new cI.LiveShareTokenProvider(this._host)}}const f=new qre.AzureClient({connection:d,logger:this._options.logger}),m=this.getOrCreateContainer(f,u,0,t),g=yield Promise.all([m,o]);return s.setAudience(g[0].services.audience),performance.mark("TeamsSync: container connecting"),Object.assign(Object.assign({},g[0]),{timestampProvider:s.timestampProvider})}finally{performance.measure("TeamsSync: container joined","TeamsSync: join container")}})}getOrCreateContainer(e,t,r,i){return v1(this,void 0,void 0,function*(){const s=yield this._host.getFluidContainerId();if(s.shouldCreate)return yield this.createNewContainer(e,t,r,i);if(s.containerId)return Object.assign({created:!1},yield e.getContainer(s.containerId,t));if(r<this.maxContainerLookupTries&&s.retryAfter>0)return yield this.wait(s.retryAfter),yield this.getOrCreateContainer(e,t,r+1,i);throw new Error("LiveShareClient: timed out attempting to create or get container for current context.")})}createNewContainer(e,t,r,i){return v1(this,void 0,void 0,function*(){const{container:s,services:o}=yield e.createContainer(t);i&&i(s);const u=yield s.attach(),d=yield this._host.setFluidContainerId(u);return d.containerState!=Ure.ContainerState.added?(s.dispose(),Object.assign({created:!1},yield e.getContainer(d.containerId,t))):{container:s,services:o,created:!0}})}wait(e){return new Promise(t=>{setTimeout(()=>t(),e)})}}Tv.LiveShareClient=Vre;var hD={};(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=Ne&&Ne.__awaiter||function(P,D,M,U){function j(E){return E instanceof M?E:new M(function(k){k(E)})}return new(M||(M=Promise))(function(E,k){function z(he){try{ie(U.next(he))}catch(pe){k(pe)}}function K(he){try{ie(U.throw(he))}catch(pe){k(pe)}}function ie(he){he.done?E(he.value):j(he.value).then(z,K)}ie((U=U.apply(P,D||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveState=n.LiveStateEvents=void 0;const t=Cc,r=sf,i=ss(),s=Pc,o=Ec(),u=Nu,d=la,f=lf();var m;(function(P){P.stateChanged="stateChanged"})(m=n.LiveStateEvents||(n.LiveStateEvents={}));class g extends f.LiveDataObject{get isInitialized(){return!!this._synchronizer}get state(){return this.latestEvent.data}initialize(D,M){return e(this,void 0,void 0,function*(){if(this.isInitialized)throw new Error("LiveState already started.");this._logger=new s.LiveTelemetryLogger(this.runtime,this.liveRuntime),this.latestEvent={clientId:"",name:"ChangeState",timestamp:0,data:D},this._allowedRoles=M||[],this._synchronizer=new u.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime),yield this._synchronizer.start(D,(j,E,k)=>e(this,void 0,void 0,function*(){return yield this.onReceivedStateEvent(j,E,k)}),j=>e(this,void 0,void 0,function*(){if(j)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}));const U=this._synchronizer.getEvents();if(U)for(let j=0;j<U.length;j++){const E=U[j];if(yield this.onReceivedStateEvent(E,E.clientId,E.clientId===(yield this.waitUntilConnected())))break}})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}set(D){return e(this,void 0,void 0,function*(){if(!this.isInitialized)throw new Error("LiveState not started.");const M=(0,i.cloneValue)(D),U=yield this._synchronizer.sendEvent(M);this.updateState(U,!0)})}get latestEvent(){return(0,r.assert)(this._latestEvent!==void 0,"LiveState is not initialized"),this._latestEvent}set latestEvent(D){this._latestEvent=D}onReceivedStateEvent(D,M,U){var j;return e(this,void 0,void 0,function*(){try{return!(yield this.liveRuntime.verifyRolesAllowed(M,this._allowedRoles))||!o.LiveEvent.isNewer(this.latestEvent,D)||JSON.stringify(this.latestEvent.data)===JSON.stringify(D.data)?!1:(this.updateState(D,U),!0)}catch(E){return(j=this._logger)===null||j===void 0||j.sendErrorEvent(i.TelemetryEvents.LiveState.RoleVerificationError,E),!1}})}updateState(D,M){var U;const j=this.latestEvent.data,E=D.data;this.latestEvent=D,this.emit(m.stateChanged,(0,i.cloneValue)(D.data),M,D.clientId,D.timestamp),(U=this._logger)===null||U===void 0||U.sendTelemetryEvent(i.TelemetryEvents.LiveState.StateChanged,{oldState:j,newState:E})}}g.TypeName="@microsoft/live-share:LiveState",g.factory=new t.DataObjectFactory(g.TypeName,g,[],{}),n.LiveState=g,d.DynamicObjectRegistry.registerObjectClass(g,g.TypeName)})(hD);var fD={};(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=Ne&&Ne.__awaiter||function(f,m,g,P){function D(M){return M instanceof g?M:new g(function(U){U(M)})}return new(g||(g=Promise))(function(M,U){function j(z){try{k(P.next(z))}catch(K){U(K)}}function E(z){try{k(P.throw(z))}catch(K){U(K)}}function k(z){z.done?M(z.value):D(z.value).then(j,E)}k((P=P.apply(f,m||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveTimer=n.LiveTimerEvents=void 0;const t=Cc,r=Nu,i=Ec(),s=la,o=lf();var u;(function(f){f.started="started",f.played="played",f.paused="paused",f.finished="finished",f.onTick="onTick"})(u=n.LiveTimerEvents||(n.LiveTimerEvents={}));class d extends o.LiveDataObject{constructor(){super(...arguments),this._currentConfig={clientId:"",timestamp:0,data:{duration:0,position:0,running:!1}},this._defaultTickRate=20,this._tickRate=this._defaultTickRate}get isInitialized(){return!!this._synchronizer}get tickRate(){return this._tickRate}set tickRate(m){this._tickRate=m}initialize(m){return e(this,void 0,void 0,function*(){if(this.isInitialized)throw new Error("LiveTimer already started.");this._allowedRoles=m||[],this._synchronizer=new r.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime),yield this._synchronizer.start(this._currentConfig.data,(P,D)=>e(this,void 0,void 0,function*(){return yield this.remoteConfigReceived(P,D)}),P=>e(this,void 0,void 0,function*(){if(P)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}));const g=this._synchronizer.getEvents();if(g)for(let P=0;P<g.length;P++){const D=g[P];if(yield this.remoteConfigReceived(Object.assign(Object.assign({},D),{clientId:D.clientId}),D.clientId))break}})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}start(m){return e(this,void 0,void 0,function*(){if(!this.isInitialized)throw new Error("LiveTimer not started.");yield this.playInternal(m,0)})}play(){return e(this,void 0,void 0,function*(){if(!this.isInitialized)throw new Error("LiveTimer not started.");!this._currentConfig.data.running&&this._currentConfig.data.position<this._currentConfig.data.duration&&(yield this.playInternal(this._currentConfig.data.duration,this._currentConfig.data.position))})}playInternal(m,g){return e(this,void 0,void 0,function*(){const P={timestamp:this.liveRuntime.getTimestamp(),clientId:yield this.waitUntilConnected(),data:{duration:m,position:g,running:!0}};yield this.updateConfig(P,!0)})}pause(){return e(this,void 0,void 0,function*(){if(!this.isInitialized)throw new Error("LiveTimer not started.");if(this._currentConfig.data.running){const m=this.liveRuntime.getTimestamp(),g={timestamp:m,clientId:yield this.waitUntilConnected(),data:{duration:this._currentConfig.data.duration,position:this._currentConfig.data.position+(m-this._currentConfig.timestamp),running:!1}};yield this.updateConfig(g,!0)}})}remoteConfigReceived(m,g){return e(this,void 0,void 0,function*(){try{const P=yield this.liveRuntime.verifyRolesAllowed(g,this._allowedRoles),D={timestamp:this._currentConfig.timestamp,clientId:this._currentConfig.clientId},M=i.LiveEvent.isNewer(D,m),U=this.liveRuntime.getTimestamp(),j=this.endTimeFromConfig(m);if(P&&this._currentConfig.timestamp===0&&m.data.running===!0&&U>=j){const E={timestamp:j,clientId:m.clientId,data:{duration:m.data.duration,position:m.data.duration,running:!1}};return this.updateConfig(E,!1),!0}return JSON.stringify(this._currentConfig.data)===JSON.stringify(m.data)&&this._currentConfig.timestamp===m.timestamp?!1:P&&M?(this.updateConfig(m,!1),!0):!1}catch{return!1}})}updateConfig(m,g){return e(this,void 0,void 0,function*(){const P=Object.assign({clientId:m.clientId,configChangedAt:m.timestamp},m.data);if(this._currentConfig=m,m.data.position===0?this.emit(u.started,P,g):m.data.duration===m.data.position?this.emit(u.finished,P):m.data.running?this.emit(u.played,P,g):this.emit(u.paused,P,g),m.data.running&&this.startTicking(),g)return yield this._synchronizer.sendEvent(m.data)})}startTicking(){const m=()=>{if(this._currentConfig.data.running){const g=this.liveRuntime.getTimestamp(),P=this.endTimeFromConfig(this._currentConfig);if(g>=P){const D={timestamp:P,clientId:this._currentConfig.clientId,data:{duration:this._currentConfig.data.duration,position:this._currentConfig.data.duration,running:!1}};this.updateConfig(D,!1).catch(M=>{console.error(M)})}else this.emit(u.onTick,P-g),this.scheduleAnimationFrame(m)}};this.scheduleAnimationFrame(m)}scheduleAnimationFrame(m){this._tickRate<=this._defaultTickRate&&typeof requestAnimationFrame=="function"?requestAnimationFrame(m):setTimeout(m,this._tickRate)}endTimeFromConfig(m){return m.timestamp-m.data.position+m.data.duration}}d.TypeName="@microsoft/live-share:LiveTimer",d.factory=new t.DataObjectFactory(d.TypeName,d,[],{}),n.LiveTimer=d,s.DynamicObjectRegistry.registerObjectClass(d,d.TypeName)})(fD);var Mv={},Ws=Ne&&Ne.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(m){try{f(r.next(m))}catch(g){o(g)}}function d(m){try{f(r.throw(m))}catch(g){o(g)}}function f(m){m.done?s(m.value):i(m.value).then(u,d)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(Mv,"__esModule",{value:!0});Mv.AzureLiveShareHost=void 0;const fI=wc,Wre=ss();class NE{constructor(e){this._shouldWarnLocalTimestamp=e,this._azureAudienceDeferred=new Wre.Deferred,this.hasWarned=!1}static create(e=!0){return new NE(e)}setAudience(e){this._azureAudienceDeferred.resolve(e)}registerClientId(e){var t;return Ws(this,void 0,void 0,function*(){const r=yield this.getClientInfo(e);return(t=r==null?void 0:r.roles)!==null&&t!==void 0?t:[]})}getClientInfo(e){return Ws(this,void 0,void 0,function*(){const t=yield this.getAudienceMemberInfo(e);if(!t)throw new Error("AzureLiveShareHost.getClientInfo: audience member not found");return{userId:t.userId,roles:this.getRolesForAudienceMember(t),displayName:t.userName}})}getNtpTime(){return Ws(this,void 0,void 0,function*(){!this.hasWarned&&this._shouldWarnLocalTimestamp&&(console.warn(`AzureLiveShareHost is using a local timestamp, which could cause issues when use some LiveDataObject data structures across multiple clients.

                To disable this warning, set _shouldWarn in AzureLiveShareHost.create() to false.

                To resolve synchronization issues you may encounter, you should implement a service API to get this timestamp value and override this function.`),this.hasWarned=!0);const e=new Date;return Promise.resolve({ntpTime:e.toUTCString(),ntpTimeInUTC:e.getTime()})})}getClientRoles(e){return Ws(this,void 0,void 0,function*(){const t=yield this.getClientInfo(e);return t==null?void 0:t.roles})}getFluidTenantInfo(){return Ws(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidTenantInfo: not implemented exception")})}getFluidToken(e){return Ws(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidToken: not implemented exception")})}getFluidContainerId(){return Ws(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidContainerId: not implemented exception")})}setFluidContainerId(e){return Ws(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.setFluidContainerId: not implemented exception")})}getAudienceMemberInfo(e){return Ws(this,void 0,void 0,function*(){const r=[...(yield this._azureAudienceDeferred.promise).getMembers().values()];for(let i=0;i<r.length;i++){const s=r[i];if(s.connections.find(o=>o.id===e))return s}})}getRolesForAudienceMember(e){return e.connections.length===0?[]:e.connections[e.connections.length-1].mode==="write"?[fI.UserMeetingRole.presenter]:[fI.UserMeetingRole.attendee]}}Mv.AzureLiveShareHost=NE;(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=Ne&&Ne.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var u=Object.getOwnPropertyDescriptor(i,s);(!u||("get"in u?!i.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,u)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=Ne&&Ne.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(la,n),t(nf,n),t(wc,n),t(Ec(),n),t(oN(),n),t(uf,n),t(af,n),t(Ev,n),t(aN,n),t(cE(),n),t(Tv,n),t(hD,n),t(Pc,n),t(fD,n),t(hf,n),t(ff,n),t(Tc,n),t(rf,n),t(Cu,n),t(lf(),n),t(pf,n),t(Mv,n),t(Nu,n)})(Nm);var Zs={},y1={},Vi={},S1={},b1={},Bv={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Bv,"__esModule",{value:!0});Bv.TelemetryEvents=void 0;Bv.TelemetryEvents={LiveCanvas:{PointerMovedEventError:"LiveCanvas:PointerMovedEventError",AddWetStrokeEventError:"LiveCanvas:AddWetStrokeEventError",BeginWetStrokeError:"LiveCanvas:BeginWetStrokeError"}};var it={},pI;function Gre(){if(pI)return it;pI=1,Object.defineProperty(it,"__esModule",{value:!0}),it.computeEndArrow=it.getSegmentIntersectionsWithRectangle=it.getSegmentsIntersection=it.segmentMayIntersectWithRectangle=it.getRectangleSegments=it.segmentsMayIntersect=it.doRectanglesOverlap=it.isRectangleInsideRectangle=it.isPointInsideRectangle=it.makeRectangle=it.renderQuadPathToSVG=it.renderFilledSVGRectangle=it.renderFilledSVGCircle=it.renderFilledSVGPath=it.computeQuadPath=it.computeQuadBetweenTwoRectangles=it.computeQuadBetweenTwoCircles=it.forceIntoRange=it.isInRange=it.generateUniqueId=it.TWO_PI=void 0;const n=nv,e=Uv();it.TWO_PI=Math.PI*2;const t=1e-6;function r(){return(0,n.v4)()}it.generateUniqueId=r;function i(X,fe,ge){const we=Math.min(fe,ge)-t,be=Math.max(fe,ge)+t;return X>=we&&X<=be}it.isInRange=i;function s(X,fe,ge){return X<fe?fe:X>ge?ge:X}it.forceIntoRange=s;function o(X,fe,ge,we){const be=ge.x-X.x,He=ge.y-X.y,ce=Math.sqrt(be*be+He*He);if(ce<=Math.abs(we-fe))return;const ve=be/ce,De=-He/ce,Xe=(we-fe)/ce,Re=Math.sqrt(1-Xe*Xe),je=De*Re+ve*Xe,Ae=ve*Re-De*Xe,Ce=De*Re-ve*Xe,Ve=ve*Re+De*Xe;return{p1:{x:X.x-je*fe,y:X.y-Ae*fe},p2:{x:ge.x-je*we,y:ge.y-Ae*we},p3:{x:ge.x+Ce*we,y:ge.y+Ve*we},p4:{x:X.x+Ce*fe,y:X.y+Ve*fe}}}it.computeQuadBetweenTwoCircles=o;function u(X,fe,ge,we,be,He){const ce=X.x-fe,ve=X.y-ge,De=X.x+fe,Xe=X.y+ge,Re=we.x-be,je=we.y-He,Ae=we.x+be,Ce=we.y+He;if(Re>=ce&&je>=ve&&Ae<=De&&Ce<=Xe||ce>=Re&&ve>=je&&De<=Ae&&Xe<=Ce)return;const Ve=we.x-X.x>0?1:-1,qe=we.y-X.y>0?1:-1;return{p1:{x:X.x-qe*fe,y:X.y+Ve*ge},p2:{x:X.x+qe*fe,y:X.y-Ve*ge},p3:{x:we.x+qe*be,y:we.y-Ve*He},p4:{x:we.x-qe*be,y:we.y+Ve*He}}}it.computeQuadBetweenTwoRectangles=u;function d(X,fe,ge,we){const be=[],He=we/2;if(fe<X.length){let ce,ve=0;fe>0&&(ce=X[fe-1],ve=(0,e.getPressureAdjustedSize)(He,ce.pressure));for(let De=fe;De<X.length;De++){const Xe=X[De];let Re=(0,e.getPressureAdjustedSize)(He,Xe.pressure);const je={endPoint:Xe,tipSize:Re};ce!==void 0&&(je.quad=ge==="ellipse"?o(Xe,Re,ce,ve):u(Xe,Re,Re,ce,ve,ve)),be.push(je),ce=Xe,ve=Re}}return be}it.computeQuadPath=d;function f(X){return X.toFixed(5)}function m(X,fe){let ge="";for(let we=0;we<X.length;we++){const be=we===0?"M":"L",He=X[we];ge+=`${be}${f(He.x)} ${f(He.y)}`}return`<path d="${ge}" fill="${(0,e.toCssRgbaColor)(fe)}"/>`}it.renderFilledSVGPath=m;function g(X,fe,ge){return`<circle cx="${f(X.x)}" cy="${f(X.y)}" r="${f(fe)}" fill="${(0,e.toCssRgbaColor)(ge)}"/>`}it.renderFilledSVGCircle=g;function P(X,fe,ge,we){const be=X.x-fe,He=X.x+fe,ce=X.y-ge,ve=X.y+ge;return m([{x:be,y:ce},{x:He,y:ce},{x:He,y:ve},{x:be,y:ve}],we)}it.renderFilledSVGRectangle=P;function D(X,fe,ge){let we="";for(let be of X)be.quad!==void 0&&(we+=m([be.quad.p1,be.quad.p2,be.quad.p3,be.quad.p4],ge)),fe==="ellipse"?we+=g(be.endPoint,be.tipSize,ge):we+=P(be.endPoint,be.tipSize,be.tipSize,ge);return we}it.renderQuadPathToSVG=D;function M(X,fe,ge){const we=fe/2,be=ge/2;return{left:X.x-we,top:X.y-be,right:X.x+we,bottom:X.y+be}}it.makeRectangle=M;function U(X,fe){return i(X.x,fe.left,fe.right)&&i(X.y,fe.top,fe.bottom)}it.isPointInsideRectangle=U;function j(X,fe){const ge={x:X.left,y:X.top},we={x:X.right,y:X.top},be={x:X.left,y:X.bottom},He={x:X.right,y:X.bottom};return U(ge,fe)&&U(we,fe)&&U(be,fe)&&U(He,fe)}it.isRectangleInsideRectangle=j;function E(X,fe){const ge=(we,be)=>{const He={x:we.left,y:we.top},ce={x:we.right,y:we.top},ve={x:we.left,y:we.bottom},De={x:we.right,y:we.bottom};return U(He,be)||U(ce,be)||U(ve,be)||U(De,be)};return ge(X,fe)||ge(fe,X)}it.doRectanglesOverlap=E;function k(X,fe){const ge={from:{x:Math.min(X.from.x,X.to.x),y:Math.min(X.from.y,X.to.y)},to:{x:Math.max(X.from.x,X.to.x),y:Math.max(X.from.y,X.to.y)}},we={from:{x:Math.min(fe.from.x,fe.to.x),y:Math.min(fe.from.y,fe.to.y)},to:{x:Math.max(fe.from.x,fe.to.x),y:Math.max(fe.from.y,fe.to.y)}};return!(ge.to.x<we.from.x||ge.from.x>we.to.x||ge.to.y<we.from.y||ge.from.y>we.to.y)}it.segmentsMayIntersect=k;function z(X){return[{from:{x:X.left,y:X.top},to:{x:X.right,y:X.top}},{from:{x:X.right,y:X.top},to:{x:X.right,y:X.bottom}},{from:{x:X.right,y:X.bottom},to:{x:X.left,y:X.bottom}},{from:{x:X.left,y:X.bottom},to:{x:X.left,y:X.top}}]}it.getRectangleSegments=z;function K(X,fe){const ge=z(fe);for(let we of ge)if(k(X,we))return!0;return!1}it.segmentMayIntersectWithRectangle=K;function ie(X,fe){const ge=X.to.y-X.from.y,we=X.from.x-X.to.x,be=fe.to.y-fe.from.y,He=fe.from.x-fe.to.x,ce=ge*He-be*we;if(ce===0)return;const ve=be*fe.from.x+He*fe.from.y,De=ge*X.from.x+we*X.from.y,Xe=1/ce,Re={x:(He*De-we*ve)*Xe,y:(ge*ve-be*De)*Xe};if(i(Re.x,X.from.x,X.to.x)&&i(Re.x,fe.from.x,fe.to.x)&&i(Re.y,X.from.y,X.to.y)&&i(Re.y,fe.from.y,fe.to.y))return Re}it.getSegmentsIntersection=ie;function he(X,fe){const ge=[],we=z(fe);for(let be of we){const He=ie(X,be);if(He){let ce=!1;for(const ve of ge)if(ve.x===He.x&&ve.y===He.y){ce=!0;break}ce||ge.push(He)}}return ge}it.getSegmentIntersectionsWithRectangle=he;function pe(X,fe,ge=20){const we=fe.x-X.x,be=fe.y-X.y,He=Math.sqrt(we*we+be*be),ce=we/He,ve=be/He;return[{x:fe.x-ge*(ce-ve),y:fe.y-ge*(ve+ce)},fe,{x:fe.x-ge*(ce+ve),y:fe.y-ge*(ve-ce)}]}return it.computeEndArrow=pe,it}var mI;function _c(){return mI||(mI=1,function(n){var e=Ne&&Ne.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var u=Object.getOwnPropertyDescriptor(i,s);(!u||("get"in u?!i.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,u)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=Ne&&Ne.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(Bv,n),t(Gre(),n)}(b1)),b1}var gI;function DE(){return gI||(gI=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.HighlighterColors=n.PenColors=n.BasicColors=n.darkenColor=n.lightenColor=n.fromCssColor=n.toCssRgbaColor=void 0;const e=_c();function t(o,u=1){const d=(0,e.forceIntoRange)(o.r,0,255),f=(0,e.forceIntoRange)(o.g,0,255),m=(0,e.forceIntoRange)(o.b,0,255),g=(0,e.forceIntoRange)(u,0,1);return`rgba(${d},${f},${m},${g})`}n.toCssRgbaColor=t;function r(o){if(o){const d=/#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/gi.exec(o);if(d){const f=parseInt(d[1],16),m=parseInt(d[2],16),g=parseInt(d[3],16);return{r:f,g:m,b:g}}}return n.PenColors.black}n.fromCssColor=r;function i(o,u){if(u<0||u>100)return o;const d=f=>{const m=255-f;return f+Math.round(m/100*u)};return{r:d(o.r),g:d(o.g),b:d(o.b)}}n.lightenColor=i;function s(o,u){if(u<0||u>100)return o;const d=f=>f-Math.round(f/100*u);return{r:d(o.r),g:d(o.g),b:d(o.b)}}n.darkenColor=s,n.BasicColors={black:r("#000000"),white:r("#ffffff"),gray:r("#808080"),silver:r("#c0c0c0"),red:r("#ff0000"),green:r("#008000"),blue:r("#0000ff"),yellow:r("#ffff00"),magenta:r("#ea33f6"),violet:r("#8719cc"),purple:r("#76147d")},n.PenColors={yellow:r("#ffc114"),orange:r("#f6630d"),pink:r("#ff0066"),red:r("#e71224"),indigo:r("#5b2d90"),purple:r("#ab008b"),plum:r("#cc0066"),darkBlue:r("#004f8b"),skyBlue:r("#00a0d7"),lightBlue:r("#33ccff"),green:r("#008c3a"),lightGreen:r("#66cc00"),black:r("#000000"),darkGray:r("#333333"),lightGray:r("#849398"),white:r("#ffffff")},n.HighlighterColors={yellow:r("#fffc00"),lime:r("#00f900"),aqua:r("#00fdff"),Pink:r("#ff40ff"),orange:r("#ff8517"),lightGreen:r("#a2d762"),paleBlue:r("#a9d8ff"),rose:r("#ffacd5"),crimson:r("#ef0c4d"),green:r("#00b44b"),blue:r("#0069af"),lavender:r("#d9aeff"),red:r("#ff2500"),lightGray:r("#e6e6e6"),gray:r("#969696"),black:r("#000000")}}(S1)),S1}var vI;function LE(){if(vI)return Vi;vI=1,Object.defineProperty(Vi,"__esModule",{value:!0}),Vi.DefaultLaserPointerBrush=Vi.DefaultHighlighterBrush=Vi.DefaultLineBrush=Vi.DefaultPenBrush=void 0;const n=DE();return Vi.DefaultPenBrush={type:"pen",color:n.PenColors.black,tip:"ellipse",tipSize:10},Vi.DefaultLineBrush={type:"pen",color:n.PenColors.black,tip:"ellipse",tipSize:10},Vi.DefaultHighlighterBrush={type:"highlighter",color:n.HighlighterColors.yellow,tip:"rectangle",tipSize:10},Vi.DefaultLaserPointerBrush={type:"laser",color:n.BasicColors.red,tip:"ellipse",tipSize:10},Vi}var xn={};Object.defineProperty(xn,"__esModule",{value:!0});xn.viewportToScreen=xn.screenToViewport=xn.getSquaredDistanceBetweenPoints=xn.getDistanceBetweenPoints=xn.combineRects=xn.expandRect=xn.getPressureAdjustedSize=void 0;function Kre(n,e){return n*(e*1.5+.25)}xn.getPressureAdjustedSize=Kre;function Jre(n,e){return{left:Math.min(n.left,e.x),right:Math.max(n.right,e.x),top:Math.min(n.top,e.y),bottom:Math.max(n.bottom,e.y)}}xn.expandRect=Jre;function Qre(n,e){return{left:Math.min(n.left,e.left),top:Math.min(n.top,e.top),right:Math.max(n.right,e.right),bottom:Math.max(n.bottom,e.bottom)}}xn.combineRects=Qre;function Xre(n,e){return Math.hypot(e.x-n.x,e.y-n.y)}xn.getDistanceBetweenPoints=Xre;function Yre(n,e){return(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y)}xn.getSquaredDistanceBetweenPoints=Yre;function Zre(n,e,t,r){const i=r>0?r:1;return{x:(n.x-t.x-e.x)/i,y:(n.y-t.y-e.y)/i}}xn.screenToViewport=Zre;function eie(n,e,t,r){const i=r>0?r:1;return{x:n.x*i+e.x+t.x,y:n.y*i+e.y+t.y}}xn.viewportToScreen=eie;var w1={},C1={},Gs={},_d={},yI;function pD(){if(yI)return _d;yI=1,Object.defineProperty(_d,"__esModule",{value:!0}),_d.InkingCanvas=void 0;const n=Uv(),e=_c();let t=class jw{render(){this.internalRender()}createLayer(){const i=document.createElement("canvas");i.style.position="absolute",i.style.touchAction="none";const s={alpha:!0,desynchronized:!1},o=i.getContext("2d",s);if(o===null)throw new Error("Could not get 2D context from canvas.");return o}resizeLayer(i,s,o){i.canvas.style.width=`${s}px`,i.canvas.style.height=`${o}px`,i.canvas.width=s*window.devicePixelRatio,i.canvas.height=o*window.devicePixelRatio,i.scale(window.devicePixelRatio,window.devicePixelRatio)}addLayerToDOM(i){this._parentElement&&(this._parentElement.appendChild(i.canvas),this.resizeLayer(i,this.clientDimensions.width,this.clientDimensions.height))}removeLayerFromDOM(i){this._parentElement&&this._parentElement.removeChild(i.canvas)}get clientDimensions(){if(!this._clientDimensions){const i=this._parentElement?this._parentElement.clientWidth:100,s=this._parentElement?this._parentElement.clientHeight:100;this._clientDimensions={width:i,height:s,halfWidth:i*.5,halfHeight:s*.5}}return this._clientDimensions}scheduleRender(){this._renderTimeout&&window.cancelAnimationFrame(this._renderTimeout);const i=()=>{this.render(),this._renderTimeout=void 0};this._renderTimeout=window.requestAnimationFrame(i)}viewportToScreen(i){return Object.assign(Object.assign({},(0,n.viewportToScreen)(i,this.referencePoint==="center"?{x:this.clientDimensions.halfWidth,y:this.clientDimensions.halfHeight}:{x:0,y:0},this.offset,this.scale)),{pressure:i.pressure})}rendersAsynchronously(){return!0}numsToIPointerPoint(i,s){return{x:i,y:s}}moveTo(i,s){const o=this.viewportToScreen(s);i.moveTo(o.x,o.y)}lineTo(i,s){const o=this.viewportToScreen(s);i.lineTo(o.x,o.y)}renderRectangle(i,s,o,u){const d=s.x-o,f=s.x+o,m=s.y-u,g=s.y+u;this.moveTo(i,this.numsToIPointerPoint(d,m)),this.lineTo(i,this.numsToIPointerPoint(f,m)),this.lineTo(i,this.numsToIPointerPoint(f,g)),this.lineTo(i,this.numsToIPointerPoint(d,g)),this.lineTo(i,this.numsToIPointerPoint(d,m))}renderQuad(i,s){this.moveTo(i,this.numsToIPointerPoint(s.p1.x,s.p1.y)),this.lineTo(i,this.numsToIPointerPoint(s.p2.x,s.p2.y)),this.lineTo(i,this.numsToIPointerPoint(s.p3.x,s.p3.y)),this.lineTo(i,this.numsToIPointerPoint(s.p4.x,s.p4.y)),this.lineTo(i,this.numsToIPointerPoint(s.p1.x,s.p1.y))}renderCircle(i,s,o){const u=this.viewportToScreen(s);i.arc(u.x,u.y,o*this._scale,0,e.TWO_PI)}addLayer(){const i=this.createLayer();return this._additionalLayers.add(i),this.addLayerToDOM(i),i}removeLayer(i){this.removeLayerFromDOM(i),this._additionalLayers.delete(i)}get context(){return this._context}constructor(i){this._parentElement=i,this._additionalLayers=new Set,this._strokeStarted=!1,this._offset={x:0,y:0},this._scale=1,this.referencePoint="center",this._context=this.createLayer(),this.addLayerToDOM(this._context)}fadeOut(){let i=.9;const s=()=>{i>0?(this.canvas.style.opacity=i.toString(),this._additionalLayers.forEach(o=>{o.canvas.style.opacity=i.toString()}),window.setTimeout(s,jw.fadeOutDuration/10),i-=.1):this.removeFromDOM()};window.setTimeout(s,jw.fadeOutDuration/10)}removeFromDOM(){this.removeLayerFromDOM(this.context),this._additionalLayers.forEach(i=>{this.removeLayerFromDOM(i)}),this._additionalLayers.clear(),this._parentElement=void 0}resize(i,s){this._clientDimensions=void 0,this.resizeLayer(this.context,i,s),this._additionalLayers.forEach(o=>{this.resizeLayer(o,i,s)})}clear(){const i=s=>{s.save(),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,s.canvas.width,s.canvas.height),s.restore()};i(this.context),this._additionalLayers.forEach(s=>{i(s)})}beginStroke(i){this._strokeStarted=!0,this.internalBeginStroke(i),this.rendersAsynchronously()&&this.scheduleRender()}addPoint(i){if(!this._strokeStarted)throw new Error("beginStroke must be called before addPoint.");this.internalAddPoint(i),this.rendersAsynchronously()&&this.scheduleRender()}endStroke(i){this.internalEndStroke(i),this.rendersAsynchronously()?this.scheduleRender():this.render(),this._strokeStarted=!1}cancelStroke(){this.internalCancelStroke(),this.clear(),this._strokeStarted=!1}renderStroke(i){if(this.setBrush(i.brush),i.length===1)this.beginStroke(i.getPointAt(0)),this.endStroke(i.getPointAt(0));else for(let s=0;s<i.length;s++)s===0?this.beginStroke(i.getPointAt(s)):s===i.length-1?this.endStroke(i.getPointAt(s)):this.addPoint(i.getPointAt(s))}setBrush(i){this._brush=i}get canvas(){return this._context.canvas}get brush(){var i;return(i=this._brush)!==null&&i!==void 0?i:this.getDefaultBrush()}get offset(){return this._offset}set offset(i){this._offset=Object.assign({},i)}get scale(){return this._scale}set scale(i){i>0&&(this._scale=i)}};return t.fadeOutDuration=300,t.laserShadowOpacity=.5,t.highlighterOpacity=.5,_d.InkingCanvas=t,_d}var SI;function mD(){if(SI)return Gs;SI=1,Object.defineProperty(Gs,"__esModule",{value:!0}),Gs.WetCanvas=Gs.DryCanvas=Gs.DryWetCanvas=void 0;const n=pD(),e=Uv(),t=_c();let r=class extends n.InkingCanvas{constructor(){super(...arguments),this._pendingPointsStartIndex=0,this._points=[]}computeQuadPath(u){return(0,t.computeQuadPath)(this._points,this._pendingPointsStartIndex,this.brush.tip,u)}renderQuadPath(u,d){const f=this.getBrushCssColor();u.strokeStyle=f,u.fillStyle=f,u.beginPath();for(let m of d)m.quad!==void 0&&this.renderQuad(u,m.quad),this.brush.tip==="ellipse"?this.renderCircle(u,m.endPoint,m.tipSize):this.renderRectangle(u,m.endPoint,m.tipSize,m.tipSize);u.fill(),u.closePath()}getDefaultBrush(){return e.DefaultPenBrush}getBrushCssColor(){return(0,e.toCssRgbaColor)(this.brush.color,this.brush.type==="highlighter"?.5:1)}rendersProgressively(){return!0}adjustOpacity(u){u.globalAlpha=1,u.canvas.style.opacity="1"}internalRender(){this.rendersProgressively()||this.clear();const u=this.computeQuadPath(this.brush.tipSize);if(this.adjustOpacity(this.context),this.renderQuadPath(this.context,u),this.brush.type==="laser"){const d=this.computeQuadPath(this.brush.tipSize/3);this._innerLayer||(this._innerLayer=this.addLayer()),this.renderQuadPath(this._innerLayer,d)}else this._innerLayer&&(this.removeLayer(this._innerLayer),this._innerLayer=void 0);this.rendersProgressively()&&(this._pendingPointsStartIndex=this._points.length)}internalBeginStroke(u){this._points=[u],this._pendingPointsStartIndex=0}internalAddPoint(u){this._points.push(u)}internalEndStroke(u){u&&this._points.push(u)}internalCancelStroke(){}get points(){return this._points}};Gs.DryWetCanvas=r;class i extends r{rendersAsynchronously(){return!1}adjustOpacity(u){switch(this.brush.type){case"laser":u.globalAlpha=n.InkingCanvas.laserShadowOpacity;break;default:super.adjustOpacity(u);break}}}Gs.DryCanvas=i;class s extends r{rendersAsynchronously(){return s.forceSynchronousRendering?!1:super.rendersAsynchronously()}rendersProgressively(){return s.forceSynchronousRendering?!1:super.rendersProgressively()}getBrushCssColor(){return(0,e.toCssRgbaColor)(this.brush.color)}adjustOpacity(u){switch(this.brush.type){case"laser":u.canvas.style.opacity=n.InkingCanvas.laserShadowOpacity.toString();break;case"highlighter":u.canvas.style.opacity=n.InkingCanvas.highlighterOpacity.toString();break;default:super.adjustOpacity(u);break}}}return s.forceSynchronousRendering=!1,Gs.WetCanvas=s,Gs}var Id={},bI;function tie(){if(bI)return Id;bI=1,Object.defineProperty(Id,"__esModule",{value:!0}),Id.LaserPointerCanvas=void 0;const n=mD();let e=class gD extends n.WetCanvas{scheduleTrailingPointsRemoval(){this._trailingPointsRemovalInterval===void 0&&this.points.length>1&&(this._trailingPointsRemovalInterval=window.setTimeout(()=>{const r=Math.ceil((this.points.length-1)/5);if(this.points.splice(0,r),this.points.length>0){let i=.5;const s=(.9-i)/this.points.length;for(let o=this.points.length-1;o>=0;o--)this.points[o].pressure=i,i-=s}this._trailingPointsRemovalInterval=void 0,this.scheduleRender(),this.scheduleTrailingPointsRemoval()},gD.TrailingPointsRemovalInterval))}cancelTralingPointRemoval(){this._trailingPointsRemovalInterval!==void 0&&(window.clearInterval(this._trailingPointsRemovalInterval),this._trailingPointsRemovalInterval=void 0)}internalAddPoint(r){super.internalAddPoint(r),this.scheduleTrailingPointsRemoval()}internalEndStroke(r){this.cancelTralingPointRemoval(),super.internalEndStroke(r)}internalCancelStroke(){this.cancelTralingPointRemoval(),super.internalCancelStroke()}rendersProgressively(){return!1}removeFromDOM(){super.removeFromDOM(),this.cancelTralingPointRemoval()}};return e.TrailingPointsRemovalInterval=20,Id.LaserPointerCanvas=e,Id}var wI;function vD(){return wI||(wI=1,function(n){var e=Ne&&Ne.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var u=Object.getOwnPropertyDescriptor(i,s);(!u||("get"in u?!i.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,u)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=Ne&&Ne.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(mD(),n),t(pD(),n),t(tie(),n)}(C1)),C1}var x1={},CI;function ME(){return CI||(CI=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Stroke=n.StrokeType=n.StrokeMode=void 0;const e=LE(),t=xn,r=_c();(function(s){s[s.freeHand=0]="freeHand",s[s.line=1]="line"})(n.StrokeMode||(n.StrokeMode={})),function(s){s[s.laserPointer=0]="laserPointer",s[s.ephemeral=1]="ephemeral",s[s.persistent=2]="persistent"}(n.StrokeType||(n.StrokeType={}));class i{serializePoints(){let o="";const u=Math.pow(10,i.coordinateSerializationPrecision),d=Math.pow(10,i.pressureSerializationPrecision);for(let f=0;f<this._points.length;f++){const m=this._points[f];o+=`${(m.x*u).toFixed(0)},${(m.y*u).toFixed(0)},${(m.pressure*d).toFixed(0)}`,f<this._points.length-1&&(o+=",")}return o}deserializePoints(o){const u=[],d=Math.pow(10,i.coordinateSerializationPrecision),f=Math.pow(10,i.pressureSerializationPrecision);let m=0,g=[];for(;m<o.length;){let P=o.indexOf(",",m);if(P===-1&&(P=o.length),g.push(parseFloat(o.substring(m,P))),g.length===3){const D={x:g[0]/d,y:g[1]/d,pressure:g[2]/f};u.push(D),g=[]}m=P+1}return u}addPoint(o){let u=this._points.length>0?this._points[this._points.length-1]:void 0;return u===void 0||u.x!==o.x||u.y!==o.y?(this._points.push(o),this._boundingRect&&!(0,r.isPointInsideRectangle)(o,this._boundingRect)&&(this._boundingRect=void 0),!0):!1}constructor(o){var u,d,f,m;this._version=1,this._brush=Object.assign({},e.DefaultPenBrush),this._iteratorCounter=0;const g={id:o?o.id:void 0,clientId:o?o.clientId:void 0,timeStamp:o?o.timeStamp:void 0,brush:o?o.brush:void 0,points:o?o.points:void 0};this._id=(u=g.id)!==null&&u!==void 0?u:(0,r.generateUniqueId)(),this._clientId=g.clientId,this._timeStamp=(d=g.timeStamp)!==null&&d!==void 0?d:Date.now(),this._points=(f=g.points)!==null&&f!==void 0?f:[],this._brush=Object.assign({},(m=g.brush)!==null&&m!==void 0?m:e.DefaultPenBrush)}addPoints(...o){let u=!1;for(let d of o)this.addPoint(d)&&(u=!0);return u}clear(){this._points=[],this._boundingRect=void 0}intersectsWithRectangle(o){let u;for(const d of this){if(u&&(0,r.getSegmentIntersectionsWithRectangle)({from:u,to:d},o).length>0)return!0;u=d}return!1}getIntersectionPoints(o){const u=[];let d;for(const f of this){if(d){const m=(0,r.getSegmentsIntersection)(o,{from:d,to:f});m&&u.push(m)}d=f}return u}getBoundingRect(){if(this._boundingRect===void 0){let o={left:Number.MAX_VALUE,top:Number.MAX_VALUE,right:-Number.MAX_VALUE,bottom:-Number.MAX_VALUE};for(const u of this)o=(0,t.expandRect)(o,u);this._boundingRect=o}return this._boundingRect}getPointAt(o){return this._points[o]}getAllPoints(){const o=[];for(const u of this._points)o.push(Object.assign({},u));return o}pointErase(o){const u=this.getBoundingRect();if(this.length===1)return(0,r.isPointInsideRectangle)(this.getPointAt(0),o)?[]:void 0;if((0,r.isRectangleInsideRectangle)(u,o))return[];if(!(0,r.doRectanglesOverlap)(o,u))return;const d=()=>new i({clientId:this.clientId,timeStamp:this.timeStamp,brush:this.brush});let f;const m=[];let g=d();for(const P of this){if(f){const D={from:f,to:P};if((0,r.segmentMayIntersectWithRectangle)(D,o)){const M=(0,r.getSegmentIntersectionsWithRectangle)(D,o);if(M.length===1)(0,r.isPointInsideRectangle)(f,o)?(g=d(),g.addPoint(Object.assign(Object.assign({},M[0]),{pressure:f.pressure})),g.addPoint(P)):(g.addPoint(Object.assign(Object.assign({},M[0]),{pressure:P.pressure})),m.push(g),g=d());else if(M.length===2){const U=(0,t.getSquaredDistanceBetweenPoints)(f,M[0]),j=(0,t.getSquaredDistanceBetweenPoints)(f,M[1]);let[E,k]=U<j?[0,1]:[1,0];g.addPoint(Object.assign(Object.assign({},M[E]),{pressure:f.pressure})),m.push(g),g=d(),g.addPoint(Object.assign(Object.assign({},M[k]),{pressure:f.pressure})),g.addPoint(P)}else!(0,r.isPointInsideRectangle)(f,o)&&!(0,r.isPointInsideRectangle)(P,o)&&(g.length===0&&g.addPoint(f),g.addPoint(P))}else g.addPoint(P)}else g.addPoint(P);f=P}return g.length>1&&m.push(g),m}serialize(){const o={v:this._version,id:this.id,cId:this.clientId,t:this.timeStamp,br:this.brush,d:this.serializePoints()};return JSON.stringify(o)}deserialize(o){const u=JSON.parse(o);this._version=u.v,this._id=u.id,this._clientId=u.cId,this._timeStamp=u.t,this._brush=u.br,this._points=this.deserializePoints(u.d)}[Symbol.iterator](){return this._iteratorCounter=0,{next:()=>({done:this._iteratorCounter===this._points.length,value:this._points[this._iteratorCounter++]})}}get id(){return this._id}get clientId(){return this._clientId}get timeStamp(){return this._timeStamp}get length(){return this._points.length}get brush(){return this._brush}}i.coordinateSerializationPrecision=1,i.pressureSerializationPrecision=2,n.Stroke=i}(x1)),x1}var BE={},xu={};Object.defineProperty(xu,"__esModule",{value:!0});xu.InputFilterCollection=xu.InputFilter=void 0;class nie{reset(e){}}xu.InputFilter=nie;class rie{constructor(...e){this._items=[],this._items.push(...e)}addFilters(...e){this._items.push(...e)}reset(e){for(const t of this._items)t.reset(e)}filterPoint(e){let t=e;for(const r of this._items)t=r.filterPoint(t);return t}}xu.InputFilterCollection=rie;var Eu={};Object.defineProperty(Eu,"__esModule",{value:!0});Eu.InputProvider=Eu.MulticastEvent=void 0;class hl{constructor(){this._listeners=new Set}on(e){this._listeners.has(e)||this._listeners.add(e)}off(e){this._listeners.delete(e)}emit(e){for(const t of this._listeners)t(e)}}Eu.MulticastEvent=hl;class iie{constructor(){this.pointerDownEvent=new hl,this.pointerMoveEvent=new hl,this.pointerUpEvent=new hl,this.pointerEnterEvent=new hl,this.pointerLeaveEvent=new hl,this._isActive=!0}activate(){this._isActive=!0}deactivate(){this._isActive=!1}get isActive(){return this._isActive}get pointerDown(){return this.pointerDownEvent}get pointerMove(){return this.pointerMoveEvent}get pointerUp(){return this.pointerUpEvent}get pointerEnter(){return this.pointerEnterEvent}get pointerLeave(){return this.pointerLeaveEvent}}Eu.InputProvider=iie;var jv={};Object.defineProperty(jv,"__esModule",{value:!0});jv.JitterFilter=void 0;const sie=xu;class Ii extends sie.InputFilter{static iir(e,t,r){return Ii._ab*e+Ii._a*t+Ii._b*r}reset(e){this._out1=e,this._out2=e}filterPoint(e){if(this._out1&&this._out2){const t={x:Ii.iir(e.x,this._out1.x,this._out2.x),y:Ii.iir(e.y,this._out1.y,this._out2.y),pressure:e.pressure};return this._out2=this._out1,this._out1=t,t}return e}}Ii._a=1.33;Ii._b=-.5;Ii._ab=1-Ii._a-Ii._b;jv.JitterFilter=Ii;var qv={};Object.defineProperty(qv,"__esModule",{value:!0});qv.PointerInputProvider=void 0;const oie=Eu;function Ad(n){return{altKey:n.altKey,ctrlKey:n.ctrlKey,shiftKey:n.shiftKey,x:n.offsetX,y:n.offsetY,pressure:n.pressure>0?n.pressure:.5}}function aie(n){if("getCoalescedEvents"in n){const e=n.getCoalescedEvents();if(e.length>=1)return e}return[n]}class uie extends oie.InputProvider{capturePointer(e){try{this.element.setPointerCapture(e),this._activePointerId=e}catch(t){console.error(`Could not capture pointer with id ${e}: ${t}`)}}releaseActivePointer(){if(this._activePointerId!==void 0){try{this.element.releasePointerCapture(this._activePointerId)}catch(e){console.error(`Could not release pointer with id ${this._activePointerId}: ${e}`)}this._activePointerId=void 0}}activate(){super.activate(),this.element.addEventListener("pointerdown",this.onPointerDown),this.element.addEventListener("pointermove",this.onPointerMove),this.element.addEventListener("pointerup",this.onPointerUp),this.element.addEventListener("pointerenter",this.onPointerEnter),this.element.addEventListener("pointerleave",this.onPointerLeave)}deactivate(){super.deactivate(),this.element.removeEventListener("pointerdown",this.onPointerDown),this.element.removeEventListener("pointermove",this.onPointerMove),this.element.removeEventListener("pointerup",this.onPointerUp),this.element.removeEventListener("pointerenter",this.onPointerEnter),this.element.removeEventListener("pointerleave",this.onPointerLeave)}constructor(e){super(),this.element=e,this.onPointerDown=t=>{this.isActive&&(this._activePointerId===void 0&&(this.capturePointer(t.pointerId),this.pointerDownEvent.emit(Ad(t))),t.preventDefault(),t.stopPropagation())},this.onPointerMove=t=>{if(this.isActive){let r=!0;if(this._activePointerId!==void 0&&(r=t.pointerId===this._activePointerId),r){const i=this._activePointerId!==void 0;aie(t).forEach(o=>{this.pointerMoveEvent.emit(Object.assign(Object.assign({},Ad(o)),{isPointerDown:i}))})}t.preventDefault(),t.stopPropagation()}},this.onPointerUp=t=>{this.isActive&&(this._activePointerId===t.pointerId&&(this.releaseActivePointer(),this.pointerUpEvent.emit(Ad(t))),t.preventDefault(),t.stopPropagation())},this.onPointerEnter=t=>{this.isActive&&(this._activePointerId===void 0&&this.pointerEnterEvent.emit(Ad(t)),t.preventDefault(),t.stopPropagation())},this.onPointerLeave=t=>{this.isActive&&(this._activePointerId===void 0&&this.pointerLeaveEvent.emit(Ad(t)),t.preventDefault(),t.stopPropagation())}}}qv.PointerInputProvider=uie;(function(n){var e=Ne&&Ne.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var u=Object.getOwnPropertyDescriptor(i,s);(!u||("get"in u?!i.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,u)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=Ne&&Ne.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(xu,n),t(Eu,n),t(jv,n),t(qv,n)})(BE);var xI;function yD(){return xI||(xI=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.InkingManager=n.AddPointsEvent=n.StrokeEndState=n.BeginStrokeEvent=n.PointerMovedEvent=n.StrokesRemovedEvent=n.StrokesAddedEvent=n.ClearEvent=n.InkingTool=void 0;const e=Fn,t=vD(),r=xn,i=ME(),s=BE,o=LE(),u=_c();var d;(function(j){j[j.pen=0]="pen",j[j.laserPointer=1]="laserPointer",j[j.highlighter=2]="highlighter",j[j.eraser=3]="eraser",j[j.pointEraser=4]="pointEraser",j[j.line=5]="line"})(d=n.InkingTool||(n.InkingTool={})),n.ClearEvent="Clear",n.StrokesAddedEvent="StrokesAdded",n.StrokesRemovedEvent="StrokesRemoved",n.PointerMovedEvent="PointerMoved",n.BeginStrokeEvent="BeginStroke";var f;(function(j){j[j.ended=0]="ended",j[j.cancelled=1]="cancelled"})(f=n.StrokeEndState||(n.StrokeEndState={})),n.AddPointsEvent="AddPoints";class m{constructor(){this._addedStrokes=new Map,this._removedStrokes=new Set}clear(){this._addedStrokes.clear(),this._removedStrokes.clear()}mergeChanges(E){for(let k of E._removedStrokes)this._addedStrokes.delete(k)||this._removedStrokes.add(k);E._addedStrokes.forEach(k=>{this._addedStrokes.set(k.id,k)})}addStroke(E){this._addedStrokes.set(E.id,E)}removeStroke(E){this._removedStrokes.add(E)}getRemovedStrokes(){return[...this._removedStrokes]}getAddedStrokes(){return[...this._addedStrokes.values()]}get hasChanges(){return this._addedStrokes.size>0||this._removedStrokes.size>0}}class g extends t.DryCanvas{constructor(E,k){super(k),this.clientId=E}scheduleRemoval(E){this._removalTimeout&&window.clearTimeout(this._removalTimeout),this._removalTimeout=window.setTimeout(()=>{this.fadeOut(),E(this)},U.ephemeralCanvasRemovalDelay)}}class P extends i.Stroke{notifyStrokeEnded(E){this.onStrokeEnded&&this.onStrokeEnded(this,E)}constructor(E,k,z,K){super(K),this._canvas=E,this.type=k,this.mode=z,this._canvas.setBrush(this.brush)}straighten(E){return E}end(){this._canvas.removeFromDOM(),this._canvas.endStroke(),this.notifyStrokeEnded(!1)}cancel(){this._canvas.removeFromDOM(),this._canvas.cancelStroke(),this.notifyStrokeEnded(!0)}get canvas(){return this._canvas}}class D extends P{addPoints(...E){const k=this.length,z=super.addPoints(...E);if(z){let K=k;K===0&&(this.canvas.beginStroke(this.getPointAt(0)),K=1);for(let ie=K;ie<this.length;ie++)this.canvas.addPoint(this.getPointAt(ie))}return z}end(){if(this.length>1&&this.brush.endArrow==="open"){const E=this.getPointAt(this.length-2),k=this.getPointAt(this.length-1),z=(0,u.computeEndArrow)(E,k);for(let K=0;K<z.length;K++){const ie=Object.assign(Object.assign({},z[K]),{pressure:k.pressure});this.addPoint(ie)}}super.end()}}class M extends P{straighten(E){const k=Object.assign({},E);if(this.length>0){const z=this.getPointAt(0);Math.abs(k.x-z.x)>Math.abs(k.y-z.y)?k.y=z.y:k.x=z.x}return k}addPoints(...E){if(this.length===0)this.addPoint(E[0]),E.length>1&&this.addPoint(E[E.length-1]);else{const k=this.getPointAt(0);this.clear(),this.addPoint(k),this.addPoint(E[E.length-1])}if(this.canvas.cancelStroke(),this.canvas.beginStroke(this.getPointAt(0)),this.length>1&&(this.canvas.addPoint(this.getPointAt(1)),this.brush.endArrow==="open")){const k=(0,u.computeEndArrow)(this.getPointAt(0),this.getPointAt(1));for(let z=0;z<k.length;z++){const K=Object.assign(Object.assign({},k[z]),{pressure:this.getPointAt(1).pressure});this.addPoint(K),this.canvas.addPoint(K)}}return!0}}class U extends e.EventEmitter{reRender(){this._dryCanvas.clear(),this._dryCanvas.offset=this._offset,this._dryCanvas.scale=this._scale;const E=[...this._strokes.values()].sort((k,z)=>k.timeStamp-z.timeStamp);for(const k of E)this._dryCanvas.renderStroke(k)}scheduleReRender(){this._reRenderTimeout!==void 0&&window.cancelAnimationFrame(this._reRenderTimeout),this._reRenderTimeout=window.requestAnimationFrame(()=>{this.reRender(),this._reRenderTimeout=void 0})}flushChangeLog(){this._changeLogFlushTimeout&&(window.clearTimeout(this._changeLogFlushTimeout),this._changeLogFlushTimeout=void 0),this._changeLog.hasChanges&&(this.notifyStrokesRemoved(...this._changeLog.getRemovedStrokes()),this.notifyStrokesAdded(...this._changeLog.getAddedStrokes()),this._changeLog.clear())}scheduleChangeLogFlush(){this._changeLogFlushTimeout===void 0&&(this._changeLogFlushTimeout=window.setTimeout(()=>{this._changeLogFlushTimeout=void 0,this.flushChangeLog()},U.changeLogFlushInterval))}processPendingPointErasePoints(){for(let E of this._pendingPointErasePoints)this.internalPointErase(E);this._pendingPointErasePoints=[]}schedulePointEraseProcessing(){this._pointEraseProcessingInterval===void 0&&(this._pointEraseProcessingInterval=window.setTimeout(()=>{this.processPendingPointErasePoints(),this._pointEraseProcessingInterval=void 0,this.scheduleChangeLogFlush()},U.pointEraserProcessingInterval))}getBrushForTool(E){switch(E){case d.laserPointer:return this.laserPointerBrush;case d.highlighter:return this.highlighterBrush;case d.line:return this.lineBrush;default:return this.penBrush}}cancelCurrentStroke(E){this._currentStroke!==void 0&&(this._currentStroke.cancel(),this.notifyEndStroke(this._currentStroke.id,E,!0),this._currentStroke=void 0)}internalAddStroke(E,k){var z,K;const ie={forceReRender:k&&(z=k.forceReRender)!==null&&z!==void 0?z:!1,addToChangeLog:k&&(K=k.addToChangeLog)!==null&&K!==void 0?K:!0};ie.forceReRender||this._strokes.has(E.id)?(this._strokes.set(E.id,E),ie.forceReRender?this.reRender():this.scheduleReRender()):(this._strokes.set(E.id,E),this._reRenderTimeout||this._dryCanvas.renderStroke(E)),ie.addToChangeLog&&this._changeLog.addStroke(E)}internalErase(E){const k=new m,z=(0,u.makeRectangle)(E,this.eraserSize,this.eraserSize);return this._strokes.forEach(K=>{K.length===1?(0,u.isPointInsideRectangle)(K.getPointAt(0),z)&&k.removeStroke(K.id):K.intersectsWithRectangle(z)&&k.removeStroke(K.id)}),k.hasChanges&&(k.getRemovedStrokes().forEach(K=>{this._strokes.delete(K)}),this.scheduleReRender(),this._changeLog.mergeChanges(k)),k}internalPointErase(E){const k=new m,z=(0,u.makeRectangle)(E,this.eraserSize,this.eraserSize);return this._strokes.forEach(K=>{const ie=K.pointErase(z);if(ie){k.removeStroke(K.id);for(const he of ie)k.addStroke(he)}}),k.hasChanges&&(k.getRemovedStrokes().forEach(K=>{this._strokes.delete(K)}),k.getAddedStrokes().forEach(K=>{this._strokes.set(K.id,K)}),this.scheduleReRender(),this._changeLog.mergeChanges(k)),k}queuePointerMovedNotification(E){this._lastPointerMovePosition=E,this._pointerMovedNotificationTimeout===void 0&&(this._pointerMovedNotificationTimeout=window.setTimeout(()=>{this.notifyPointerMoved(this._lastPointerMovePosition),this._pointerMovedNotificationTimeout=void 0},U.pointerMovedNotificationDelay))}notifyPointerMoved(E){const k={position:E};this.emit(n.PointerMovedEvent,k)}notifyStrokesAdded(...E){E.length>0&&this.emit(n.StrokesAddedEvent,E)}notifyStrokesRemoved(...E){E.length>0&&this.emit(n.StrokesRemovedEvent,E)}notifyClear(){this.emit(n.ClearEvent)}notifyBeginStroke(E){const k={strokeId:E.id,brush:E.brush,startPoint:E.getPointAt(0),type:E.type,mode:E.mode};this.emit(n.BeginStrokeEvent,k)}notifyAddPoints(E,...k){const z={strokeId:E,points:k};this.emit(n.AddPointsEvent,z)}notifyEndStroke(E,k,z=!1){const K={strokeId:E,points:k?[k]:[],endState:z?f.cancelled:f.ended};this.emit(n.AddPointsEvent,K)}createInputFilterCollection(E){const k=new s.InputFilterCollection;return E?k.addFilters(...E):k.addFilters(new s.JitterFilter),k.addFilters(new U.ScreenToViewportCoordinateTransform(this)),k}constructor(E){super(),this._penBrush=Object.assign({},o.DefaultPenBrush),this._lineBrush=Object.assign({},o.DefaultLineBrush),this._highlighterBrush=Object.assign({},o.DefaultHighlighterBrush),this._laserPointerBrush=Object.assign({},o.DefaultLaserPointerBrush),this._tool=d.pen,this._strokes=new Map,this._pendingPointErasePoints=[],this._changeLog=new m,this._isUpdating=!1,this._referencePoint="center",this._offset={x:0,y:0},this._scale=1,this._ephemeralCanvases=new Map,this.onHostResized=(k,z)=>{if(this._clientWidth=void 0,this._clientHeight=void 0,this._centerX=void 0,this._centerY=void 0,k.length>=1){const K=k[0];this._canvasPoolHost.style.width=K.contentRect.width+"px",this._canvasPoolHost.style.height=K.contentRect.height+"px",this._dryCanvas.resize(K.contentRect.width,K.contentRect.height),this.reRender()}},this.onPointerDown=k=>{this._inputFilters.reset(k);const z=this._inputFilters.filterPoint(k);switch(this.cancelCurrentStroke(z),this.tool){case d.pen:case d.line:case d.highlighter:case d.laserPointer:const K=this.tool===d.line||k.ctrlKey&&U.enableStrokeModifierHotKeys?i.StrokeMode.line:i.StrokeMode.freeHand,ie=Object.assign({},this.getBrushForTool(this.tool));k.altKey&&U.enableStrokeModifierHotKeys&&(ie.endArrow="open"),this._currentStroke=this.beginWetStroke(this.tool===d.laserPointer?i.StrokeType.ephemeral:i.StrokeType.persistent,K,z,{brush:ie}),this.notifyBeginStroke(this._currentStroke);break;case d.eraser:this.erase(z);break;case d.pointEraser:this._pendingPointErasePoints.push(z),this.schedulePointEraseProcessing();break}},this.onPointerMove=k=>{if(k.isPointerDown){let z=this._inputFilters.filterPoint(k);if(this._currentStroke)k.shiftKey&&U.enableStrokeModifierHotKeys&&(z=this._currentStroke.straighten(z)),this._currentStroke.addPoints(z),this.notifyAddPoints(this._currentStroke.id,z);else switch(this.tool){case d.eraser:this.erase(z),this.queuePointerMovedNotification(z);break;case d.pointEraser:this._pendingPointErasePoints.push(z),this.queuePointerMovedNotification(z),this.schedulePointEraseProcessing();break}}else if(this.tool===d.laserPointer)if(this._currentStroke===void 0){this._inputFilters.reset(k);const z=this._inputFilters.filterPoint(k);this._currentStroke=this.beginWetStroke(i.StrokeType.laserPointer,i.StrokeMode.freeHand,z,{brush:this.getBrushForTool(this.tool)}),this.notifyBeginStroke(this._currentStroke)}else{const z=this._inputFilters.filterPoint(k);this._currentStroke.addPoints(z),this.notifyAddPoints(this._currentStroke.id,z)}else{const z=this._inputFilters.filterPoint(k);this.queuePointerMovedNotification(z)}},this.onPointerUp=k=>{let z=this._inputFilters.filterPoint(k);this._currentStroke&&(k.shiftKey&&U.enableStrokeModifierHotKeys&&(z=this._currentStroke.straighten(z)),this._currentStroke.addPoints(z),this._currentStroke.end(),this.notifyEndStroke(this._currentStroke.id,z),this._currentStroke=void 0),this.flushChangeLog()},this.onPointerLeave=k=>{if(this.tool===d.laserPointer){const z=this._inputFilters.filterPoint(k);this.cancelCurrentStroke(z)}else this.queuePointerMovedNotification()},this.wetStrokeEnded=(k,z)=>{var K;if(!z)if(k.type===i.StrokeType.ephemeral){const ie=(K=k.clientId)!==null&&K!==void 0?K:U.localClientId;let he=this._ephemeralCanvases.get(ie);he||(he=new g(ie,this._canvasPoolHost),he.offset=this.offset,he.scale=this.scale,this._ephemeralCanvases.set(ie,he)),he.renderStroke(k),he.scheduleRemoval(pe=>{this._ephemeralCanvases.delete(pe.clientId)})}else k.type===i.StrokeType.persistent&&this.internalAddStroke(k)},this.eraserSize=20,this._inputFilters=this.createInputFilterCollection(),this._hostElement=E,this._dryCanvas=new t.DryCanvas(this._hostElement),this._canvasPoolHost=document.createElement("div"),this._canvasPoolHost.style.position="absolute",this._canvasPoolHost.style.pointerEvents="none",this._hostElement.appendChild(this._canvasPoolHost),this.inputProvider=new s.PointerInputProvider(this._dryCanvas.canvas),this._hostResizeObserver=new ResizeObserver(this.onHostResized),this._hostResizeObserver.observe(this._hostElement)}setInputFilters(E){this._inputFilters=this.createInputFilterCollection(E)}beginUpdate(){this._isUpdating=!0}endUpdate(){this._isUpdating&&(this._isUpdating=!1,this.flushChangeLog())}activate(){this._inputProvider.activate()}deactivate(){this._inputProvider.deactivate()}clear(){this._strokes.clear(),this.scheduleReRender(),this.notifyClear()}exportRaw(){const E=[];return this._strokes.forEach(k=>{E.push({points:k.getAllPoints(),brush:Object.assign({},k.brush)})}),E}exportSVG(){let E="",k,z=0;this._strokes.forEach(ie=>{const he=ie.getBoundingRect();k=k?(0,r.combineRects)(k,he):he,ie.brush.tipSize>z&&(z=ie.brush.tipSize);const pe=(0,u.computeQuadPath)(ie.getAllPoints(),0,ie.brush.tip,ie.brush.tipSize);let X=(0,u.renderQuadPathToSVG)(pe,ie.brush.tip,ie.brush.color);ie.brush.type==="highlighter"&&(X=`<g opacity="${t.InkingCanvas.highlighterOpacity}">${X}</g>`),E+=X});let K="";if(k){const ie=z/2;k.left-=ie,k.top-=ie;const he=k.right-k.left+z,pe=k.bottom-k.top+z;K=`viewBox="${k.left} ${k.top} ${he} ${pe}"`}return`<svg ${K} xmlns="http://www.w3.org/2000/svg">${E}</svg>`}importRaw(E){for(const k of E){const z=new i.Stroke({brush:k.brush,points:k.points,clientId:U.localClientId});this.addStroke(z)}}beginWetStroke(E,k,z,K){const ie=E===i.StrokeType.laserPointer?new t.LaserPointerCanvas(this._canvasPoolHost):new t.WetCanvas(this._canvasPoolHost);ie.resize(this.clientWidth,this.clientHeight),ie.offset=this.offset,ie.scale=this.scale,ie.referencePoint=this.referencePoint;let he;return k===i.StrokeMode.line?he=new M(ie,E,k,K):he=new D(ie,E,k,K),he.onStrokeEnded=this.wetStrokeEnded,he.addPoints(z),he}getStroke(E){return this._strokes.get(E)}addStroke(E,k){this.internalAddStroke(E,k),this._isUpdating||this.flushChangeLog()}removeStroke(E,k){var z,K;if(this._strokes.delete(E)){const ie={forceReRender:k&&(z=k.forceReRender)!==null&&z!==void 0?z:!1,addToChangeLog:k&&(K=k.addToChangeLog)!==null&&K!==void 0?K:!0};ie.forceReRender?this.reRender():this.scheduleReRender(),ie.addToChangeLog&&this._changeLog.removeStroke(E),this._isUpdating||this.flushChangeLog()}}erase(E){this.internalErase(E),this._isUpdating||this.flushChangeLog()}pointErase(E){this.internalPointErase(E),this._isUpdating||this.flushChangeLog()}screenToViewport(E){return(0,r.screenToViewport)(E,this.referencePoint==="center"?{x:this.centerX,y:this.centerY}:{x:0,y:0},this.offset,this.scale)}viewportToScreen(E){return(0,r.viewportToScreen)(E,this.referencePoint==="center"?{x:this.centerX,y:this.centerY}:{x:0,y:0},this.offset,this.scale)}get hostElement(){return this._hostElement}get penBrush(){return this._penBrush}set penBrush(E){this._penBrush=Object.assign({},E)}get lineBrush(){return this._lineBrush}set lineBrush(E){this._lineBrush=Object.assign({},E)}get highlighterBrush(){return this._highlighterBrush}set highlighterBrush(E){this._highlighterBrush=Object.assign({},E)}get laserPointerBrush(){return this._laserPointerBrush}set laserPointerBrush(E){this._laserPointerBrush=Object.assign({},E)}get clientWidth(){return this._clientWidth||(this._clientWidth=this._hostElement.clientWidth),this._clientWidth}get clientHeight(){return this._clientHeight||(this._clientHeight=this._hostElement.clientHeight),this._clientHeight}get centerX(){return this._centerX||(this._centerX=this.clientWidth*.5),this._centerX}get centerY(){return this._centerY||(this._centerY=this.clientHeight*.5),this._centerY}get inputProvider(){return this._inputProvider}set inputProvider(E){if(this._inputProvider!==E){let k=!1;this._inputProvider&&(k=this._inputProvider.isActive,this._inputProvider.deactivate(),this._inputProvider.pointerDown.off(this.onPointerDown),this._inputProvider.pointerMove.off(this.onPointerMove),this._inputProvider.pointerUp.off(this.onPointerUp),this._inputProvider.pointerLeave.off(this.onPointerLeave)),this._inputProvider=E,this._inputProvider&&(this._inputProvider.pointerDown.on(this.onPointerDown),this._inputProvider.pointerMove.on(this.onPointerMove),this._inputProvider.pointerUp.on(this.onPointerUp),this._inputProvider.pointerLeave.on(this.onPointerLeave),k&&this._inputProvider.activate())}}get tool(){return this._tool}set tool(E){this._tool!==E&&(this._currentStroke!==void 0&&this._currentStroke.cancel(),this._tool=E)}get referencePoint(){return this._referencePoint}set referencePoint(E){this._referencePoint!==E&&(this._referencePoint=E,this._dryCanvas.referencePoint=E,this.reRender())}get offset(){return this._offset}set offset(E){this._offset!=E&&(this._offset=Object.assign({},E),this.reRender())}get scale(){return this._scale}set scale(E){this._scale!==E&&E>0&&(this._scale=E,this.reRender())}get viewPort(){const E=this.screenToViewport({x:0,y:0}),k=this.screenToViewport({x:this.clientWidth,y:this.clientHeight});return{left:E.x,top:E.y,right:k.x,bottom:k.y}}}U.pointerMovedNotificationDelay=15,U.pointEraserProcessingInterval=30,U.changeLogFlushInterval=60,U.localClientId=(0,u.generateUniqueId)(),U.ephemeralCanvasRemovalDelay=1500,U.enableStrokeModifierHotKeys=!0,U.ScreenToViewportCoordinateTransform=class extends s.InputFilter{constructor(j){super(),this._owner=j}filterPoint(j){return Object.assign(Object.assign({},this._owner.screenToViewport(j)),{pressure:j.pressure})}},n.InkingManager=U}(w1)),w1}var Aa={};const lie=Li(vK);var EI;function cie(){if(EI)return Aa;EI=1;var n=Ne&&Ne.__awaiter||function(M,U,j,E){function k(z){return z instanceof j?z:new j(function(K){K(z)})}return new(j||(j=Promise))(function(z,K){function ie(X){try{pe(E.next(X))}catch(fe){K(fe)}}function he(X){try{pe(E.throw(X))}catch(fe){K(fe)}}function pe(X){X.done?z(X.value):k(X.value).then(ie,he)}pe((E=E.apply(M,U||[])).next())})};Object.defineProperty(Aa,"__esModule",{value:!0}),Aa.LiveCanvas=Aa.LiveCursor=void 0;const e=Cc,t=lie,r=yD(),i=xn,s=ME(),o=Nm,u=DE(),d=_c();var f;(function(M){M.pointerMove="PointerMove",M.beginWetStroke="BeginWetStroke",M.addWetStrokePoints="AddWetStrokePoint"})(f||(f={}));class m{process(){if(this.type!==s.StrokeType.persistent)return;let U=0;for(;U+2<this._points.length;){const j=this._points[U],E=this._points[U+1],k=this._points[U+2],z=(0,i.getDistanceBetweenPoints)(j,E),K=(0,i.getDistanceBetweenPoints)(E,k),ie=(0,i.getDistanceBetweenPoints)(j,k);(z+K)*(100/ie)<this.simplificationThreshold?this._points.splice(U+1,1):U++}}constructor(U,j,E,k){this.id=U,this.type=j,this.brush=E,this.simplificationThreshold=k,this._points=[]}get points(){return this._points}clear(){this._points=[]}scheduleProcessing(U){this._processTimeout===void 0&&(this._processTimeout=window.setTimeout(()=>{this.process(),this._processTimeout=void 0,U(this)},m.wetStrokeEventsStreamDelay))}}m.wetStrokeEventsStreamDelay=60;class g{constructor(U,j){this.clientId=U,this._lastUpdated=Date.now(),this._userInfo=j}setPosition(U){this._lastUpdated=Date.now(),this.renderedElement&&(this.renderedElement.style.left=U.x+"px",this.renderedElement.style.top=U.y+"px")}set userInfo(U){this._userInfo=U}get userInfo(){return this._userInfo}get idleTime(){return Date.now()-this._lastUpdated}get renderedElement(){return this._renderedElement||(this._renderedElement=this.internalRender()),this._renderedElement}}Aa.LiveCursor=g;class P extends g{internalRender(){const U=[{x:0,y:0},{x:10,y:30},{x:17,y:17},{x:30,y:10}];if(!this._arrowPathData||!this._arrowBounds){this._arrowPathData="",this._arrowBounds={left:Number.MAX_VALUE,top:Number.MAX_VALUE,right:Number.MIN_VALUE,bottom:Number.MIN_VALUE};for(let fe=0;fe<U.length;fe++){const ge=U[fe];this._arrowBounds=(0,i.expandRect)(this._arrowBounds,ge),this._arrowPathData+=`${fe===0?"M":"L"} ${ge.x} ${ge.y} `}this._arrowPathData+="Z"}const j=this._arrowBounds.right-this._arrowBounds.left,E=this._arrowBounds.bottom-this._arrowBounds.top,k=10,z=(0,u.toCssRgbaColor)(this._color.textColor),K=(0,u.toCssRgbaColor)((0,u.lightenColor)(this._color.backgroundColor,80)),ie=(0,u.toCssRgbaColor)(this._color.backgroundColor);let he=`
            <svg viewbox="-${k} -${k} ${2*k+j} ${2*k+E}"
                width="${j}" height="${E}" style="filter: drop-shadow(0px 0px 1px rgba(0, 0, 0, .7)">
                <path d="${this._arrowPathData}" stroke="${K}" stroke-width="10" stroke-linejoin="round" stroke-opacity="0.90"/>
                <path d="${this._arrowPathData}" fill="${ie}" stroke="${ie}" stroke-width="2" stroke-linejoin="round"/>
            </svg>`;this.userInfo&&(this.userInfo.displayName&&!this.userInfo.pictureUri?he+=`
                    <div style="display: flex; align-items: center; box-shadow: 0 0 2px black; background-color: ${ie};
                        height: ${E}px; color: ${z}; border-radius: ${E/2}px / 50%;
                        border-top-left-radius: 4px; padding: 2px 8px; margin: ${E*.75}px 0 0 -${j*.25}px;
                        white-space: nowrap; font-size: 12px; font-family: sans-serif">
                        ${this.userInfo.displayName}
                    </div>`:this.userInfo.pictureUri&&!this.userInfo.displayName?he+=`
                    <img src="${this.userInfo.pictureUri}" style="width: ${E*1.1}px; height: ${E*1.1}px;
                        border-radius: 50%; box-shadow: 0 0 2px black;
                        margin: ${E*.75}px 0 0 -${j*.25}px;">`:this.userInfo.pictureUri&&this.userInfo.displayName&&(he+=`
                    <div style="display: flex; flex-direction: row; align-items: center; background-color: ${ie}; color: ${z};
                        border-radius: ${E/2}px / 50%; margin: ${E*.75}px 0 0 -${j*.25}px;
                        padding: 2px; white-space: nowrap; font-size: 12px; font-family: sans-serif; box-shadow: 0 0 2px black">
                        <img src="${this.userInfo.pictureUri}" style="width: ${E*1.1}px; height: ${E*1.1}px; border-radius: 50%;">
                        <div style="padding: 0 8px">${this.userInfo.displayName}</div>
                    </div>`));const pe=document.createElement("template");pe.innerHTML=he;const X=document.createElement("div");return X.style.position="absolute",X.style.display="flex",X.style.flexDirection="row",X.appendChild(pe.content.cloneNode(!0)),X}constructor(U,j){super(U,j),this.clientId=U,this._color=P.cursorColors[P.currentColorIndex],P.currentColorIndex++,P.currentColorIndex>=P.cursorColors.length&&(P.currentColorIndex=0)}}P.cursorColors=[{backgroundColor:u.BasicColors.red,textColor:u.BasicColors.white},{backgroundColor:u.BasicColors.green,textColor:u.BasicColors.white},{backgroundColor:u.BasicColors.blue,textColor:u.BasicColors.white},{backgroundColor:u.BasicColors.purple,textColor:u.BasicColors.white},{backgroundColor:u.BasicColors.magenta,textColor:u.BasicColors.white},{backgroundColor:u.BasicColors.violet,textColor:u.BasicColors.white},{backgroundColor:u.BasicColors.gray,textColor:u.BasicColors.white},{backgroundColor:u.BasicColors.silver,textColor:u.BasicColors.black}],P.currentColorIndex=0;let D=class Po extends o.LiveDataObject{constructor(){super(...arguments),this._processingIncomingChanges=!1,this._wetStrokes=new Map,this._pendingLiveStrokes=new Map,this._liveCursorsMap=new Map,this._isCursorShared=!1,this.liveStrokeProcessed=U=>{this.onLocalUserAllowed(()=>n(this,void 0,void 0,function*(){var j;try{yield this._addWetStrokePointEventTarget.sendEvent({isCursorShared:this.isCursorShared?!0:void 0,strokeId:U.id,points:U.points,endState:U.endState})}catch(E){(j=this._logger)===null||j===void 0||j.sendErrorEvent(d.TelemetryEvents.LiveCanvas.AddWetStrokeEventError,E)}U.clear()}))}}getLocalUserPictureUrl(){return this.onGetLocalUserPictureUrl?this.onGetLocalUserPictureUrl():void 0}setupWetInkProcessing(){this._inkingManager&&(this._inkingManager.on(r.PointerMovedEvent,j=>{this.isCursorShared&&this.onLocalUserAllowed(()=>n(this,void 0,void 0,function*(){var E;try{this._pointerMovedEventTarget.sendEvent({position:j.position,pictureUri:this.getLocalUserPictureUrl()})}catch(k){(E=this._logger)===null||E===void 0||E.sendErrorEvent(d.TelemetryEvents.LiveCanvas.PointerMovedEventError,k)}}))}),this._inkingManager.on(r.BeginStrokeEvent,j=>{const E=new m(j.strokeId,j.type,j.brush,Po.wetStrokePointSimplificationThreshold);E.points.push(j.startPoint),this._pendingLiveStrokes.set(E.id,E),this.onLocalUserAllowed(()=>n(this,void 0,void 0,function*(){var k;try{this._beginWetStrokeEventTarget.sendEvent(Object.assign({isCursorShared:this.isCursorShared?!0:void 0,pictureUri:this.getLocalUserPictureUrl()},j))}catch(z){(k=this._logger)===null||k===void 0||k.sendErrorEvent(d.TelemetryEvents.LiveCanvas.BeginWetStrokeError,z)}}))}),this._inkingManager.on(r.AddPointsEvent,j=>{const E=this._pendingLiveStrokes.get(j.strokeId);E!==void 0&&(!j.endState&&j.points.length>0&&E.points.push(...j.points),E.endState=j.endState,j.endState&&this._pendingLiveStrokes.delete(j.strokeId),j.points.length>0&&E.scheduleProcessing(this.liveStrokeProcessed))}));const U=new o.LiveEventScope(this.runtime,this.liveRuntime,this.allowedRoles);this._pointerMovedEventTarget=new o.LiveEventTarget(U,f.pointerMove,(j,E)=>{!E&&j.clientId&&this.updateCursorPosition(j.clientId,{pictureUri:j.data.pictureUri},j.data.position)}),this._beginWetStrokeEventTarget=new o.LiveEventTarget(U,f.beginWetStroke,(j,E)=>{if(!E&&this._inkingManager){const k=this._inkingManager.beginWetStroke(j.data.type,j.data.mode,j.data.startPoint,{id:j.data.strokeId,clientId:j.clientId,timeStamp:j.timestamp,brush:j.data.brush});this._wetStrokes.set(j.data.strokeId,k),j.clientId&&(j.data.type!==s.StrokeType.persistent||!j.data.isCursorShared?this.removeCursor(j.clientId):this.updateCursorPosition(j.clientId,{pictureUri:j.data.pictureUri},j.data.startPoint))}}),this._addWetStrokePointEventTarget=new o.LiveEventTarget(U,f.addWetStrokePoints,(j,E)=>{if(!E){const k=this._wetStrokes.get(j.data.strokeId);k&&(k.addPoints(...j.data.points),j.data.endState===r.StrokeEndState.cancelled?k.cancel():j.data.endState===r.StrokeEndState.ended&&k.type===s.StrokeType.ephemeral&&k.end(),j.clientId&&(k.type!==s.StrokeType.persistent||j.data.endState||!j.data.isCursorShared?this.removeCursor(j.clientId):this.updateCursorPosition(j.clientId,{pictureUri:j.data.pictureUri},j.data.points[j.data.points.length-1])))}})}setupStorageProcessing(){if(this._inkingManager){const U=this._inkingManager;this._dryInkMap.forEach(j=>{const E=new s.Stroke;E.deserialize(j),U.addStroke(E)}),this._dryInkMap.on("valueChanged",(j,E)=>{var k;this._processingIncomingChanges=!0;try{if(!E){const z=this._dryInkMap.get(j.key),K={forceReRender:!0,addToChangeLog:!1};if(z!==void 0){const ie=(k=U.getStroke(j.key))!==null&&k!==void 0?k:new s.Stroke;ie.deserialize(z);const he=this._wetStrokes.get(ie.id);he&&(he.cancel(),this._wetStrokes.delete(he.id)),U.addStroke(ie,K)}else U.removeStroke(j.key,K)}}finally{this._processingIncomingChanges=!1}}),this._dryInkMap.on("op",(j,E)=>{this._processingIncomingChanges=!0;try{E||j.contents.type==="clear"&&U.clear()}finally{this._processingIncomingChanges=!1}}),U.on(r.StrokesAddedEvent,j=>{if(!this._processingIncomingChanges)for(let E of j)this._dryInkMap.set(E.id,E.serialize())}),U.on(r.StrokesRemovedEvent,j=>{if(!this._processingIncomingChanges)for(let E of j)this._dryInkMap.delete(E)}),U.on(r.ClearEvent,()=>{this._processingIncomingChanges||this._dryInkMap.clear()})}}sweepLiveCursors(){const U=[];this._liveCursorsMap.forEach(j=>{j.idleTime>Po.liveCursorIdleLifetime&&U.push(j.clientId)});for(let j of U)this.removeCursor(j)}scheduleLiveCursorSweep(){this._liveCursorSweepTimeout===void 0&&(this._liveCursorSweepTimeout=window.setTimeout(()=>{this._liveCursorSweepTimeout=void 0,this.sweepLiveCursors(),this._liveCursorsMap.size>0&&this.scheduleLiveCursorSweep()},Po.liveCursorSweepFrequency))}getCursor(U,j){let E=this._liveCursorsMap.get(U);return E?j!=null&&j.displayName&&(E.userInfo=j):(E=this.onCreateLiveCursor?this.onCreateLiveCursor(U,j):new P(U,j),this._liveCursorsMap.set(U,E)),this._liveCursorsHost.contains(E.renderedElement)||this._liveCursorsHost.appendChild(E.renderedElement),this.scheduleLiveCursorSweep(),E}removeCursor(U){const j=this._liveCursorsMap.get(U);j&&this._liveCursorsHost.contains(j.renderedElement)&&this._liveCursorsHost.removeChild(j.renderedElement)}updateCursorPosition(U,j,E){E?this.liveRuntime.getClientInfo(U).then(k=>{if(this._inkingManager){const z={displayName:k==null?void 0:k.displayName,pictureUri:j==null?void 0:j.pictureUri},K=this.getCursor(U,z),ie=this._inkingManager.viewportToScreen(E);K.setPosition(ie)}}):this.removeCursor(U)}initializingFirstTime(){return n(this,void 0,void 0,function*(){this._dryInkMap=t.SharedMap.create(this.runtime,Po.dryInkMapKey),this.root.set(Po.dryInkMapKey,this._dryInkMap.handle)})}hasInitialized(){return n(this,void 0,void 0,function*(){const U=this.root.get(Po.dryInkMapKey);if(U)this._dryInkMap=yield U.get();else throw new Error(`Unable to get SharedMap with key "${Po.dryInkMapKey}"`)})}initialize(U,j){return n(this,void 0,void 0,function*(){this._inkingManager=U,j&&(this._allowedRoles=j),this._logger=new o.LiveTelemetryLogger(this.runtime,this.liveRuntime),this.setupStorageProcessing(),this.setupWetInkProcessing(),this._liveCursorsHost=document.createElement("div"),this._liveCursorsHost.style.position="absolute",this._liveCursorsHost.style.pointerEvents="none",this._liveCursorsHost.style.width="100%",this._liveCursorsHost.style.height="100%",this._liveCursorsHost.style.overflow="hidden",U.hostElement.appendChild(this._liveCursorsHost)})}get isCursorShared(){return this._isCursorShared}set isCursorShared(U){this._isCursorShared!==U&&(this._isCursorShared=U,this._isCursorShared||this.onLocalUserAllowed(()=>n(this,void 0,void 0,function*(){var j;try{yield this._pointerMovedEventTarget.sendEvent({})}catch(E){(j=this._logger)===null||j===void 0||j.sendErrorEvent(d.TelemetryEvents.LiveCanvas.PointerMovedEventError,E)}})))}get allowedRoles(){return this._allowedRoles}set allowedRoles(U){this._allowedRoles=U,this.setupWetInkProcessing()}};return D.dryInkMapKey="dryInk",D.wetStrokePointSimplificationThreshold=100.05,D.liveCursorSweepFrequency=1e3,D.liveCursorIdleLifetime=5e3,D.TypeName="@microsoft/shared-inking-session",D.factory=new e.DataObjectFactory(D.TypeName,D,[],{}),Aa.LiveCanvas=D,o.DynamicObjectRegistry.registerObjectClass(D,D.TypeName),Aa}var TI;function Uv(){return TI||(TI=1,function(n){var e=Ne&&Ne.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var u=Object.getOwnPropertyDescriptor(i,s);(!u||("get"in u?!i.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,u)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=Ne&&Ne.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(LE(),n),t(DE(),n),t(xn,n),t(yD(),n),t(cie(),n),t(ME(),n)}(y1)),y1}(function(n){var e=Ne&&Ne.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var u=Object.getOwnPropertyDescriptor(i,s);(!u||("get"in u?!i.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,u)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=Ne&&Ne.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(Uv(),n),t(vD(),n),t(BE,n)})(Zs);const die=(n,e)=>{const t=$t.useRef(!1),[r,i]=$t.useState(void 0),[s,o]=$t.useState(void 0),u=$t.useCallback(async()=>{if(!(!n||!e||t.current)){t.current=!0;try{const d=e,f=new Zs.InkingManager(d);await n.initialize(f),f.activate(),i(f)}catch(d){console.error(d),o(d)}}},[n,e]);return $t.useEffect(()=>{u()},[u]),{inkingManager:r,error:s}},hie={initialObjects:{liveCanvas:Zs.LiveCanvas}},fie=()=>{const[n,e]=$t.useState(void 0),t=$t.useRef(),{inkingManager:r}=die(n,t.current),i=$t.useCallback(()=>{r&&(r.tool=Zs.InkingTool.pen)},[r]),s=$t.useCallback(()=>{r&&(r.tool=Zs.InkingTool.laserPointer)},[r]),o=$t.useCallback(()=>{r&&(r.tool=Zs.InkingTool.highlighter)},[r]),u=$t.useCallback(()=>{r&&(r.tool=Zs.InkingTool.pointEraser)},[r]),d=$t.useCallback(()=>{r&&(r.penBrush.color={r:0,g:0,b:0})},[r]),f=$t.useCallback(()=>{r&&(r.penBrush.color={r:0,g:0,b:255,a:1})},[r]),m=$t.useCallback(()=>{r&&(r.penBrush.color={r:255,g:0,b:0})},[r]),g=$t.useCallback(()=>{r&&r.clear()},[r]),P=$t.useCallback(()=>{r&&(r.tool=Zs.InkingTool.line,r.lineBrush.endArrow="none")},[r]),D=$t.useCallback(()=>{r&&(r.tool=Zs.InkingTool.line,r.lineBrush.endArrow="open")},[r]);function M(j){if(j.data&&j.data.action)switch(j.data.action){case"setToLine":document.getElementById("Line").click();break;case"setToArrow":document.getElementById("Arrow").click();break;case"setToHighlighter":document.getElementById("Highlighter").click();break;case"setToEraser":document.getElementById("Eraser").click();break;default:console.warn("Unknown action received:",j.data.action)}}const U=async()=>{const j=new Nm.LiveShareClient(Nm.TestLiveShareHost.create()),{container:E}=await j.joinContainer(hie);e(E.initialObjects.liveCanvas),window.addEventListener("message",M,!1)};return $t.useEffect(()=>{U()},[]),$E($D,{children:[Gn("div",{id:"inkingRoot",children:Gn("div",{id:"inkingHost",ref:t})}),$E("div",{style:{display:"none"},children:[Gn("button",{onClick:g,children:"Clear"}),Gn("button",{id:"Eraser",onClick:u,children:"Eraser"}),Gn("button",{onClick:i,children:"Pen"}),Gn("button",{id:"Highlighter",onClick:o,children:"Highlighter"}),Gn("button",{onClick:s,children:"Laser Pointer"}),Gn("button",{onClick:f,children:"Blue brush"}),Gn("button",{onClick:d,children:"Black brush"}),Gn("button",{onClick:m,children:"Red brush"}),Gn("button",{id:"Line",onClick:P,children:"Enable Line"}),Gn("br",{}),Gn("button",{id:"Arrow",onClick:D,children:"Enable Arrow"}),Gn("br",{})]})]})};function E1(){return!!(window.location.href.includes("/#/")?new URL(`${window.location.href.split("/#/").join("/")}`):new URL(window.location)).searchParams.get("inTeams")}function pie(){const n=$t.useRef(!1),[e,t]=$t.useState(!1);return $t.useEffect(()=>{if(n.current)return;n.current=!0;const i=async()=>{try{console.log("App.js: initializing client SDK initialized"),await Ty.app.initialize(),Ty.app.notifyAppLoaded(),Ty.app.notifySuccess(),t(!0)}catch(s){console.error(s)}};E1()&&(console.log("App.js: initializing client SDK"),i())}),(E1()&&e||!E1())&&Gn(fie,{})}const mie=document.getElementById("root"),gie=jk(mie);gie.render(Gn(LD.StrictMode,{children:Gn(pie,{})}));export{VC as b,Ms as g};
